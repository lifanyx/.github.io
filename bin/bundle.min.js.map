{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/ismobilejs/isMobile.js","bundle.min.js","src/Application.js","src/Common.js","src/CommonGame.js","src/Main.js","src/SavedData.js","src/game/Brush.js","src/game/Canvas.js","src/game/ColourBrush.js","src/game/ColourPencil.js","src/game/DrawLayer.js","src/game/Eraser.js","src/game/FillLayer.js","src/game/HUD.js","src/game/InkPot.js","src/game/MagicBrush.js","src/game/MagicPencil.js","src/game/MyGame.js","src/game/PaletteButton.js","src/game/Pencil.js","src/game/Spray.js","src/game/Stamp.js","src/game/Tutorial.js","src/game/UndoManager.js","src/src/index.js","src/src/node_modules/browser-pack/_prelude.js","src/src/pixi-multistyle-text.ts","src/scenes/GallerySelectionScene.js","src/scenes/GameScene.js","src/scenes/ImageSelectionScene.js","src/scenes/MainScene.js","src/scenes/PreloaderScene.js","src/scenes/SimpleScene.js","src/shaders/OutlineFilter.js","src/ui/UICarousel.js","src/ui/UITopBarSharedControls.js","src/ui/overlays/ConfirmationPanel.js","src/ui/overlays/MenuPanel.js","src/ui/overlays/PalettePanel.js","src/ui/overlays/TrashConfirmationPanel.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","global","apple_phone","apple_ipod","apple_tablet","android_phone","android_tablet","amazon_phone","amazon_tablet","windows_phone","windows_tablet","other_blackberry","other_blackberry_10","other_opera","other_chrome","other_firefox","seven_inch","RegExp","match","regex","userAgent","test","IsMobileClass","ua","navigator","tmp","split","this","apple","phone","ipod","tablet","device","amazon","android","windows","other","blackberry","blackberry10","opera","firefox","chrome","any","window","instantiate","IM","Class","define","amd","isMobile","2","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","Object","defineProperty","value","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","_Common","_Common2","_GallerySelectionScene","_GallerySelectionScene2","_ImageSelectionScene","_ImageSelectionScene2","_GameScene","_GameScene2","_MainScene","_MainScene2","_SavedData","_SavedData2","Application","assets","texture","bind","showMainScene","savedData","init","paused","scene","signals","next","add","showGallerySelectionScene","show","showGameScene","previous","showImageSelectionScene","home","./Common","./SavedData","./scenes/GallerySelectionScene","./scenes/GameScene","./scenes/ImageSelectionScene","./scenes/MainScene","3","Common","_typeof","Symbol","iterator","constructor","_Application","main","assetRes","themeIndex","killGlowSignal","Signal","toggleCurrentGlowSignal","buttonsAppear","arr","scale","set","TweenMax","to","x","y","ease","Back","easeOut","easeParams","delay","view","isWebGL","isFirstPlay","isDebug","isMute","game_key","audio","camera","PHYSICS_TICK","copy","config","language","STAGE_WIDTH","STAGE_HEIGHT","stage","renderer","saveMute","data","localStorage","setItem","JSON","stringify","loadMute","parse","getItem","mute","saveGame","gameData","highestScore","loadGame","shuffleString","string","j","Math","floor","random","join","shuffleArr","_ref","randomID","strLen","toString","substr","angle","x1","y1","x2","y2","dy","dx","atan2","distance","sqrt","deg2rad","deg","PI","rad2deg","rad","keyboard","keyCode","isDown","isUp","down","undefined","up","downHandler","event","preventDefault","upHandler","addEventListener","genTex","width","height","colour","shape","g","PIXI","Graphics","beginFill","drawRect","drawEllipse","endFill","generateTexture","generateRect","retTexture","lineStyle","sprite","Sprite","anchor","destroy","generateEllipse","centreAnchor","arguments","matrix","numRows","numCols","initial","columns","array","size","push","sort","highToLow","quickSort","first","last","swap","p","q","temp","partition","pivot","index","pivotIndex","sortTiles","b","sortBy","sortX","sortDistances","compareXY","point1","point2","round","lerpAxis","start","end","percent","lerpVector","Vector","sub","mult","div","scalePerc","lookAt","update","rotation","detectCircularRef","detectCircularReferences","toBeStringifiedValue","serializationKeyStack","keys","forEach","serializationKeyStackWithNewKey","slice","error","isCircularValue","circularExcludingStringifyResult","replaceRootStringifyReplacer","joinStrings","serializedObjectCounter","separator","reduce","v1","v2","pinchable","inertia","on","move","originalEvent","targetTouches","clientX","clientY","_pinch","date","Date","emit","now","interval","center","velocity","pp","removeListener","intervalId","setInterval","abs","clearInterval","updatedDistance","interactive","getAndroidVersion","toLowerCase","erraticTween","time","params","CustomEase","create","Dijkstra","_graph","_source","_target","_verts","_paths","_x4","vert","Number","POSITIVE_INFINITY","prev","neighbours","descending","paths","pop","v","sourceToV","pos","node","path","recurse","followPath","tWid","Power0","easeNone","onComplete","holder","Container","gridSize","graph","addChild","_x5","_sp","P3","createSprite","Texture","WHITE","tint","source","t0","performance","findPaths","t1","console","warn","retrievePathTo","log","sp","position","PathD","BreadthFirst","_openList","startNode","_x6","visited","reverse","endNode","unshift","edge","_x7","_sp2","find","PathBFS","randBool","toOneDecimalStr","result","toFixed","indexOf","randomInt","min","max","heapPermutations","arrElement","generate","permutations","getScreenPositionLeft","View","getScreenPositionRight","distanceBetween","pow","angleBetween","randomFloat","midPointBtw","p1","p2","hexToRgb","hex","exec","parseInt","findPositionInScene","Point","parent","./Application","4","CommonGame","SCENE_ID_MAIN","SCENE_ID_GAME","SCENE_ID_IMAGE_SELECTION","SCENE_ID_GALLERY_SELECTION","LAYER_ID_FILL","LAYER_ID_DRAW","GALLERY_ID_DRAW_IT","GALLERY_ID_COLOUR_IT","ARR_COLOUR_IT_SPRITE_ID","ARR_DRAW_IT_SPRITE_ID","TUT_EVENT","TOOL_BAR_HIDDEN","TOOL_BAR_VISIBLE","PALETTE_SELECTED","PALETTE_PANEL_HIDDEN","TOOL_SELECTED","CANVAS_DRAWN","CANVAS_VISIBLE","PALETTE_BUTTON_ENABLED","PALETTE_BUTTON_DISABLED","MENU_PANEL_SHOWN","MENU_PANEL_HIDDEN","TOOL","PENCIL","BRUSH","STAMP","BUCKET","INK_POT","SPRAY","ERASER","GALLERY_BORDER_TINT","TEXTURE_BUTTON_BASE_ID","TEXTURE_SPRITE_BASE_ID","CANVAS_HEIGHT","CANVAS_WIDTH","selectedGallery","selectedImageId","drawItTextId","createCanvasBg","SCALE_FACTOR","galleryKey","canvasTex","getTexture","canvasBg","drawRoundedRect","findColourCode","selection","pages","getJSON","palettePanel","itemIndex","5","simpleText","fontName","col","textView","Text","fontFamily","fontSize","fill","createText","override","jsonName","conf","str","font","align","padding","wordWrapWidth","wordWrap","stroke","strokeThickness","assign","letterSpacing","lineJoin","createMultiText","confCopy","realConfig","s0","s1","s2","s3","s4","s5","s6","s7","s8","s9","s10","s11","s12","s13","s14","s15","s16","s17","s18","s19","s20","s21","s22","s23","realCopy","copyArr","finalCopy","_pixiMultistyleText2","createButton","icon","type","buttonStates","ButtonStates","iconOver","iconDown","button","iconAlt","iconOverAlt","iconDownAlt","MuteButton","Button","Timestep","_Application2","_PreloaderScene","_PreloaderScene2","_ismobilejs","_ismobilejs2","_pixiMultistyleText","Main","_width","_height","_preloader","blankTexture","AssetManager","AudioManager","Device","name","json","hasTexture","bool","fromFrame","err","isPortrait","holderId","portrait","aspectRatioFillHeight","rotateImageUrl","rotateImageColor","settings","RETINA_PREFIX","defaultOverwrite","ticker","fps","ready","addOnce","canvas","options","transparent","antialias","preserveDrawingBuffer","resolution","screencanvas","document","onclick","focus","autoDetectRenderer","backgroundColor","WebGLRenderer","SceneManager","updateAll","shared","deltaTime","TARGET_FPMS","render","callback","scope","delayedCall","translate","strings","loadPreloader","resize","onCanvasResize","files","url","sounds","addFiles","complete","createConfig","loadAssets","load","addSounds","music","genericSfx","progress","onLoadingProgress","onLoadingCompleted","startGame","loaded","removeAll","finishedLoading","correct","./pixi-multistyle-text","./scenes/PreloaderScene","ismobilejs","6","SavedData","SAVE_NAME","SAVE_VERSION","SAVE_SEED","_isToolTutorial","_isDrawTutorial","_isPaletteTutorial","reset","save","isToolTutorial","isDrawTutorial","isPaletteTutorial","hash","md5","get","./CommonGame","7","Brush","_drawLayer","_magicBrush","_colourBrush","_paletteItem","_curBrush","_audio","_PalettePanel","_MagicBrush","_MagicBrush2","_ColourBrush","_ColourBrush2","drawLayer","game","onColourChanged","_onColour_Changed","_stopAudio","howl","stop","id","_draw","from","dynOutlineContext","beginPath","strokeStyle","lineWidth","LINE_THICKNESS","moveTo","lineTo","closePath","onDrawBegan","point","onDrawMoved","playSound","loop","killDelayedCallsTo","onDrawEnded","dynOutlineData","getImageData","WIDTH","HEIGHT","textureId","../Common","../ui/overlays/PalettePanel","./ColourBrush","./MagicBrush","8","Canvas","_fillLayer","_bgSprite","_borderSprite","_CommonGame2","_CommonGame","_MyGame","_FillLayer","_FillLayer2","_DrawLayer","_DrawLayer2","hud","onDrawModeChanged","_onDrawMode_Changed","animateIn","alpha","Sine","addTutorialEvent","onCompleteScope","clear","setEnabled","../CommonGame","./DrawLayer","./FillLayer","./MyGame","9","ColourBrush","_colour","dist","lastX","sin","lastY","cos","radGrad","context","createRadialGradient","rgbColour","addColorStop","fillStyle","fillRect","onContext_Changed","10","ColourPencil","11","DrawLayer","STATE","IDLE","DRAWING","_state","_canvas2d","_context","_dynOutline_c2d","_dynOutlineContext","_dynOutlineLayerData","_pencil","_brush","_spray","_stamp","_inkPot","_drawingTool","_eraser","_drawPS","_layerSprite","_lastInputLocalPosition","_updateInputLocalPosition","_Pencil","_Pencil2","_InkPot","_InkPot2","_Brush","_Brush2","_Spray","_Spray2","_Stamp","_Stamp2","_Eraser","_Eraser2","createElement","getContext","fillLayer","fromCanvas","mousedown","touchstart","_onDrawLayer_MouseDown","mousemove","touchmove","_onDrawLayer_MouseMove","mouseup","touchend","_onDrawLayer_MouseUp","mouseupoutside","touchendoutside","_onDrawLayer_MouseOut","isEnabled","setLayerData","putImageData","clearRect","mouseData","undoManager","localCoordsPosition","getLocalPosition","ctxCoordPosition","spawnPos","updateSpawnPos","resetPositionTracking","_onThickness_Changed","_thickness","BASE_LINE_THICKNESS","paletteItem","startColor","endColor","particles","Emitter","emitterLifetime","./Brush","./Eraser","./InkPot","./Pencil","./Spray","./Stamp","12","Eraser","_arrCanvasContext","_colourContext","_colourCodeContext","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","done","globalCompositeOperation","_lastPosition","plugins","interaction","mouse","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","restore","updateContextData","13","FillLayer","FILL_ANIM","_colour_c2d","_colourCode_c2d","_fillAnim_c2d","_fillAnimContext","_curColour","_outlineImage","Image","_fillAnimLayerData","_colourLayerData","_outlineLayerData","_colourCodeLayerData","_colourLayerSprite","_fillAnimLayerSprite","_outlineLayerSprite","_fillAnimMask","_lastInputGlobalPosition","_fillAnimRadius","_fillAnimMaxDeltaX","_fillAnimMaxDeltaY","_textureStartPixelPos","click","_onFillLayer_Click","mask","outlineTexture","fromImage","croppedOutlineTexture","Rectangle","setTexture","src","drawImage","colourCodeData","_fillAt","startX","startY","pixelIndex","colourCode","_floodFill","targetRadius","Linear","easeInOut","_updateFillAnimMask","onUpdate","onUpdateScope","newPos","reachLeft","reachRight","drawingBoundLeft","drawingBoundTop","drawingBoundRight","drawingBoundBottom","pixelStack","_isPixelToFill","_paintPixel","isTexture","textureY","textureX","basePixelPos","drawCircle","pageIndex","frame","baseTexture","14","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","setPrototypeOf","__proto__","_PaletteButton","_PaletteButton2","_OutlineFilter","_OutlineFilter2","HUD","_PIXI$Container","_this","getPrototypeOf","_leftBarContainer","_rightBarContainer","_leftBarSprite","_rightBarSprite","_menuBtn","_undoBtn","_lastToolBtn","_pencilButton","_brushButton","_bucketButton","_stampButton","_inkPotButton","_sprayButton","_eraserButton","_paletteButton","_drawItText","_palettePanel","_drawMode","onMenuClick","onPaletteClick","assert","buttonOffset","overSoundName","downSoundName","_onMenuButton_Click","btnStatesAux","_onUndoButton_Click","onClick","_onPaletteBtn_Click","setup","drawMode","defaultScale","STAGE_MIN_WIDTH","scaleFactor","_highlightToolBtn","onStackEmpty","_onUndoStack_Empty","onStackIncreased","_onUndoStack_Increased","_onPaletteSelection_Changed","onStampChanged","btn","filters","killTweensOf","animate","onCompleteParams","stopAnimations","yoyo","repeat","dispatch","undo","setInteractive","drawingTool","paletteType","../shaders/OutlineFilter","./PaletteButton","15","InkPot","MIN_RADIUS","MAX_RADIUS","globalAlpha","arc","lineCap","16","MagicBrush","_textureId","_createPattern","patternCanvas","ctx","createPattern","17","MagicPencil","18","_HUD","_HUD2","_UndoManager","_UndoManager2","_Canvas","_Canvas2","MyGame","_scene","_decoration","_hud","_canvas","_undoManager","_initDecoration","gameLayer","topFlowers","offset","botFlowers","Elastic","./Canvas","./HUD","./UndoManager","19","PaletteButton","_button","_selectionSprite","_shineOverlay","_type","blendMode","BLEND_MODES","ADD","toolType","visible","_currentNormalTexture","_currentOverTexture","_currentDownTexture","_background","substring","isInteractive","20","Pencil","_magicPencil","_colourPencil","_curPencil","_MagicPencil","_MagicPencil2","_ColourPencil","_ColourPencil2","./ColourPencil","./MagicPencil","21","Spray","DENSITY","PERIOD","RADIUS","_drawPosition","_drawColour","radius","22","Stamp","tools","stamp","_onStamp_Changed","23","Tutorial","DRAW","PALETTE","TUT_STEP_DELAY","_isPaused","_tutorialStepTimer","_tutorialHand","_arrEvent","_arrTutorialStep","state","isValid","isDone","onCompleted","spine","Spine","spineData","skeleton","setToSetupPose","setSkin","setSkinByName","autoUpdate","setAnimationByName","removeChild","_processEvents","tutorialStep","_showHand","getBrushBtnPosition","getPaletteBtnPosition","addEvent","tutorialEvent","_hideHand","_checkTutorialEnd","tm","eventCallback","24","UndoManager","MAX_STACK_SIZE","_arrLayerState","drawlayerData","drawDynOutlineData","fillLayerData","colourContext","fillColourCodeData","colourCodeContext","splice","layerState","25","_Main","_Main2","./Main","26","MultiStyleText","__extends","extendStatics","Array","d","hasOwnProperty","__","factory","_super","text","styles","textStyles","DEFAULT_TAG_STYLE","style","_style","TextStyle","dirty","setTagStyle","tag","deleteTagStyle","_getTextDataPerLine","lines","outputTextData","tags","re","styleStack","tagNameStack","lineTextData","matches","matchArray","createTextData","currentSearchIdx","getFontString","toFontString","tagName","fontProperties","getDropShadowPadding","maxDistance","maxBlur","styleKey","_a","dropShadowDistance","dropShadowBlur","updateText","outputText","lineWidths","lineYMins","lineYMaxs","maxLineWidth","lineYMin","lineYMax","sty","measureText","TextMetrics","measureFont","valign","descent","ascent","myValue","foo","map","cur","stylesArray","maxStrokeThickness","dropShadowPadding","totalHeight","textBaseline","basePositionY","drawingData","line","linePositionX","width_1","linePositionY","k","charAt","dropShadow","dropFillStyle","dropShadowColor","utils","hex2string","shadowColor","shadowBlur","shadowOffsetX","dropShadowAngle","shadowOffsetY","fillText","isArray","_generateFillStyle","strokeText","debugSpan","debug","debugOptions","spans","enabled","bounding","rect","baseline","top","bottom","objects","updateTexture","spaceLeft","words","parts","partWidth","breakWords","characters","c","characterWidth","paddedPartWidth","_texture","hasLoaded","realWidth","realHeight","trim","orig","_onTextureUpdate","destination","sources","_i","sources_1","fillGradientType","TEXT_GRADIENT","LINEAR_VERTICAL","fontStyle","fontVariant","fontWeight","lineHeight","miterLimit","27","_get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","getter","_SimpleScene2","_SimpleScene3","GallerySelectionScene","_SimpleScene","_colourItBtn","_drawItBtn","_colourItText","_titleSprite","_titleText","_colourItSprite","_drawItSprite","_onColourGalleryButton_Click","colourItTextConf","_onDrawGalleryButton_Click","stokeThickness","_uiTopBarSharedControls","muteBtn","backBtn","onBackBtn_Click","children","killAll","./SimpleScene","28","_MyGame2","_Tutorial","_Tutorial2","_MenuPanel","_MenuPanel2","_PalettePanel2","GameScene","_menuPanel","_tutorial","_gameLayer","_tutorialLayer","_overlayLayer","_onMenuBtn_Click","createSharedControls","stopMusic","playMusic","../game/MyGame","../game/PaletteButton","../game/Tutorial","../ui/overlays/MenuPanel","29","_UICarousel","_UICarousel2","ImageSelectionScene","ARR_DRAW_IT_TEXT_ID","ARR_IMAGE_SPRITE_ID","_imageLength","_playBtn","_prevImageBtn","_nextImageBtn","_uiCarousel","imagePrefix","arrCarouselItem","carouselItem","bgSprite","borderSprite","imageSprite","onIndexChanged","_onCarouselIndex_Changed","onItemSelected","_onPlayButton_Click","_onNextImageButton_Click","_onPrevImageButton_Click","_updateUI","selectedIndex","../ui/UICarousel","30","MainScene","31","PreloaderScene","_isPlayingAnim","_logoAnimation","_bar","_barOverlay","_text","_playButton","Scene","onAllLoaded","logoFrames","extras","MovieClip","animationSpeed","gotoAndStop","gotoAndPlay","_onPlayButtonClick","appear","animateOut","easeIn","isAndroid","screenfull","request","setTimeout","../Application","32","_UITopBarSharedControls","_UITopBarSharedControls2","SimpleScene","_P3$Scene","../ui/UITopBarSharedControls","33","OutlineFilter","thickness","color","Filter","replace","uniforms","outlineColor","Float32Array","rgb2hex","hex2rgb","34","UICarousel","PAGE_WIDTH","DEFAULT_ITEM_SCALE","UNSELECTED_ITEM_SCALE_DELTA","SELECTED_ITEM_EXIT_EASE_FACTOR","_pageContainer","_interactiveArea","_mask","_startX","_lastX","_currentX","_itemIndex","items","buttonMode","_onMouseDown","_onMouseUp","item","page","pageBg","_updateItemHiglighting","pageFactor","itemIndexAux","isTweening","_snap","newItemIndex","localPos","_onMouseMove","selectedItem","35","UITopBarSharedControls","_homeBtn","_muteBtn","_backBtn","_icon","_onHomeButton_Click","_onMuteButton_Click","_onBackButton_Click","application","loadScene","_currentIconTexture","36","ConfirmationPanel","_messageSprite","_messageText","_yesBtn","_noBtn","_selectedBtn","onYes","onNo","message","_hide","_onHidden","../../Common","../../CommonGame","37","_ConfirmationPanel","_ConfirmationPanel2","_TrashConfirmationPanel","_TrashConfirmationPanel2","MenuPanel","_gameSceneSignals","_quitBtn","_printBtn","_downloadBtn","_binBtn","_boxBorderSprite","_popupContainer","_drawingActionContainer","_bgGradientSprite","_confirmationPanel","_trashConfirmationPanel","EMPTY","bkText","_onQuitButton_Click","_onSoundButton_Click","btnOffset","menuPanel","printBtn","isVisible","_onPrintButton_Click","downloadBtn","_onDownloadButton_Click","binBtn","_onBinButton_Click","Quad","_this2","LEAVE_CONFIRMATION","_this3","extract","myWindow","open","body","appendChild","css","head","getElementsByTagName","media","styleSheet","cssText","createTextNode","print","close","_this4","BIN_CONFIRMATION","./ConfirmationPanel","./TrashConfirmationPanel","38","PalettePanel","ITEMS_PER_ROW","ITEMS_PER_PAGE","PALETTE_TOOLS","PALETTE_TYPE_TO_TOOL","pencil","brush","ink","spray","_panel","_boxSprite","_nextBtn","_prevBtn","_pageIndex","_pageCount","_arrBtnInfo","hide","_onNextButton_Click","_onPrevButton_Click","_findItems","_updateNavControls","_createItems","_removeItems","removeChildren","menuButton","menuBtn","PALETTE_PAGES","arrPageIndex","out","over","isShine","spriteId","arrBtnInfo","arrCurPageBtnInfo","btnIndex","colIndex","rowIndex","arcHeight","rowCount","ceil","startingX","_findItemCount","startingY","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","btnInfo","shineOverlay","btnCount","remainingBtnCount","_onPageIndex_Changed","39","_ConfirmationPanel3","TrashConfirmationPanel","_canvasContainer","_trashBgSprite","_trashFgSprite","contentSprite","repeatDelay","onRepeat","onRepeatScope","fromTo"],"mappings":"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","file":"bundle.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * isMobile.js v0.4.1\n *\n * A simple library to detect Apple phones and tablets,\n * Android phones and tablets, other mobile devices (like blackberry, mini-opera and windows phone),\n * and any kind of seven inch device, via user agent sniffing.\n *\n * @author: Kai Mallea (kmallea@gmail.com)\n *\n * @license: http://creativecommons.org/publicdomain/zero/1.0/\n */\n(function (global) {\n\n    var apple_phone         = /iPhone/i,\n        apple_ipod          = /iPod/i,\n        apple_tablet        = /iPad/i,\n        android_phone       = /(?=.*\\bAndroid\\b)(?=.*\\bMobile\\b)/i, // Match 'Android' AND 'Mobile'\n        android_tablet      = /Android/i,\n        amazon_phone        = /(?=.*\\bAndroid\\b)(?=.*\\bSD4930UR\\b)/i,\n        amazon_tablet       = /(?=.*\\bAndroid\\b)(?=.*\\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\\b)/i,\n        windows_phone       = /Windows Phone/i,\n        windows_tablet      = /(?=.*\\bWindows\\b)(?=.*\\bARM\\b)/i, // Match 'Windows' AND 'ARM'\n        other_blackberry    = /BlackBerry/i,\n        other_blackberry_10 = /BB10/i,\n        other_opera         = /Opera Mini/i,\n        other_chrome        = /(CriOS|Chrome)(?=.*\\bMobile\\b)/i,\n        other_firefox       = /(?=.*\\bFirefox\\b)(?=.*\\bMobile\\b)/i, // Match 'Firefox' AND 'Mobile'\n        seven_inch = new RegExp(\n            '(?:' +         // Non-capturing group\n\n            'Nexus 7' +     // Nexus 7\n\n            '|' +           // OR\n\n            'BNTV250' +     // B&N Nook Tablet 7 inch\n\n            '|' +           // OR\n\n            'Kindle Fire' + // Kindle Fire\n\n            '|' +           // OR\n\n            'Silk' +        // Kindle Fire, Silk Accelerated\n\n            '|' +           // OR\n\n            'GT-P1000' +    // Galaxy Tab 7 inch\n\n            ')',            // End non-capturing group\n\n            'i');           // Case-insensitive matching\n\n    var match = function(regex, userAgent) {\n        return regex.test(userAgent);\n    };\n\n    var IsMobileClass = function(userAgent) {\n        var ua = userAgent || navigator.userAgent;\n\n        // Facebook mobile app's integrated browser adds a bunch of strings that\n        // match everything. Strip it out if it exists.\n        var tmp = ua.split('[FBAN');\n        if (typeof tmp[1] !== 'undefined') {\n            ua = tmp[0];\n        }\n\n        // Twitter mobile app's integrated browser on iPad adds a \"Twitter for\n        // iPhone\" string. Same probable happens on other tablet platforms.\n        // This will confuse detection so strip it out if it exists.\n        tmp = ua.split('Twitter');\n        if (typeof tmp[1] !== 'undefined') {\n            ua = tmp[0];\n        }\n\n        this.apple = {\n            phone:  match(apple_phone, ua),\n            ipod:   match(apple_ipod, ua),\n            tablet: !match(apple_phone, ua) && match(apple_tablet, ua),\n            device: match(apple_phone, ua) || match(apple_ipod, ua) || match(apple_tablet, ua)\n        };\n        this.amazon = {\n            phone:  match(amazon_phone, ua),\n            tablet: !match(amazon_phone, ua) && match(amazon_tablet, ua),\n            device: match(amazon_phone, ua) || match(amazon_tablet, ua)\n        };\n        this.android = {\n            phone:  match(amazon_phone, ua) || match(android_phone, ua),\n            tablet: !match(amazon_phone, ua) && !match(android_phone, ua) && (match(amazon_tablet, ua) || match(android_tablet, ua)),\n            device: match(amazon_phone, ua) || match(amazon_tablet, ua) || match(android_phone, ua) || match(android_tablet, ua)\n        };\n        this.windows = {\n            phone:  match(windows_phone, ua),\n            tablet: match(windows_tablet, ua),\n            device: match(windows_phone, ua) || match(windows_tablet, ua)\n        };\n        this.other = {\n            blackberry:   match(other_blackberry, ua),\n            blackberry10: match(other_blackberry_10, ua),\n            opera:        match(other_opera, ua),\n            firefox:      match(other_firefox, ua),\n            chrome:       match(other_chrome, ua),\n            device:       match(other_blackberry, ua) || match(other_blackberry_10, ua) || match(other_opera, ua) || match(other_firefox, ua) || match(other_chrome, ua)\n        };\n        this.seven_inch = match(seven_inch, ua);\n        this.any = this.apple.device || this.android.device || this.windows.device || this.other.device || this.seven_inch;\n\n        // excludes 'other' devices and ipods, targeting touchscreen phones\n        this.phone = this.apple.phone || this.android.phone || this.windows.phone;\n\n        // excludes 7 inch devices, classifying as phone or tablet is left to the user\n        this.tablet = this.apple.tablet || this.android.tablet || this.windows.tablet;\n\n        if (typeof window === 'undefined') {\n            return this;\n        }\n    };\n\n    var instantiate = function() {\n        var IM = new IsMobileClass();\n        IM.Class = IsMobileClass;\n        return IM;\n    };\n\n    if (typeof module !== 'undefined' && module.exports && typeof window === 'undefined') {\n        //node\n        module.exports = IsMobileClass;\n    } else if (typeof module !== 'undefined' && module.exports && typeof window !== 'undefined') {\n        //browserify\n        module.exports = instantiate();\n    } else if (typeof define === 'function' && define.amd) {\n        //AMD\n        define('isMobile', [], global.isMobile = instantiate());\n    } else {\n        global.isMobile = instantiate();\n    }\n\n})(this);\n","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/**\n * isMobile.js v0.4.1\n *\n * A simple library to detect Apple phones and tablets,\n * Android phones and tablets, other mobile devices (like blackberry, mini-opera and windows phone),\n * and any kind of seven inch device, via user agent sniffing.\n *\n * @author: Kai Mallea (kmallea@gmail.com)\n *\n * @license: http://creativecommons.org/publicdomain/zero/1.0/\n */\n(function (global) {\n\n    var apple_phone         = /iPhone/i,\n        apple_ipod          = /iPod/i,\n        apple_tablet        = /iPad/i,\n        android_phone       = /(?=.*\\bAndroid\\b)(?=.*\\bMobile\\b)/i, // Match 'Android' AND 'Mobile'\n        android_tablet      = /Android/i,\n        amazon_phone        = /(?=.*\\bAndroid\\b)(?=.*\\bSD4930UR\\b)/i,\n        amazon_tablet       = /(?=.*\\bAndroid\\b)(?=.*\\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\\b)/i,\n        windows_phone       = /Windows Phone/i,\n        windows_tablet      = /(?=.*\\bWindows\\b)(?=.*\\bARM\\b)/i, // Match 'Windows' AND 'ARM'\n        other_blackberry    = /BlackBerry/i,\n        other_blackberry_10 = /BB10/i,\n        other_opera         = /Opera Mini/i,\n        other_chrome        = /(CriOS|Chrome)(?=.*\\bMobile\\b)/i,\n        other_firefox       = /(?=.*\\bFirefox\\b)(?=.*\\bMobile\\b)/i, // Match 'Firefox' AND 'Mobile'\n        seven_inch = new RegExp(\n            '(?:' +         // Non-capturing group\n\n            'Nexus 7' +     // Nexus 7\n\n            '|' +           // OR\n\n            'BNTV250' +     // B&N Nook Tablet 7 inch\n\n            '|' +           // OR\n\n            'Kindle Fire' + // Kindle Fire\n\n            '|' +           // OR\n\n            'Silk' +        // Kindle Fire, Silk Accelerated\n\n            '|' +           // OR\n\n            'GT-P1000' +    // Galaxy Tab 7 inch\n\n            ')',            // End non-capturing group\n\n            'i');           // Case-insensitive matching\n\n    var match = function(regex, userAgent) {\n        return regex.test(userAgent);\n    };\n\n    var IsMobileClass = function(userAgent) {\n        var ua = userAgent || navigator.userAgent;\n\n        // Facebook mobile app's integrated browser adds a bunch of strings that\n        // match everything. Strip it out if it exists.\n        var tmp = ua.split('[FBAN');\n        if (typeof tmp[1] !== 'undefined') {\n            ua = tmp[0];\n        }\n\n        // Twitter mobile app's integrated browser on iPad adds a \"Twitter for\n        // iPhone\" string. Same probable happens on other tablet platforms.\n        // This will confuse detection so strip it out if it exists.\n        tmp = ua.split('Twitter');\n        if (typeof tmp[1] !== 'undefined') {\n            ua = tmp[0];\n        }\n\n        this.apple = {\n            phone:  match(apple_phone, ua),\n            ipod:   match(apple_ipod, ua),\n            tablet: !match(apple_phone, ua) && match(apple_tablet, ua),\n            device: match(apple_phone, ua) || match(apple_ipod, ua) || match(apple_tablet, ua)\n        };\n        this.amazon = {\n            phone:  match(amazon_phone, ua),\n            tablet: !match(amazon_phone, ua) && match(amazon_tablet, ua),\n            device: match(amazon_phone, ua) || match(amazon_tablet, ua)\n        };\n        this.android = {\n            phone:  match(amazon_phone, ua) || match(android_phone, ua),\n            tablet: !match(amazon_phone, ua) && !match(android_phone, ua) && (match(amazon_tablet, ua) || match(android_tablet, ua)),\n            device: match(amazon_phone, ua) || match(amazon_tablet, ua) || match(android_phone, ua) || match(android_tablet, ua)\n        };\n        this.windows = {\n            phone:  match(windows_phone, ua),\n            tablet: match(windows_tablet, ua),\n            device: match(windows_phone, ua) || match(windows_tablet, ua)\n        };\n        this.other = {\n            blackberry:   match(other_blackberry, ua),\n            blackberry10: match(other_blackberry_10, ua),\n            opera:        match(other_opera, ua),\n            firefox:      match(other_firefox, ua),\n            chrome:       match(other_chrome, ua),\n            device:       match(other_blackberry, ua) || match(other_blackberry_10, ua) || match(other_opera, ua) || match(other_firefox, ua) || match(other_chrome, ua)\n        };\n        this.seven_inch = match(seven_inch, ua);\n        this.any = this.apple.device || this.android.device || this.windows.device || this.other.device || this.seven_inch;\n\n        // excludes 'other' devices and ipods, targeting touchscreen phones\n        this.phone = this.apple.phone || this.android.phone || this.windows.phone;\n\n        // excludes 7 inch devices, classifying as phone or tablet is left to the user\n        this.tablet = this.apple.tablet || this.android.tablet || this.windows.tablet;\n\n        if (typeof window === 'undefined') {\n            return this;\n        }\n    };\n\n    var instantiate = function() {\n        var IM = new IsMobileClass();\n        IM.Class = IsMobileClass;\n        return IM;\n    };\n\n    if (typeof module !== 'undefined' && module.exports && typeof window === 'undefined') {\n        //node\n        module.exports = IsMobileClass;\n    } else if (typeof module !== 'undefined' && module.exports && typeof window !== 'undefined') {\n        //browserify\n        module.exports = instantiate();\n    } else if (typeof define === 'function' && define.amd) {\n        //AMD\n        define('isMobile', [], global.isMobile = instantiate());\n    } else {\n        global.isMobile = instantiate();\n    }\n\n})(this);\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Common = require(\"./Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _GallerySelectionScene = require(\"./scenes/GallerySelectionScene\");\n\nvar _GallerySelectionScene2 = _interopRequireDefault(_GallerySelectionScene);\n\nvar _ImageSelectionScene = require(\"./scenes/ImageSelectionScene\");\n\nvar _ImageSelectionScene2 = _interopRequireDefault(_ImageSelectionScene);\n\nvar _GameScene = require(\"./scenes/GameScene\");\n\nvar _GameScene2 = _interopRequireDefault(_GameScene);\n\nvar _MainScene = require(\"./scenes/MainScene\");\n\nvar _MainScene2 = _interopRequireDefault(_MainScene);\n\nvar _SavedData = require(\"./SavedData\");\n\nvar _SavedData2 = _interopRequireDefault(_SavedData);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/*\n\n var AudioParams = require(\"./AudioParams\");\n var Common = require(\"./Common\");\n var CommonGame = require(\"./CommonGame\");\n var SavedData = require(\"./SavedData\");\n var MainScene = require(\"./scenes/MainScene\");\n var GameScene = require(\"./scenes/GameScene\");\n var ImageSelectionScene = require(\"./scenes/ImageSelectionScene\");\n var GallerySelectionScene = require(\"./scenes/GallerySelectionScene\");\n */\nvar Application = function () {\n    function Application() {\n        _classCallCheck(this, Application);\n    }\n\n    _createClass(Application, null, [{\n        key: \"init\",\n        value: function init() {\n            _Common2.default.assets.texture = _Common2.default.assets.texture.bind(_Common2.default.assets);\n\n            Application.showMainScene();\n\n            _Common2.default.savedData = new _SavedData2.default();\n            _Common2.default.savedData.init();\n        }\n\n        /**\n         * @returns {Scene}\n         */\n\n    }, {\n        key: \"showMainScene\",\n        value: function showMainScene() {\n\n            _Common2.default.paused = false;\n\n            var scene = new _MainScene2.default();\n\n            scene.signals.next.add(function () {\n                Application.showGallerySelectionScene();\n            }, this);\n\n            _Common2.default.scene.show(scene);\n\n            return scene;\n        }\n    }, {\n        key: \"showGameScene\",\n        value: function showGameScene() {\n\n            var scene = new _GameScene2.default();\n\n            scene.signals.next.add(function (scene) {\n                Application.showGameScene();\n            }, this);\n\n            scene.signals.previous.add(function (scene) {\n                Application.showImageSelectionScene();\n            }, this);\n\n            scene.signals.home.add(function (scene) {\n                Application.showMainScene();\n            }, this);\n\n            _Common2.default.scene.show(scene);\n\n            return scene;\n        }\n    }, {\n        key: \"showImageSelectionScene\",\n        value: function showImageSelectionScene() {\n\n            var scene = new _ImageSelectionScene2.default();\n\n            scene.signals.next.add(function (scene) {\n                Application.showGameScene();\n            }, this);\n\n            scene.signals.previous.add(function (scene) {\n                Application.showGallerySelectionScene();\n            }, this);\n\n            scene.signals.home.add(function (scene) {\n                Application.showMainScene();\n            }, this);\n\n            _Common2.default.scene.show(scene);\n\n            return scene;\n        }\n    }, {\n        key: \"showGallerySelectionScene\",\n        value: function showGallerySelectionScene() {\n\n            var scene = new _GallerySelectionScene2.default();\n\n            scene.signals.next.add(function (scene) {\n                Application.showImageSelectionScene();\n            }, this);\n\n            scene.signals.previous.add(function (scene) {\n                Application.showMainScene();\n            }, this);\n\n            scene.signals.home.add(function (scene) {\n                Application.showMainScene();\n            }, this);\n\n            _Common2.default.scene.show(scene);\n\n            return scene;\n        }\n    }]);\n\n    return Application;\n}();\n\nexports.default = Application;\n\n},{\"./Common\":3,\"./SavedData\":6,\"./scenes/GallerySelectionScene\":27,\"./scenes/GameScene\":28,\"./scenes/ImageSelectionScene\":29,\"./scenes/MainScene\":30}],3:[function(require,module,exports){\n\"use strict\";\n//import Button from \"./Button\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _Application = require(\"./Application\");\n\nvar _Application2 = _interopRequireDefault(_Application);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction Common() {}\nexports.default = Common;\n\n//====================================//\n//=====PROJECT SPECIFIC VARIABLES=====//\n//====================================//\n\n/**\n * Wrapper for legacy of jons old happo paint game\n * @type {{assetRes: number}}\n */\n\nCommon.main = { assetRes: 1 };\n\n/**\n * Currently selected intellectual property\n * @type {string}\n */\nCommon.themeIndex = 0;\n\n/**\n * @type {signals.Signal}\n */\nCommon.killGlowSignal = new signals.Signal();\n\n/**\n * @type {signals.Signal}\n */\nCommon.toggleCurrentGlowSignal = new signals.Signal();\n\n/**\n * @param arr\n */\nCommon.buttonsAppear = function (arr) {\n    for (var i = 0; i < arr.length; i++) {\n        arr[i].scale.set(0);\n        TweenMax.to(arr[i].scale, 0.34, {\n            x: 1,\n            y: 1,\n            ease: Back.easeOut,\n            easeParams: [2],\n            delay: i * 0.15 + 0.25\n        });\n    }\n};\n\n//====================================//\n//========PROJECT SPECIFIC END========//\n//====================================//\n\n/**\n * @type {null|P3.AssetManager}\n */\nCommon.assets = null;\n\n/**\n * @type {P3.View}\n */\nCommon.view = null;\n\n/**\n * @type {number}\n */\nCommon.paused = false;\n\n/**\n * @type {boolean}\n */\nCommon.isWebGL = false;\n\n/**\n * @type {boolean}\n */\nCommon.isFirstPlay = true;\n\n/**\n * @type {boolean}\n */\nCommon.isDebug = false;\n\n/**\n * @type {boolean}\n */\nCommon.isMute = false;\n\n//===============//\n//==static vars==//\n//===============//\n\n/**\n * Semi unique key used as an identifier for save files, followed by the version\n * (useful if you want players to start a new game, increment version number)\n * @static\n * @type {string}\n */\nCommon.game_key = \"rozhc7o7-dsn-create-v1.0\";\n\n/**\n * @static\n * @type {AudioManager}\n */\nCommon.audio = null;\n\n/**\n * @static\n * @type {P3.Camera}\n */\nCommon.camera = null;\n\n/**\n * @static\n * @type {number}\n * @const\n */\nCommon.PHYSICS_TICK = 1.0 / 30.0;\n\n/**\n * @static\n * @type {object}\n */\nCommon.copy = null;\n\n/**\n * @static\n * @type {object}\n */\nCommon.config = null;\n\n/**\n * @type {string}\n * @static\n */\nCommon.language = \"\";\n\n/**\n * @static\n * @const\n * @type {number}\n */\nCommon.STAGE_WIDTH = 1664;\n\n/**\n * @static\n * @const\n * @type {number}\n */\nCommon.STAGE_HEIGHT = 768;\n\n/**\n * @static\n * @type {PIXI.Container}\n */\nCommon.stage = null;\n\n/**\n * @static\n * @type {PIXI.CanvasRenderer|PIXI.WebGLRenderer}\n */\nCommon.renderer = null;\n\n//===============//\n//==static ends==//\n//===============//\n\n//================================//\n//=====save and load functions====//\n//================================//\n\nCommon.saveMute = function () {\n    var data = { isMute: Common.isMute };\n    localStorage.setItem(Common.game_key + \"_isMute\", JSON.stringify(data));\n};\n\nCommon.loadMute = function () {\n    var data = JSON.parse(localStorage.getItem(Common.game_key + \"_isMute\"));\n    if (data) {\n        Common.isMute = data.isMute;\n        Common.audio.mute(Common.isMute);\n    }\n};\n\nCommon.saveGame = function () {\n    var gameData = { highestScore: Common.highestScore };\n    localStorage.setItem(Common.game_key, JSON.stringify(gameData));\n};\n\nCommon.loadGame = function () {\n    var gameData = JSON.parse(localStorage.getItem(Common.game_key));\n    if (gameData) {\n        Common.highestScore = gameData.highestScore;\n        Common.isFirstPlay = false;\n    } else {\n        Common.isFirstPlay = true;\n    }\n};\n\n//=========================================================//\n//=============Rest is all util type functions=============//\n//=========================================================//\n\n/**\n * Knuth shuffle variant\n * @param string\n * @returns {string}\n */\nCommon.shuffleString = function (string) {\n    var a = string.split(\"\"); //our array\n    var n = a.length; //number of elements\n    for (var i = n - 1; i > 0; i--) {\n        var j = Math.floor(Math.random() * (i + 1));\n        var tmp = a[i];\n        a[i] = a[j];\n        a[j] = tmp;\n    }\n    return a.join(\"\");\n};\n\n/**\n * Knuth shuffle\n * @param a\n * @returns {*}\n */\nCommon.shuffleArr = function (a) {\n    for (var i = a.length; i; i--) {\n        var j = Math.floor(Math.random() * i);\n        var _ref = [a[j], a[i - 1]];\n        a[i - 1] = _ref[0];\n        a[j] = _ref[1];\n    }\n    return a;\n};\n\n/**\n * Generates a random string for use as a semi unique ID for save data\n * @param strLen - Desired length of random string\n * @returns {string}\n */\nCommon.randomID = function (strLen) {\n    strLen = strLen || 8;\n    return Math.random().toString(36).substr(2, strLen);\n};\n\n/**\n * Returns the angle between two points, where 0 is 3 o clock, 90 degrees is 6 o clock, etc.\n * @param x1 {number}\n * @param y1 {number}\n * @param x2 {number}\n * @param y2 {number}\n * @returns {number}\n */\nCommon.angle = function (x1, y1, x2, y2) {\n    var dy = y2 - y1;\n    var dx = x2 - x1;\n    return Math.atan2(dy, dx);\n};\n\n/**\n * @param {number} x1 - Coordinate X of 1st point\n * @param {number} y1 - Coordinate Y of 1st point\n * @param {number} x2 - Coordinate X of 2nd point\n * @param {number} y2 - Coordinate Y of 2nd point\n * @returns {number} distance - Euclidean distance between the two points\n */\nCommon.distance = function (x1, y1, x2, y2) {\n    return Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));\n};\n\n/**\n * @param {number} deg\n * @returns {number} rad\n */\nCommon.deg2rad = function (deg) {\n    return deg * (Math.PI / 180);\n};\n\n/**\n * @param rad\n * @returns {number}\n */\nCommon.rad2deg = function (rad) {\n    return rad * 180 / Math.PI; // rads to degs, range (-180, 180]\n};\n\n/**\n * Returns a new keyboard object that listens for keyboard input\n * @param keyCode\n * @returns {{}}\n */\nCommon.keyboard = function (keyCode) {\n    var key = {};\n    key.code = keyCode;\n    key.isDown = false;\n    key.isUp = true;\n    key.down = undefined;\n    key.up = undefined;\n    //The `downHandler`\n    key.downHandler = function (event) {\n        if (event.keyCode === key.code) {\n            if (key.isUp && key.down) key.down();\n            key.isDown = true;\n            key.isUp = false;\n        }\n        event.preventDefault();\n    };\n\n    //The `upHandler`\n    key.upHandler = function (event) {\n        if (event.keyCode === key.code) {\n            if (key.isDown && key.up) key.up();\n            key.isDown = false;\n            key.isUp = true;\n        }\n        event.preventDefault();\n    };\n\n    //Attach event listeners\n    window.addEventListener(\"keydown\", key.downHandler.bind(key), false);\n    window.addEventListener(\"keyup\", key.upHandler.bind(key), false);\n    return key;\n};\n\n/**\n * @param width\n * @param height\n * @param colour\n * @param shape\n * @returns {Texture}\n */\nCommon.genTex = function (width, height, colour, shape) {\n    var g = new PIXI.Graphics();\n    if (colour) g.beginFill(colour);else g.beginFill(0x000fff);\n    if (shape === \"rect\") g.drawRect(0, 0, width, height);else if (shape === \"circle\") g.drawEllipse(0, 0, width, height);else g.drawRect(0, 0, width, height); //fallback to rect\n    g.endFill();\n    return Common.renderer.generateTexture(g);\n};\n\n/**\n * Returns a new sprite that uses a texture generated using pixi graphics, mostly for debug and prototyping etc.\n * @param width\n * @param height\n * @param colour\n * @param retTexture - should we return a texture or a sprite?\n * @returns {PIXI.Sprite|String}\n */\nCommon.generateRect = function (width, height, colour, retTexture) {\n    var g = new PIXI.Graphics();\n    if (colour) g.beginFill(colour);else g.beginFill(0x000fff);\n    g.lineStyle(5, 0xd9d9d9);\n    g.drawRect(0, 0, width, height);\n    g.endFill();\n    var texture = Common.renderer.generateTexture(g);\n    var sprite = new PIXI.Sprite(texture);\n    sprite.anchor = { x: 0.5, y: 0.5 };\n    g.destroy();\n    if (!retTexture) return sprite;\n    sprite.destroy();\n    return texture;\n};\n\n/**\n * Returns a new sprite that uses a texture generated using pixi graphics, mostly for debug and prototyping etc.\n * @param width\n * @param height\n * @param colour\n * @param retTexture - Should we return a texture or a sprite?\n * @returns {PIXI.Sprite|PIXI.Texture}\n */\nCommon.generateEllipse = function (width, height, colour, retTexture) {\n    var g = new PIXI.Graphics();\n    if (colour) g.beginFill(colour);else g.beginFill(0xfff000);\n    g.drawEllipse(0, 0, width, height);\n    g.endFill();\n    var texture = Common.renderer.generateTexture(g);\n    var sprite = new PIXI.Sprite(texture);\n    sprite.anchor.set(0.5);\n    g.destroy();\n    if (!retTexture) return sprite;else return texture;\n};\n\n/**\n * Centres all sprites passed to it\n * @param sprite\n */\nCommon.centreAnchor = function (sprite) {\n    for (var i = 0; i < arguments.length; i++) {\n        arguments[i].anchor.set(0.5);\n    }\n};\n\n/**\n * Returns a matrix of defined size with optional initial values\n * @param {number} numRows - Number rows in matrix\n * @param {number} numCols - Number of columns in matrix\n * @param initial - Optional initial value\n * @returns {Array}\n */\nCommon.matrix = function (numRows, numCols, initial) {\n    var arr = [];\n    for (var i = 0; i < numRows; i++) {\n        var columns = [];\n        for (var j = 0; j < numCols; j++) {\n            columns[j] = initial;\n        }arr[i] = columns;\n    }\n    return arr;\n};\n\n/**\n * Returns array of defined size with optional initial values\n * @param {number} size\n * @param initial\n * @returns {Array}\n */\nCommon.array = function (size, initial) {\n    var arr = [];\n    for (var i = 0; i < size; i++) {\n        arr.push(initial);\n    }return arr;\n};\n\n/**\n * Uses quick sort to sort an array, with optional flag to sort high to low\n * @param array\n * @param highToLow\n * @returns {*}\n */\nCommon.sort = function (array, highToLow) {\n    var size = array.length - 1;\n    quickSort(0, size);\n    return array;\n\n    function quickSort(first, last) {\n\n        if (first < last) {\n            var pivotIndex = partition();\n            quickSort(first, pivotIndex - 1);\n            quickSort(pivotIndex + 1, last);\n        }\n\n        function swap(p, q) {\n            var temp = array[p];\n            array[p] = array[q];\n            array[q] = temp;\n        }\n\n        function partition() {\n            var pivot = array[first],\n                index = first;\n            swap(index, last);\n            for (var i = first; i < last; i++) {\n                if (!highToLow && array[i] < pivot) swap(index++, i);else if (highToLow && array[i] > pivot) swap(index++, i);\n            }\n            swap(index, last);\n            return index;\n        }\n    }\n};\n\n/**\n * Sorts tiles (or any display object) by x, y coordinates so they are ordered lowest top to bottom , left to right\n * @param array\n * @returns {*}\n */\nCommon.sortTiles = function (array) {\n    array.sort(function (a, b) {\n        if (a.y == b.y) return a.x - b.x;else return a.y - b.y;\n    });\n    return array;\n};\n\n/**\n * Sorts object with an x or y property (such as sprites) by x or y dependant on flag\n * @param array - array to sort\n * @param highToLow - sort high to low?\n * @param sortX - flag to choose whether to sort by x or y\n * @returns {*}\n */\nCommon.sortBy = function (array, highToLow, sortX) {\n\n    var size = array.length - 1;\n    quickSort(0, size);\n    return array;\n\n    function quickSort(first, last) {\n        if (first < last) {\n            var pivotIndex = partition();\n            quickSort(first, pivotIndex - 1);\n            quickSort(pivotIndex + 1, last);\n        }\n        function swap(p, q) {\n            var temp = array[p];\n            array[p] = array[q];\n            array[q] = temp;\n        }\n\n        function partition() {\n            var pivot = array[first],\n                index = first;\n            swap(index, last);\n            for (var i = first; i < last; i++) {\n                if (!highToLow) {\n                    if (x) {\n                        if (array[i].x < pivot.x) swap(index++, i);\n                    } else {\n                        if (array[i].y < pivot.y) swap(index++, i);\n                    }\n                } else {\n                    if (x) {\n                        if (array[i].x > pivot.x) swap(index++, i);\n                    } else {\n                        if (array[i].y > pivot.y) swap(index++, i);\n                    }\n                }\n            }\n            swap(index, last);\n            return index;\n        }\n    }\n};\n\n/**\n * Sorts object with a distance property\n * @param array - array to sort\n * @param highToLow - sort high to low?\n * @returns {*}\n */\nCommon.sortDistances = function (array, highToLow) {\n\n    highToLow = highToLow || false;\n\n    var size = array.length - 1;\n    quickSort(0, size);\n    return array;\n\n    function quickSort(first, last) {\n        if (first < last) {\n            var pivotIndex = partition();\n            quickSort(first, pivotIndex - 1);\n            quickSort(pivotIndex + 1, last);\n        }\n        function swap(p, q) {\n            var temp = array[p];\n            array[p] = array[q];\n            array[q] = temp;\n        }\n\n        function partition() {\n            var pivot = array[first],\n                index = first;\n            swap(index, last);\n            for (var i = first; i < last; i++) {\n                if (!highToLow) {\n                    if (array[i].distance < pivot.x) swap(index++, i);\n                } else {\n                    if (array[i].distance > pivot.distance) swap(index++, i);\n                }\n            }\n            swap(index, last);\n            return index;\n        }\n    }\n};\n\nCommon.compareXY = function (point1, point2) {\n    return Math.round(point1.x) === Math.round(point2.x) && Math.round(point1.y) === Math.round(point2.y);\n};\n\nCommon.lerpAxis = function (start, end, percent) {\n    return (end - start) * percent + start;\n};\n\nCommon.lerpVector = function (start, end, percent) {\n    return Common.Vector.add(Common.Vector.scale(Common.Vector.sub(start, end), percent), start);\n};\n\nCommon.Vector = {\n    add: function add(a, b) {\n        if (a.x === undefined || b.x === undefined) throw new Error('Vector.add() must be passed a pair of vectors');\n        return { x: a.x + b.x, y: a.y + b.y };\n    },\n    sub: function sub(a, b) {\n        if (a.x === undefined || b.x === undefined) throw new Error('Vector.sub() must be passed a pair of vectors');\n        return { x: a.x - b.x, y: a.y - b.y };\n    },\n    mult: function mult(a, b) {\n        if (a.x === undefined || b.x === undefined) throw new Error('Vector.mult() must be passed a pair of vectors');\n        return { x: a.x * b.x, y: a.y * b.y };\n    },\n    div: function div(a, b) {\n        if (a.x === undefined || b.x === undefined) throw new Error('Vector.div() must be passed a pair of vectors');\n        return { x: a.x / b.x, y: a.y / b.y };\n    },\n    scale: function scale(a, scalePerc) {\n        if (a.x === undefined) throw new Error('Vector.scale() must be passed a vector for first arg');\n        return { x: a.x * scalePerc, y: a.y * scalePerc };\n    }\n};\n\nCommon.lookAt = function (sprite, target, update) {\n    var rotation = Math.atan2(target.y - sprite.y, target.x - sprite.x);\n    if (update) sprite.rotation = rotation;\n    return rotation;\n};\n\n//--from stackoverflow-- https://stackoverflow.com/questions/14962018/detecting-and-fixing-circular-references-in-javascript //\nCommon.detectCircularRef = function (obj) {\n\n    return detectCircularReferences(obj);\n\n    function detectCircularReferences(toBeStringifiedValue) {\n        var serializationKeyStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n        Object.keys(toBeStringifiedValue).forEach(function (key) {\n            var value = toBeStringifiedValue[key];\n            var serializationKeyStackWithNewKey = serializationKeyStack.slice();\n            serializationKeyStackWithNewKey.push(key);\n            try {\n                JSON.stringify(value);\n            } catch (error) {\n                var isCircularValue;\n                var circularExcludingStringifyResult = \"\";\n                try {\n                    circularExcludingStringifyResult = JSON.stringify(value, replaceRootStringifyReplacer(value), 2);\n                    isCircularValue = true;\n                } catch (error) {\n                    detectCircularReferences(value, serializationKeyStackWithNewKey);\n                    isCircularValue = false;\n                }\n                if (isCircularValue) {\n                    throw new Error(\"Circular reference detected:\\nCircularly referenced value is value under path \\\"\" + joinStrings(serializationKeyStackWithNewKey) + \"\\\" of the given root object\\n\" + (\"Calling stringify on this value but replacing itself with [Circular object --- fix me] ( <-- search for this string) results in:\\n\" + circularExcludingStringifyResult + \"\\n\"));\n                }\n            }\n        });\n    }\n\n    function replaceRootStringifyReplacer(toBeStringifiedValue) {\n        var serializedObjectCounter = 0;\n        return function (key, value) {\n            if (serializedObjectCounter !== 0 && (typeof toBeStringifiedValue === \"undefined\" ? \"undefined\" : _typeof(toBeStringifiedValue)) === 'object' && toBeStringifiedValue === value) {\n                return '[Circular object --- fix me]';\n            }\n            serializedObjectCounter++;\n            return value;\n        };\n    }\n\n    function joinStrings(arr) {\n        var separator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \":\";\n\n        if (arr.length === 0) return \"\";\n        return arr.reduce(function (v1, v2) {\n            return \"\" + v1 + separator + v2;\n        });\n    }\n};\n\n//from github pixi-simple-gestures\nCommon.pinchable = function (sprite, inertia) {\n\n    sprite.interactive = true;\n    sprite.on('touchstart', start);\n    sprite.on('touchend', end);\n    sprite.on('touchendoutside', end);\n\n    function start(e) {\n        sprite.on('touchmove', move);\n    }\n\n    function move(e) {\n        var t = e.data.originalEvent.targetTouches;\n        if (!t || t.length < 2) {\n            return;\n        }\n        var dx = t[0].clientX - t[1].clientX;\n        var dy = t[0].clientY - t[1].clientY;\n        var distance = Math.sqrt(dx * dx + dy * dy);\n        if (!sprite._pinch) {\n            sprite._pinch = {\n                p: {\n                    distance: distance,\n                    date: new Date()\n                }\n            };\n            sprite.emit('pinchstart');\n            return;\n        }\n        var now = new Date();\n        var interval = now - sprite._pinch.p.date;\n        if (interval < 12) {\n            return;\n        }\n        var center = {\n            x: (t[0].clientX + t[1].clientX) / 2,\n            y: (t[0].clientY + t[1].clientY) / 2\n        };\n        var event = {\n            scale: distance / sprite._pinch.p.distance,\n            velocity: distance / interval,\n            center: center,\n            data: e.data\n        };\n        sprite.emit('pinchmove', event);\n        sprite._pinch.pp = {\n            distance: sprite._pinch.p.distance,\n            date: sprite._pinch.p.date\n        };\n        sprite._pinch.p = {\n            distance: distance,\n            date: now\n        };\n    }\n\n    function end(e) {\n        sprite.removeListener('touchmove', move);\n        if (!sprite._pinch) {\n            return;\n        }\n        if (inertia && sprite._pinch.pp) {\n            if (sprite._pinch.intervalId) {\n                return;\n            }\n            var interval = new Date() - sprite._pinch.p.date;\n            var velocity = (sprite._pinch.p.distance - sprite._pinch.pp.distance) / interval;\n            var center = sprite._pinch.p.center;\n            var distance = sprite._pinch.p.distance;\n            sprite._pinch.intervalId = setInterval(function () {\n                if (Math.abs(velocity) < 0.04) {\n                    clearInterval(sprite._pinch.intervalId);\n                    sprite.emit('pinchend');\n                    sprite._pinch = null;\n                    return;\n                }\n                var updatedDistance = distance + velocity * 12;\n                var event = {\n                    scale: updatedDistance / distance,\n                    velocity: velocity,\n                    center: center,\n                    data: e.data\n                };\n                sprite.emit('pinchmove', event);\n                distance = updatedDistance;\n                velocity *= 0.8;\n            }, 12);\n        } else {\n            sprite.emit('pinchend');\n            sprite._pinch = null;\n        }\n    }\n};\n\n//from https://stackoverflow.com/questions/7184573/pick-up-the-android-version-in-the-browser-by-javascript\nCommon.getAndroidVersion = function (ua) {\n    ua = (ua || navigator.userAgent).toLowerCase();\n    var match = ua.match(/android\\s([0-9\\.]*)/);\n    return match ? match[1] : false;\n};\n\n/**\n * Custom tween\n * @param obj\n * @param time\n * @param params\n * @returns {TweenLite|TweenMax|TimelineLite|*}\n */\nCommon.erraticTween = function (obj, time) {\n    var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : { delay: 0 };\n\n    params.ease = CustomEase.create(\"custom\", \"M0,0,C0,0,0.065,0.167,0.08,0.205,0.09,0.2,0.124,0.182,0.135,0.176,0.157,0.223,0.21,0.59,0.22,0.608,0.223,0.585,0.298,0.12,0.3,0.111,0.3,0.118,0.309,0.262,0.315,0.345,0.322,0.36,0.325,0.372,0.335,0.388,0.352,0.417,0.372,0.439,0.39,0.463,0.391,0.502,0.394,0.58,0.395,0.583,0.396,0.578,0.418,0.461,0.43,0.399,0.431,0.397,0.463,0.611,0.464,0.61,0.475,0.621,0.488,0.448,0.495,0.455,0.495,0.449,0.498,0.417,0.5,0.404,0.512,0.401,0.562,0.262,0.572,0.26,0.577,0.293,0.568,0.499,0.58,0.568,0.597,0.639,0.603,0.787,0.608,0.806,0.616,0.794,0.698,0.64,0.705,0.63,0.705,0.638,0.708,0.685,0.71,0.72,0.711,0.734,0.713,0.745,0.715,0.756,0.719,0.759,0.737,0.781,0.742,0.784,0.746,0.83,0.743,0.912,0.745,0.925,0.756,0.907,0.863,0.732,0.88,0.705,0.894,0.741,1,1,1,1\");\n    return TweenMax.to(obj, time, params);\n};\n\n/**\n * Dijkstra implementation of a path finder. Prefer this over A* if you have multiple agents with same starting position\n * and you are using a weighted graph. For non weighted graphics use BFS. For a single agent with a known single target destination use A*.\n * Or alternatively if you are unsure what your target is you can calc the path to all nodes, and then just retrieve the path to the target\n * node once you know it which could be useful depending on use case.\n *\n * @class\n */\n\nvar Dijkstra = function () {\n    function Dijkstra() {\n        _classCallCheck(this, Dijkstra);\n\n        /**\n         * @type {null}\n         * @private\n         */\n        this._graph = null;\n\n        /**\n         * @type {null}\n         * @private\n         */\n        this._source = null;\n\n        //todo - add findPath() function which terminates when u === v\n        /**\n         * @type {null}\n         * @private\n         */\n        this._target = null; //note we may want to target if we only have one agent, but A* is probably better for this case so prefer that if you don't need to guarantee the shortest path\n\n        /**\n         * Vertex set Q\n         * @type {Array}\n         * @private\n         */\n        this._verts = [];\n\n        /**\n         * @type {null}\n         * @private\n         */\n        this._paths = null;\n    }\n\n    _createClass(Dijkstra, [{\n        key: \"init\",\n        value: function init() {\n\n            if (!this._graph) throw new Error('must set graph before init');\n            if (!this._source) throw new Error('must set source before init');\n\n            //--create vertex set Q--//\n            for (var _x4 = 0; _x4 < this._graph.length; _x4++) {\n                for (var y = 0; y < this._graph[_x4].length; y++) {\n                    // All nodes initially in Q (unvisited nodes)\n                    var vert = this._graph[_x4][y];\n\n                    vert.distance = Number.POSITIVE_INFINITY;\n                    vert.prev = null;\n                    vert.neighbours = [];\n\n                    if (_x4 > 0) vert.neighbours.push(this._graph[_x4 - 1][y]); //grid sq left\n                    if (_x4 < this._graph.length - 1) vert.neighbours.push(this._graph[_x4 + 1][y]); //grid sq right\n                    if (y > 0) vert.neighbours.push(this._graph[_x4][y - 1]); //grid sq above\n                    if (y < this._graph[_x4].length - 1) vert.neighbours.push(this._graph[_x4][y + 1]); //grid sq below\n\n                    this._verts.push(vert);\n                }\n            }\n            var s = this._source;\n            this._verts[this._graph.length * s.x + s.y].distance = 0; //set source to source distance as zero (ensures this is first in our list becaue it has the lowest dist)\n        }\n    }, {\n        key: \"findPaths\",\n        value: function findPaths() {\n\n            var descending = function descending(a, b) {\n                return b.distance - a.distance;\n            }; //descending sort function\n\n            var paths = [];\n\n            while (this._verts.length > 0) {\n\n                //TODO can we take the sort out for optimisation?\n\n                //--find node with least dist by sorting--//\n                // this._verts = Common.sortDistances(this._verts, true);   //highToLow\n                this._verts.sort(descending); //way outperforms my quick sort function (100 to 300 percent quicker)\n\n                var u = this._verts[this._verts.length - 1]; //take last element which is the one with the shortest distance\n\n                this._verts.pop(); //remove u from vert list (Q)\n\n                //--for each neighbour v of u--//\n                for (var i = 0; i < u.neighbours.length; i++) {\n                    var v = u.neighbours[i];\n                    var sourceToV = u.distance + Common.distance(u.x, u.y, v.x, v.y);\n                    if (sourceToV < v.distance) {\n                        //we found a new shortest distance to this node v\n                        v.distance = sourceToV; //store dist\n                        v.prev = u; //store prev node\n\n                        paths.push(v);\n                    }\n                }\n            }\n\n            this._paths = paths;\n\n            return paths;\n        }\n\n        /**\n         * Fetches the path from the this._paths pre calculated paths to all nodes\n         * @param pos\n         */\n\n    }, {\n        key: \"retrievePathTo\",\n        value: function retrievePathTo(pos) {\n            var node = void 0;\n            for (var i = 0; i < this._paths.length; i++) {\n                if (Common.compareXY(pos, this._paths[i])) {\n                    node = this._paths[i];\n                }\n            }\n\n            if (!node) {\n                throw new Error(\"can't retrieve path, position not on graph\");\n            }\n\n            var path = [];\n\n            //--trace back to start node to create the path--//\n            var recurse = function recurse() {\n                //using a little recursive function to trace the path backwards\n                path.push({ x: node.x, y: node.y });\n                if (node.prev) {\n                    node = node.prev;\n                    recurse();\n                }\n            };\n            recurse();\n\n            return path;\n        }\n    }, {\n        key: \"reset\",\n        value: function reset() {\n            this.init();\n        }\n    }, {\n        key: \"test\",\n        value: function test(scene) {\n\n            var tWid = 50;\n            var holder = new PIXI.Container();\n            var gridSize = 15;\n            var graph = Common.matrix(gridSize, gridSize);\n            holder.x = Common.STAGE_WIDTH * 0.5 - tWid * (gridSize * 0.5);\n            scene.addChild(holder);\n\n            for (var _x5 = 0; _x5 < gridSize; _x5++) {\n                for (var y = 0; y < gridSize; y++) {\n\n                    var _sp = P3.createSprite(PIXI.Texture.WHITE, holder);\n                    _sp.x = _x5 * tWid;\n                    _sp.y = y * tWid;\n\n                    _sp.width = tWid - 2;\n                    _sp.height = tWid - 2;\n\n                    _sp.tint = 0xD8D8D8;\n\n                    graph[_x5][y] = { x: _x5, y: y }; //grid should be stored as int and we will multiply out to get tile pos\n                }\n            }\n\n            this.graph = graph;\n            this.source = graph[0][0]; //set source to be top left\n\n            var t0 = performance.now();\n            this.init();\n            var paths = this.findPaths();\n            var t1 = performance.now();\n            console.warn(\"found paths in : \" + (t1 - t0));\n\n            var path = this.retrievePathTo({ x: gridSize - 1, y: gridSize - 1 }); //retrieve path to bottom right\n\n            console.log(paths);\n            console.log(path);\n\n            var sp = P3.createSprite(PIXI.Texture.WHITE, holder);\n            sp.anchor.set(0.5);\n            sp.position.set(graph[0][0].x, graph[0][0].y);\n            sp.width = tWid * 0.5;\n            sp.height = tWid * 0.5;\n\n            followPath(sp, tWid, path);\n\n            function followPath(sprite, tWid, path) {\n                var node = path[path.length - 1];\n                TweenMax.to(sprite, 0.5, {\n                    x: node.x * tWid,\n                    y: node.y * tWid + tWid * 0.5,\n                    ease: Power0.easeNone,\n                    onComplete: function onComplete() {\n                        path.pop();\n                        if (path.length > 0) followPath(sprite, tWid, path);\n                    }\n                });\n            }\n        }\n    }, {\n        key: \"graph\",\n        set: function set(value) {\n            this._graph = value;\n        }\n    }, {\n        key: \"source\",\n        set: function set(value) {\n            this._source = value;\n        }\n    }, {\n        key: \"target\",\n        set: function set(value) {\n            this._target = value;\n        }\n    }]);\n\n    return Dijkstra;\n}();\n\nCommon.PathD = new Dijkstra();\n\n/**\n * Best performing path finding algorithm in cases where node distances are all the same (unweighted graph / grid).\n * Could be adapted to use without a target in which case it will find path to every node,\n * a possible use for this could be enemies in an RTS game.\n * @class\n */\n\nvar BreadthFirst = function () {\n    function BreadthFirst() {\n        _classCallCheck(this, BreadthFirst);\n\n        /**\n         * @type {null}\n         * @private\n         */\n        this._graph = null;\n\n        /**\n         * @type {null}\n         * @private\n         */\n        this._source = null;\n\n        /**\n         * @type {null}\n         * @private\n         */\n        this._target = null;\n\n        /**\n         * List of nodes currently being explored\n         * @type {Array}\n         * @private\n         */\n        this._openList = [];\n    }\n\n    _createClass(BreadthFirst, [{\n        key: \"init\",\n        value: function init() {\n\n            if (!this._graph) throw new Error('must set graph before init');\n            if (!this._source) throw new Error('must set source before init');\n\n            var startNode = void 0;\n\n            for (var _x6 = 0; _x6 < this._graph.length; _x6++) {\n                for (var y = 0; y < this._graph[_x6].length; y++) {\n                    var vert = this._graph[_x6][y];\n\n                    vert.neighbours = [];\n                    vert.prev = null;\n\n                    if (_x6 > 0) vert.neighbours.push(this._graph[_x6 - 1][y]); //grid sq left\n                    if (_x6 < this._graph.length - 1) vert.neighbours.push(this._graph[_x6 + 1][y]); //grid sq right\n                    if (y > 0) vert.neighbours.push(this._graph[_x6][y - 1]); //grid sq above\n                    if (y < this._graph[_x6].length - 1) vert.neighbours.push(this._graph[_x6][y + 1]); //grid sq below\n\n                    if (Common.compareXY({ x: _x6, y: y }, this._source)) {\n                        //if node is source node we can immediately mark as visited\n                        vert.visited = true;\n                        startNode = vert;\n                    }\n                }\n            }\n\n            //--we want the list to be fifo--//\n            this._openList.reverse();\n            this._openList.push(startNode);\n        }\n    }, {\n        key: \"find\",\n        value: function find() {\n\n            /*\n             -PSUEDOCODE-\n             unmark all vertices\n             choose some starting vertex x\n             mark x\n             list L = x\n             tree T = x\n             while L nonempty\n             choose some vertex u from front of list\n             visit u\n             for each unmarked neighbor v\n             mark v\n             add it to end of list\n             add edge uv to T\n             */\n\n            if (!this._target) throw new Error('must set target before performing BFS');\n\n            var endNode = void 0;\n\n            var arr = [];\n            while (this._openList.length > 0) {\n                var u = this._openList[this._openList.length - 1]; //get our first vertex\n                this._openList.pop();\n                u.visited = true; //mark as visited\n\n                if (Common.compareXY(u, this._target)) {\n                    console.warn(\"found target\");\n                    endNode = u;\n                    break;\n                }\n\n                for (var i = 0; i < u.neighbours.length; i++) {\n                    var v = u.neighbours[i];\n                    if (!v.visited) {\n                        v.visited = true;\n                        v.prev = u;\n\n                        this._openList.unshift(v); //fifo\n\n                        var edge = { start: u, end: v };\n                        arr.push(edge);\n                    }\n                }\n            }\n\n            // console.log(this._closedList);\n\n            // console.log(arr);\n\n            var path = [];\n\n            var node = endNode;\n            //--trace back to start node to create the path--//\n            var recurse = function recurse() {\n                //using a little recursive function to trace the path backwards\n                path.push({ x: node.x, y: node.y });\n                if (node.prev) {\n                    node = node.prev;\n                    recurse();\n                }\n            };\n            recurse();\n\n            return path;\n        }\n    }, {\n        key: \"test\",\n        value: function test(scene) {\n\n            var tWid = 25;\n            var holder = new PIXI.Container();\n            var gridSize = 25;\n            var graph = Common.matrix(gridSize, gridSize);\n            holder.x = Common.STAGE_WIDTH * 0.5 - tWid * (gridSize * 0.5);\n            scene.addChild(holder);\n\n            for (var _x7 = 0; _x7 < gridSize; _x7++) {\n                for (var y = 0; y < gridSize; y++) {\n\n                    var _sp2 = P3.createSprite(PIXI.Texture.WHITE, holder);\n                    _sp2.x = _x7 * tWid;\n                    _sp2.y = y * tWid;\n\n                    _sp2.width = tWid - 2;\n                    _sp2.height = tWid - 2;\n\n                    _sp2.tint = 0xD8D8D8;\n\n                    graph[_x7][y] = { x: _x7, y: y }; //grid should be stored as int and we will multiply out to get tile pos\n                }\n            }\n\n            this.graph = graph;\n            this.source = graph[0][0]; //set source to be top left\n            this.target = { x: gridSize - 1, y: gridSize - 1 };\n\n            var t0 = performance.now();\n            this.init();\n            var path = this.find();\n            var t1 = performance.now();\n            console.warn(\"found paths in : \" + (t1 - t0));\n\n            // const path = Common.Path.retrievePathTo({x: gridSize - 1, y: gridSize - 1}); //retrieve path to bottom right\n\n            // return;\n            //  console.log(paths);\n            console.log(path);\n\n            var sp = P3.createSprite(PIXI.Texture.WHITE, holder);\n            sp.anchor.set(0.5);\n            sp.position.set(graph[0][0].x, graph[0][0].y);\n            sp.width = tWid * 0.5;\n            sp.height = tWid * 0.5;\n\n            followPath(sp, tWid, path);\n\n            function followPath(sprite, tWid, path) {\n                var node = path[path.length - 1];\n                TweenMax.to(sprite, 0.5, {\n                    x: node.x * tWid,\n                    y: node.y * tWid + tWid * 0.5,\n                    ease: Power0.easeNone,\n                    onComplete: function onComplete() {\n                        path.pop();\n                        if (path.length > 0) followPath(sprite, tWid, path);\n                    }\n                });\n            }\n        }\n    }, {\n        key: \"graph\",\n        set: function set(value) {\n            this._graph = value;\n        }\n    }, {\n        key: \"source\",\n        set: function set(value) {\n            this._source = value;\n        }\n    }, {\n        key: \"target\",\n        set: function set(value) {\n            this._target = value;\n        }\n    }]);\n\n    return BreadthFirst;\n}();\n\nCommon.PathBFS = new BreadthFirst();\n\n//===================================================\n//\n// Jon's Methods\n//\n//===================================================\n\n/**\n * @type {boolean}\n * @static\n */\nCommon.randBool = function () {\n    return Math.random() > 0.5;\n};\n\n/**\n * @type {boolean}\n * @static\n */\nCommon.toOneDecimalStr = function (a) {\n    var result = a.toFixed(1);\n    if (result[result.indexOf(\".\") + 1] == \"0\") result = result.substr(0, result.indexOf(\".\"));\n\n    return result;\n};\n\n/**\n * @type {number}\n * @static\n */\nCommon.randomInt = function (min, max) {\n    return Math.floor(Math.random() * (max - min + 1) + min);\n};\n\n/**\n * @type {Array<object>}\n * @static\n */\nCommon.heapPermutations = function (arrElement) {\n    var arr = arrElement.slice();\n    var permutations = [];\n\n    function swap(a, b) {\n        var tmp = arr[a];\n        arr[a] = arr[b];\n        arr[b] = tmp;\n    }\n\n    function generate(n) {\n        if (n == 1) permutations.push(arr.slice());else {\n            for (var i = 0; i != n; ++i) {\n                generate(n - 1);\n                swap(n % 2 ? 0 : i, n - 1);\n            }\n        }\n    }\n\n    generate(arr.length);\n\n    return permutations;\n};\n\n/**\n * @returns Number\n */\nCommon.getScreenPositionLeft = function () {\n    return Math.max(0, Common.STAGE_WIDTH * 0.5 - P3.View.width * 0.5);\n};\n\n/**\n * @returns Number\n */\nCommon.getScreenPositionRight = function () {\n    return Math.min(Common.STAGE_WIDTH, Common.STAGE_WIDTH * 0.5 + P3.View.width * 0.5);\n};\n\nCommon.distanceBetween = function (point1, point2) {\n    return Math.sqrt(Math.pow(point2.x - point1.x, 2) + Math.pow(point2.y - point1.y, 2));\n};\n\nCommon.angleBetween = function (point1, point2) {\n    return Math.atan2(point2.x - point1.x, point2.y - point1.y);\n};\n\nCommon.randomFloat = function (min, max) {\n    return Math.random() * (max - min) + min;\n};\n\nCommon.midPointBtw = function (p1, p2) {\n    return {\n        x: p1.x + (p2.x - p1.x) / 2,\n        y: p1.y + (p2.y - p1.y) / 2\n    };\n};\n\nCommon.hexToRgb = function (hex) {\n    var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n\n    return result ? {\n        r: parseInt(result[1], 16),\n        g: parseInt(result[2], 16),\n        b: parseInt(result[3], 16)\n    } : null;\n};\n\n/**\n * @type {number}\n * @static\n */\nCommon.findPositionInScene = function (sprite, scene) {\n    var result = new PIXI.Point(sprite.x, sprite.y);\n\n    var parent = sprite.parent;\n    while (parent != scene) {\n        result.x += parent.x;\n        result.y += parent.y;\n\n        parent = parent.parent;\n    }\n\n    return result;\n};\n\nwindow.Common = Common;\n\n},{\"./Application\":2}],4:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"./Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction CommonGame() {}\nexports.default = CommonGame;\n\n//===================================================\n//\n// Enumerators\n//\n//===================================================\n\n// Scene types.\n\nCommonGame.SCENE_ID_MAIN = 0;\nCommonGame.SCENE_ID_GAME = 1;\nCommonGame.SCENE_ID_IMAGE_SELECTION = 2;\nCommonGame.SCENE_ID_GALLERY_SELECTION = 3;\n\n// Layer types.\nCommonGame.LAYER_ID_FILL = 0;\nCommonGame.LAYER_ID_DRAW = 1;\n\n// Gallery types.\nCommonGame.GALLERY_ID_DRAW_IT = 0;\nCommonGame.GALLERY_ID_COLOUR_IT = 1;\n\nCommonGame.ARR_COLOUR_IT_SPRITE_ID = [\"colour_image_1\", \"colour_image_2\", \"colour_image_3\", \"colour_image_4\", \"colour_image_5\", \"colour_image_6\", \"colour_image_7\", \"colour_image_8\", \"colour_image_9\", \"colour_image_10\"];\n\nCommonGame.ARR_DRAW_IT_SPRITE_ID = [\"draw_image_1\", \"draw_image_2\", \"draw_image_3\", \"draw_image_4\", \"draw_image_5\", \"draw_image_6\", \"draw_image_7_\", \"draw_image_8\", \"draw_image_9\", \"draw_image_10\"];\n\nCommonGame.TUT_EVENT = {\n    TOOL_BAR_HIDDEN: 0,\n    TOOL_BAR_VISIBLE: 1,\n    PALETTE_SELECTED: 2,\n    PALETTE_PANEL_HIDDEN: 3,\n    TOOL_SELECTED: 4,\n    CANVAS_DRAWN: 5,\n    CANVAS_VISIBLE: 6,\n    PALETTE_BUTTON_ENABLED: 7,\n    PALETTE_BUTTON_DISABLED: 8,\n    MENU_PANEL_SHOWN: 9,\n    MENU_PANEL_HIDDEN: 10\n};\n\nCommonGame.TOOL = {\n    PENCIL: 0,\n    BRUSH: 1,\n    STAMP: 2,\n    BUCKET: 3,\n    INK_POT: 4,\n    SPRAY: 5,\n    ERASER: 6\n};\n\n//===================================================\n//\n// Constants\n//\n//===================================================\n\nCommonGame.GALLERY_BORDER_TINT = [0x87d027, // Draw it!\n0x1e84c9 // Colour it!\n];\n\nCommonGame.TEXTURE_BUTTON_BASE_ID = \"btns_colour_texture\";\nCommonGame.TEXTURE_SPRITE_BASE_ID = \"texture_fill\";\n\nCommonGame.CANVAS_HEIGHT = 612;\nCommonGame.CANVAS_WIDTH = 870;\n\n//===================================================\n//\n// Attributes\n//\n//===================================================\n\nCommonGame.selectedGallery = null;\nCommonGame.selectedImageId = null;\nCommonGame.drawItTextId = null;\n\n//===================================================\n//\n// Methods\n//\n//===================================================\n\nCommonGame.createCanvasBg = function () {\n    var SCALE_FACTOR = 0.979;\n\n    var galleryKey = \"drawing\";\n    if (CommonGame.selectedGallery === 1) galleryKey = \"colouring\";\n\n    var canvasTex = _Common2.default.assets.getTexture(\"canvas_\" + galleryKey);\n    var canvasBg = new PIXI.Graphics();\n    canvasBg.beginFill(CommonGame.GALLERY_BORDER_TINT[CommonGame.selectedGallery], 1);\n    canvasBg.drawRoundedRect(-canvasTex.width * 0.5 * SCALE_FACTOR, -canvasTex.height * 0.5 * SCALE_FACTOR, canvasTex.width * SCALE_FACTOR, canvasTex.height * SCALE_FACTOR, 30);\n    canvasBg.endFill();\n\n    return canvasBg;\n};\n\nCommonGame.findColourCode = function (selection) {\n    var result = { r: 0, g: 0, b: 1 };\n\n    var pages = _Common2.default.assets.getJSON(\"config\").palettePanel.pages;\n    for (var i = 0; i < pages.length; ++i) {\n        var itemIndex = pages[i].indexOf(selection);\n        if (itemIndex != -1) {\n            result.r = i;\n            result.g = itemIndex;\n\n            break;\n        }\n    }\n\n    return result;\n};\n\n},{\"./Common\":3}],5:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Application = require(\"./Application\");\n\nvar _Application2 = _interopRequireDefault(_Application);\n\nvar _PreloaderScene = require(\"./scenes/PreloaderScene\");\n\nvar _PreloaderScene2 = _interopRequireDefault(_PreloaderScene);\n\nvar _Common = require(\"./Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _ismobilejs = require(\"ismobilejs\");\n\nvar _ismobilejs2 = _interopRequireDefault(_ismobilejs);\n\nvar _pixiMultistyleText = require(\"./pixi-multistyle-text\");\n\nvar _pixiMultistyleText2 = _interopRequireDefault(_pixiMultistyleText);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Main = function () {\n    /**\r\n     * @param {number} width\r\n     * @param {number} height\r\n     */\n    function Main(width, height) {\n        _classCallCheck(this, Main);\n\n        /**\r\n         * @member {!number}\r\n         * @private\r\n         */\n        this._width = width;\n\n        /**\r\n         * @member {!number}\r\n         * @private\r\n         */\n        this._height = height;\n\n        /**\r\n         * @member {PreloaderScene}\r\n         * @private\r\n         */\n        this._preloader = null;\n    }\n\n    _createClass(Main, [{\n        key: \"init\",\n        value: function init(language) {\n\n            _Common2.default.blankTexture = PIXI.Texture.WHITE;\n\n            _Common2.default.assets = new P3.AssetManager();\n            _Common2.default.audio = P3.Button.audio = new P3.AudioManager();\n            _Common2.default.language = language;\n\n            _Common2.default.assets.texture.bind(_Common2.default.assets);\n\n            //--for legacy--//\n            P3.Device = {};\n            P3.Device.isMobile = _ismobilejs2.default.any;\n\n            //wrapped to make compatible with p3lib v5\n            _Common2.default.assets.getTexture = function (name) {\n                return _Common2.default.assets.texture(name);\n            };\n            _Common2.default.assets.getJSON = function (name) {\n                return _Common2.default.assets.json(name);\n            };\n            _Common2.default.assets.hasTexture = function (name) {\n                var bool = true;\n                try {\n                    PIXI.Texture.fromFrame(name + \".png\");\n                } catch (err) {\n                    bool = false;\n                }\n                return bool;\n            };\n\n            //Common.loadMute();\n            //Common.loadGame();\n\n            var isPortrait = false;\n\n            var params = {};\n            params.holderId = \"game\";\n            params.width = this._width;\n            params.height = this._height;\n            params.portrait = isPortrait;\n            params.aspectRatioFillHeight = !isPortrait;\n            params.rotateImageUrl = \"./assets/images/localisation/rotate/rotate_screen_\" + language + \".jpg\";\n            params.rotateImageColor = \"#000000\";\n\n            PIXI.settings.RETINA_PREFIX = /\\_(?=[^_]*$)(.+)x/;\n\n            TweenMax.defaultOverwrite = \"none\";\n            TweenMax.ticker.fps(60);\n\n            var view = new P3.View(params);\n            view.signals.ready.addOnce(function (canvas) {\n\n                var options = {};\n                options.view = canvas;\n                options.transparent = false;\n                options.antialias = false;\n                options.preserveDrawingBuffer = false;\n                options.resolution = 1.0;\n\n                _Common2.default.stage = new PIXI.Container();\n\n                // hotfix\n                canvas.screencanvas = true;\n\n                // const input = new Input();\n                // input.init(stage, canvas);\n                //  Common.input = input;\n\n                //on clicking the document focus on canvas, fix for buttons not working on mobile\n                document.onclick = function () {\n                    canvas.focus();\n                };\n\n                var renderer = PIXI.autoDetectRenderer(this._width, this._height, options);\n                renderer.backgroundColor = 0x000000;\n                _Common2.default.renderer = renderer;\n                _Common2.default.isWebGL = renderer instanceof PIXI.WebGLRenderer;\n\n                var scene = new P3.SceneManager(renderer);\n                scene.updateAll = true;\n                _Common2.default.scene = scene;\n                _Common2.default.stage.addChild(scene.view);\n\n                PIXI.ticker.shared.add(function (deltaTime) {\n\n                    window.P3.deltaTime = window.deltaTime = deltaTime / PIXI.settings.TARGET_FPMS / 1000;\n                    P3.Timestep.deltaTime = window.deltaTime;\n                    scene.update();\n                    renderer.render(_Common2.default.stage);\n                }, this);\n\n                window.delay = function (callback, delay, scope) {\n                    TweenMax.delayedCall(delay, callback, [], scope);\n                };\n                window.translate = function (str) {\n                    var s = _Common2.default.config.strings[str];\n                    s = s && s[_Common2.default.language];\n                    return typeof s !== \"undefined\" ? s : str;\n                };\n\n                this.loadPreloader();\n            }, this);\n            view.signals.resize.add(this.onCanvasResize, this);\n            _Common2.default.view = view;\n        }\n    }, {\n        key: \"loadPreloader\",\n        value: function loadPreloader() {\n            var files = [\n            //sprite sheets\n            { name: \"ui_default_0_1x\", url: \"images/\" + \"ui_default_0_1x\" + \".json\" }, { name: \"ui_default_1_1x\", url: \"images/\" + \"ui_default_1_1x\" + \".json\" }, { name: \"preloader\", url: \"images/\" + \"preloader_1x\" + \".json\" }, { name: \"aeromaticslight_50\", url: \"fonts/\" + \"aeromaticslight_50\" + \".xml\" //preloader font\n            }];\n            var sounds = [];\n            if (files.length) {\n                _Common2.default.assets.addFiles(files, \"assets/\");\n                _Common2.default.assets.signals.complete.addOnce(function () {\n                    this.createConfig();\n                    this.loadAssets();\n                }, this);\n                _Common2.default.assets.load();\n                _Common2.default.audio.addSounds(sounds, [\".mp3\", \".ogg\"], \"\");\n            } else {\n                this.loadAssets();\n            }\n        }\n    }, {\n        key: \"loadAssets\",\n        value: function loadAssets() {\n\n            var files = [\n            // json.\n            { name: \"languages\", url: \"data/\" + \"languages\" + \".json\" }, { name: \"config\", url: \"data/\" + \"config\" + \".json\" }, { name: \"draw_it\", url: \"data/\" + \"draw_it\" + \".json\" },\n            // texture sheets.\n            { name: \"ui_default_0_1x\", url: \"images/\" + \"ui_default_0_1x\" + \".json\" }, { name: \"ui_default_1_1x\", url: \"images/\" + \"ui_default_1_1x\" + \".json\" },\n            // raw images.\n            { name: \"game_title\", url: \"images/localisation/title/\" + \"title_\" + _Common2.default.language + \".png\" }, { name: \"colour_image_1\", url: \"images/outlines/colour_it/\" + \"image_1\" + \".png\" }, { name: \"colour_image_2\", url: \"images/outlines/colour_it/\" + \"image_2\" + \".png\" }, { name: \"colour_image_3\", url: \"images/outlines/colour_it/\" + \"image_3\" + \".png\" }, { name: \"colour_image_4\", url: \"images/outlines/colour_it/\" + \"image_4\" + \".png\" }, { name: \"colour_image_5\", url: \"images/outlines/colour_it/\" + \"image_5\" + \".png\" }, { name: \"colour_image_6\", url: \"images/outlines/colour_it/\" + \"image_6\" + \".png\" }, { name: \"colour_image_7\", url: \"images/outlines/colour_it/\" + \"image_7\" + \".png\" }, { name: \"colour_image_8\", url: \"images/outlines/colour_it/\" + \"image_8\" + \".png\" }, { name: \"colour_image_9\", url: \"images/outlines/colour_it/\" + \"image_9\" + \".png\" }, { name: \"colour_image_10\", url: \"images/outlines/colour_it/\" + \"image_10\" + \".png\" }, { name: \"draw_image_1\", url: \"images/outlines/draw_it/\" + \"image_1\" + \".png\" }, { name: \"draw_image_2\", url: \"images/outlines/draw_it/\" + \"image_2\" + \".png\" }, { name: \"draw_image_3\", url: \"images/outlines/draw_it/\" + \"image_3\" + \".png\" }, { name: \"draw_image_4\", url: \"images/outlines/draw_it/\" + \"image_4\" + \".png\" }, { name: \"draw_image_5\", url: \"images/outlines/draw_it/\" + \"image_5\" + \".png\" }, { name: \"draw_image_6\", url: \"images/outlines/draw_it/\" + \"image_6\" + \".png\" }, { name: \"draw_image_7\", url: \"images/outlines/draw_it/\" + \"image_7\" + \".png\" }, { name: \"draw_image_8\", url: \"images/outlines/draw_it/\" + \"image_8\" + \".png\" }, { name: \"draw_image_9\", url: \"images/outlines/draw_it/\" + \"image_9\" + \".png\" }, { name: \"draw_image_10\", url: \"images/outlines/draw_it/\" + \"image_10\" + \".png\" },\n\n            // bgs.\n            { name: \"splash_bg\", url: \"images/bg/\" + \"splash_bg\" + \".jpg\" }, { name: \"bg\", url: \"images/bg/\" + \"bg_1x\" + \".jpg\" },\n            // fonts.\n\n            // particles.\n            { name: \"eraser_ps\", url: \"particles/\" + \"particle_emitter_eraser_loop_00\" + \".json\" }, { name: \"ink_ps\", url: \"particles/\" + \"particle_emitter_ink_loop_00\" + \".json\" }, { name: \"ink_splatter_ps\", url: \"particles/\" + \"particle_emitter_inksplatter_loop_01\" + \".json\" }, { name: \"brush_ps\", url: \"particles/\" + \"particle_emitter_paintbrush_loop_00\" + \".json\" }, { name: \"pencil_ps\", url: \"particles/\" + \"particle_emitter_pencil_loop_00\" + \".json\" }, { name: \"spray_ps\", url: \"particles/\" + \"particle_emitter_spray_loop_00\" + \".json\" }, { name: \"stamp_ps\", url: \"particles/\" + \"particle_emitter_stamo_burst_00\" + \".json\" }, { name: \"fill_ps\", url: \"particles/\" + \"particle_paintfill_burst_00\" + \".json\" },\n\n            //--spine--//\n            { name: \"tutorial_hand\", url: \"images/\" + \"tutorial_hand\" + \".json\" }];\n            var music = [\"music_mainmenu_loop_00\", \"music_ready_loop_012\"];\n            var genericSfx = [\"sfx_ambient_desert_loop_00\", \"sfx_drawer_hide_00\", \"sfx_drawer_reveal_00\", \"sfx_generic_colour_type_change_00\", \"sfx_tool_eraser_loop_03\", \"sfx_tool_eraser_select_00\", \"sfx_tool_inkpot_select_00\", \"sfx_tool_inkpot_use_splat_00\", \"sfx_tool_magictape_select_00\", \"sfx_tool_magictape_use_end_only_00\", \"sfx_tool_magictape_use_loop_00\", \"sfx_tool_paintbrush_dry_use_loop_00\", \"sfx_tool_paintbrush_select_00\", \"sfx_tool_paintbrush_wet_use_loop_00\", \"sfx_tool_paintpot_fill_select_01\", \"sfx_tool_paintpot_fill_use_02\", \"sfx_tool_pencil_select_00\", \"sfx_tool_pencil_use_loop_00\", \"sfx_tool_spraycan_select_00\", \"sfx_tool_spraycan_use_loop_00\", \"sfx_tool_stamp_use_00\", \"sfx_tool_stamps_select_00\", \"sfx_tool_sticker_end_only\", \"sfx_tool_sticker_place_00\", \"sfx_tool_sticker_use_00\", \"sfx_tool_stickers_select_00\", \"sfx_tool_trashcan_confirm_00\", \"sfx_tool_trashcan_select_00\", \"sfx_tool_undo_step_back_00\", \"sfx_ui_folder_save_00\", \"sfx_ui_newpage_00\", \"sfx_palette_select_00\", \"sfx_palette_close_00\", \"sfx_ui_carousel_swipe_00\", \"sfx_ui_click_00\", \"sfx_ui_rollover_00\",\n            //  \"vo_happo_ok_00\",\n            //   \"vo_happo_ooh_00\",\n            //   \"vo_happo_ready_00\",\n            \"sfx_btn_play_start_doorbell_00\"];\n            if (files.length) {\n                this._preloader = new _PreloaderScene2.default();\n                _Common2.default.scene.add(this._preloader);\n\n                _Common2.default.assets.addFiles(files, \"assets/\");\n                _Common2.default.assets.signals.progress.add(this.onLoadingProgress, this);\n                _Common2.default.assets.signals.complete.addOnce(this.onLoadingCompleted, this);\n                _Common2.default.assets.load();\n\n                _Common2.default.audio.addSounds(music, [\".m4a\", \".ogg\", \".mp3\"], \"assets/audio/music/\");\n                _Common2.default.audio.addSounds(genericSfx, [\".m4a\", \".ogg\", \".mp3\"], \"assets/audio/sfx/\");\n            } else {\n                this.startGame();\n            }\n        }\n    }, {\n        key: \"createConfig\",\n        value: function createConfig() {\n            var assets = _Common2.default.assets;\n\n            var config = {};\n            _Common2.default.config = config;\n        }\n    }, {\n        key: \"startGame\",\n        value: function startGame() {\n\n            delay(function () {\n                if (!_ismobilejs2.default.any) _Application2.default.init();\n            }, 1.0, this);\n        }\n    }, {\n        key: \"onLoadingProgress\",\n        value: function onLoadingProgress(event) {\n            this._preloader.loaded = event.progress / 100.0;\n        }\n    }, {\n        key: \"onLoadingCompleted\",\n        value: function onLoadingCompleted() {\n            _Common2.default.assets.signals.progress.removeAll();\n            _Common2.default.assets.signals.complete.removeAll();\n            _Common2.default.finishedLoading = true;\n            this._preloader.loaded = 1;\n\n            this.startGame(1);\n        }\n\n        /**\r\n         * @param {boolean} correct\r\n         */\n\n    }, {\n        key: \"onCanvasResize\",\n        value: function onCanvasResize(correct) {\n            if (correct) {\n                _Common2.default.renderer.resize(P3.View.width, P3.View.height);\n                if (_Common2.default.scene) {\n                    _Common2.default.scene.resize();\n                }\n            }\n        }\n    }]);\n\n    return Main;\n}();\n\nexports.default = Main;\n\n\nwindow.Main = Main;\n\n/**\r\n *\r\n * @param copy\r\n * @param fontName\r\n * @param size\r\n * @param holder\r\n * @param colour\r\n * @returns {PIXI.Text}\r\n */\nfunction simpleText(copy, fontName, size, holder, colour) {\n    var col = colour | 0x000000;\n    var textView = new PIXI.Text(copy, { fontFamily: fontName, fontSize: size, fill: col });\n    textView.anchor.x = 0.5;\n    if (holder) holder.addChild(textView);\n    return textView;\n}\nP3.simpleText = simpleText;\n\n/**\r\n * Creates and returns a new UI button\r\n * @param point {PIXI.Point}\r\n * @param type\r\n * @param callback\r\n * @param scope\r\n * @param params\r\n * @returns {Button}\r\n */\n/*\r\n function createButton(point, type, callback, scope, params = {holder: null, text: null, icon: null}) {\r\n\r\n const states = new P3.ButtonStates();\r\n\r\n if (!type || type === \"blank\") {\r\n\r\n states.normal = PIXI.Texture.EMPTY;\r\n states.down = PIXI.Texture.EMPTY;\r\n\r\n } else if (typeof type === \"string\") {\r\n\r\n if (Common.assets.hasTexture(\"btn_\" + type + \"_up\")) {\r\n states.normal = Common.assets.texture(\"btn_\" + type + \"_up\");\r\n } else if (Common.assets.hasTexture(\"buttons/ui_\" + \"btn_\" + type + \"_up\")) {\r\n states.normal = Common.assets.texture(\"buttons/ui_\" + \"btn_\" + type + \"_up\");\r\n }\r\n\r\n if (Common.assets.hasTexture(\"btn_\" + type + \"_down\")) {\r\n states.down = Common.assets.texture(\"btn_\" + type + \"_down\");\r\n } else if (Common.assets.texture(\"buttons/ui_\" + \"btn_\" + type + \"_down\")) {\r\n states.down = Common.assets.texture(\"buttons/ui_\" + \"btn_\" + type + \"_down\");\r\n }\r\n\r\n if (Common.assets.hasTexture(\"btn_\" + type + \"_over\")) {\r\n states.over = Common.assets.texture(\"btn_\" + type + \"_over\");\r\n }\r\n\r\n } else {\r\n\r\n states.normal = type;\r\n\r\n }\r\n\r\n const button = new Button(states);\r\n button.x = point.x;\r\n button.y = point.y;\r\n button.anchor = new PIXI.Point(0.5, 0.5);\r\n button.animate = true;\r\n\r\n button.signals.click.add(callback, scope);\r\n\r\n //  buttons/ui_icon_close\r\n\r\n if (params) {\r\n if (params.holder) {\r\n params.holder.addChild(button);\r\n }\r\n if (params.icon) {\r\n let sp;\r\n if (Common.assets.hasTexture(params.icon)) {\r\n sp = P3.createSprite(params.icon);\r\n } else {\r\n sp = P3.createSprite(\"buttons/ui_\" + params.icon);\r\n }\r\n sp.anchor.set(0.5);\r\n button.addChild(sp);\r\n button.icon = sp;\r\n }\r\n if (params.text) {\r\n let txtView = P3.simpleText(params.text, \"consolas\", 45, button, 0xffffff);//new PIXI.extras.BitmapText(text, {font: \"45px Calibri\"});\r\n txtView.anchor = {x: 0.5, y: 0.5};\r\n button.txtView = txtView;\r\n }\r\n }\r\n\r\n return button;\r\n }\r\n P3.createButton = createButton;\r\n */\n\n/**\r\n * @param copy {string}\r\n * @param config {object}\r\n * @param override {string} - overrides default language font type\r\n * @param jsonName\r\n * @returns {PIXI.Text|PIXI.BitmapText}\r\n */\nfunction createText(copy, config, override, jsonName) {\n    var textView, conf;\n    var str = jsonName || \"languages\";\n    if (_Common2.default.language === \"ar\") {\n        conf = {\n            font: config.size + \" Noto Kufi Arabic\",\n            fill: config.fill,\n            align: \"center\",\n            //  letterSpacing: 5,\n            padding: config.padding || 0\n        };\n        if (config.wordWrapWidth) {\n            conf.wordWrap = true;\n            conf.wordWrapWidth = config.wordWrapWidth;\n        }\n        if (config.stroke) {\n            conf.stroke = config.stroke;\n            conf.strokeThickness = 4 || config.strokeThickness;\n        }\n        Object.assign(conf, config);\n        textView = new PIXI.Text(_Common2.default.assets.getJSON(str)[copy][_Common2.default.language], conf);\n    } else {\n        conf = {\n            font: config.size + \" Duality\",\n            fill: config.fill,\n            align: \"center\",\n            letterSpacing: 4,\n            padding: config.padding || 0,\n            lineJoin: \"round\"\n        };\n        if (config.wordWrapWidth) {\n            conf.wordWrap = true;\n            conf.wordWrapWidth = config.wordWrapWidth;\n        }\n        if (config.stroke) {\n            conf.stroke = config.stroke;\n            conf.strokeThickness = 8;\n        }\n        Object.assign(conf, config);\n        textView = new PIXI.Text(_Common2.default.assets.getJSON(str)[copy][_Common2.default.language], conf);\n    }\n\n    return textView;\n}\nP3.createText = createText;\n\n/**\r\n * @param copy {string}\r\n * @param config\r\n */\nfunction createMultiText(copy, config) {\n    var textView, conf;\n    var str = \"languages\";\n    if (_Common2.default.language === \"ar\") {\n        conf = {\n            font: config.size + \" Noto Kufi Arabic\",\n            fill: config.fill,\n            align: \"center\",\n            padding: config.padding || 0\n        };\n        if (config.wordWrapWidth) {\n            conf.wordWrap = true;\n            conf.wordWrapWidth = config.wordWrapWidth;\n        }\n        if (config.stroke) {\n            conf.stroke = config.stroke;\n            conf.strokeThickness = 4 || config.strokeThickness;\n        }\n        textView = new PIXI.Text(_Common2.default.assets.getJSON(str)[copy][_Common2.default.language], conf);\n    } else {\n        conf = {\n            font: config.size + \" Duality\",\n            fill: 0xffffff,\n            align: \"center\",\n            letterSpacing: 4,\n            padding: config.padding || 0,\n            lineJoin: \"round\"\n        };\n        if (config.wordWrapWidth) {\n            conf.wordWrap = true;\n            conf.wordWrapWidth = config.wordWrapWidth;\n        }\n        if (config.stroke) {\n            conf.stroke = config.stroke;\n            conf.strokeThickness = 8;\n        }\n\n        //LOL...\n        var confCopy = Object.assign({}, conf);\n        delete confCopy.fill;\n        var realConfig = { //deliberately made larger than needs to be, trying to ovoid overflow\n            \"default\": conf,\n            \"s0\": Object.assign({ fill: \"#fff200\" }, confCopy), //\n            \"s1\": Object.assign({ fill: \"#00bff3\" }, confCopy), //\n            \"s2\": Object.assign({ fill: \"#00a650\" }, confCopy), //\n            \"s3\": Object.assign({ fill: \"#00bff3\" }, confCopy), //\n            \"s4\": Object.assign({ fill: \"#ff4b96\" }, confCopy), //\n            \"s5\": Object.assign({ fill: \"#ff2600\" }, confCopy), //red\n            \"s6\": Object.assign({ fill: \"#f26522\" }, confCopy), //orange\n            \"s7\": Object.assign({ fill: \"#fff200\" }, confCopy), //yellow\n            \"s8\": Object.assign({ fill: \"#00a650\" }, confCopy), //green\n            \"s9\": Object.assign({ fill: \"#fff200\" }, confCopy),\n            \"s10\": Object.assign({ fill: \"#00bff3\" }, confCopy),\n            \"s11\": Object.assign({ fill: \"#00a650\" }, confCopy),\n            \"s12\": Object.assign({ fill: \"#00bff3\" }, confCopy),\n            \"s13\": Object.assign({ fill: \"#ff4b96\" }, confCopy),\n            \"s14\": Object.assign({ fill: \"#f26522\" }, confCopy),\n            \"s15\": Object.assign({ fill: \"#fff200\" }, confCopy),\n            \"s16\": Object.assign({ fill: \"#00a650\" }, confCopy),\n            \"s17\": Object.assign({ fill: \"#ff2600\" }, confCopy),\n            \"s18\": Object.assign({ fill: \"#00a650\" }, confCopy),\n            \"s19\": Object.assign({ fill: \"#00a650\" }, confCopy),\n            \"s20\": Object.assign({ fill: \"#00a650\" }, confCopy),\n            \"s21\": Object.assign({ fill: \"#00a650\" }, confCopy),\n            \"s22\": Object.assign({ fill: \"#00a650\" }, confCopy),\n            \"s23\": Object.assign({ fill: \"#00a650\" }, confCopy)\n        };\n\n        var realCopy = _Common2.default.assets.getJSON(str)[copy][_Common2.default.language];\n        var copyArr = realCopy.split(\"\");\n        var finalCopy = \"\";\n        for (var i = 0; i < copyArr.length; i++) {\n            finalCopy += \"<s\" + i + \">\";\n            finalCopy += copyArr[i];\n            finalCopy += \"</s\" + i + \">\";\n        }\n\n        //--create the text--//\n        textView = new _pixiMultistyleText2.default(finalCopy, realConfig);\n    }\n\n    return textView;\n}\nP3.createMultiText = createMultiText;\n\nfunction createButton(icon, type) {\n    type = type || 'primary_small';\n    var buttonStates = new P3.ButtonStates(_Common2.default.assets.getTexture('btn_' + type + '_off'), _Common2.default.assets.getTexture('btn_' + type + '_over'), _Common2.default.assets.getTexture('btn_' + type + '_down'), _Common2.default.assets.getTexture(\"icon_\" + icon + '_off'));\n\n    buttonStates.iconOver = _Common2.default.assets.getTexture(\"icon_\" + icon + '_over');\n    buttonStates.iconDown = _Common2.default.assets.getTexture(\"icon_\" + icon + '_down');\n\n    var button = void 0;\n    if (icon === 'sound') {\n        buttonStates.iconAlt = _Common2.default.assets.getTexture('icon_' + \"mute\" + '_off');\n        buttonStates.iconOverAlt = _Common2.default.assets.getTexture('icon_' + \"mute\" + '_over');\n        buttonStates.iconDownAlt = _Common2.default.assets.getTexture('icon_' + \"mute\" + '_down');\n        button = new P3.MuteButton(buttonStates);\n    } else {\n        button = new P3.Button(buttonStates);\n    }\n    return button;\n}\n\nwindow.createButton = createButton;\n\nfunction Timestep() {}\nTimestep.deltaTime = 0;\nP3.Timestep = Timestep;\n\n},{\"./Application\":2,\"./Common\":3,\"./pixi-multistyle-text\":26,\"./scenes/PreloaderScene\":31,\"ismobilejs\":1}],6:[function(require,module,exports){\n\"use strict\";\n\nvar Common = require(\"./Common\");\nvar CommonGame = require(\"./CommonGame\");\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\nfunction SavedData() {\n\tvar assetManager = P3.AssetManager.instance;\n\n\t/**\n  * @type {String}\n  * @const\n  */\n\tthis.SAVE_NAME = \"customer_focus\";\n\tthis.SAVE_VERSION = \"0.0.18\";\n\tthis.SAVE_SEED = \"y5k0Eo6R177mUkb\";\n\n\t/**\n  * @type {Boolean}\n  */\n\tthis._isToolTutorial = true;\n\tthis._isDrawTutorial = true;\n\tthis._isPaletteTutorial = true;\n}\nmodule.exports = SavedData;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nSavedData.prototype.init = function () {\n\tif (!window.localStorage[this.SAVE_NAME + \"_\" + this.SAVE_VERSION]) {\n\t\t//console.log( 'reset' );\n\t\tthis.reset();\n\t\tthis.save();\n\t} else {\n\t\t//console.log( 'load' );\n\t\tthis.load();\n\t}\n};\n\nSavedData.prototype.reset = function () {\n\tthis._isToolTutorial = true;\n\tthis._isDrawTutorial = true;\n\tthis._isPaletteTutorial = true;\n};\n\nSavedData.prototype.load = function () {\n\tvar data = window.localStorage[this.SAVE_NAME + \"_\" + this.SAVE_VERSION];\n\tdata = JSON.parse(data);\n\n\tthis._isToolTutorial = data.isToolTutorial;\n\tthis._isDrawTutorial = data.isDrawTutorial;\n\tthis._isPaletteTutorial = data.isPaletteTutorial;\n};\n\nSavedData.prototype.save = function () {\n\t//console.log( 'save' );\n\tvar data = {};\n\tdata.isToolTutorial = this._isToolTutorial;\n\tdata.isDrawTutorial = this._isDrawTutorial;\n\tdata.isPaletteTutorial = this._isPaletteTutorial;\n\n\tvar json = JSON.stringify(data);\n\tdata.hash = md5(json + this.SAVE_SEED);\n\n\twindow.localStorage[this.SAVE_NAME + \"_\" + this.SAVE_VERSION] = JSON.stringify(data);\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(SavedData.prototype, \"isToolTutorial\", { get: function get() {\n\t\treturn this._isToolTutorial;\n\t},\n\tset: function set(a) {\n\t\tthis._isToolTutorial = a;\n\t} });\n\nObject.defineProperty(SavedData.prototype, \"isDrawTutorial\", { get: function get() {\n\t\treturn this._isDrawTutorial;\n\t},\n\tset: function set(a) {\n\t\tthis._isDrawTutorial = a;\n\t} });\n\nObject.defineProperty(SavedData.prototype, \"isPaletteTutorial\", { get: function get() {\n\t\treturn this._isPaletteTutorial;\n\t},\n\tset: function set(a) {\n\t\tthis._isPaletteTutorial = a;\n\t} });\n\n},{\"./Common\":3,\"./CommonGame\":4}],7:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _PalettePanel = require(\"../ui/overlays/PalettePanel\");\n\nvar _PalettePanel2 = _interopRequireDefault(_PalettePanel);\n\nvar _MagicBrush = require(\"./MagicBrush\");\n\nvar _MagicBrush2 = _interopRequireDefault(_MagicBrush);\n\nvar _ColourBrush = require(\"./ColourBrush\");\n\nvar _ColourBrush2 = _interopRequireDefault(_ColourBrush);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction Brush() {\n    // Attributes.\n    this._drawLayer = null;\n    this._magicBrush = null;\n    this._colourBrush = null;\n    this._paletteItem = null;\n    this._curBrush = null;\n    this._audio = null;\n}\nexports.default = Brush;\n//module.exports = Brush;\n\nBrush.prototype.constructor = Brush;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nBrush.prototype.init = function (drawLayer) {\n    this._drawLayer = drawLayer;\n\n    // Magic brush.\n    this._magicBrush = new _MagicBrush2.default();\n    this._magicBrush.init(drawLayer);\n\n    // Colour brush.\n    this._colourBrush = new _ColourBrush2.default();\n    this._colourBrush.init(drawLayer);\n\n    // Set initial brush.\n    this._curBrush = this._colourBrush;\n    this._curBrush.colour = _Common2.default.assets.getJSON(\"config\").palettePanel.pages[0][0];\n    this._paletteItem = this._curBrush.colour;\n\n    // Signals.\n    _Common2.default.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\n};\n\nBrush.prototype._stopAudio = function () {\n    this._audio.howl.stop(this._audio.id);\n    this._audio = null;\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nBrush.prototype._draw = function (from, to) {\n    // TEST: DYN_OUT:\n    var dynOutlineContext = _Common2.default.game.canvas.drawLayer.dynOutlineContext;\n    dynOutlineContext.beginPath();\n    dynOutlineContext.strokeStyle = \"black\";\n    dynOutlineContext.lineWidth = this._curBrush.LINE_THICKNESS;\n    dynOutlineContext.lineJoin = \"round\";\n    dynOutlineContext.moveTo(from.x, from.y);\n    dynOutlineContext.lineTo(to.x, to.y);\n    dynOutlineContext.closePath();\n    dynOutlineContext.stroke();\n};\n\nBrush.prototype._stopAudio = function () {\n    this._audio.howl.stop(this._audio.id);\n    this._audio = null;\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nBrush.prototype.onDrawBegan = function (point) {\n    this._curBrush.onDrawBegan(point);\n    // TEST: DYN_OUT:\n    this._draw(point, new PIXI.Point(point.x + 0.1, point.y + 0.1));\n};\n\nBrush.prototype.onDrawMoved = function (from, to) {\n    // Sfx.\n    if (this._audio == null) this._audio = _Common2.default.audio.playSound(\"sfx_tool_paintbrush_wet_use_loop_00\", { \"loop\": true });\n    TweenMax.killDelayedCallsTo(this._stopAudio);\n    TweenMax.delayedCall(0.25, this._stopAudio, null, this);\n\n    this._curBrush.onDrawMoved(from, to);\n    // TEST: DYN_OUT:\n    this._draw(from, to);\n};\n\nBrush.prototype.onDrawEnded = function () {\n    // Sfx.\n    TweenMax.killDelayedCallsTo(this._stopAudio);\n    if (this._audio != null) this._stopAudio();\n\n    // TEST: DYN_OUT:\n    _Common2.default.game.canvas.drawLayer.dynOutlineData = _Common2.default.game.canvas.drawLayer.dynOutlineContext.getImageData(0, 0, _Common2.default.game.canvas.WIDTH, _Common2.default.game.canvas.HEIGHT);\n};\n\nBrush.prototype._onColour_Changed = function (selection) {\n    if (selection.indexOf(\"#\") == 0) {\n        this._curBrush = this._colourBrush;\n        this._colourBrush.colour = selection;\n    } else {\n        this._curBrush = this._magicBrush;\n        this._magicBrush.textureId = selection;\n    }\n\n    this._paletteItem = selection;\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(Brush.prototype, \"paletteItem\", {\n    get: function get() {\n        return this._paletteItem;\n    }\n});\n\n},{\"../Common\":3,\"../ui/overlays/PalettePanel\":38,\"./ColourBrush\":9,\"./MagicBrush\":16}],8:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _MyGame = require(\"./MyGame\");\n\nvar _MyGame2 = _interopRequireDefault(_MyGame);\n\nvar _FillLayer = require(\"./FillLayer\");\n\nvar _FillLayer2 = _interopRequireDefault(_FillLayer);\n\nvar _DrawLayer = require(\"./DrawLayer\");\n\nvar _DrawLayer2 = _interopRequireDefault(_DrawLayer);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction Canvas() {\n    PIXI.Container.call(this);\n\n    // Attributes.\n    this._fillLayer = null;\n    this._drawLayer = null;\n\n    // Sprites.\n    this._bgSprite = null;\n    this._borderSprite = null;\n\n    // Constants.\n    this.WIDTH = _CommonGame2.default.CANVAS_WIDTH; //Common.STAGE_WIDTH\n    this.HEIGHT = _CommonGame2.default.CANVAS_HEIGHT; //Common.STAGE_HEIGHT\n}\nexports.default = Canvas;\n//module.exports = Canvas;\n\nCanvas.prototype = Object.create(PIXI.Container.prototype);\nCanvas.prototype.constructor = Canvas;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nCanvas.prototype.init = function () {\n    // Bg.\n    this.addChild(_CommonGame2.default.createCanvasBg());\n\n    this._bgSprite = new PIXI.Sprite(_Common2.default.blankTexture);\n    this._bgSprite.anchor = new PIXI.Point(0.5, 0.5);\n    this._bgSprite.width = this.WIDTH;\n    this._bgSprite.height = this.HEIGHT;\n    this._bgSprite.tint = 0xffffff;\n\n    this.addChild(this._bgSprite);\n\n    // Layers.\n    // Fill.\n    this._fillLayer = new _FillLayer2.default();\n    this._fillLayer.init();\n    this.addChild(this._fillLayer);\n    // Draw.\n    this._drawLayer = new _DrawLayer2.default();\n    this._drawLayer.init();\n    this.addChild(this._drawLayer);\n\n    var galleryKey = \"drawing\";\n    if (_CommonGame2.default.selectedGallery === 1) galleryKey = \"colouring\";\n\n    // Border.\n    this._borderSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"canvas_\" + galleryKey));\n    this._borderSprite.anchor = new PIXI.Point(0.5, 0.5);\n    this.addChild(this._borderSprite);\n\n    // Listen to HUD controls.\n    _Common2.default.game.hud.signals.onDrawModeChanged.add(this._onDrawMode_Changed, this);\n\n    // Start with the pencil\n    this._onDrawMode_Changed(_CommonGame2.default.TOOL.PENCIL);\n};\n\nCanvas.prototype.update = function () {\n    this._fillLayer.update();\n    this._drawLayer.update();\n};\n\nCanvas.prototype.animateIn = function () {\n    this.y -= 100;\n    this.alpha = 0;\n    TweenMax.to(this, 0.25, {\n        alpha: 1,\n        y: this.y + 100,\n        ease: Sine.easeOut,\n        onComplete: function onComplete() {\n            _Common2.default.game.scene.addTutorialEvent(_CommonGame2.default.TUT_EVENT.CANVAS_VISIBLE);\n        },\n        onCompleteScope: this\n    });\n};\n\nCanvas.prototype.clear = function () {\n    this._fillLayer.clear();\n    this._drawLayer.clear();\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\n// TODO:\n\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nCanvas.prototype._onDrawMode_Changed = function (selection) {\n    if (selection == _CommonGame2.default.TOOL.PENCIL || selection == _CommonGame2.default.TOOL.BRUSH || selection == _CommonGame2.default.TOOL.SPRAY || selection == _CommonGame2.default.TOOL.STAMP || selection == _CommonGame2.default.TOOL.INK_POT || selection == _CommonGame2.default.TOOL.ERASER) {\n        this._drawLayer.setEnabled(true);\n        this._fillLayer.setEnabled(false);\n    } else if (selection == _CommonGame2.default.TOOL.BUCKET) {\n        this._drawLayer.setEnabled(false);\n        this._fillLayer.setEnabled(true);\n    }\n\n    // Sfx.\n    _Common2.default.audio.playSound(\"sfx_tool_paintbrush_select_00\");\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(Canvas.prototype, \"fillLayer\", {\n    get: function get() {\n        return this._fillLayer;\n    }\n});\n\nObject.defineProperty(Canvas.prototype, \"drawLayer\", {\n    get: function get() {\n        return this._drawLayer;\n    }\n});\n\n},{\"../Common\":3,\"../CommonGame\":4,\"./DrawLayer\":11,\"./FillLayer\":13,\"./MyGame\":18}],9:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction ColourBrush() {\n    // Constants.\n    this.LINE_THICKNESS = 10;\n\n    // Attributes.\n    this._drawLayer = null;\n    this._colour = null;\n}\nexports.default = ColourBrush;\n//module.exports               \t\t= ColourBrush;\n\nColourBrush.prototype.constructor = ColourBrush;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nColourBrush.prototype.init = function (drawLayer) {\n    this._drawLayer = drawLayer;\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nColourBrush.prototype._draw = function (start, end) {\n    var dist = Math.round(_Common2.default.distanceBetween(start, end));\n    var angle = _Common2.default.angleBetween(start, end);\n\n    var lastX = Math.round(start.x + Math.sin(angle) * dist),\n        lastY = Math.round(start.y + Math.cos(angle) * dist);\n\n    for (var i = 0; i < dist; i += 3) {\n        var x = Math.round(start.x + Math.sin(angle) * i);\n        var y = Math.round(start.y + Math.cos(angle) * i);\n\n        var radGrad = this._drawLayer.context.createRadialGradient(lastX, lastY, this.LINE_THICKNESS, x, y, 0);\n        var rgbColour = _Common2.default.hexToRgb(this._colour);\n        radGrad.addColorStop(0, \"rgba( \" + rgbColour.r + \",\" + rgbColour.g + \",\" + rgbColour.b + \", 0 )\");\n        radGrad.addColorStop(1, \"rgba( \" + rgbColour.r + \",\" + rgbColour.g + \",\" + rgbColour.b + \", 1 )\");\n\n        this._drawLayer.context.fillStyle = radGrad;\n        this._drawLayer.context.fillRect(x - this.LINE_THICKNESS, y - this.LINE_THICKNESS, this.LINE_THICKNESS * 2, this.LINE_THICKNESS * 2);\n\n        lastX = x;\n        lastY = y;\n    }\n\n    this._drawLayer.onContext_Changed();\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nColourBrush.prototype.onDrawBegan = function (point) {\n    this._draw(point, new PIXI.Point(point.x + 0.1, point.y + 0.1));\n};\n\nColourBrush.prototype.onDrawMoved = function (from, to) {\n    this._draw(from, to);\n};\n\nColourBrush.prototype.onDrawEnded = function () {};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(ColourBrush.prototype, \"colour\", {\n    get: function get() {\n        return this._colour;\n    },\n    set: function set(a) {\n        this._colour = a;\n    }\n});\n\n},{\"../Common\":3}],10:[function(require,module,exports){\n\"use strict\";\n\nvar Common = require(\"../Common\");\nvar CommonGame = require(\"../CommonGame\");\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction ColourPencil() {\n\t// Constants.\n\tthis.LINE_THICKNESS = 5;\n\n\t// Attributes.\n\tthis._drawLayer = null;\n\tthis._colour = null;\n}\nmodule.exports = ColourPencil;\nColourPencil.prototype.constructor = ColourPencil;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nColourPencil.prototype.init = function (drawLayer) {\n\tthis._drawLayer = drawLayer;\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nColourPencil.prototype._draw = function (from, to) {\n\tthis._drawLayer.context.beginPath();\n\tthis._drawLayer.context.strokeStyle = this._colour;\n\tthis._drawLayer.context.lineWidth = this.LINE_THICKNESS;\n\tthis._drawLayer.context.lineJoin = \"round\";\n\tthis._drawLayer.context.moveTo(from.x, from.y);\n\tthis._drawLayer.context.lineTo(to.x, to.y);\n\tthis._drawLayer.context.closePath();\n\tthis._drawLayer.context.stroke();\n\n\tthis._drawLayer.onContext_Changed();\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nColourPencil.prototype.onDrawBegan = function (point) {\n\tthis._draw(point, new PIXI.Point(point.x + 0.1, point.y + 0.1));\n};\n\nColourPencil.prototype.onDrawMoved = function (from, to) {\n\tthis._draw(from, to);\n};\n\nColourPencil.prototype.onDrawEnded = function () {};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(ColourPencil.prototype, \"colour\", { get: function get() {\n\t\treturn this._colour;\n\t},\n\tset: function set(a) {\n\t\tthis._colour = a;\n\t} });\n\n},{\"../Common\":3,\"../CommonGame\":4}],11:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _Pencil = require(\"./Pencil\");\n\nvar _Pencil2 = _interopRequireDefault(_Pencil);\n\nvar _InkPot = require(\"./InkPot\");\n\nvar _InkPot2 = _interopRequireDefault(_InkPot);\n\nvar _Brush = require(\"./Brush\");\n\nvar _Brush2 = _interopRequireDefault(_Brush);\n\nvar _Spray = require(\"./Spray\");\n\nvar _Spray2 = _interopRequireDefault(_Spray);\n\nvar _Stamp = require(\"./Stamp\");\n\nvar _Stamp2 = _interopRequireDefault(_Stamp);\n\nvar _Eraser = require(\"./Eraser\");\n\nvar _Eraser2 = _interopRequireDefault(_Eraser);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction DrawLayer() {\n    PIXI.Container.call(this);\n\n    // States.\n    this.STATE = {\n        IDLE: 0,\n        DRAWING: 1\n    };\n\n    // Attributes.\n    this._state = this.STATE.IDLE;\n\n    this._canvas2d = null;\n    this._context = null;\n\n    // TEST: DYN_OUT:\n    this._dynOutline_c2d = null;\n    this._dynOutlineContext = null;\n    this._dynOutlineLayerData = null;\n\n    this._pencil = null;\n    this._brush = null;\n    this._spray = null;\n    this._stamp = null;\n    this._inkPot = null;\n    this._drawingTool = null;\n    this._eraser = null;\n\n    this._drawPS = null;\n\n    // Sprites.\n    this._layerSprite = null;\n\n    // Input.\n    this._lastInputLocalPosition = new PIXI.Point();\n    this._updateInputLocalPosition = new PIXI.Point();\n}\nexports.default = DrawLayer;\n//module.exports = DrawLayer;\n\nDrawLayer.prototype = Object.create(PIXI.Container.prototype);\nDrawLayer.prototype.constructor = DrawLayer;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nDrawLayer.prototype.init = function () {\n    // Canvas.\n    this._canvas2d = document.createElement('canvas');\n    this._canvas2d.width = _Common2.default.game.canvas.WIDTH;\n    this._canvas2d.height = _Common2.default.game.canvas.HEIGHT;\n\n    // Context.\n    this._context = this._canvas2d.getContext('2d');\n\n    // TEST: DYN_OUT:\n    this._dynOutline_c2d = document.createElement('canvas');\n    this._dynOutline_c2d.width = _Common2.default.game.canvas.WIDTH;\n    this._dynOutline_c2d.height = _Common2.default.game.canvas.HEIGHT;\n\n    this._dynOutlineContext = this._dynOutline_c2d.getContext('2d');\n    this._dynOutlineContext.fillStyle = 'rgba(0, 0, 0, 0)';\n    this._dynOutlineContext.fillRect(0, 0, this._dynOutline_c2d.width, this._dynOutline_c2d.height);\n\n    this._dynOutlineLayerData = this._dynOutlineContext.getImageData(0, 0, this._dynOutline_c2d.width, this._dynOutline_c2d.height);\n\n    // Tools.\n    // Pencil.\n    this._pencil = new _Pencil2.default();\n    this._pencil.init(this);\n    // Brush.\n    this._brush = new _Brush2.default();\n    this._brush.init(this);\n    // Spray.\n    this._spray = new _Spray2.default();\n    this._spray.init(this);\n    // Stamp.\n    this._stamp = new _Stamp2.default();\n    this._stamp.init(this);\n    // Ink pot.\n    this._inkPot = new _InkPot2.default();\n    this._inkPot.init(this);\n    // Eraser.\n    this._eraser = new _Eraser2.default();\n    this._eraser.init(this, _Common2.default.game.canvas.fillLayer);\n\n    // Layer.\n    this._layerSprite = new PIXI.Sprite(PIXI.Texture.fromCanvas(this._canvas2d));\n    this._layerSprite.anchor = new PIXI.Point(0.5, 0.5);\n    this._layerSprite.interactive = true;\n    this._layerSprite.mousedown = this._layerSprite.touchstart = this._onDrawLayer_MouseDown.bind(this);\n    this._layerSprite.mousemove = this._layerSprite.touchmove = this._onDrawLayer_MouseMove.bind(this);\n    this._layerSprite.mouseup = this._layerSprite.touchend = this._onDrawLayer_MouseUp.bind(this);\n    this._layerSprite.mouseupoutside = this._layerSprite.touchendoutside = this._onDrawLayer_MouseOut.bind(this);\n    this.addChild(this._layerSprite);\n\n    // Default tool.\n    this._onDrawMode_Changed(_CommonGame2.default.TOOL.PENCIL);\n\n    // Listen to HUD controls.\n    _Common2.default.game.hud.signals.onDrawModeChanged.add(this._onDrawMode_Changed, this);\n    _Common2.default.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\n};\n\nDrawLayer.prototype.setEnabled = function (isEnabled) {\n    this._layerSprite.interactive = isEnabled;\n};\n\nDrawLayer.prototype.update = function () {\n    // Vfx.\n    this._drawPS.update(P3.Timestep.deltaTime);\n\n    if (this._drawingTool != this._spray && this._drawPS.emit && this._lastInputLocalPosition.x == this._updateInputLocalPosition.x && this._lastInputLocalPosition.y == this._updateInputLocalPosition.y) this._drawPS.emit = false;\n\n    this._updateInputLocalPosition.x = this._lastInputLocalPosition.x;\n    this._updateInputLocalPosition.y = this._lastInputLocalPosition.y;\n};\n\nDrawLayer.prototype.setLayerData = function (data, dynOutlineData) {\n    this._context.putImageData(data, 0, 0);\n\n    this._dynOutlineLayerData = dynOutlineData;\n    this._dynOutlineContext.putImageData(dynOutlineData, 0, 0);\n\n    this._layerSprite.texture.update();\n};\n\nDrawLayer.prototype.clear = function () {\n    this._dynOutlineContext.clearRect(0, 0, this._canvas2d.width, this._canvas2d.height);\n    this._dynOutlineLayerData = this._dynOutlineContext.getImageData(0, 0, this._dynOutline_c2d.width, this._dynOutline_c2d.height);\n\n    this._context.clearRect(0, 0, this._canvas2d.width, this._canvas2d.height);\n\n    this._layerSprite.texture.update();\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\n// TODO:\n\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nDrawLayer.prototype.onContext_Changed = function () {\n    // Tutorial.\n    _Common2.default.game.scene.addTutorialEvent(_CommonGame2.default.TUT_EVENT.CANVAS_DRAWN);\n\n    this._layerSprite.texture.update();\n};\n\nDrawLayer.prototype._onDrawLayer_MouseDown = function (mouseData) {\n    //console.log( \"mousedown\" );\n\n    // Undo manager.\n    _Common2.default.game.undoManager.save();\n\n    // Use canvas' left-top corner as origin.\n    var localCoordsPosition = mouseData.data.getLocalPosition(this._layerSprite);\n    var ctxCoordPosition = new PIXI.Point();\n    ctxCoordPosition.x = Math.floor(localCoordsPosition.x + _Common2.default.game.canvas.WIDTH * 0.5);\n    ctxCoordPosition.y = Math.floor(localCoordsPosition.y + _Common2.default.game.canvas.HEIGHT * 0.5);\n\n    this._lastInputLocalPosition = new PIXI.Point(ctxCoordPosition.x, ctxCoordPosition.y);\n    this._state = this.STATE.DRAWING;\n\n    this._drawingTool.onDrawBegan(ctxCoordPosition);\n\n    // Vfx.\n    if (this._drawingTool == this._stamp || this._drawingTool == this._spray) {\n        this._drawPS.spawnPos = new PIXI.Point(localCoordsPosition.x, localCoordsPosition.y);\n        this._drawPS.emit = true;\n    }\n};\n\nDrawLayer.prototype._onDrawLayer_MouseMove = function (mouseData) {\n    //console.log( \"mousemove\" );\n\n    if (this._state != this.STATE.DRAWING) return;\n\n    // Use canvas' left-top corner as origin.\n    var localCoordsPosition = mouseData.data.getLocalPosition(this._layerSprite);\n    var ctxCoordPosition = new PIXI.Point();\n    ctxCoordPosition.x = Math.floor(localCoordsPosition.x + _Common2.default.game.canvas.WIDTH * 0.5);\n    ctxCoordPosition.y = Math.floor(localCoordsPosition.y + _Common2.default.game.canvas.HEIGHT * 0.5);\n\n    this._drawingTool.onDrawMoved(this._lastInputLocalPosition, ctxCoordPosition);\n\n    this._lastInputLocalPosition.x = ctxCoordPosition.x;\n    this._lastInputLocalPosition.y = ctxCoordPosition.y;\n\n    // Vfx.\n    if (this._drawingTool != this._stamp) {\n        if (!this._drawPS.emit) {\n            this._drawPS.resetPositionTracking();\n            this._drawPS.spawnPos = new PIXI.Point(localCoordsPosition.x, localCoordsPosition.y);\n            this._drawPS.emit = true;\n        } else this._drawPS.updateSpawnPos(localCoordsPosition.x, localCoordsPosition.y);\n    }\n};\n\nDrawLayer.prototype._onDrawLayer_MouseUp = function (mouseData) {\n    //console.log( \"mouseup\" );\n\n    if (this._state == this.STATE.DRAWING) {\n        this._drawingTool.onDrawEnded();\n\n        this._state = this.STATE.IDLE;\n\n        // Vfx.\n        if (this._drawingTool != this._stamp) this._drawPS.emit = false;\n    }\n};\n\nDrawLayer.prototype._onDrawLayer_MouseOut = function (mouseData) {\n    //console.log( \"mouseout\" );\n\n    if (this._state == this.STATE.DRAWING) {\n        this._drawingTool.onDrawEnded();\n\n        this._state = this.STATE.IDLE;\n    }\n\n    // Vfx.\n    this._drawPS.emit = false;\n};\n\nDrawLayer.prototype._onThickness_Changed = function (selection) {\n    this._thickness = this.BASE_LINE_THICKNESS * (selection + 1);\n};\n\nDrawLayer.prototype._onColour_Changed = function (selection) {\n    if (this._drawingTool == this._pencil || this._drawingTool == this._brush || this._drawingTool == this._spray || this._drawingTool == this._inkPot) {\n        var rgbColour = { r: 255, g: 255, b: 255 };\n\n        if (this._drawingTool.paletteItem.indexOf(\"#\") == 0) rgbColour = _Common2.default.hexToRgb(this._drawingTool.paletteItem);\n\n        this._drawPS.startColor = [rgbColour.r, rgbColour.g, rgbColour.b];\n        this._drawPS.endColor = this._drawPS.startColor;\n    }\n};\n\nDrawLayer.prototype._onDrawMode_Changed = function (selection) {\n    var rgbColour = { r: 255, g: 255, b: 255 };\n\n    switch (selection) {\n        case _CommonGame2.default.TOOL.PENCIL:\n            {\n                this._drawingTool = this._pencil;\n\n                // Vfx.\n                if (this._drawingTool.paletteItem.indexOf(\"#\") == 0) rgbColour = _Common2.default.hexToRgb(this._drawingTool.paletteItem);\n                this._drawPS = new PIXI.particles.Emitter(this, [_Common2.default.assets.getTexture(\"particle_draw\")], _Common2.default.assets.getJSON(\"pencil_ps\"));\n                this._drawPS.emitterLifetime = -1;\n\n                // Sfx.\n                //Common.audio.playSound( \"sfx_tool_pencil_select_00\" );\n                break;\n            }\n\n        case _CommonGame2.default.TOOL.BRUSH:\n            {\n                this._drawingTool = this._brush;\n\n                // Vfx.\n                if (this._drawingTool.paletteItem.indexOf(\"#\") == 0) rgbColour = _Common2.default.hexToRgb(this._drawingTool.paletteItem);\n                this._drawPS = new PIXI.particles.Emitter(this, [_Common2.default.assets.getTexture(\"particle_paintbrush\")], _Common2.default.assets.getJSON(\"brush_ps\"));\n                this._drawPS.emitterLifetime = -1;\n\n                // Sfx.\n                //Common.audio.playSound( \"sfx_tool_paintbrush_select_00\" );\n                break;\n            }\n\n        case _CommonGame2.default.TOOL.SPRAY:\n            {\n                this._drawingTool = this._spray;\n\n                // Vfx.\n                if (this._drawingTool.paletteItem.indexOf(\"#\") == 0) rgbColour = _Common2.default.hexToRgb(this._drawingTool.paletteItem);\n                this._drawPS = new PIXI.particles.Emitter(this, [_Common2.default.assets.getTexture(\"particle_spray\")], _Common2.default.assets.getJSON(\"spray_ps\"));\n                this._drawPS.emitterLifetime = -1;\n\n                // Sfx.\n                //Common.audio.playSound( \"sfx_tool_spraycan_select_00\" );\n                break;\n            }\n\n        case _CommonGame2.default.TOOL.STAMP:\n            {\n                this._drawingTool = this._stamp;\n\n                // Vfx.\n                rgbColour = _Common2.default.hexToRgb(\"#ffe400\");\n                this._drawPS = new PIXI.particles.Emitter(this, [_Common2.default.assets.getTexture(\"particle_stamp\")], _Common2.default.assets.getJSON(\"stamp_ps\"));\n                this._drawPS.emitterLifetime = 0.1;\n\n                // Sfx.\n                //Common.audio.playSound( \"sfx_tool_stamps_select_00\" );\n                break;\n            }\n\n        case _CommonGame2.default.TOOL.INK_POT:\n            {\n                this._drawingTool = this._inkPot;\n\n                // Vfx.\n                if (this._drawingTool.paletteItem.indexOf(\"#\") == 0) rgbColour = _Common2.default.hexToRgb(this._drawingTool.paletteItem);\n                this._drawPS = new PIXI.particles.Emitter(this, [_Common2.default.assets.getTexture(\"particle_ink_splatter\")], _Common2.default.assets.getJSON(\"ink_splatter_ps\"));\n                this._drawPS.emitterLifetime = -1;\n\n                // Sfx.\n                //Common.audio.playSound( \"sfx_tool_inkpot_select_00\" );\n                break;\n            }\n\n        case _CommonGame2.default.TOOL.ERASER:\n            {\n                this._drawingTool = this._eraser;\n\n                // Vfx.\n                rgbColour = _Common2.default.hexToRgb(\"#fd93bd\");\n                this._drawPS = new PIXI.particles.Emitter(this, [_Common2.default.assets.getTexture(\"particle_erase\")], _Common2.default.assets.getJSON(\"eraser_ps\"));\n                this._drawPS.emitterLifetime = -1;\n\n                // Sfx.\n                //Common.audio.playSound( \"sfx_tool_eraser_select_00\" );\n                break;\n            }\n    }\n\n    this._drawPS.startColor = [rgbColour.r, rgbColour.g, rgbColour.b];\n    this._drawPS.endColor = this._drawPS.startColor;\n    this._drawPS.emit = false;\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(DrawLayer.prototype, \"context\", {\n    get: function get() {\n        return this._context;\n    }\n});\n\nObject.defineProperty(DrawLayer.prototype, \"dynOutlineContext\", {\n    get: function get() {\n        return this._dynOutlineContext;\n    }\n});\n\nObject.defineProperty(DrawLayer.prototype, \"state\", {\n    get: function get() {\n        return this._state;\n    }\n});\n\nObject.defineProperty(DrawLayer.prototype, \"drawingTool\", {\n    get: function get() {\n        return this._drawingTool;\n    }\n});\n\nObject.defineProperty(DrawLayer.prototype, \"dynOutlineData\", {\n    get: function get() {\n        return this._dynOutlineLayerData;\n    },\n    set: function set(a) {\n        return this._dynOutlineLayerData = a;\n    }\n});\n\n},{\"../Common\":3,\"../CommonGame\":4,\"./Brush\":7,\"./Eraser\":12,\"./InkPot\":15,\"./Pencil\":20,\"./Spray\":21,\"./Stamp\":22}],12:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction Eraser() {\n    // Constants.\n    this.LINE_THICKNESS = 10;\n\n    // Attributes.\n    this._drawLayer = null;\n    this._fillLayer = null;\n    this._audio = null;\n    this._arrCanvasContext = [];\n}\nexports.default = Eraser;\n//module.exports               \t= Eraser;\n\nEraser.prototype.constructor = Eraser;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nEraser.prototype.init = function (drawLayer, fillLayer) {\n    this._drawLayer = drawLayer;\n    this._fillLayer = fillLayer;\n\n    this._arrCanvasContext.push(this._drawLayer.context);\n    this._arrCanvasContext.push(this._fillLayer._colourContext);\n    this._arrCanvasContext.push(this._fillLayer._colourCodeContext);\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nEraser.prototype._draw = function (context, from, to) {\n    context.beginPath();\n    context.lineWidth = this.LINE_THICKNESS;\n    context.lineJoin = \"round\";\n    context.moveTo(from.x, from.y);\n    context.lineTo(to.x, to.y);\n    context.closePath();\n    context.stroke();\n};\n\nEraser.prototype._stopAudio = function () {\n    this._audio.howl.stop(this._audio.id);\n    this._audio = null;\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nEraser.prototype.onDrawBegan = function (point) {\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n        for (var _iterator = this._arrCanvasContext[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var context = _step.value;\n\n            context.save();\n            context.globalCompositeOperation = \"destination-out\";\n            context.strokeStyle = \"rgba( 255, 255, 255, 255 )\";\n\n            this._draw(context, point, new PIXI.Point(point.x + 0.1, point.y + 0.1));\n        }\n\n        // TEST: DYN_OUT:\n    } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n    } finally {\n        try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n                _iterator.return();\n            }\n        } finally {\n            if (_didIteratorError) {\n                throw _iteratorError;\n            }\n        }\n    }\n\n    var dynOutlineContext = _Common2.default.game.canvas.drawLayer.dynOutlineContext;\n    dynOutlineContext.save();\n    dynOutlineContext.globalCompositeOperation = \"destination-out\";\n    dynOutlineContext.beginPath();\n    dynOutlineContext.strokeStyle = \"rgba( 255, 255, 255, 255 )\";\n    dynOutlineContext.lineWidth = this.LINE_THICKNESS;\n    dynOutlineContext.lineJoin = \"round\";\n    dynOutlineContext.moveTo(point.x, point.y);\n    dynOutlineContext.lineTo(point.x + 0.1, point.y + 0.1);\n    dynOutlineContext.closePath();\n    dynOutlineContext.stroke();\n\n    this._drawLayer.onContext_Changed();\n    this._fillLayer.onContext_Changed();\n};\n\nEraser.prototype.onDrawMoved = function (from, to) {\n    // Sfx.\n    if (this._audio == null) this._audio = _Common2.default.audio.playSound(\"sfx_tool_eraser_loop_03\", { \"loop\": true });\n    TweenMax.killDelayedCallsTo(this._stopAudio);\n    TweenMax.delayedCall(0.25, this._stopAudio, null, this);\n\n    this._lastPosition = _Common2.default.renderer.plugins.interaction.mouse.global;\n\n    var _iteratorNormalCompletion2 = true;\n    var _didIteratorError2 = false;\n    var _iteratorError2 = undefined;\n\n    try {\n        for (var _iterator2 = this._arrCanvasContext[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n            var context = _step2.value;\n\n            this._draw(context, from, to);\n        }\n    } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n    } finally {\n        try {\n            if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                _iterator2.return();\n            }\n        } finally {\n            if (_didIteratorError2) {\n                throw _iteratorError2;\n            }\n        }\n    }\n\n    this._drawLayer.onContext_Changed();\n    this._fillLayer.onContext_Changed();\n\n    // TEST: DYN_OUT:\n    var dynOutlineContext = _Common2.default.game.canvas.drawLayer.dynOutlineContext;\n    dynOutlineContext.beginPath();\n    dynOutlineContext.lineWidth = this.LINE_THICKNESS;\n    dynOutlineContext.lineJoin = \"round\";\n    dynOutlineContext.moveTo(from.x, from.y);\n    dynOutlineContext.lineTo(to.x, to.y);\n    dynOutlineContext.closePath();\n    dynOutlineContext.stroke();\n};\n\nEraser.prototype.onDrawEnded = function () {\n    // Sfx.\n    TweenMax.killDelayedCallsTo(this._stopAudio);\n    if (this._audio != null) this._stopAudio();\n\n    var _iteratorNormalCompletion3 = true;\n    var _didIteratorError3 = false;\n    var _iteratorError3 = undefined;\n\n    try {\n        for (var _iterator3 = this._arrCanvasContext[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n            var context = _step3.value;\n\n            context.restore();\n        } // TEST: DYN_OUT:\n    } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n    } finally {\n        try {\n            if (!_iteratorNormalCompletion3 && _iterator3.return) {\n                _iterator3.return();\n            }\n        } finally {\n            if (_didIteratorError3) {\n                throw _iteratorError3;\n            }\n        }\n    }\n\n    var dynOutlineContext = _Common2.default.game.canvas.drawLayer.dynOutlineContext;\n    dynOutlineContext.restore();\n    _Common2.default.game.canvas.drawLayer._dynOutlineLayerData = dynOutlineContext.getImageData(0, 0, _Common2.default.game.canvas.WIDTH, _Common2.default.game.canvas.HEIGHT);\n\n    this._fillLayer.updateContextData();\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\n// TODO:\n\n},{\"../Common\":3}],13:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _PalettePanel = require(\"../ui/overlays/PalettePanel\");\n\nvar _PalettePanel2 = _interopRequireDefault(_PalettePanel);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction FillLayer() {\n    PIXI.Container.call(this);\n\n    // Enumerators.\n    this.STATE = {\n        IDLE: 0,\n        FILL_ANIM: 1\n    };\n\n    // Attributes.\n    this._state = this.STATE.IDLE;\n    this._paletteItem = null;\n\n    this._colour_c2d = null;\n    this._colourCode_c2d = null;\n    this._fillAnim_c2d = null;\n\n    this._colourContext = null;\n    this._colourCodeContext = null;\n    this._fillAnimContext = null;\n\n    this._curColour = null;\n\n    this._outlineImage = new Image();\n\n    // Buffers.\n    this._fillAnimLayerData = null;\n    this._colourLayerData = null; // Contains the pixel colour for the painted areas (no outline) as they are seen on the screen.\n    this._outlineLayerData = null; // Contains the pixel colour for the outline. Its content is not displayed.\n    this._colourCodeLayerData = null; // Contains the pixel colour CODE for the painted areas (no outline). Its content is not displayed.\n    // The flood fill algorithm implemented uses plain colours, so to make it compatible with textures it is necessary to use this auxiliary buffer.\n\n    // Sprites.\n    this._colourLayerSprite = null;\n    this._fillAnimLayerSprite = null;\n    this._outlineLayerSprite = null;\n    this._fillAnimMask = null;\n\n    // Input.\n    this._lastInputGlobalPosition = new PIXI.Point();\n\n    // Fill animation.\n    this._fillAnimRadius = 0;\n    this._fillAnimMaxDeltaX = 0;\n    this._fillAnimMaxDeltaY = 0;\n    this._textureStartPixelPos = -1; // The pixel position (as an index in colourLayerData ) where the selected texture is applied.\n\n    this._drawPS = null;\n}\nexports.default = FillLayer;\n//module.exports               \t\t= FillLayer;\n\nFillLayer.prototype = Object.create(PIXI.Container.prototype);\nFillLayer.prototype.constructor = FillLayer;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nFillLayer.prototype.init = function () {\n    // Canvas.\n    this._colour_c2d = document.createElement('canvas');\n    this._colour_c2d.width = _Common2.default.game.canvas.WIDTH;\n    this._colour_c2d.height = _Common2.default.game.canvas.HEIGHT;\n\n    this._colourCode_c2d = document.createElement('canvas');\n    this._colourCode_c2d.width = _Common2.default.game.canvas.WIDTH;\n    this._colourCode_c2d.height = _Common2.default.game.canvas.HEIGHT;\n\n    this._fillAnim_c2d = document.createElement('canvas');\n    this._fillAnim_c2d.width = _Common2.default.game.canvas.WIDTH;\n    this._fillAnim_c2d.height = _Common2.default.game.canvas.HEIGHT;\n\n    // Context.\n    this._colourContext = this._colour_c2d.getContext('2d');\n    this._colourCodeContext = this._colourCode_c2d.getContext('2d');\n    this._fillAnimContext = this._fillAnim_c2d.getContext('2d');\n\n    // Layers.\n    // Fill colour.\n    this._colourLayerSprite = new PIXI.Sprite(PIXI.Texture.fromCanvas(this._colour_c2d));\n    this._colourLayerSprite.anchor = new PIXI.Point(0.5, 0.5);\n    this._colourLayerSprite.interactive = true;\n    this._colourLayerSprite.click = this._colourLayerSprite.touchend = this._onFillLayer_Click.bind(this);\n    this.addChild(this._colourLayerSprite);\n    // Fill animation.\n    this._fillAnimMask = new PIXI.Graphics();\n    this.addChild(this._fillAnimMask);\n    this._fillAnimLayerSprite = new PIXI.Sprite(PIXI.Texture.fromCanvas(this._fillAnim_c2d));\n    this._fillAnimLayerSprite.anchor = new PIXI.Point(0.5, 0.5);\n    this._fillAnimLayerSprite.mask = this._fillAnimMask;\n    this.addChild(this._fillAnimLayerSprite);\n    // Outline.\n    var outlineTexture = PIXI.Texture.fromImage(\"assets/images/outlines/\" + (_CommonGame2.default.selectedGallery == _CommonGame2.default.GALLERY_ID_DRAW_IT ? \"draw_it/\" : \"colour_it/\") + _CommonGame2.default.selectedImageId + \".png\");\n    this._outlineLayerSprite = new PIXI.Sprite(outlineTexture);\n    var croppedOutlineTexture = new PIXI.Texture(outlineTexture, new PIXI.Rectangle(outlineTexture.width * 0.5 - _Common2.default.game.canvas.WIDTH * 0.5, outlineTexture.height * 0.5 - _Common2.default.game.canvas.HEIGHT * 0.5, _Common2.default.game.canvas.WIDTH, _Common2.default.game.canvas.HEIGHT));\n    this._outlineLayerSprite.setTexture(croppedOutlineTexture);\n\n    //this._outlineLayerSprite = new PIXI.Sprite( Common.assets.getTexture( CommonGame.selectedImageId ) );\n    this._outlineLayerSprite.anchor = new PIXI.Point(0.5, 0.5);\n    this.addChild(this._outlineLayerSprite);\n\n    // Buffers.\n    this._colourContext.clearRect(0, 0, this._colour_c2d.width, this._colour_c2d.height);\n    // Fill animation.\n    this._fillAnimLayerData = this._fillAnimContext.getImageData(0, 0, this._fillAnim_c2d.width, this._fillAnim_c2d.height);\n    // Colour.\n    this._colourLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\n    // Colour code.\n    this._colourCodeLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\n    // Outline.\n    this._outlineImage.src = \"assets/images/outlines/\" + (_CommonGame2.default.selectedGallery == _CommonGame2.default.GALLERY_ID_DRAW_IT ? \"draw_it/\" : \"colour_it/\") + _CommonGame2.default.selectedImageId + \".png\";\n    this._colourContext.drawImage(this._outlineImage, this._colourLayerSprite.width * 0.5 - this._outlineImage.width * 0.5 * this._outlineLayerSprite.scale.x, this._colourLayerSprite.height * 0.5 - this._outlineImage.height * 0.5 * this._outlineLayerSprite.scale.y, this._outlineImage.width * this._outlineLayerSprite.scale.x, this._outlineImage.height * this._outlineLayerSprite.scale.y);\n    this._outlineLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\n\n    //this._colourContext.fillStyle = 'white';\n    //this._colourContext.fillRect( 0, 0, this._colour_c2d.width, this._colour_c2d.height );\n\n    // TODO: ???\n    this._colourContext.clearRect(0, 0, this._colourContext.canvas.width, this._colourContext.canvas.height);\n\n    // Initial empty canvas .\n    this._colourContext.clearRect(0, 0, this._colour_c2d.width, this._colour_c2d.height);\n\n    // Default colour.\n    this._onColour_Changed(_Common2.default.assets.getJSON(\"config\").palettePanel.pages[0][0], 0, 0);\n\n    // Vfx.\n    this._drawPS = new PIXI.particles.Emitter(this._outlineLayerSprite, [_Common2.default.assets.getTexture(\"particle_paintfill\")], _Common2.default.assets.getJSON(\"fill_ps\"));\n    this._drawPS.emit = false;\n    this._drawPS.emitterLifetime = 0.1;\n\n    // Listen to HUD controls.\n    _Common2.default.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\n};\n\nFillLayer.prototype.update = function () {\n    // Vfx.\n    this._drawPS.update(P3.Timestep.deltaTime);\n};\n\nFillLayer.prototype.setEnabled = function (isEnabled) {\n    this._colourLayerSprite.interactive = isEnabled;\n};\n\nFillLayer.prototype.setLayerData = function (data, colourCodeData) {\n    this._colourCodeLayerData = colourCodeData;\n    this._colourCodeContext.putImageData(colourCodeData, 0, 0);\n    //this._colourCodeLayerData = this._colourCodeContext.getImageData( 0, 0, this._colourCode_c2d.width, this._colourCode_c2d.height );\n\n    this._colourLayerData = data;\n    this._colourContext.putImageData(data, 0, 0);\n\n    this._colourLayerSprite.texture.update();\n};\n\nFillLayer.prototype.clear = function () {\n    this._colourContext.clearRect(0, 0, this._colour_c2d.width, this._colour_c2d.height);\n    this._colourLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\n\n    this._colourCodeLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\n\n    this._colourLayerSprite.texture.update();\n};\n\nFillLayer.prototype.updateContextData = function () {\n    this._colourCodeLayerData = this._colourCodeContext.getImageData(0, 0, this._colourCode_c2d.width, this._colourCode_c2d.height);\n    this._colourLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nFillLayer.prototype._fillAt = function (startX, startY) {\n    //console.log( \"_fillAt :: ini\" );\n\n    // Check same colour.\n    var pixelIndex = (startY * this._colour_c2d.width + startX) * 4;\n    var r = this._colourCodeLayerData.data[pixelIndex];\n    var g = this._colourCodeLayerData.data[pixelIndex + 1];\n    var b = this._colourCodeLayerData.data[pixelIndex + 2];\n    var a = this._colourCodeLayerData.data[pixelIndex + 3];\n\n    if (r == this._curColour.colourCode.r && g == this._curColour.colourCode.g && b == this._curColour.colourCode.b) {\n        // Return because trying to fill with the same colour\n        //console.log( \"same colour!\" );\n\n        return;\n    }\n\n    // Check outline.\n    a = this._outlineLayerData.data[pixelIndex + 3];\n    if (a > 0) {\n        // Return because clicked outline\n        //console.log( \"outline!\" );\n\n        return;\n    }\n\n    // Check dynamic outline.\n    a = _Common2.default.game.canvas.drawLayer.dynOutlineData.data[pixelIndex + 3];\n    if (a > 0) {\n        // Return because clicked dyn outline\n        //console.log( \"dyn outline!\" );\n\n        return;\n    }\n\n    // Flood fill.\n    this._textureStartPixelPos = pixelIndex;\n    this._floodFill(startX, startY);\n\n    // Redraw.\n    this._colourContext.clearRect(0, 0, this._colourContext.canvas.width, this._colourContext.canvas.height);\n    this._colourContext.putImageData(this._colourLayerData, 0, 0);\n    //this._colourLayerSprite.texture.update();\n\n    // Filling animation.\n    var targetRadius = Math.sqrt(Math.pow(this._fillAnimMaxDeltaX, 2) + Math.pow(this._fillAnimMaxDeltaY, 2));\n    TweenMax.to(this, targetRadius / 600, {\n        _fillAnimRadius: targetRadius,\n        ease: Linear.easeInOut,\n        onComplete: function onComplete() {\n            this._updateFillAnimMask();\n\n            this._fillAnimMaxDeltaX = 0;\n            this._fillAnimMaxDeltaY = 0;\n            this._fillAnimRadius = 0;\n            this._state = this.STATE.IDLE;\n\n            // Update layers and buffers.\n            this._colourLayerSprite.texture.update();\n\n            this._fillAnimMask.clear();\n\n            this._fillAnimContext.clearRect(0, 0, this._fillAnim_c2d.width, this._fillAnim_c2d.height);\n            this._fillAnimLayerData = this._fillAnimContext.getImageData(0, 0, this._fillAnim_c2d.width, this._fillAnim_c2d.height);\n            this._fillAnimLayerSprite.texture.update();\n        },\n        onCompleteScope: this,\n        onUpdate: function onUpdate() {\n            this._updateFillAnimMask();\n        },\n        onUpdateScope: this\n    });\n\n    this._fillAnimContext.putImageData(this._fillAnimLayerData, 0, 0);\n    this._fillAnimLayerSprite.texture.update();\n\n    this._state = this.STATE.FILL_ANIM;\n\n    //console.log( \"_fillAt :: end\" );\n};\n\nFillLayer.prototype._floodFill = function (startX, startY) {\n    var newPos,\n        x,\n        y,\n        pixelIndex,\n        reachLeft,\n        reachRight,\n        drawingBoundLeft = 0,\n        drawingBoundTop = 0,\n        drawingBoundRight = _Common2.default.game.canvas.WIDTH - 1,\n        drawingBoundBottom = _Common2.default.game.canvas.HEIGHT - 1,\n        pixelStack = [[startX, startY]];\n\n    while (pixelStack.length) {\n        newPos = pixelStack.pop();\n        x = newPos[0];\n        y = newPos[1];\n\n        //console.log( \"dx = \" + dx );\n        var dx = x - startX;\n        var dy = y - startY;\n\n        // Update limits for filling animation.\n        if (Math.abs(dy) > this._fillAnimMaxDeltaY) this._fillAnimMaxDeltaY = Math.abs(dy);\n        if (Math.abs(dx) > this._fillAnimMaxDeltaX) this._fillAnimMaxDeltaX = Math.abs(dx);\n\n        // Get current pixel index inside image data.\n        pixelIndex = (y * this._colour_c2d.width + x) * 4;\n\n        // Go up as long as the colour matches and are inside the canvas.\n        while (y >= drawingBoundTop && this._isPixelToFill(pixelIndex)) {\n            y -= 1;\n            pixelIndex -= this._colour_c2d.width * 4;\n        }\n\n        pixelIndex += this._colour_c2d.width * 4;\n        y += 1;\n        reachLeft = false;\n        reachRight = false;\n\n        // Go down as long as the colour matches and in inside the canvas.\n        while (y <= drawingBoundBottom && this._isPixelToFill(pixelIndex)) {\n            this._paintPixel(pixelIndex);\n\n            //console.log( \"_floodFill :: pixelIndex = \" + pixelIndex );\n\n            if (x > drawingBoundLeft) {\n                if (this._isPixelToFill(pixelIndex - 4)) {\n                    if (!reachLeft) {\n                        // Add pixel to stack\n                        pixelStack.push([x - 1, y]);\n                        reachLeft = true;\n                    }\n                } else if (reachLeft) reachLeft = false;\n            }\n\n            if (x < drawingBoundRight) {\n                if (this._isPixelToFill(pixelIndex + 4)) {\n                    if (!reachRight) {\n                        // Add pixel to stack\n                        pixelStack.push([x + 1, y]);\n                        reachRight = true;\n                    }\n                } else if (reachRight) reachRight = false;\n            }\n\n            y += 1;\n            pixelIndex += this._colour_c2d.width * 4;\n\n            // Update limits for filling animation.\n            dy = y - startY;\n            if (Math.abs(dy) > this._fillAnimMaxDeltaY) this._fillAnimMaxDeltaY = Math.abs(dy);\n        }\n    }\n};\n\nFillLayer.prototype._isPixelToFill = function (pixelIndex) {\n    var result = true;\n\n    // If given pixel is not part of the outline.\n    var r = this._outlineLayerData.data[pixelIndex];\n    var g = this._outlineLayerData.data[pixelIndex + 1];\n    var b = this._outlineLayerData.data[pixelIndex + 2];\n    var a = this._outlineLayerData.data[pixelIndex + 3];\n\n    // TODO: Adjust tolerance as necessary.\n    result = a <= 255 * 0.5;\n\n    // If current pixel doesn't match the new colour.\n    if (result) {\n        r = this._colourCodeLayerData.data[pixelIndex];\n        g = this._colourCodeLayerData.data[pixelIndex + 1];\n        b = this._colourCodeLayerData.data[pixelIndex + 2];\n\n        result = r != this._curColour.colourCode.r || g != this._curColour.colourCode.g || b != this._curColour.colourCode.b;\n    }\n\n    // TEST: DYN_OUT:\n    // If current pixel is not part of the dynamic outline.\n    if (result) {\n        a = _Common2.default.game.canvas.drawLayer.dynOutlineData.data[pixelIndex + 3];\n        // TODO: Adjust tolerance as necessary.\n        result = a < 255;\n    }\n\n    return result;\n};\n\nFillLayer.prototype._paintPixel = function (pixelIndex) {\n    // Find pixel colour.\n    var r, g, b, a;\n    if (this._curColour.isTexture) {\n        // pixelIndex is not in canvas coordinates, but image data coordinates! Divide by 4 ( r + g + b + a ) to make the conversion.\n        var dy = Math.floor(pixelIndex / 4 / this._colour_c2d.width) - Math.floor(this._textureStartPixelPos / 4 / this._colour_c2d.width);\n        var dx = Math.floor(pixelIndex / 4 % this._colour_c2d.width) - Math.floor(this._textureStartPixelPos / 4 % this._colour_c2d.width);\n\n        var textureY = dy % this._curColour.data.height;\n        if (textureY < 0) textureY += this._curColour.data.height;\n        var textureX = dx % this._curColour.data.height;\n        if (textureX < 0) textureX += this._curColour.data.height;\n        var basePixelPos = (this._curColour.data.height * textureY + textureX) * 4;\n\n        //console.log( \"dx,dy = \" + dx + \" :: \" + dy );\n\n        r = this._curColour.data.data[basePixelPos];\n        g = this._curColour.data.data[basePixelPos + 1];\n        b = this._curColour.data.data[basePixelPos + 2];\n        a = this._curColour.data.data[basePixelPos + 3] !== undefined ? this._curColour.data.data[basePixelPos + 3] : 255;\n    } else {\n        r = this._curColour.r;\n        g = this._curColour.g;\n        b = this._curColour.b;\n        a = this._curColour.a !== undefined ? this._curColour.a : 255;\n    }\n\n    // Buffers.\n    // Colour.\n    this._colourLayerData.data[pixelIndex] = r;\n    this._colourLayerData.data[pixelIndex + 1] = g;\n    this._colourLayerData.data[pixelIndex + 2] = b;\n    this._colourLayerData.data[pixelIndex + 3] = a;\n    // Filling.\n    this._fillAnimLayerData.data[pixelIndex] = r;\n    this._fillAnimLayerData.data[pixelIndex + 1] = g;\n    this._fillAnimLayerData.data[pixelIndex + 2] = b;\n    this._fillAnimLayerData.data[pixelIndex + 3] = a;\n    // Colour code.\n    this._colourCodeLayerData.data[pixelIndex] = this._curColour.colourCode.r;\n    this._colourCodeLayerData.data[pixelIndex + 1] = this._curColour.colourCode.g;\n    this._colourCodeLayerData.data[pixelIndex + 2] = this._curColour.colourCode.b;\n    this._colourCodeLayerData.data[pixelIndex + 3] = 255;\n};\n\nFillLayer.prototype._updateFillAnimMask = function () {\n    this._fillAnimMask.clear();\n    this._fillAnimMask.beginFill();\n    this._fillAnimMask.drawCircle(this._lastInputGlobalPosition.x, this._lastInputGlobalPosition.y, this._fillAnimRadius);\n    this._fillAnimMask.endFill();\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nFillLayer.prototype.onContext_Changed = function () {\n    this._colourLayerSprite.texture.update();\n};\n\nFillLayer.prototype._onColour_Changed = function (selection, pageIndex, itemIndex) {\n    this._paletteItem = selection;\n    if (selection.indexOf(\"#\") == 0) {\n        // Colour.\n        var rgbColour = _Common2.default.hexToRgb(selection);\n\n        this._curColour = {\n            r: rgbColour.r,\n            g: rgbColour.g,\n            b: rgbColour.b,\n            isTexture: false,\n            colourCode: { r: pageIndex, g: itemIndex, b: 1 // { r: 0, g: 0, b: 0 } is reserved to represent no colour code, so make sure to not use it! That's why b: 1.\n            } };\n    } else {\n        // Texture.\n        var texture = _Common2.default.assets.getTexture(selection);\n        var frame = texture.frame;\n        var canvas = document.createElement('canvas');\n        canvas.width = frame.width;\n        canvas.height = frame.height;\n        var context = canvas.getContext('2d');\n        context.drawImage(texture.baseTexture.source, frame.x * _Common2.default.main.assetRes, frame.y * _Common2.default.main.assetRes, frame.width * _Common2.default.main.assetRes, frame.height * _Common2.default.main.assetRes, 0, 0, frame.width, frame.height);\n\n        this._curColour = {\n            data: context.getImageData(0, 0, canvas.width, canvas.height),\n            isTexture: true,\n            colourCode: { r: pageIndex, g: itemIndex, b: 1 // { r: 0, g: 0, b: 0 } is reserved to represent no colour code, so make sure to not use it! That's why b: 1.\n            } };\n    }\n};\n\nFillLayer.prototype._onFillLayer_Click = function (mouseData) {\n    if (this._state == this.STATE.FILL_ANIM) return;\n\n    // Undo manager.\n    this._colourCodeContext.putImageData(this._colourCodeLayerData, 0, 0);\n    _Common2.default.game.undoManager.save();\n\n    // Use canvas' left-top corner as origin.\n    var localCoordsPosition = mouseData.data.getLocalPosition(this._colourLayerSprite);\n    var ctxCoordPosition = new PIXI.Point();\n    ctxCoordPosition.x = Math.floor(localCoordsPosition.x + _Common2.default.game.canvas.WIDTH * 0.5);\n    ctxCoordPosition.y = Math.floor(localCoordsPosition.y + _Common2.default.game.canvas.HEIGHT * 0.5);\n    //console.log( localCoordsPosition.x + \" :: \" + localCoordsPosition.y );\n\n    this._fillAt(Math.floor(ctxCoordPosition.x), Math.floor(ctxCoordPosition.y));\n\n    this._lastInputGlobalPosition = new PIXI.Point(mouseData.data.global.x - _Common2.default.game.scene.x - _Common2.default.game.canvas.x, mouseData.data.global.y - _Common2.default.game.canvas.y);\n\n    // Vfx.\n    var rgbColour = { r: 255, g: 255, b: 255 };\n    if (this._paletteItem.indexOf(\"#\") == 0) rgbColour = _Common2.default.hexToRgb(this._paletteItem);\n    this._drawPS.startColor = [rgbColour.r, rgbColour.g, rgbColour.b];\n    this._drawPS.endColor = this._drawPS.startColor;\n    this._drawPS.spawnPos = new PIXI.Point(localCoordsPosition.x, localCoordsPosition.y);\n    this._drawPS.emit = true;\n\n    // Sfx.\n    _Common2.default.audio.playSound(\"sfx_tool_paintpot_fill_use_02\");\n\n    // Tutorial.\n    _Common2.default.game.scene.addTutorialEvent(_CommonGame2.default.TUT_EVENT.CANVAS_DRAWN);\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(FillLayer.prototype, \"colourContext\", {\n    get: function get() {\n        return this._colourContext;\n    }\n});\n\nObject.defineProperty(FillLayer.prototype, \"colourCodeContext\", {\n    get: function get() {\n        return this._colourCodeContext;\n    }\n});\n\nObject.defineProperty(FillLayer.prototype, \"state\", {\n    get: function get() {\n        return this._state;\n    }\n});\n\nObject.defineProperty(FillLayer.prototype, \"paletteItem\", {\n    get: function get() {\n        return this._paletteItem;\n    }\n});\n\n},{\"../Common\":3,\"../CommonGame\":4,\"../ui/overlays/PalettePanel\":38}],14:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _PalettePanel = require(\"../ui/overlays/PalettePanel\");\n\nvar _PalettePanel2 = _interopRequireDefault(_PalettePanel);\n\nvar _PaletteButton = require(\"./PaletteButton\");\n\nvar _PaletteButton2 = _interopRequireDefault(_PaletteButton);\n\nvar _OutlineFilter = require(\"../shaders/OutlineFilter\");\n\nvar _OutlineFilter2 = _interopRequireDefault(_OutlineFilter);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar HUD = function (_PIXI$Container) {\n    _inherits(HUD, _PIXI$Container);\n\n    function HUD() {\n        _classCallCheck(this, HUD);\n\n        // Attributes.\n        var _this = _possibleConstructorReturn(this, (HUD.__proto__ || Object.getPrototypeOf(HUD)).call(this));\n\n        _this._leftBarContainer = null;\n        _this._rightBarContainer = null;\n        _this._leftBarSprite = null;\n        _this._rightBarSprite = null;\n        _this._menuBtn = null;\n        _this._undoBtn = null;\n        _this._lastToolBtn = null;\n\n        _this._pencilButton = null;\n        _this._brushButton = null;\n        _this._bucketButton = null;\n        _this._stampButton = null;\n        _this._inkPotButton = null;\n        _this._sprayButton = null;\n        _this._eraserButton = null;\n        _this._paletteButton = null;\n\n        _this._drawItText = null;\n        _this._palettePanel = null;\n\n        _this._drawMode = _CommonGame2.default.TOOL.PENCIL;\n\n        // Signals.\n        _this.signals = {};\n        _this.signals.onMenuClick = new signals.Signal();\n        _this.signals.onPaletteClick = new signals.Signal();\n        _this.signals.onDrawModeChanged = new signals.Signal();\n        return _this;\n    }\n\n    _createClass(HUD, [{\n        key: \"init\",\n        value: function init() {\n\n            console.assert(_Common2.default.game.scene.palettePanel != null, \"Initialization failed: Common.game.scene.palettePanel is null.\");\n            this._palettePanel = _Common2.default.game.scene.palettePanel;\n\n            // Left bar.\n            // Container.\n            this._leftBarContainer = new PIXI.Container();\n            this._leftBarContainer.anchor = new PIXI.Point(0, 0.5);\n            this._leftBarContainer.x = _Common2.default.getScreenPositionLeft() - this.x;\n            this.addChild(this._leftBarContainer);\n            // Sprite.\n            this._leftBarSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"panel_l\"));\n            this._leftBarSprite.anchor = new PIXI.Point(0, 0.5);\n            this._leftBarContainer.addChild(this._leftBarSprite);\n            // Right bar.\n            // Container.\n            this._rightBarContainer = new PIXI.Container();\n            this._rightBarContainer.anchor = new PIXI.Point(0, 0.5);\n            this._rightBarContainer.x = _Common2.default.getScreenPositionRight() - this.x;\n            this.addChild(this._rightBarContainer);\n            // Sprite.\n            this._rightBarSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"panel_r\"));\n            this._rightBarSprite.anchor = new PIXI.Point(1, 0.5);\n            this._rightBarContainer.addChild(this._rightBarSprite);\n\n            //--buttons--//\n            var buttonOffset = 90; //made an offset variable to use to offset the buttons\n\n            // Menu button.\n            //  var btnStatesAux = new P3.ButtonStates(\n            ///     Common.assets.getTexture(\"btn_primary_small_off\"),\n            //     Common.assets.getTexture(\"btn_primary_small_over\"),\n            //    Common.assets.getTexture(\"btn_primary_small_down\"),\n            //    Common.assets.getTexture(\"icon_menu\"));\n            this._menuBtn = createButton(\"menu\");\n            this._menuBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._menuBtn.y = -280;\n            this._menuBtn.x = buttonOffset;\n            this._menuBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._menuBtn.downSoundName = \"sfx_ui_click_00\";\n            this._menuBtn.signals.click.add(this._onMenuButton_Click, this);\n            this._leftBarSprite.addChild(this._menuBtn);\n\n            // Undo button.\n            var btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_undo\"), _Common2.default.assets.getTexture(\"icon_undo\"), _Common2.default.assets.getTexture(\"icon_undo\"));\n            this._undoBtn = new P3.Button(btnStatesAux);\n            this._undoBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._undoBtn.y = -280;\n            this._undoBtn.x = -buttonOffset;\n            this._undoBtn.signals.click.add(this._onUndoButton_Click, this);\n            this._rightBarSprite.addChild(this._undoBtn);\n\n            this._undoBtn.interactive = false;\n            this._undoBtn.alpha = 0.5;\n\n            // Tool buttons.\n            // Left.\n            // Palette.\n            this._paletteButton = new _PaletteButton2.default();\n            this._paletteButton.init();\n            this._paletteButton.anchor = new PIXI.Point(0.5, 0.5);\n            this._paletteButton.y = 260;\n            this._paletteButton.x = buttonOffset;\n            this._paletteButton.scale.x = -1;\n            this._paletteButton.signals.onClick.add(this._onPaletteBtn_Click, this);\n            this._leftBarSprite.addChild(this._paletteButton);\n            //this._arrToolBtn.push( this._colourPaletteButton );\n            this._paletteButton.setup(_Common2.default.assets.getJSON(\"config\").palettePanel.pages[0][0], _CommonGame2.default.TOOL.PENCIL);\n            // Pencil.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_pencil\"), _Common2.default.assets.getTexture(\"icon_pencil\"), _Common2.default.assets.getTexture(\"icon_pencil\"));\n            this._pencilButton = new P3.Button(btnStatesAux);\n            this._pencilButton.anchor = new PIXI.Point(0.5, 0.5);\n            this._pencilButton.y = 110;\n            this._pencilButton.x = buttonOffset;\n            this._pencilButton.drawMode = _CommonGame2.default.TOOL.PENCIL;\n            this._pencilButton.signals.click.add(this._onDrawMode_Changed, this);\n            this._leftBarSprite.addChild(this._pencilButton);\n            // Brush.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_brush\"), _Common2.default.assets.getTexture(\"icon_brush\"), _Common2.default.assets.getTexture(\"icon_brush\"));\n            this._brushButton = new P3.Button(btnStatesAux);\n            this._brushButton.anchor = new PIXI.Point(0.5, 0.5);\n            this._brushButton.y = -10;\n            this._brushButton.x = buttonOffset;\n            this._brushButton.drawMode = _CommonGame2.default.TOOL.BRUSH;\n            this._brushButton.signals.click.add(this._onDrawMode_Changed, this);\n            this._leftBarSprite.addChild(this._brushButton);\n            // Bucket.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_fill\"), _Common2.default.assets.getTexture(\"icon_fill\"), _Common2.default.assets.getTexture(\"icon_fill\"));\n            this._bucketButton = new P3.Button(btnStatesAux);\n            this._bucketButton.anchor = new PIXI.Point(0.5, 0.5);\n            this._bucketButton.y = -130;\n            this._bucketButton.x = buttonOffset;\n            this._bucketButton.drawMode = _CommonGame2.default.TOOL.BUCKET;\n            this._bucketButton.signals.click.add(this._onDrawMode_Changed, this);\n            this._leftBarSprite.addChild(this._bucketButton);\n            // Right.\n            // Stamp.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_stamp\"), _Common2.default.assets.getTexture(\"icon_stamp\"), _Common2.default.assets.getTexture(\"icon_stamp\"));\n            this._stampButton = new P3.Button(btnStatesAux);\n            this._stampButton.anchor = new PIXI.Point(0.5, 0.5);\n            this._stampButton.scale.x = -1;\n            this._stampButton.defaultScale.x = this._stampButton.scale.x;\n            this._stampButton.y = 230;\n            this._stampButton.x = -buttonOffset;\n            this._stampButton.drawMode = _CommonGame2.default.TOOL.STAMP;\n            this._stampButton.signals.click.add(this._onDrawMode_Changed, this);\n            this._rightBarSprite.addChild(this._stampButton);\n            // Ink pot.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_ink\"), _Common2.default.assets.getTexture(\"icon_ink\"), _Common2.default.assets.getTexture(\"icon_ink\"));\n            this._inkPotButton = new P3.Button(btnStatesAux);\n            this._inkPotButton.anchor = new PIXI.Point(0.5, 0.5);\n            this._inkPotButton.y = 110;\n            this._inkPotButton.x = -buttonOffset;\n            this._inkPotButton.drawMode = _CommonGame2.default.TOOL.INK_POT;\n            this._inkPotButton.signals.click.add(this._onDrawMode_Changed, this);\n            this._rightBarSprite.addChild(this._inkPotButton);\n            // Spray.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_spray\"), _Common2.default.assets.getTexture(\"icon_spray\"), _Common2.default.assets.getTexture(\"icon_spray\"));\n            this._sprayButton = new P3.Button(btnStatesAux);\n            this._sprayButton.anchor = new PIXI.Point(0.5, 0.5);\n            this._sprayButton.y = -10;\n            this._sprayButton.x = -buttonOffset;\n            this._sprayButton.drawMode = _CommonGame2.default.TOOL.SPRAY;\n            this._sprayButton.signals.click.add(this._onDrawMode_Changed, this);\n            this._rightBarSprite.addChild(this._sprayButton);\n            // Eraser.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_eraser\"), _Common2.default.assets.getTexture(\"icon_eraser\"), _Common2.default.assets.getTexture(\"icon_eraser\"));\n            this._eraserButton = new P3.Button(btnStatesAux);\n            this._eraserButton.anchor = new PIXI.Point(0.5, 0.5);\n            this._eraserButton.y = -130;\n            this._eraserButton.x = -buttonOffset;\n            this._eraserButton.drawMode = _CommonGame2.default.TOOL.ERASER;\n            this._eraserButton.signals.click.add(this._onDrawMode_Changed, this);\n            this._rightBarSprite.addChild(this._eraserButton);\n\n            // Draw it text (only for Draw It! mode).\n            if (_CommonGame2.default.selectedGallery === _CommonGame2.default.GALLERY_ID_DRAW_IT) {\n                this._drawItText = P3.createText(_CommonGame2.default.drawItTextId, {\n                    size: \"64px\",\n                    fill: [0xfff8b3, 0xfac109],\n                    stroke: 0x4c2607,\n                    strokeThickness: 4,\n                    padding: 20,\n                    wordWrapWidth: P3.View.width * 0.65\n                }, \"truetype\", \"draw_it\");\n\n                this._drawItText.y = -_Common2.default.STAGE_HEIGHT * 0.5 + 15;\n                this._drawItText.anchor = new PIXI.Point(0.5, 0);\n                this.addChild(this._drawItText);\n\n                // Scale down.\n                if (this._drawItText.width > _Common2.default.STAGE_MIN_WIDTH * 0.8) {\n                    var scaleFactor = _Common2.default.STAGE_MIN_WIDTH * 0.8 / this._drawItText.width;\n                    this._drawItText.y += (1 - scaleFactor) * this._drawItText.height * 0.5;\n                    this._drawItText.scale = new PIXI.Point(scaleFactor, scaleFactor);\n                }\n            }\n\n            // Initial state.\n            this._highlightToolBtn(this._pencilButton);\n\n            // Signals.\n            _Common2.default.game.undoManager.signals.onStackEmpty.add(this._onUndoStack_Empty, this);\n            _Common2.default.game.undoManager.signals.onStackIncreased.add(this._onUndoStack_Increased, this);\n\n            this._palettePanel.signals.onColourChanged.add(this._onPaletteSelection_Changed, this);\n            this._palettePanel.signals.onStampChanged.add(this._onPaletteSelection_Changed, this);\n        }\n    }, {\n        key: \"resize\",\n        value: function resize() {\n            this._leftBarContainer.x = _Common2.default.getScreenPositionLeft() - this.x;\n            this._rightBarContainer.x = _Common2.default.getScreenPositionRight() - this.x;\n        }\n    }, {\n        key: \"getPaletteBtnPosition\",\n        value: function getPaletteBtnPosition() {\n            return _Common2.default.findPositionInScene(this._paletteButton, _Common2.default.game.scene);\n        }\n    }, {\n        key: \"getBrushBtnPosition\",\n        value: function getBrushBtnPosition() {\n            return _Common2.default.findPositionInScene(this._brushButton, _Common2.default.game.scene);\n        }\n    }, {\n        key: \"_highlightToolBtn\",\n        value: function _highlightToolBtn(btn) {\n            if (this._lastToolBtn) {\n                // Remove outline.\n                this._lastToolBtn.filters = [];\n\n                TweenMax.killTweensOf(this._lastToolBtn.scale);\n                this._lastToolBtn.animate = true;\n                TweenMax.to(this._lastToolBtn.scale, 0.25, {\n                    x: this._lastToolBtn.scale.x < 0 ? -1 : 1,\n                    y: 1,\n                    ease: Sine.easeOut,\n                    onComplete: function onComplete(btn) {\n                        btn.interactive = true;\n                    },\n                    onCompleteParams: [this._lastToolBtn]\n                });\n            }\n\n            btn.animate = false;\n            btn.interactive = false;\n            btn.stopAnimations();\n            TweenMax.to(btn.scale, 0.5, {\n                x: 1.1 * (btn.scale.x < 0 ? -1 : 1),\n                y: 1.1,\n                ease: Sine.easeInOut,\n                yoyo: true,\n                repeat: -1\n            });\n\n            this._lastToolBtn = btn;\n\n            // Add outline.\n            this._lastToolBtn.filters = [new _OutlineFilter2.default(9, 0xFFFFFF)];\n        }\n\n        //----EVENTS----//\n\n    }, {\n        key: \"_onMenuButton_Click\",\n        value: function _onMenuButton_Click() {\n            this.signals.onMenuClick.dispatch();\n        }\n    }, {\n        key: \"_onUndoButton_Click\",\n        value: function _onUndoButton_Click() {\n            _Common2.default.game.undoManager.undo();\n\n            // Sfx.\n            _Common2.default.audio.playSound(\"sfx_tool_undo_step_back_00\");\n        }\n    }, {\n        key: \"_onDrawMode_Changed\",\n        value: function _onDrawMode_Changed(btn) {\n            // Highlight selected button.\n            this._highlightToolBtn(btn);\n\n            this._drawMode = btn.drawMode;\n\n            this.signals.onDrawModeChanged.dispatch(btn.drawMode);\n\n            // Palette button.\n            if (btn.drawMode == _CommonGame2.default.TOOL.ERASER)\n                // Disable it if the eraser is selected.\n                this._paletteButton.setInteractive(false);else {\n                // Otherwise, enable it.\n                this._paletteButton.setInteractive(true);\n\n                // Update visual elements.\n                if (btn.drawMode == _CommonGame2.default.TOOL.BUCKET) this._paletteButton.setup(_Common2.default.game.canvas.fillLayer.paletteItem, btn.drawMode);else this._paletteButton.setup(_Common2.default.game.canvas.drawLayer.drawingTool.paletteItem, btn.drawMode);\n            }\n\n            // Tutorial.\n            _Common2.default.game.scene.addTutorialEvent(_CommonGame2.default.TUT_EVENT.TOOL_SELECTED);\n            if (btn.drawMode != _CommonGame2.default.TOOL.ERASER) _Common2.default.game.scene.addTutorialEvent(_CommonGame2.default.TUT_EVENT.PALETTE_BUTTON_ENABLED);else _Common2.default.game.scene.addTutorialEvent(_CommonGame2.default.TUT_EVENT.PALETTE_BUTTON_DISABLED);\n        }\n    }, {\n        key: \"_onUndoStack_Empty\",\n        value: function _onUndoStack_Empty() {\n            this._undoBtn.interactive = false;\n            this._undoBtn.alpha = 0.5;\n        }\n    }, {\n        key: \"_onUndoStack_Increased\",\n        value: function _onUndoStack_Increased() {\n            this._undoBtn.interactive = true;\n            this._undoBtn.alpha = 1;\n        }\n    }, {\n        key: \"_onPaletteBtn_Click\",\n        value: function _onPaletteBtn_Click() {\n            this.signals.onPaletteClick.dispatch(this._paletteButton.type);\n        }\n    }, {\n        key: \"_onPaletteSelection_Changed\",\n        value: function _onPaletteSelection_Changed(selection, paletteType) {\n            this._paletteButton.setup(selection, this._paletteButton.type);\n        }\n    }]);\n\n    return HUD;\n}(PIXI.Container);\n\nexports.default = HUD;\n\n},{\"../Common\":3,\"../CommonGame\":4,\"../shaders/OutlineFilter\":33,\"../ui/overlays/PalettePanel\":38,\"./PaletteButton\":19}],15:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction InkPot() {\n    // Constants.\n    this.MIN_RADIUS = 5;\n    this.MAX_RADIUS = 20;\n\n    // Attributes.\n    this._drawLayer = null;\n    this._colour = null;\n}\nexports.default = InkPot;\n//module.exports               \t= InkPot;\n\nInkPot.prototype.constructor = InkPot;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nInkPot.prototype.init = function (drawLayer) {\n    this._drawLayer = drawLayer;\n    this._colour = _Common2.default.assets.getJSON(\"config\").palettePanel.pages[0][0];\n\n    // Signals.\n    _Common2.default.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nInkPot.prototype._draw = function (from, to) {\n    this._drawLayer.context.beginPath();\n    this._drawLayer.context.globalAlpha = Math.random() * 0.25 + 0.15;\n    this._drawLayer.context.arc(to.x, to.y, _Common2.default.randomInt(this.MIN_RADIUS, this.MAX_RADIUS), false, Math.PI * 2, false);\n    this._drawLayer.context.fill();\n\n    this._drawLayer.onContext_Changed();\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nInkPot.prototype.onDrawBegan = function (point) {\n    this._drawLayer.context.save();\n\n    this._drawLayer.context.lineJoin = this._drawLayer.context.lineCap = 'round';\n    this._drawLayer.context.fillStyle = this._colour;\n\n    this._draw(point, point);\n\n    // Sfx.\n    _Common2.default.audio.playSound(\"sfx_tool_inkpot_use_splat_00\");\n};\n\nInkPot.prototype.onDrawMoved = function (from, to) {\n    this._draw(from, to);\n};\n\nInkPot.prototype.onDrawEnded = function () {\n    this._drawLayer.context.restore();\n};\n\nInkPot.prototype._onColour_Changed = function (selection) {\n    if (selection.indexOf(\"#\") == 0) this._colour = selection;\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(InkPot.prototype, \"paletteItem\", {\n    get: function get() {\n        return this._colour;\n    }\n});\n\n},{\"../Common\":3}],16:[function(require,module,exports){\n\"use strict\";\n\nvar Common = require(\"../Common\");\nvar CommonGame = require(\"../CommonGame\");\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction MagicBrush() {\n\t// Constants.\n\tthis.LINE_THICKNESS = 20;\n\n\t// Attributes.\n\tthis._drawLayer = null;\n\tthis._textureId = null;\n}\nmodule.exports = MagicBrush;\nMagicBrush.prototype.constructor = MagicBrush;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nMagicBrush.prototype.init = function (drawLayer) {\n\tthis._drawLayer = drawLayer;\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nMagicBrush.prototype._draw = function (from, to) {\n\tthis._drawLayer.context.beginPath();\n\tthis._drawLayer.context.moveTo(from.x, from.y);\n\tthis._drawLayer.context.lineTo(to.x, to.y);\n\tthis._drawLayer.context.stroke();\n\n\tthis._drawLayer.onContext_Changed();\n};\n\nMagicBrush.prototype._createPattern = function () {\n\tvar patternCanvas = document.createElement('canvas');\n\tvar ctx = patternCanvas.getContext('2d');\n\tvar texture = Common.assets.getTexture(this._textureId);\n\tvar frame = texture.frame;\n\tpatternCanvas.width = patternCanvas.height = frame.width;\n\n\tctx.drawImage(texture.baseTexture.source, frame.x, frame.y, frame.width, frame.height, 0, 0, frame.width, frame.height);\n\n\treturn ctx.createPattern(patternCanvas, 'repeat');\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nMagicBrush.prototype.onDrawBegan = function (point) {\n\tthis._drawLayer.context.lineWidth = this.LINE_THICKNESS;\n\tthis._drawLayer.context.lineJoin = this._drawLayer.context.lineCap = 'round';\n\tthis._drawLayer.context.strokeStyle = this._createPattern();\n\n\tthis._draw(point, point);\n};\n\nMagicBrush.prototype.onDrawMoved = function (from, to) {\n\tthis._draw(from, to);\n};\n\nMagicBrush.prototype.onDrawEnded = function () {};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(MagicBrush.prototype, \"textureId\", { set: function set(a) {\n\t\tthis._textureId = a;\n\t} });\n\n},{\"../Common\":3,\"../CommonGame\":4}],17:[function(require,module,exports){\n\"use strict\";\n\nvar Common = require(\"../Common\");\nvar CommonGame = require(\"../CommonGame\");\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction MagicPencil() {\n\t// Constants.\n\tthis.LINE_THICKNESS = 5;\n\n\t// Attributes.\n\tthis._drawLayer = null;\n\tthis._textureId = null;\n}\nmodule.exports = MagicPencil;\nMagicPencil.prototype.constructor = MagicPencil;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nMagicPencil.prototype.init = function (drawLayer) {\n\tthis._drawLayer = drawLayer;\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nMagicPencil.prototype._draw = function (from, to) {\n\tthis._drawLayer.context.beginPath();\n\tthis._drawLayer.context.moveTo(from.x, from.y);\n\tthis._drawLayer.context.lineTo(to.x, to.y);\n\tthis._drawLayer.context.stroke();\n\n\tthis._drawLayer.onContext_Changed();\n};\n\nMagicPencil.prototype._createPattern = function () {\n\tvar patternCanvas = document.createElement('canvas');\n\tvar ctx = patternCanvas.getContext('2d');\n\tvar texture = Common.assets.getTexture(this._textureId);\n\tvar frame = texture.frame;\n\tpatternCanvas.width = patternCanvas.height = frame.width;\n\n\tctx.drawImage(texture.baseTexture.source, frame.x, frame.y, frame.width, frame.height, 0, 0, frame.width, frame.height);\n\n\treturn ctx.createPattern(patternCanvas, 'repeat');\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nMagicPencil.prototype.onDrawBegan = function (point) {\n\tthis._drawLayer.context.lineWidth = this.LINE_THICKNESS;\n\tthis._drawLayer.context.lineJoin = this._drawLayer.context.lineCap = 'round';\n\tthis._drawLayer.context.strokeStyle = this._createPattern();\n\n\tthis._draw(point, point);\n};\n\nMagicPencil.prototype.onDrawMoved = function (from, to) {\n\tthis._draw(from, to);\n};\n\nMagicPencil.prototype.onDrawEnded = function () {};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(MagicPencil.prototype, \"textureId\", { set: function set(a) {\n\t\tthis._textureId = a;\n\t} });\n\n},{\"../Common\":3,\"../CommonGame\":4}],18:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _HUD = require(\"./HUD\");\n\nvar _HUD2 = _interopRequireDefault(_HUD);\n\nvar _UndoManager = require(\"./UndoManager\");\n\nvar _UndoManager2 = _interopRequireDefault(_UndoManager);\n\nvar _Canvas = require(\"./Canvas\");\n\nvar _Canvas2 = _interopRequireDefault(_Canvas);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MyGame = function () {\n    function MyGame() {\n        _classCallCheck(this, MyGame);\n\n        // TODO:\n\n        // Attributes.\n        this._scene = null;\n        this._decoration = null;\n        this._hud = null;\n        this._canvas = null;\n        this._undoManager = null;\n    }\n\n    _createClass(MyGame, [{\n        key: \"init\",\n        value: function init() {\n            console.assert(this._scene != null, \"Initialization failed: this._scene is null.\");\n\n            // Undo manager.\n            this._undoManager = new _UndoManager2.default();\n\n            // Decoration.\n            this._decoration = new PIXI.Container();\n            this._initDecoration();\n\n            // HUD.\n            this._hud = new _HUD2.default();\n            this._hud.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5, _Common2.default.STAGE_HEIGHT * 0.5);\n            this._hud.init();\n\n            // Canvas.\n            // - Initialization dependencies: HUD.\n            this._canvas = new _Canvas2.default();\n            this._canvas.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5, _Common2.default.STAGE_HEIGHT * 0.5);\n            this._canvas.init();\n\n            this._scene.gameLayer.addChild(this._canvas);\n            this._scene.gameLayer.addChild(this._decoration);\n            this._scene.gameLayer.addChild(this._hud);\n\n            //--add an extra overlay so the drawn / colouring is underneath the black lines--//\n            var outlineTexture = PIXI.Texture.fromImage(\"assets/images/outlines/\" + (_CommonGame2.default.selectedGallery == _CommonGame2.default.GALLERY_ID_DRAW_IT ? \"draw_it/\" : \"colour_it/\") + _CommonGame2.default.selectedImageId + \".png\");\n            var sp = new PIXI.Sprite(outlineTexture);\n            sp.anchor.set(0.5);\n            this._canvas.addChild(sp);\n        }\n    }, {\n        key: \"update\",\n        value: function update() {\n            this._canvas.update();\n        }\n    }, {\n        key: \"animateIn\",\n        value: function animateIn() {\n            this._canvas.animateIn();\n        }\n    }, {\n        key: \"resize\",\n        value: function resize() {\n            this._hud.resize();\n        }\n    }, {\n        key: \"_initDecoration\",\n        value: function _initDecoration() {\n\n            var t = _Common2.default.assets.texture;\n\n            var topFlowers = new PIXI.Sprite(t(\"leaves\"));\n            var offset = topFlowers.height * 0.5;\n\n            topFlowers.anchor.set(0.5, 0.5);\n            topFlowers.x = _Common2.default.STAGE_WIDTH * 0.5;\n            topFlowers.y = -offset;\n\n            var botFlowers = new PIXI.Sprite(t(\"leaves\"));\n            botFlowers.anchor.set(0.5, 0.5);\n            botFlowers.scale.y = -1;\n            botFlowers.x = _Common2.default.STAGE_WIDTH * 0.5;\n            botFlowers.y = _Common2.default.STAGE_HEIGHT + offset;\n\n            this._decoration.addChild(topFlowers, botFlowers);\n\n            TweenMax.to(topFlowers, 2 + Math.random() * 0.5, {\n                y: 0,\n                ease: Elastic.easeOut.config(1, 0.3 - 0.1 * Math.random()),\n                delay: Math.random() * 0.25\n            });\n\n            TweenMax.to(botFlowers, 2 + Math.random() * 0.5, {\n                y: _Common2.default.STAGE_HEIGHT,\n                ease: Elastic.easeOut.config(1, 0.3 - 0.1 * Math.random()),\n                delay: Math.random() * 0.25\n            });\n        }\n    }, {\n        key: \"scene\",\n        get: function get() {\n            return this._scene;\n        },\n        set: function set(value) {\n            this._scene = value;\n        }\n    }, {\n        key: \"hud\",\n        get: function get() {\n            return this._hud;\n        }\n    }, {\n        key: \"canvas\",\n        get: function get() {\n            return this._canvas;\n        }\n    }, {\n        key: \"undoManager\",\n        get: function get() {\n            return this._undoManager;\n        }\n    }]);\n\n    return MyGame;\n}();\n\nexports.default = MyGame;\n\n},{\"../Common\":3,\"../CommonGame\":4,\"./Canvas\":8,\"./HUD\":14,\"./UndoManager\":24}],19:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _PalettePanel = require(\"../ui/overlays/PalettePanel\");\n\nvar _PalettePanel2 = _interopRequireDefault(_PalettePanel);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\nfunction PaletteButton() {\n    PIXI.Container.call(this);\n\n    // Attributes\n    this._button = null;\n    this._selectionSprite = null;\n    this._shineOverlay = null;\n    this._type = null;\n\n    // Signals.\n    this.signals = {};\n    this.signals.onClick = new signals.Signal();\n}\n\nexports.default = PaletteButton;\n//module.exports = PaletteButton;\n\nPaletteButton.prototype = Object.create(PIXI.Container.prototype);\nPaletteButton.prototype.constructor = PaletteButton;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nPaletteButton.prototype.init = function () {\n    // Button.\n    var btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_colour_palette_bg\"), _Common2.default.assets.getTexture(\"icon_colour_palette_bg\"), _Common2.default.assets.getTexture(\"icon_colour_palette_bg\"));\n    this._button = new P3.Button(btnStatesAux);\n    this._button.anchor = new PIXI.Point(0.5, 0.5);\n    this._button.signals.click.add(this.signals.onClick.dispatch, this);\n    this.addChild(this._button);\n\n    // Selection sprite.\n    this._selectionSprite = new PIXI.Sprite(_Common2.default.blankTexture);\n    this._selectionSprite.x = -60;\n    this._selectionSprite.y = 21;\n    this._selectionSprite.anchor = new PIXI.Point(0.5, 0.5);\n    this._button.addChild(this._selectionSprite);\n\n    this._shineOverlay = new PIXI.Sprite(_Common2.default.assets.getTexture(\"btns_colour_overlay\"));\n    this._shineOverlay.anchor = new PIXI.Point(0.5, 0.5);\n    this._shineOverlay.blendMode = PIXI.BLEND_MODES.ADD;\n    this._shineOverlay.alpha = 0.4;\n    this._selectionSprite.addChild(this._shineOverlay);\n};\n\nPaletteButton.prototype.setup = function (selection, toolType) {\n    this._type = toolType;\n\n    this._selectionSprite.tint = 0xffffff;\n\n    switch (this._type) {\n        case _CommonGame2.default.TOOL.BRUSH:\n        case _CommonGame2.default.TOOL.PENCIL:\n        case _CommonGame2.default.TOOL.INK_POT:\n        case _CommonGame2.default.TOOL.SPRAY:\n        case _CommonGame2.default.TOOL.BUCKET:\n            {\n                this._shineOverlay.visible = true;\n\n                this._button._currentNormalTexture = _Common2.default.assets.getTexture(\"icon_colour_palette_bg\");\n                this._button._currentOverTexture = _Common2.default.assets.getTexture(\"icon_colour_palette_bg\");\n                this._button._currentDownTexture = _Common2.default.assets.getTexture(\"icon_colour_palette_bg\");\n                this._button._background.texture = this._button._currentNormalTexture;\n\n                if (selection.indexOf(\"#\") == 0) {\n                    this._selectionSprite.texture = _Common2.default.assets.getTexture(\"btns_colour_white\");\n                    this._selectionSprite.tint = parseInt(\"0x\" + selection.substring(1));\n                } else this._selectionSprite.texture = _Common2.default.assets.getTexture(_CommonGame2.default.TEXTURE_BUTTON_BASE_ID + selection.substring(selection.length - 2));\n\n                this._selectionSprite.scale.x = -0.8;\n                this._selectionSprite.scale.y = 0.8;\n\n                break;\n            }\n\n        case _CommonGame2.default.TOOL.STAMP:\n            {\n                this._shineOverlay.visible = false;\n\n                this._button._currentNormalTexture = _Common2.default.assets.getTexture(\"icon_stamp_palette_bg\");\n                this._button._currentOverTexture = _Common2.default.assets.getTexture(\"icon_stamp_palette_bg\");\n                this._button._currentDownTexture = _Common2.default.assets.getTexture(\"icon_stamp_palette_bg\");\n                this._button._background.texture = this._button._currentNormalTexture;\n\n                this._selectionSprite.texture = _Common2.default.assets.getTexture(selection);\n                this._selectionSprite.scale.x = -1;\n                this._selectionSprite.scale.y = 0.8;\n\n                break;\n            }\n    }\n};\n\nPaletteButton.prototype.setInteractive = function (isInteractive) {\n    this._button.interactive = isInteractive;\n    this._button.alpha = isInteractive ? 1 : 0.5;\n    this._selectionSprite.alpha = this._button.alpha;\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\n// TODO:\n\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\n// TODO:\n\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(PaletteButton.prototype, \"type\", {\n    get: function get() {\n        return this._type;\n    }\n});\n\n},{\"../Common\":3,\"../CommonGame\":4,\"../ui/overlays/PalettePanel\":38}],20:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _PalettePanel = require(\"../ui/overlays/PalettePanel\");\n\nvar _PalettePanel2 = _interopRequireDefault(_PalettePanel);\n\nvar _MagicPencil = require(\"./MagicPencil\");\n\nvar _MagicPencil2 = _interopRequireDefault(_MagicPencil);\n\nvar _ColourPencil = require(\"./ColourPencil\");\n\nvar _ColourPencil2 = _interopRequireDefault(_ColourPencil);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction Pencil() {\n    // Attributes.\n    this._drawLayer = null;\n    this._magicPencil = null;\n    this._colourPencil = null;\n    this._paletteItem = null;\n    this._curPencil = null;\n    this._audio = null;\n}\nexports.default = Pencil;\n//module.exports = Pencil;\n\nPencil.prototype.constructor = Pencil;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nPencil.prototype.init = function (drawLayer) {\n    this._drawLayer = drawLayer;\n\n    // Magic pencil.\n    this._magicPencil = new _MagicPencil2.default();\n    this._magicPencil.init(drawLayer);\n\n    // Colour pencil.\n    this._colourPencil = new _ColourPencil2.default();\n    this._colourPencil.init(drawLayer);\n\n    // Set initial pencil.\n    this._curPencil = this._colourPencil;\n    this._curPencil.colour = _Common2.default.assets.getJSON(\"config\").palettePanel.pages[0][0];\n    this._paletteItem = this._curPencil.colour;\n\n    // Signals.\n    _Common2.default.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nPencil.prototype._draw = function (from, to) {\n    // TEST: DYN_OUT:\n    _Common2.default.game.canvas.drawLayer._dynOutlineContext.beginPath();\n    _Common2.default.game.canvas.drawLayer._dynOutlineContext.strokeStyle = \"black\";\n    _Common2.default.game.canvas.drawLayer._dynOutlineContext.lineWidth = this._curPencil.LINE_THICKNESS;\n    _Common2.default.game.canvas.drawLayer._dynOutlineContext.lineJoin = \"round\";\n    _Common2.default.game.canvas.drawLayer._dynOutlineContext.moveTo(from.x, from.y);\n    _Common2.default.game.canvas.drawLayer._dynOutlineContext.lineTo(to.x, to.y);\n    _Common2.default.game.canvas.drawLayer._dynOutlineContext.closePath();\n    _Common2.default.game.canvas.drawLayer._dynOutlineContext.stroke();\n};\n\nPencil.prototype._stopAudio = function () {\n    this._audio.howl.stop(this._audio.id);\n    this._audio = null;\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nPencil.prototype.onDrawBegan = function (point) {\n    this._curPencil.onDrawBegan(point);\n    // TEST: DYN_OUT:\n    this._draw(point, new PIXI.Point(point.x + 0.1, point.y + 0.1));\n};\n\nPencil.prototype.onDrawMoved = function (from, to) {\n    // Sfx.\n    if (this._audio == null) this._audio = _Common2.default.audio.playSound(\"sfx_tool_pencil_use_loop_00\", { \"loop\": true });\n    TweenMax.killDelayedCallsTo(this._stopAudio);\n    TweenMax.delayedCall(0.25, this._stopAudio, null, this);\n\n    this._curPencil.onDrawMoved(from, to);\n    // TEST: DYN_OUT:\n    this._draw(from, to);\n};\n\nPencil.prototype.onDrawEnded = function () {\n    // Sfx.\n    TweenMax.killDelayedCallsTo(this._stopAudio);\n    if (this._audio != null) this._stopAudio();\n\n    // TEST: DYN_OUT:\n    _Common2.default.game.canvas.drawLayer.dynOutlineData = _Common2.default.game.canvas.drawLayer._dynOutlineContext.getImageData(0, 0, _Common2.default.game.canvas.WIDTH, _Common2.default.game.canvas.HEIGHT);\n};\n\nPencil.prototype._onColour_Changed = function (selection) {\n    if (selection.indexOf(\"#\") == 0) {\n        this._curPencil = this._colourPencil;\n        this._colourPencil.colour = selection;\n    } else {\n        this._curPencil = this._magicPencil;\n        this._magicPencil.textureId = selection;\n    }\n\n    this._paletteItem = selection;\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(Pencil.prototype, \"paletteItem\", {\n    get: function get() {\n        return this._paletteItem;\n    }\n});\n\n},{\"../Common\":3,\"../ui/overlays/PalettePanel\":38,\"./ColourPencil\":10,\"./MagicPencil\":17}],21:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction Spray() {\n    // Constants.\n    this.DENSITY = 40;\n    this.PERIOD = 0.05;\n    this.RADIUS = 15;\n\n    // Attributes.\n    this._drawLayer = null;\n    this._drawPosition = null;\n    this._colour = null;\n    this._audio = null;\n}\nexports.default = Spray;\n//module.exports               \t= Spray;\n\nSpray.prototype.constructor = Spray;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nSpray.prototype.init = function (drawLayer) {\n    this._drawLayer = drawLayer;\n    this._colour = _Common2.default.assets.getJSON(\"config\").palettePanel.pages[0][0];\n\n    // Signals.\n    _Common2.default.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\n};\n\nSpray.prototype._stopAudio = function () {\n    this._audio.howl.stop(this._audio.id);\n    this._audio = null;\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nSpray.prototype._draw = function () {\n    if (this._drawPosition == null) return;\n\n    for (var i = this.DENSITY; i--;) {\n        this._drawLayer.context.save();\n\n        this._drawColour();\n\n        this._drawLayer.context.restore();\n    }\n\n    TweenMax.delayedCall(this.PERIOD, this._draw, null, this);\n\n    this._drawLayer.onContext_Changed();\n};\n\nSpray.prototype._drawColour = function () {\n    var angle = _Common2.default.randomFloat(0, Math.PI * 2);\n    var radius = _Common2.default.randomFloat(0, this.RADIUS);\n\n    this._drawLayer.context.fillStyle = this._colour;\n    this._drawLayer.context.globalAlpha = Math.random();\n    this._drawLayer.context.fillRect(this._drawPosition.x + radius * Math.cos(angle), this._drawPosition.y + radius * Math.sin(angle), _Common2.default.randomFloat(1, 2), _Common2.default.randomFloat(1, 2));\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nSpray.prototype.onDrawBegan = function (point) {\n    this._drawPosition = new PIXI.Point(point.x, point.y);\n\n    this._drawLayer.context.lineJoin = this._drawLayer.context.lineCap = 'round';\n\n    this._draw();\n\n    // Sfx.\n    this._audio = _Common2.default.audio.playSound(\"sfx_tool_spraycan_use_loop_00\", { \"loop\": true });\n};\n\nSpray.prototype.onDrawMoved = function (from, to) {\n    this._drawPosition.x = to.x;\n    this._drawPosition.y = to.y;\n};\n\nSpray.prototype.onDrawEnded = function () {\n    TweenMax.killTweensOf(this);\n    this._drawPosition = null;\n\n    // Sfx.\n    this._stopAudio();\n};\n\nSpray.prototype._onColour_Changed = function (selection) {\n    if (selection.indexOf(\"#\") == 0) this._colour = selection;\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(Spray.prototype, \"paletteItem\", {\n    get: function get() {\n        return this._colour;\n    }\n});\n\n},{\"../Common\":3}],22:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction Stamp() {\n    // Attributes.\n    this._drawLayer = null;\n    this._paletteItem = null;\n}\nexports.default = Stamp;\n//module.exports = Stamp;\n\nStamp.prototype.constructor = Stamp;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nStamp.prototype.init = function (drawLayer) {\n    this._drawLayer = drawLayer;\n    this._paletteItem = _Common2.default.assets.getJSON(\"config\").palettePanel.pages[_Common2.default.assets.getJSON(\"config\").palettePanel.tools.stamp[0]][0];\n\n    // Listen to HUD controls.\n    _Common2.default.game.scene.palettePanel.signals.onStampChanged.add(this._onStamp_Changed, this);\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\n// TODO:\n\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nStamp.prototype.onDrawBegan = function (point) {\n    var scaleFactor = Math.random();\n\n    this._drawLayer.context.save();\n    this._drawLayer.context.translate(point.x, point.y);\n    //this._drawLayer.context.scale( 0.6 + 0.4 * scaleFactor, 0.6 + 0.4 * scaleFactor );\n    //this._drawLayer.context.rotate( Math.PI * 2 * Math.random() );\n    //this._drawLayer.context.drawImage( this._image, -this._image.width * 0.5, -this._image.height * 0.5 );\n    var texture = _Common2.default.assets.getTexture(this._paletteItem);\n    var frame = texture.frame;\n    this._drawLayer.context.drawImage(texture.baseTexture.source, frame.x * _Common2.default.main.assetRes, frame.y * _Common2.default.main.assetRes, frame.width * _Common2.default.main.assetRes, frame.height * _Common2.default.main.assetRes, 0.5 * -frame.width, 0.5 * -frame.height, frame.width, frame.height);\n    this._drawLayer.context.restore();\n\n    this._drawLayer.onContext_Changed();\n\n    // Sfx.\n    _Common2.default.audio.playSound(\"sfx_tool_stamp_use_00\");\n};\n\nStamp.prototype.onDrawMoved = function (from, to) {};\n\nStamp.prototype.onDrawEnded = function () {};\n\nStamp.prototype._onStamp_Changed = function (selection) {\n    this._paletteItem = selection;\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(Stamp.prototype, \"paletteItem\", {\n    get: function get() {\n        return this._paletteItem;\n    }\n});\n\n},{\"../Common\":3,\"../CommonGame\":4}],23:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _PalettePanel = require(\"../ui/overlays/PalettePanel\");\n\nvar _PalettePanel2 = _interopRequireDefault(_PalettePanel);\n\nvar _PaletteButton = require(\"./PaletteButton\");\n\nvar _PaletteButton2 = _interopRequireDefault(_PaletteButton);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\nfunction Tutorial() {\n    PIXI.Container.call(this);\n\n    // Enumerators.\n    this.STATE = {\n        DRAW: 0,\n        TOOL: 1,\n        PALETTE: 2,\n        IDLE: 3\n    };\n\n    // Constants.\n    this.TUT_STEP_DELAY = 3;\n\n    // Attributes.\n    this._isPaused = false;\n    this._tutorialStepTimer = 0;\n    this._tutorialHand = null;\n    this._state = this.STATE.IDLE;\n    this._arrEvent = [];\n    this._arrTutorialStep = [{\n        state: this.STATE.DRAW,\n        isValid: false,\n        isDone: !_Common2.default.savedData.isDrawTutorial\n    }, {\n        state: this.STATE.TOOL,\n        isValid: true,\n        isDone: !_Common2.default.savedData.isToolTutorial\n    }, {\n        state: this.STATE.PALETTE,\n        isValid: false,\n        isDone: !_Common2.default.savedData.isPaletteTutorial\n    }];\n\n    // Signals.\n    this.signals = {};\n    this.signals.onCompleted = new signals.Signal();\n}\n\nexports.default = Tutorial;\n//module.exports = Tutorial;\n\nTutorial.prototype = Object.create(PIXI.Container.prototype);\nTutorial.prototype.constructor = Tutorial;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nTutorial.prototype.init = function () {\n\n    this._tutorialHand = new PIXI.spine.Spine(_Common2.default.assets.spineData(\"tutorial_hand\"));\n    this._tutorialHand.skeleton.setToSetupPose();\n    this._tutorialHand.skeleton.setSkin(null);\n    this._tutorialHand.skeleton.setSkinByName(\"default\");\n    this._tutorialHand.autoUpdate = false;\n    this._tutorialHand.scale = new PIXI.Point(0.7, 0.7);\n    this._tutorialHand.alpha = 0;\n    this.addChild(this._tutorialHand);\n\n    this._tutorialHand.state.setAnimationByName(0, \"still_\" + (P3.Device.isMobile ? \"mobile\" : \"desktop\"), true);\n    this._tutorialHand.update(deltaTime);\n};\n\nTutorial.prototype.end = function () {\n    this.removeChild(this._tutorialHand);\n    this._tutorialHand.destroy();\n    this._tutorialHand = null;\n};\n\nTutorial.prototype.update = function () {\n    if (this._tutorialHand == null) return;\n\n    this._tutorialHand.update(deltaTime);\n\n    this._processEvents();\n\n    // Delayed tutorial step activation.\n    if (!this._isPaused) {\n        this._tutorialStepTimer += deltaTime;\n        if (this._tutorialStepTimer >= this.TUT_STEP_DELAY && this._state == this.STATE.IDLE) {\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n                for (var _iterator = this._arrTutorialStep[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var tutorialStep = _step.value;\n\n                    if (tutorialStep.isValid && !tutorialStep.isDone) {\n                        this._state = tutorialStep.state;\n\n                        switch (this._state) {\n                            case this.STATE.DRAW:\n                                {\n                                    this._tutorialHand.state.setAnimationByName(0, \"drag_\" + (P3.Device.isMobile ? \"mobile\" : \"desktop\"), true);\n                                    this._tutorialHand.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5, _Common2.default.STAGE_HEIGHT * 0.5);\n\n                                    this._showHand();\n\n                                    break;\n                                }\n\n                            case this.STATE.TOOL:\n                                {\n                                    this._tutorialHand.state.setAnimationByName(0, \"tap_\" + (P3.Device.isMobile ? \"mobile\" : \"desktop\"), true);\n                                    this._tutorialHand.position = _Common2.default.game.hud.getBrushBtnPosition();\n\n                                    this._showHand();\n\n                                    break;\n                                }\n\n                            case this.STATE.PALETTE:\n                                {\n                                    this._tutorialHand.state.setAnimationByName(0, \"tap_\" + (P3.Device.isMobile ? \"mobile\" : \"desktop\"), true);\n                                    this._tutorialHand.position = _Common2.default.game.hud.getPaletteBtnPosition();\n\n                                    this._showHand();\n\n                                    break;\n                                }\n                        }\n                    }\n\n                    if (!tutorialStep.isDone) break;\n                }\n            } catch (err) {\n                _didIteratorError = true;\n                _iteratorError = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                        _iterator.return();\n                    }\n                } finally {\n                    if (_didIteratorError) {\n                        throw _iteratorError;\n                    }\n                }\n            }\n\n            this._tutorialStepTimer = 0;\n        }\n    }\n};\n\nTutorial.prototype.addEvent = function (tutorialEvent) {\n    this._arrEvent.push(tutorialEvent);\n};\n\nTutorial.prototype.resize = function () {\n    if (this._tutorialHand == null) return;\n\n    if (this._state == this.STATE.DRAW) this._tutorialHand.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5, _Common2.default.STAGE_HEIGHT * 0.5);else if (this._state == this.STATE.TOOL) this._tutorialHand.position = _Common2.default.game.hud.getBrushBtnPosition();else if (this._state == this.STATE.PALETTE) this._tutorialHand.position = _Common2.default.game.hud.getPaletteBtnPosition();\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nTutorial.prototype._processEvents = function () {\n    var _iteratorNormalCompletion2 = true;\n    var _didIteratorError2 = false;\n    var _iteratorError2 = undefined;\n\n    try {\n        for (var _iterator2 = this._arrEvent[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n            var tutorialEvent = _step2.value;\n\n            switch (tutorialEvent) {\n                case _CommonGame2.default.TUT_EVENT.CANVAS_VISIBLE:\n                    {\n                        this._arrTutorialStep[this.STATE.DRAW].isValid = true;\n\n                        break;\n                    }\n\n                case _CommonGame2.default.TUT_EVENT.PALETTE_SELECTED:\n                    {\n                        if (this._state == this.STATE.DRAW || this._state == this.STATE.TOOL) this._hideHand();else if (this._state == this.STATE.PALETTE) {\n                            this._hideHand(this._checkTutorialEnd);\n\n                            this._state = this.STATE.IDLE;\n                        }\n\n                        if (_Common2.default.savedData.isPaletteTutorial) {\n                            this._arrTutorialStep[this.STATE.PALETTE].isDone = true;\n\n                            _Common2.default.savedData.isPaletteTutorial = false;\n                            _Common2.default.savedData.save();\n                        }\n\n                        this._isPaused = true;\n                        this._tutorialStepTimer = 0;\n\n                        break;\n                    }\n\n                case _CommonGame2.default.TUT_EVENT.MENU_PANEL_SHOWN:\n                    {\n                        if (this._state != this.STATE.IDLE) this._hideHand();\n\n                        this._isPaused = true;\n                        this._tutorialStepTimer = 0;\n\n                        break;\n                    }\n\n                case _CommonGame2.default.TUT_EVENT.MENU_PANEL_HIDDEN:\n                case _CommonGame2.default.TUT_EVENT.PALETTE_PANEL_HIDDEN:\n                    {\n                        if (this._state != this.STATE.IDLE) this._showHand();\n\n                        this._isPaused = false;\n                        this._tutorialStepTimer = 0;\n\n                        break;\n                    }\n\n                case _CommonGame2.default.TUT_EVENT.PALETTE_BUTTON_ENABLED:\n                    {\n                        this._arrTutorialStep[this.STATE.PALETTE].isValid = true;\n\n                        if (this._state == this.STATE.PALETTE) this._showHand();\n\n                        break;\n                    }\n\n                case _CommonGame2.default.TUT_EVENT.PALETTE_BUTTON_DISABLED:\n                    {\n                        this._arrTutorialStep[this.STATE.PALETTE].isValid = false;\n\n                        if (this._state == this.STATE.PALETTE) this._hideHand();\n\n                        break;\n                    }\n\n                case _CommonGame2.default.TUT_EVENT.TOOL_SELECTED:\n                    {\n                        if (this._state == this.STATE.TOOL) {\n                            this._hideHand(this._checkTutorialEnd);\n\n                            this._state = this.STATE.IDLE;\n                        }\n\n                        if (_Common2.default.savedData.isToolTutorial) {\n                            this._arrTutorialStep[this.STATE.TOOL].isDone = true;\n\n                            _Common2.default.savedData.isToolTutorial = false;\n                            _Common2.default.savedData.save();\n                        }\n\n                        this._tutorialStepTimer = 0;\n\n                        break;\n                    }\n\n                case _CommonGame2.default.TUT_EVENT.CANVAS_DRAWN:\n                    {\n                        if (this._state == this.STATE.DRAW) {\n                            this._hideHand(this._checkTutorialEnd);\n\n                            this._state = this.STATE.IDLE;\n                        }\n\n                        if (_Common2.default.savedData.isDrawTutorial) {\n                            this._arrTutorialStep[this.STATE.DRAW].isDone = true;\n\n                            _Common2.default.savedData.isDrawTutorial = false;\n                            _Common2.default.savedData.save();\n                        }\n\n                        this._tutorialStepTimer = 0;\n\n                        break;\n                    }\n            }\n        }\n    } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n    } finally {\n        try {\n            if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                _iterator2.return();\n            }\n        } finally {\n            if (_didIteratorError2) {\n                throw _iteratorError2;\n            }\n        }\n    }\n\n    this._arrEvent = [];\n};\n\nTutorial.prototype._showHand = function () {\n    TweenMax.to(this._tutorialHand, 0.25, { alpha: 1 });\n};\n\nTutorial.prototype._hideHand = function (onComplete) {\n    var tm = TweenMax.to(this._tutorialHand, 0.25, { alpha: 0 });\n\n    if (onComplete != null) tm.eventCallback(\"onComplete\", onComplete, null, this);\n};\n\nTutorial.prototype._checkTutorialEnd = function () {\n    if (!_Common2.default.savedData.isDrawTutorial && !_Common2.default.savedData.isToolTutorial && !_Common2.default.savedData.isPaletteTutorial) this.signals.onCompleted.dispatch();\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\n// TODO:\n\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\n// TODO:\n\n},{\"../Common\":3,\"../CommonGame\":4,\"../ui/overlays/PalettePanel\":38,\"./PaletteButton\":19}],24:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\nfunction UndoManager() {\n    // Constants.\n    this.MAX_STACK_SIZE = 3;\n\n    // Attributes.\n    this._arrLayerState = [];\n\n    // Signals.\n    this.signals = {};\n    this.signals.onStackEmpty = new signals.Signal();\n    this.signals.onStackIncreased = new signals.Signal();\n}\nexports.default = UndoManager;\n//module.exports = UndoManager;\n\nUndoManager.prototype.constructor = UndoManager;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nUndoManager.prototype.save = function () {\n    var drawlayerData = _Common2.default.game.canvas.drawLayer.context.getImageData(0, 0, _Common2.default.game.canvas.WIDTH, _Common2.default.game.canvas.HEIGHT);\n    var drawDynOutlineData = _Common2.default.game.canvas.drawLayer.dynOutlineContext.getImageData(0, 0, _Common2.default.game.canvas.WIDTH, _Common2.default.game.canvas.HEIGHT);\n    var fillLayerData = _Common2.default.game.canvas.fillLayer.colourContext.getImageData(0, 0, _Common2.default.game.canvas.WIDTH, _Common2.default.game.canvas.HEIGHT);\n    var fillColourCodeData = _Common2.default.game.canvas.fillLayer.colourCodeContext.getImageData(0, 0, _Common2.default.game.canvas.WIDTH, _Common2.default.game.canvas.HEIGHT);\n\n    if (this._arrLayerState.length == this.MAX_STACK_SIZE) this._arrLayerState.splice(0, 1);\n\n    this._arrLayerState.push({\n        drawlayerData: drawlayerData,\n        drawDynOutlineData: drawDynOutlineData,\n        fillLayerData: fillLayerData,\n        fillColourCodeData: fillColourCodeData\n    });\n\n    // Signals.\n    this.signals.onStackIncreased.dispatch();\n};\n\nUndoManager.prototype.undo = function () {\n    if (this._arrLayerState.length == 0) return;\n\n    var layerState = this._arrLayerState.splice(this._arrLayerState.length - 1, 1)[0];\n\n    _Common2.default.game.canvas.fillLayer.setLayerData(layerState.fillLayerData, layerState.fillColourCodeData);\n    _Common2.default.game.canvas.drawLayer.setLayerData(layerState.drawlayerData, layerState.drawDynOutlineData);\n\n    // Signals.\n    if (this._arrLayerState.length == 0) this.signals.onStackEmpty.dispatch();\n};\n\nUndoManager.prototype.clear = function () {\n    this._arrLayerState = [];\n\n    this.signals.onStackEmpty.dispatch();\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\n// TODO:\n\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\n// TODO:\n\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\n// TODO:\n\n},{\"../Common\":3,\"../CommonGame\":4}],25:[function(require,module,exports){\n(function (global){\n'use strict';\n\nvar _Main = require('./Main');\n\nvar _Main2 = _interopRequireDefault(_Main);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nglobal.Main = _Main2.default;\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./Main\":5}],26:[function(require,module,exports){\n(function (global){\n\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n(function (f) {\n    if ((typeof exports === \"undefined\" ? \"undefined\" : _typeof(exports)) === \"object\" && typeof module !== \"undefined\") {\n        module.exports = f();\n    } else if (typeof define === \"function\" && define.amd) {\n        define([], f);\n    } else {\n        var g;if (typeof window !== \"undefined\") {\n            g = window;\n        } else if (typeof global !== \"undefined\") {\n            g = global;\n        } else if (typeof self !== \"undefined\") {\n            g = self;\n        } else {\n            g = this;\n        }g.MultiStyleText = f();\n    }\n})(function () {\n    var define, module, exports;return function e(t, n, r) {\n        function s(o, u) {\n            if (!n[o]) {\n                if (!t[o]) {\n                    var a = typeof require == \"function\" && require;if (!u && a) return a(o, !0);if (i) return i(o, !0);var f = new Error(\"Cannot find module '\" + o + \"'\");throw f.code = \"MODULE_NOT_FOUND\", f;\n                }var l = n[o] = { exports: {} };t[o][0].call(l.exports, function (e) {\n                    var n = t[o][1][e];return s(n ? n : e);\n                }, l, l.exports, e, t, n, r);\n            }return n[o].exports;\n        }var i = typeof require == \"function\" && require;for (var o = 0; o < r.length; o++) {\n            s(r[o]);\n        }return s;\n    }({ 1: [function (require, module, exports) {\n            module.exports = require(\"./pixi-multistyle-text\").default;\n        }, { \"./pixi-multistyle-text\": 2 }], 2: [function (require, module, exports) {\n            var __extends = this && this.__extends || function () {\n                var extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n                    d.__proto__ = b;\n                } || function (d, b) {\n                    for (var p in b) {\n                        if (b.hasOwnProperty(p)) d[p] = b[p];\n                    }\n                };\n                return function (d, b) {\n                    extendStatics(d, b);\n                    function __() {\n                        this.constructor = d;\n                    }\n                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n                };\n            }();\n            (function (factory) {\n                if ((typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) === \"object\" && _typeof(module.exports) === \"object\") {\n                    var v = factory(require, exports);\n                    if (v !== undefined) module.exports = v;\n                } else if (typeof define === \"function\" && define.amd) {\n                    define([\"require\", \"exports\"], factory);\n                }\n            })(function (require, exports) {\n                \"use strict\";\n\n                Object.defineProperty(exports, \"__esModule\", { value: true });\n                var MultiStyleText = function (_super) {\n                    __extends(MultiStyleText, _super);\n                    function MultiStyleText(text, styles) {\n                        var _this = _super.call(this, text) || this;\n                        _this.styles = styles;\n                        return _this;\n                    }\n                    Object.defineProperty(MultiStyleText.prototype, \"styles\", {\n                        set: function set(styles) {\n                            this.textStyles = {};\n                            this.textStyles[\"default\"] = this.assign({}, MultiStyleText.DEFAULT_TAG_STYLE);\n                            for (var style in styles) {\n                                if (style === \"default\") {\n                                    this.assign(this.textStyles[\"default\"], styles[style]);\n                                } else {\n                                    this.textStyles[style] = this.assign({}, styles[style]);\n                                }\n                            }\n                            this._style = new PIXI.TextStyle(this.textStyles[\"default\"]);\n                            this.dirty = true;\n                        },\n                        enumerable: true,\n                        configurable: true\n                    });\n                    MultiStyleText.prototype.setTagStyle = function (tag, style) {\n                        if (tag in this.textStyles) {\n                            this.assign(this.textStyles[tag], style);\n                        } else {\n                            this.textStyles[tag] = this.assign({}, style);\n                        }\n                        this._style = new PIXI.TextStyle(this.textStyles[\"default\"]);\n                        this.dirty = true;\n                    };\n                    MultiStyleText.prototype.deleteTagStyle = function (tag) {\n                        if (tag === \"default\") {\n                            this.textStyles[\"default\"] = this.assign({}, MultiStyleText.DEFAULT_TAG_STYLE);\n                        } else {\n                            delete this.textStyles[tag];\n                        }\n                        this._style = new PIXI.TextStyle(this.textStyles[\"default\"]);\n                        this.dirty = true;\n                    };\n                    MultiStyleText.prototype._getTextDataPerLine = function (lines) {\n                        var outputTextData = [];\n                        var tags = Object.keys(this.textStyles).join(\"|\");\n                        var re = new RegExp(\"</?(\" + tags + \")>\", \"g\");\n                        var styleStack = [this.assign({}, this.textStyles[\"default\"])];\n                        var tagNameStack = [\"default\"];\n                        for (var i = 0; i < lines.length; i++) {\n                            var lineTextData = [];\n                            var matches = [];\n                            var matchArray = void 0;\n                            while (matchArray = re.exec(lines[i])) {\n                                matches.push(matchArray);\n                            }\n                            if (matches.length === 0) {\n                                lineTextData.push(this.createTextData(lines[i], styleStack[styleStack.length - 1], tagNameStack[tagNameStack.length - 1]));\n                            } else {\n                                var currentSearchIdx = 0;\n                                for (var j = 0; j < matches.length; j++) {\n                                    if (matches[j].index > currentSearchIdx) {\n                                        lineTextData.push(this.createTextData(lines[i].substring(currentSearchIdx, matches[j].index), styleStack[styleStack.length - 1], tagNameStack[tagNameStack.length - 1]));\n                                    }\n                                    if (matches[j][0][1] === \"/\") {\n                                        if (styleStack.length > 1) {\n                                            styleStack.pop();\n                                            tagNameStack.pop();\n                                        }\n                                    } else {\n                                        styleStack.push(this.assign({}, styleStack[styleStack.length - 1], this.textStyles[matches[j][1]]));\n                                        tagNameStack.push(matches[j][1]);\n                                    }\n                                    currentSearchIdx = matches[j].index + matches[j][0].length;\n                                }\n                                if (currentSearchIdx < lines[i].length) {\n                                    lineTextData.push(this.createTextData(lines[i].substring(currentSearchIdx), styleStack[styleStack.length - 1], tagNameStack[tagNameStack.length - 1]));\n                                }\n                            }\n                            outputTextData.push(lineTextData);\n                        }\n                        return outputTextData;\n                    };\n                    MultiStyleText.prototype.getFontString = function (style) {\n                        return new PIXI.TextStyle(style).toFontString();\n                    };\n                    MultiStyleText.prototype.createTextData = function (text, style, tagName) {\n                        return {\n                            text: text,\n                            style: style,\n                            width: 0,\n                            height: 0,\n                            fontProperties: undefined,\n                            tagName: tagName\n                        };\n                    };\n                    MultiStyleText.prototype.getDropShadowPadding = function () {\n                        var _this = this;\n                        var maxDistance = 0;\n                        var maxBlur = 0;\n                        Object.keys(this.textStyles).forEach(function (styleKey) {\n                            var _a = _this.textStyles[styleKey],\n                                dropShadowDistance = _a.dropShadowDistance,\n                                dropShadowBlur = _a.dropShadowBlur;\n                            maxDistance = Math.max(maxDistance, dropShadowDistance || 0);\n                            maxBlur = Math.max(maxBlur, dropShadowBlur || 0);\n                        });\n                        return maxDistance + maxBlur;\n                    };\n                    MultiStyleText.prototype.updateText = function () {\n                        var _this = this;\n                        if (!this.dirty) {\n                            return;\n                        }\n                        this.texture.baseTexture.resolution = this.resolution;\n                        var textStyles = this.textStyles;\n                        var outputText = this.text;\n                        if (this._style.wordWrap) {\n                            outputText = this.wordWrap(this.text);\n                        }\n                        var lines = outputText.split(/(?:\\r\\n|\\r|\\n)/);\n                        var outputTextData = this._getTextDataPerLine(lines);\n                        var lineWidths = [];\n                        var lineYMins = [];\n                        var lineYMaxs = [];\n                        var baselines = [];\n                        var maxLineWidth = 0;\n                        for (var i = 0; i < lines.length; i++) {\n                            var lineWidth = 0;\n                            var lineYMin = 0;\n                            var lineYMax = 0;\n                            var baseline = 0;\n                            for (var j = 0; j < outputTextData[i].length; j++) {\n                                var sty = outputTextData[i][j].style;\n                                this.context.font = this.getFontString(sty);\n                                outputTextData[i][j].width = this.context.measureText(outputTextData[i][j].text).width;\n                                if (outputTextData[i][j].text.length === 0) {\n                                    outputTextData[i][j].width += (outputTextData[i][j].text.length - 1) * sty.letterSpacing;\n                                    if (j > 0) {\n                                        lineWidth += sty.letterSpacing / 2;\n                                    }\n                                    if (j < outputTextData[i].length - 1) {\n                                        lineWidth += sty.letterSpacing / 2;\n                                    }\n                                }\n                                lineWidth += outputTextData[i][j].width;\n                                outputTextData[i][j].fontProperties = PIXI.TextMetrics.measureFont(this.context.font);\n                                outputTextData[i][j].height = outputTextData[i][j].fontProperties.fontSize + outputTextData[i][j].style.strokeThickness;\n                                if (typeof sty.valign === \"number\") {\n                                    lineYMin = Math.min(lineYMin, sty.valign - outputTextData[i][j].fontProperties.descent);\n                                    lineYMax = Math.max(lineYMax, sty.valign + outputTextData[i][j].fontProperties.ascent);\n                                } else {\n                                    lineYMin = Math.min(lineYMin, -outputTextData[i][j].fontProperties.descent);\n                                    lineYMax = Math.max(lineYMax, outputTextData[i][j].fontProperties.ascent);\n                                }\n                            }\n                            //owain\n                            var foo = Object.keys(textStyles).map(function (key) {\n                                return textStyles[key];\n                            });\n                            var myValue;\n                            var bar = foo.reduce(function (prev, cur) {\n                                myValue = cur.strokeThickness;\n                                return Math.max(prev, cur.strokeThickness || 0);\n                            }, 0);\n                            lineWidth += myValue * 8; //owain - hacky fix for cut off text when using a stroke (I think 8 is stroke width)\n                            lineWidths[i] = lineWidth;\n                            lineYMins[i] = lineYMin;\n                            lineYMaxs[i] = lineYMax;\n                            maxLineWidth = Math.max(maxLineWidth, lineWidth);\n                        }\n                        var stylesArray = Object.keys(textStyles).map(function (key) {\n                            return textStyles[key];\n                        });\n                        var maxStrokeThickness = stylesArray.reduce(function (prev, cur) {\n                            return Math.max(prev, cur.strokeThickness || 0);\n                        }, 0);\n                        var dropShadowPadding = this.getDropShadowPadding();\n                        var totalHeight = lineYMaxs.reduce(function (prev, cur) {\n                            return prev + cur;\n                        }, 0) - lineYMins.reduce(function (prev, cur) {\n                            return prev + cur;\n                        }, 0);\n                        var width = maxLineWidth + maxStrokeThickness + 2 * dropShadowPadding;\n                        var height = totalHeight + 2 * dropShadowPadding;\n                        this.canvas.width = (width + this.context.lineWidth) * this.resolution;\n                        this.canvas.height = height * this.resolution;\n                        this.context.scale(this.resolution, this.resolution);\n                        this.context.textBaseline = \"alphabetic\";\n                        this.context.lineJoin = \"round\";\n                        var basePositionY = dropShadowPadding;\n                        var drawingData = [];\n                        for (var i = 0; i < outputTextData.length; i++) {\n                            var line = outputTextData[i];\n                            var linePositionX = void 0;\n                            switch (this._style.align) {\n                                case \"left\":\n                                    linePositionX = dropShadowPadding;\n                                    break;\n                                case \"center\":\n                                    linePositionX = dropShadowPadding + (maxLineWidth - lineWidths[i]) / 2;\n                                    break;\n                                case \"right\":\n                                    linePositionX = dropShadowPadding + maxLineWidth - lineWidths[i];\n                                    break;\n                            }\n                            for (var j = 0; j < line.length; j++) {\n                                var _a = line[j],\n                                    style = _a.style,\n                                    text = _a.text,\n                                    fontProperties = _a.fontProperties,\n                                    width_1 = _a.width,\n                                    height_1 = _a.height,\n                                    tagName = _a.tagName;\n                                linePositionX += maxStrokeThickness / 2;\n                                var linePositionY = maxStrokeThickness / 2 + basePositionY + fontProperties.ascent;\n                                switch (style.valign) {\n                                    case \"top\":\n                                        break;\n                                    case \"baseline\":\n                                        linePositionY += lineYMaxs[i] - fontProperties.ascent;\n                                        break;\n                                    case \"middle\":\n                                        linePositionY += (lineYMaxs[i] - lineYMins[i] - fontProperties.ascent - fontProperties.descent) / 2;\n                                        break;\n                                    case \"bottom\":\n                                        linePositionY += lineYMaxs[i] - lineYMins[i] - fontProperties.ascent - fontProperties.descent;\n                                        break;\n                                    default:\n                                        linePositionY += lineYMaxs[i] - fontProperties.ascent - style.valign;\n                                        break;\n                                }\n                                if (style.letterSpacing === 0) {\n                                    drawingData.push({\n                                        text: text,\n                                        style: style,\n                                        x: linePositionX,\n                                        y: linePositionY,\n                                        width: width_1,\n                                        ascent: fontProperties.ascent,\n                                        descent: fontProperties.descent,\n                                        tagName: tagName\n                                    });\n                                    linePositionX += line[j].width;\n                                } else {\n                                    this.context.font = this.getFontString(line[j].style);\n                                    for (var k = 0; k < text.length; k++) {\n                                        if (k > 0 || j > 0) {\n                                            linePositionX += style.letterSpacing / 2;\n                                        }\n                                        drawingData.push({\n                                            text: text.charAt(k),\n                                            style: style,\n                                            x: linePositionX,\n                                            y: linePositionY,\n                                            width: width_1,\n                                            ascent: fontProperties.ascent,\n                                            descent: fontProperties.descent,\n                                            tagName: tagName\n                                        });\n                                        linePositionX += this.context.measureText(text.charAt(k)).width;\n                                        if (k < text.length - 1 || j < line.length - 1) {\n                                            linePositionX += style.letterSpacing / 2;\n                                        }\n                                    }\n                                }\n                                linePositionX -= maxStrokeThickness / 2;\n                            }\n                            basePositionY += lineYMaxs[i] - lineYMins[i];\n                        }\n                        this.context.save();\n                        drawingData.forEach(function (_a) {\n                            var style = _a.style,\n                                text = _a.text,\n                                x = _a.x,\n                                y = _a.y;\n                            if (!style.dropShadow) {\n                                return;\n                            }\n                            _this.context.font = _this.getFontString(style);\n                            var dropFillStyle = style.dropShadowColor;\n                            if (typeof dropFillStyle === \"number\") {\n                                dropFillStyle = PIXI.utils.hex2string(dropFillStyle);\n                            }\n                            _this.context.shadowColor = dropFillStyle;\n                            _this.context.shadowBlur = style.dropShadowBlur;\n                            _this.context.shadowOffsetX = Math.cos(style.dropShadowAngle) * style.dropShadowDistance * _this.resolution;\n                            _this.context.shadowOffsetY = Math.sin(style.dropShadowAngle) * style.dropShadowDistance * _this.resolution;\n                            _this.context.fillText(text, x, y);\n                        });\n                        this.context.restore();\n                        drawingData.forEach(function (_a) {\n                            var style = _a.style,\n                                text = _a.text,\n                                x = _a.x,\n                                y = _a.y,\n                                width = _a.width,\n                                ascent = _a.ascent,\n                                descent = _a.descent,\n                                tagName = _a.tagName;\n                            _this.context.font = _this.getFontString(style);\n                            var strokeStyle = style.stroke;\n                            if (typeof strokeStyle === \"number\") {\n                                strokeStyle = PIXI.utils.hex2string(strokeStyle);\n                            }\n                            _this.context.strokeStyle = strokeStyle;\n                            _this.context.lineWidth = style.strokeThickness;\n                            var fillStyle = style.fill;\n                            if (typeof fillStyle === \"number\") {\n                                fillStyle = PIXI.utils.hex2string(fillStyle);\n                            } else if (Array.isArray(fillStyle)) {\n                                for (var i = 0; i < fillStyle.length; i++) {\n                                    var fill = fillStyle[i];\n                                    if (typeof fill === \"number\") {\n                                        fillStyle[i] = PIXI.utils.hex2string(fill);\n                                    }\n                                }\n                            }\n                            _this.context.fillStyle = _this._generateFillStyle(new PIXI.TextStyle(style), [text]);\n                            if (style.stroke && style.strokeThickness) {\n                                _this.context.strokeText(text, x, y);\n                            }\n                            if (style.fill) {\n                                _this.context.fillText(text, x, y);\n                            }\n                            var debugSpan = style.debug === undefined ? MultiStyleText.debugOptions.spans.enabled : style.debug;\n                            if (debugSpan) {\n                                _this.context.lineWidth = 1;\n                                if (MultiStyleText.debugOptions.spans.bounding) {\n                                    _this.context.fillStyle = MultiStyleText.debugOptions.spans.bounding;\n                                    _this.context.strokeStyle = MultiStyleText.debugOptions.spans.bounding;\n                                    _this.context.beginPath();\n                                    _this.context.rect(x, y - ascent, width, ascent + descent);\n                                    _this.context.fill();\n                                    _this.context.stroke();\n                                    _this.context.stroke();\n                                }\n                                if (MultiStyleText.debugOptions.spans.baseline) {\n                                    _this.context.strokeStyle = MultiStyleText.debugOptions.spans.baseline;\n                                    _this.context.beginPath();\n                                    _this.context.moveTo(x, y);\n                                    _this.context.lineTo(x + width, y);\n                                    _this.context.closePath();\n                                    _this.context.stroke();\n                                }\n                                if (MultiStyleText.debugOptions.spans.top) {\n                                    _this.context.strokeStyle = MultiStyleText.debugOptions.spans.top;\n                                    _this.context.beginPath();\n                                    _this.context.moveTo(x, y - ascent);\n                                    _this.context.lineTo(x + width, y - ascent);\n                                    _this.context.closePath();\n                                    _this.context.stroke();\n                                }\n                                if (MultiStyleText.debugOptions.spans.bottom) {\n                                    _this.context.strokeStyle = MultiStyleText.debugOptions.spans.bottom;\n                                    _this.context.beginPath();\n                                    _this.context.moveTo(x, y + descent);\n                                    _this.context.lineTo(x + width, y + descent);\n                                    _this.context.closePath();\n                                    _this.context.stroke();\n                                }\n                                if (MultiStyleText.debugOptions.spans.text) {\n                                    _this.context.fillStyle = \"#ffffff\";\n                                    _this.context.strokeStyle = \"#000000\";\n                                    _this.context.lineWidth = 2;\n                                    _this.context.font = \"8px monospace\";\n                                    _this.context.strokeText(tagName, x, y - ascent + 8);\n                                    _this.context.fillText(tagName, x, y - ascent + 8);\n                                    _this.context.strokeText(width.toFixed(2) + \"x\" + (ascent + descent).toFixed(2), x, y - ascent + 16);\n                                    _this.context.fillText(width.toFixed(2) + \"x\" + (ascent + descent).toFixed(2), x, y - ascent + 16);\n                                }\n                            }\n                        });\n                        if (MultiStyleText.debugOptions.objects.enabled) {\n                            if (MultiStyleText.debugOptions.objects.bounding) {\n                                this.context.fillStyle = MultiStyleText.debugOptions.objects.bounding;\n                                this.context.beginPath();\n                                this.context.rect(0, 0, width, height);\n                                this.context.fill();\n                            }\n                            if (MultiStyleText.debugOptions.objects.text) {\n                                this.context.fillStyle = \"#ffffff\";\n                                this.context.strokeStyle = \"#000000\";\n                                this.context.lineWidth = 2;\n                                this.context.font = \"8px monospace\";\n                                this.context.strokeText(width.toFixed(2) + \"x\" + height.toFixed(2), 0, 8, width);\n                                this.context.fillText(width.toFixed(2) + \"x\" + height.toFixed(2), 0, 8, width);\n                            }\n                        }\n                        this.updateTexture();\n                    };\n                    MultiStyleText.prototype.wordWrap = function (text) {\n                        var result = '';\n                        var tags = Object.keys(this.textStyles).join(\"|\");\n                        var re = new RegExp(\"(</?(\" + tags + \")>)\", \"g\");\n                        var lines = text.split(\"\\n\");\n                        var wordWrapWidth = this._style.wordWrapWidth;\n                        var styleStack = [this.assign({}, this.textStyles[\"default\"])];\n                        this.context.font = this.getFontString(this.textStyles[\"default\"]);\n                        for (var i = 0; i < lines.length; i++) {\n                            var spaceLeft = wordWrapWidth;\n                            var words = lines[i].split(\" \");\n                            for (var j = 0; j < words.length; j++) {\n                                var parts = words[j].split(re);\n                                for (var k = 0; k < parts.length; k++) {\n                                    if (re.test(parts[k])) {\n                                        result += parts[k];\n                                        if (parts[k][1] === \"/\") {\n                                            k++;\n                                            styleStack.pop();\n                                        } else {\n                                            k++;\n                                            styleStack.push(this.assign({}, styleStack[styleStack.length - 1], this.textStyles[parts[k]]));\n                                        }\n                                        this.context.font = this.getFontString(styleStack[styleStack.length - 1]);\n                                        continue;\n                                    }\n                                    var partWidth = this.context.measureText(parts[k]).width;\n                                    if (this._style.breakWords && partWidth > spaceLeft) {\n                                        var characters = parts[k].split('');\n                                        if (j > 0 && k === 0) {\n                                            result += \" \";\n                                            spaceLeft -= this.context.measureText(\" \").width;\n                                        }\n                                        for (var c = 0; c < characters.length; c++) {\n                                            var characterWidth = this.context.measureText(characters[c]).width;\n                                            if (characterWidth > spaceLeft) {\n                                                result += \"\\n\" + characters[c];\n                                                spaceLeft = wordWrapWidth - characterWidth;\n                                            } else {\n                                                if (j > 0 && k === 0 && c === 0) {\n                                                    result += \" \";\n                                                }\n                                                result += characters[c];\n                                                spaceLeft -= characterWidth;\n                                            }\n                                        }\n                                    } else if (this._style.breakWords) {\n                                        result += parts[k];\n                                        spaceLeft -= partWidth;\n                                    } else {\n                                        var paddedPartWidth = partWidth + (k === 0 ? this.context.measureText(\" \").width : 0);\n                                        if (j === 0 || paddedPartWidth > spaceLeft) {\n                                            if (j > 0) {\n                                                result += \"\\n\";\n                                            }\n                                            result += parts[k];\n                                            spaceLeft = wordWrapWidth - partWidth;\n                                        } else {\n                                            spaceLeft -= paddedPartWidth;\n                                            if (k === 0) {\n                                                result += \" \";\n                                            }\n                                            result += parts[k];\n                                        }\n                                    }\n                                }\n                            }\n                            if (i < lines.length - 1) {\n                                result += '\\n';\n                            }\n                        }\n                        return result;\n                    };\n                    MultiStyleText.prototype.updateTexture = function () {\n                        var texture = this._texture;\n                        var dropShadowPadding = this.getDropShadowPadding();\n                        texture.baseTexture.hasLoaded = true;\n                        texture.baseTexture.resolution = this.resolution;\n                        texture.baseTexture.realWidth = this.canvas.width;\n                        texture.baseTexture.realHeight = this.canvas.height;\n                        texture.baseTexture.width = this.canvas.width / this.resolution;\n                        texture.baseTexture.height = this.canvas.height / this.resolution;\n                        texture.trim.width = texture.frame.width = this.canvas.width / this.resolution;\n                        texture.trim.height = texture.frame.height = this.canvas.height / this.resolution;\n                        texture.trim.x = -this._style.padding - dropShadowPadding;\n                        texture.trim.y = -this._style.padding - dropShadowPadding;\n                        texture.orig.width = texture.frame.width - (this._style.padding + dropShadowPadding) * 2;\n                        texture.orig.height = texture.frame.height - (this._style.padding + dropShadowPadding) * 2;\n                        this._onTextureUpdate();\n                        texture.baseTexture.emit('update', texture.baseTexture);\n                        this.dirty = false;\n                    };\n                    MultiStyleText.prototype.assign = function (destination) {\n                        var sources = [];\n                        for (var _i = 1; _i < arguments.length; _i++) {\n                            sources[_i - 1] = arguments[_i];\n                        }\n                        for (var _a = 0, sources_1 = sources; _a < sources_1.length; _a++) {\n                            var source = sources_1[_a];\n                            for (var key in source) {\n                                destination[key] = source[key];\n                            }\n                        }\n                        return destination;\n                    };\n                    return MultiStyleText;\n                }(PIXI.Text);\n                MultiStyleText.DEFAULT_TAG_STYLE = {\n                    align: \"left\",\n                    breakWords: false,\n                    dropShadow: false,\n                    dropShadowAngle: Math.PI / 6,\n                    dropShadowBlur: 0,\n                    dropShadowColor: \"#000000\",\n                    dropShadowDistance: 5,\n                    fill: \"black\",\n                    fillGradientType: PIXI.TEXT_GRADIENT.LINEAR_VERTICAL,\n                    fontFamily: \"Arial\",\n                    fontSize: 26,\n                    fontStyle: \"normal\",\n                    fontVariant: \"normal\",\n                    fontWeight: \"normal\",\n                    letterSpacing: 0,\n                    lineHeight: 0,\n                    lineJoin: \"miter\",\n                    miterLimit: 10,\n                    padding: 0,\n                    stroke: \"black\",\n                    strokeThickness: 0,\n                    textBaseline: \"alphabetic\",\n                    valign: \"baseline\",\n                    wordWrap: false,\n                    wordWrapWidth: 100\n                };\n                MultiStyleText.debugOptions = {\n                    spans: {\n                        enabled: false,\n                        baseline: \"#44BB44\",\n                        top: \"#BB4444\",\n                        bottom: \"#4444BB\",\n                        bounding: \"rgba(255, 255, 255, 0.1)\",\n                        text: true\n                    },\n                    objects: {\n                        enabled: false,\n                        bounding: \"rgba(255, 255, 255, 0.05)\",\n                        text: true\n                    }\n                };\n                exports.default = MultiStyleText;\n            });\n        }, {}] }, {}, [1])(1);\n});\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./pixi-multistyle-text\":26}],27:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _SimpleScene2 = require(\"./SimpleScene\");\n\nvar _SimpleScene3 = _interopRequireDefault(_SimpleScene2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar GallerySelectionScene = function (_SimpleScene) {\n    _inherits(GallerySelectionScene, _SimpleScene);\n\n    function GallerySelectionScene() {\n        _classCallCheck(this, GallerySelectionScene);\n\n        // Attributes.\n        var _this = _possibleConstructorReturn(this, (GallerySelectionScene.__proto__ || Object.getPrototypeOf(GallerySelectionScene)).call(this));\n\n        _this._colourItBtn = null;\n        _this._drawItBtn = null;\n        _this._colourItText = null;\n        _this._drawItText = null;\n        _this._titleSprite = null;\n        _this._titleText = null;\n        _this._colourItSprite = null;\n        _this._drawItSprite = null;\n        return _this;\n    }\n\n    _createClass(GallerySelectionScene, [{\n        key: \"init\",\n        value: function init() {\n\n            this._bgSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"bg\")); //not sure why this is like this, but must create background first\n            _get(GallerySelectionScene.prototype.__proto__ || Object.getPrototypeOf(GallerySelectionScene.prototype), \"init\", this).call(this);\n\n            /*\r\n             deprecated title sprite and text\r\n             */\n\n            // Title sprite.\n            // this._titleSprite = new PIXI.Sprite(Common.assets.getTexture(\"popup_box_title_bg\"));\n            //  this._titleSprite.y = this._titleSprite.height * 0.5;\n            //  this._titleSprite.x = Common.STAGE_WIDTH * 0.5;\n            //  this._titleSprite.anchor = new PIXI.Point(0.5, 0.75);\n            //  this.addChild(this._titleSprite);\n\n            // Title text.\n            /*\r\n             let bkText = P3.createText(\"GAMES\", {\r\n             fill: [0xfff8b3, 0xfac109],\r\n             size: \"90px\",\r\n             wordWrap: true,\r\n             wordWrapWidth: 500,\r\n             stroke: 0x23a838,\r\n             strokeThickness: 14,\r\n             align: \"centre\"\r\n             });\r\n               this._titleText = P3.createText(\"GAMES\", {\r\n             fill: [0xfff8b3, 0xfac109],\r\n             size: \"90px\",\r\n             wordWrap: true,\r\n             wordWrapWidth: 500,\r\n             stroke: 0x006130,\r\n             align: \"centre\",\r\n             strokeThickness: 8\r\n             });\r\n               this._titleText.anchor = bkText.anchor = new PIXI.Point(0.5, 0.5);\r\n             this._titleText.y = bkText.y = -45;\r\n             this._titleSprite.addChild(bkText, this._titleText);\r\n             */\n\n            // Colour gallery.\n            // Image.\n            var btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"game_colour\"), _Common2.default.assets.getTexture(\"game_colour\"), _Common2.default.assets.getTexture(\"game_colour\"));\n            this._colourItSprite = new P3.Button(btnStatesAux);\n            this._colourItSprite.signals.click.addOnce(this._onColourGalleryButton_Click, this);\n            this._colourItSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._colourItSprite.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5 - 255, _Common2.default.STAGE_HEIGHT * 0.5);\n            this.addChild(this._colourItSprite);\n\n            var colourItTextConf = {\n                size: \"75px\",\n                fill: \"#3992ff\",\n                stroke: \"#2c1812\",\n                wordWrapWidth: 400\n            };\n            this._colourItText = P3.createMultiText(\"COLOUR_IT\", colourItTextConf);\n\n            this._colourItText.anchor = new PIXI.Point(0.5, 0.5);\n            this._colourItText.y = -this._colourItSprite.height * 0.5 + 15;\n            this._colourItSprite.addChild(this._colourItText);\n\n            // Button.\n            this._colourItBtn = createButton(\"play_large\", \"primary_large\");\n            this._colourItBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._colourItBtn.y = this._colourItSprite.y + this._colourItSprite.height * 0.5;\n            this._colourItBtn.x = this._colourItSprite.x;\n            this._colourItBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._colourItBtn.downSoundName = \"sfx_btn_play_start_doorbell_00\";\n            this._colourItBtn.signals.click.addOnce(this._onColourGalleryButton_Click, this);\n            this.addChild(this._colourItBtn);\n\n            // Draw gallery.\n            // Image.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"game_draw\"), _Common2.default.assets.getTexture(\"game_draw\"), _Common2.default.assets.getTexture(\"game_draw\"));\n            this._drawItSprite = new P3.Button(btnStatesAux);\n            this._drawItSprite.signals.click.addOnce(this._onDrawGalleryButton_Click, this);\n\n            this._drawItSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._drawItSprite.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5 + 255, _Common2.default.STAGE_HEIGHT * 0.5);\n            this.addChild(this._drawItSprite);\n\n            this._drawItText = P3.createText(\"DRAW_IT\", {\n                size: \"75px\",\n                fill: \"white\",\n                stroke: \"#2c1812\",\n                stokeThickness: 6,\n                wordWrap: true,\n                wordWrapWidth: 300\n            }, \"truetype\");\n\n            this._drawItText.anchor = new PIXI.Point(0.5, 0.5);\n            this._drawItText.y = -this._drawItSprite.height * 0.5 + 15;\n            this._drawItSprite.addChild(this._drawItText);\n            // Button.\n\n            this._drawItBtn = createButton(\"play_large\", \"primary_large\");\n            this._drawItBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._drawItBtn.position.y = this._drawItSprite.y + this._drawItSprite.height * 0.5;\n            this._drawItBtn.position.x = this._drawItSprite.x;\n            this._drawItBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._drawItBtn.downSoundName = \"sfx_btn_play_start_doorbell_00\";\n            this._drawItBtn.signals.click.addOnce(this._onDrawGalleryButton_Click, this);\n            this.addChild(this._drawItBtn);\n\n            _get(GallerySelectionScene.prototype.__proto__ || Object.getPrototypeOf(GallerySelectionScene.prototype), \"createSharedControls\", this).call(this, this);\n            this._uiTopBarSharedControls.muteBtn.visible = true;\n            this._uiTopBarSharedControls.backBtn.visible = true;\n            this._uiTopBarSharedControls.signals.onBackBtn_Click.addOnce(function () {\n                this.signals.previous.dispatch(this);\n            }, this);\n        }\n    }, {\n        key: \"destroy\",\n        value: function destroy() {\n            _get(GallerySelectionScene.prototype.__proto__ || Object.getPrototypeOf(GallerySelectionScene.prototype), \"destroy\", this).call(this, { children: true });\n            TweenMax.killAll();\n        }\n    }, {\n        key: \"animateIn\",\n        value: function animateIn() {\n            //this._titleSprite.y -= 100;\n            // TweenMax.to(this._titleSprite, 1.5, {y: this._titleSprite.y + 100, ease: Elastic.easeOut});\n\n            this._drawItSprite.x += 100;\n            this._drawItSprite.alpha = 0;\n            TweenMax.to(this._drawItSprite, 0.25, { alpha: 1, x: this._drawItSprite.x - 100, ease: Sine.easeOut });\n\n            this._colourItSprite.x -= 100;\n            this._colourItSprite.alpha = 0;\n            TweenMax.to(this._colourItSprite, 0.25, { alpha: 1, x: this._colourItSprite.x + 100, ease: Sine.easeOut });\n\n            this._drawItBtn.alpha = 0;\n            this._drawItBtn.scale = new PIXI.Point();\n            TweenMax.to(this._drawItBtn, 0.25, { alpha: 1, ease: Sine.easeOut, delay: 0.2 });\n            TweenMax.to(this._drawItBtn.scale, 0.5, { x: 1, y: 1, ease: Elastic.easeOut, delay: 0.2 });\n\n            this._colourItBtn.alpha = 0;\n            this._colourItBtn.scale = new PIXI.Point();\n            TweenMax.to(this._colourItBtn, 0.25, { alpha: 1, ease: Sine.easeOut, delay: 0.35 });\n            TweenMax.to(this._colourItBtn.scale, 0.5, { x: 1, y: 1, ease: Elastic.easeOut, delay: 0.35 });\n        }\n\n        //----EVENTS----//\n\n    }, {\n        key: \"_onColourGalleryButton_Click\",\n        value: function _onColourGalleryButton_Click() {\n            _CommonGame2.default.selectedGallery = _CommonGame2.default.GALLERY_ID_COLOUR_IT;\n            this.signals.next.dispatch(this);\n        }\n    }, {\n        key: \"_onDrawGalleryButton_Click\",\n        value: function _onDrawGalleryButton_Click() {\n            _CommonGame2.default.selectedGallery = _CommonGame2.default.GALLERY_ID_DRAW_IT;\n            this.signals.next.dispatch(this);\n        }\n    }]);\n\n    return GallerySelectionScene;\n}(_SimpleScene3.default);\n\nexports.default = GallerySelectionScene;\n\n},{\"../Common\":3,\"../CommonGame\":4,\"./SimpleScene\":32}],28:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _MyGame = require(\"../game/MyGame\");\n\nvar _MyGame2 = _interopRequireDefault(_MyGame);\n\nvar _Tutorial = require(\"../game/Tutorial\");\n\nvar _Tutorial2 = _interopRequireDefault(_Tutorial);\n\nvar _MenuPanel = require(\"../ui/overlays/MenuPanel\");\n\nvar _MenuPanel2 = _interopRequireDefault(_MenuPanel);\n\nvar _PalettePanel = require(\"../ui/overlays/PalettePanel\");\n\nvar _PalettePanel2 = _interopRequireDefault(_PalettePanel);\n\nvar _PaletteButton = require(\"../game/PaletteButton\");\n\nvar _PaletteButton2 = _interopRequireDefault(_PaletteButton);\n\nvar _SimpleScene2 = require(\"./SimpleScene\");\n\nvar _SimpleScene3 = _interopRequireDefault(_SimpleScene2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar GameScene = function (_SimpleScene) {\n    _inherits(GameScene, _SimpleScene);\n\n    function GameScene() {\n        _classCallCheck(this, GameScene);\n\n        // Attributes.\n        var _this = _possibleConstructorReturn(this, (GameScene.__proto__ || Object.getPrototypeOf(GameScene)).call(this));\n\n        _this._menuPanel = null;\n        _this._tutorial = null;\n\n        _this._gameLayer = null;\n        _this._tutorialLayer = null;\n        _this._overlayLayer = null;\n        return _this;\n    }\n\n    _createClass(GameScene, [{\n        key: \"init\",\n        value: function init() {\n\n            this._bgSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"bg\")); //not sure why this is like this, but must create background first\n            _get(GameScene.prototype.__proto__ || Object.getPrototypeOf(GameScene.prototype), \"init\", this).call(this);\n\n            // Layers.\n            this._gameLayer = new PIXI.Container();\n            this.addChild(this._gameLayer);\n            this._tutorialLayer = new PIXI.Container();\n            this.addChild(this._tutorialLayer);\n            this._overlayLayer = new PIXI.Container();\n            this.addChild(this._overlayLayer);\n\n            // Overlay initialization. Order is important due to dependencies.\n            // Menu.\n            this._menuPanel = new _MenuPanel2.default(this.signals);\n            this._menuPanel.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5, _Common2.default.STAGE_HEIGHT * 0.5);\n            this._menuPanel.init();\n            this._overlayLayer.addChild(this._menuPanel);\n\n            // Palette.\n            this._palettePanel = new _PalettePanel2.default();\n            this._palettePanel.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5, _Common2.default.STAGE_HEIGHT * 0.5);\n            this._palettePanel.init();\n            this._overlayLayer.addChild(this._palettePanel);\n\n            // Game.\n            _Common2.default.game = new _MyGame2.default();\n            _Common2.default.game.scene = this;\n            _Common2.default.game.init();\n\n            // Tutorial.\n            if (_Common2.default.savedData.isDrawTutorial || _Common2.default.savedData.isToolTutorial || _Common2.default.savedData.isPaletteTutorial) {\n                this._tutorial = new _Tutorial2.default();\n                this._tutorial.init();\n                this._tutorial.signals.onCompleted.addOnce(function () {\n                    this._tutorial.end();\n                    this._tutorial.destroy();\n                    this._tutorial = null;\n                }, this);\n                this._tutorialLayer.addChild(this._tutorial);\n            }\n\n            // Signals.\n            // Link the panels to the HUD buttons that show them.\n            _Common2.default.game.hud.signals.onMenuClick.add(this._onMenuBtn_Click, this);\n            _Common2.default.game.hud.signals.onPaletteClick.add(this._onPaletteBtn_Click, this);\n\n            this.createSharedControls();\n        }\n    }, {\n        key: \"update\",\n        value: function update() {\n            if (this._tutorial) this._tutorial.update();\n            _Common2.default.game.update();\n        }\n    }, {\n        key: \"animateIn\",\n        value: function animateIn() {\n            // Music.\n            _Common2.default.audio.stopMusic();\n            _Common2.default.audio.playMusic(\"sfx_ambient_desert_loop_00\");\n\n            _Common2.default.game.animateIn();\n        }\n    }, {\n        key: \"resize\",\n        value: function resize() {\n            this.x = (P3.View.width - _Common2.default.STAGE_WIDTH) * 0.5;\n\n            _Common2.default.game.resize();\n            if (this._tutorial) this._tutorial.resize();\n        }\n    }, {\n        key: \"addTutorialEvent\",\n        value: function addTutorialEvent(tutorialEvent) {\n            if (this._tutorial) this._tutorial.addEvent(tutorialEvent);\n        }\n\n        //----EVENTS----//\n\n    }, {\n        key: \"_onMenuBtn_Click\",\n        value: function _onMenuBtn_Click() {\n            this._menuPanel.show();\n        }\n    }, {\n        key: \"_onPaletteBtn_Click\",\n        value: function _onPaletteBtn_Click(toolType) {\n            // Show palette panel.\n            this._palettePanel.show(toolType);\n\n            // Tutorial.\n            _Common2.default.game.scene.addTutorialEvent(_CommonGame2.default.TUT_EVENT.PALETTE_SELECTED);\n        }\n    }, {\n        key: \"gameLayer\",\n        get: function get() {\n            return this._gameLayer;\n        }\n    }, {\n        key: \"palettePanel\",\n        get: function get() {\n            return this._palettePanel;\n        }\n    }]);\n\n    return GameScene;\n}(_SimpleScene3.default);\n\nexports.default = GameScene;\n\n},{\"../Common\":3,\"../CommonGame\":4,\"../game/MyGame\":18,\"../game/PaletteButton\":19,\"../game/Tutorial\":23,\"../ui/overlays/MenuPanel\":37,\"../ui/overlays/PalettePanel\":38,\"./SimpleScene\":32}],29:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _SimpleScene2 = require(\"./SimpleScene\");\n\nvar _SimpleScene3 = _interopRequireDefault(_SimpleScene2);\n\nvar _UICarousel = require(\"../ui/UICarousel\");\n\nvar _UICarousel2 = _interopRequireDefault(_UICarousel);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar ImageSelectionScene = function (_SimpleScene) {\n    _inherits(ImageSelectionScene, _SimpleScene);\n\n    function ImageSelectionScene() {\n        _classCallCheck(this, ImageSelectionScene);\n\n        // Constants.\n        var _this = _possibleConstructorReturn(this, (ImageSelectionScene.__proto__ || Object.getPrototypeOf(ImageSelectionScene)).call(this));\n\n        _this.ARR_DRAW_IT_TEXT_ID = [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\"];\n        _this.ARR_IMAGE_SPRITE_ID = []; //from legacy project, working around//--\n        _this._imageLength = _this.ARR_DRAW_IT_TEXT_ID.length;\n\n        for (var i = 0; i < _this._imageLength; i++) {\n            _this.ARR_IMAGE_SPRITE_ID.push(\"image_\" + (i + 1)); //--\n        }\n\n        // Attributes.\n        _this._titleSprite = null;\n        _this._titleText = null;\n\n        // UI.\n        _this._playBtn = null;\n        _this._prevImageBtn = null;\n        _this._nextImageBtn = null;\n        _this._uiCarousel = null;\n        return _this;\n    }\n\n    _createClass(ImageSelectionScene, [{\n        key: \"init\",\n        value: function init() {\n\n            this._bgSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"bg\")); //for some reason bg must be created before super is called\n            _get(ImageSelectionScene.prototype.__proto__ || Object.getPrototypeOf(ImageSelectionScene.prototype), \"init\", this).call(this);\n\n            this.imagePrefix = _CommonGame2.default.selectedGallery == _CommonGame2.default.GALLERY_ID_COLOUR_IT ? \"colour_\" : \"draw_\";\n            /*\r\n             // Title sprite.\r\n             this._titleSprite = new PIXI.Sprite(Common.assets.getTexture(\"popup_box_title_bg\"));\r\n             this._titleSprite.y = this._titleSprite.height * 0.5;\r\n             this._titleSprite.x = Common.STAGE_WIDTH * 0.5;\r\n             this._titleSprite.anchor = new PIXI.Point(0.5, 0.75);\r\n             this.addChild(this._titleSprite);\r\n               // Title text.\r\n               // Title text.\r\n             let bkText = P3.createText(\"DRAWINGS\", {\r\n             fill: [0xfff8b3, 0xfac109],\r\n             size: \"90px\",\r\n             wordWrap: true,\r\n             wordWrapWidth: 500,\r\n             stroke: 0x23a838,\r\n             strokeThickness: 14,\r\n             align: \"centre\"\r\n             });\r\n               this._titleText = P3.createText(\"DRAWINGS\", {\r\n             fill: [0xfff8b3, 0xfac109],\r\n             size: \"90px\",\r\n             wordWrap: true,\r\n             wordWrapWidth: 500,\r\n             stroke: 0x006130,\r\n             align: \"centre\",\r\n             strokeThickness: 8\r\n             });\r\n               this._titleText.y = bkText.y = -45;\r\n             this._titleText.anchor = bkText.anchor = new PIXI.Point(0.5, 0.5);\r\n             this._titleSprite.addChild(bkText, this._titleText);\r\n             */\n            // Carousel items.\n            var arrCarouselItem = [];\n            for (var i = 0; i < this._imageLength; i++) {\n                // Container.\n                var carouselItem = new PIXI.Container();\n                carouselItem.scale = new PIXI.Point(0.6, 0.6);\n                carouselItem.anchor = new PIXI.Point(0.5, 0.5);\n\n                carouselItem.addChild(_CommonGame2.default.createCanvasBg());\n\n                // Bg.\n                var bgSprite = new PIXI.Sprite(_Common2.default.blankTexture);\n                bgSprite.anchor = new PIXI.Point(0.5, 0.5);\n                bgSprite.width = _CommonGame2.default.CANVAS_WIDTH;\n                bgSprite.height = _CommonGame2.default.CANVAS_HEIGHT;\n                bgSprite.tint = 0xffffff;\n\n                carouselItem.addChild(bgSprite);\n\n                var galleryKey = \"drawing\";\n                if (_CommonGame2.default.selectedGallery === 1) galleryKey = \"colouring\";\n\n                // Border.\n                var borderSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"canvas_\" + galleryKey));\n                borderSprite.anchor = new PIXI.Point(0.5, 0.5);\n                carouselItem.addChild(borderSprite);\n                // Sprite.\n                var imageSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(this.imagePrefix + \"image_\" + (i + 1)));\n                imageSprite.anchor = new PIXI.Point(0.5, 0.5);\n                carouselItem.addChild(imageSprite);\n\n                arrCarouselItem.push(carouselItem);\n            }\n\n            // UICarousel.\n            this._uiCarousel = new _UICarousel2.default();\n            this._uiCarousel.init(arrCarouselItem);\n            this._uiCarousel.signals.onIndexChanged.add(this._onCarouselIndex_Changed, this);\n            this._uiCarousel.signals.onItemSelected.add(this._onPlayButton_Click, this);\n            this.addChild(this._uiCarousel);\n\n            // Play button.\n            var btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"btn_primary_large_off\"), _Common2.default.assets.getTexture(\"btn_primary_large_over\"), _Common2.default.assets.getTexture(\"btn_primary_large_down\"), _Common2.default.assets.getTexture(\"icon_play_large_off\"));\n            this._playBtn = createButton(\"play_large\", \"primary_large\");\n            this._playBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._playBtn.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5, _Common2.default.STAGE_HEIGHT * 0.5 + 220);\n            this._playBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._playBtn.downSoundName = \"sfx_btn_play_start_doorbell_00\";\n            this._playBtn.signals.click.addOnce(this._onPlayButton_Click, this);\n            this.addChild(this._playBtn);\n\n            // Next image button.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_next_off\"), _Common2.default.assets.getTexture(\"icon_next_over\"), _Common2.default.assets.getTexture(\"icon_next_down\"));\n\n            this._nextImageBtn = new P3.Button(btnStatesAux);\n            this._nextImageBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._nextImageBtn.scale = new PIXI.Point(1.5, 1.5);\n            this._nextImageBtn.defaultScale = new PIXI.Point(1.5, 1.5);\n            this._nextImageBtn.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5 + 400, _Common2.default.STAGE_HEIGHT * 0.5);\n            this._nextImageBtn.signals.click.add(this._onNextImageButton_Click, this);\n            this.addChild(this._nextImageBtn);\n\n            // Prev image button.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_next_off\"), _Common2.default.assets.getTexture(\"icon_next_over\"), _Common2.default.assets.getTexture(\"icon_next_down\"));\n\n            this._prevImageBtn = new P3.Button(btnStatesAux);\n            this._prevImageBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._prevImageBtn.scale = new PIXI.Point(-1.5, 1.5);\n            this._prevImageBtn.alpha = 0;\n\n            this._prevImageBtn.defaultScale = new PIXI.Point(-1.5, 1.5);\n            this._prevImageBtn.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5 - 400, _Common2.default.STAGE_HEIGHT * 0.5);\n            this._prevImageBtn.signals.click.add(this._onPrevImageButton_Click, this);\n            this.addChild(this._prevImageBtn);\n\n            this._updateUI();\n\n            _get(ImageSelectionScene.prototype.__proto__ || Object.getPrototypeOf(ImageSelectionScene.prototype), \"createSharedControls\", this).call(this);\n            this._uiTopBarSharedControls.muteBtn.visible = true;\n            this._uiTopBarSharedControls.backBtn.visible = true;\n            this._uiTopBarSharedControls.signals.onBackBtn_Click.addOnce(function () {\n                this.signals.previous.dispatch(this);\n            }, this);\n        }\n    }, {\n        key: \"update\",\n        value: function update() {\n            this._uiCarousel.update();\n        }\n    }, {\n        key: \"animateIn\",\n        value: function animateIn() {\n            // this._titleSprite.y -= 100;\n            // TweenMax.to(this._titleSprite, 1.5, {y: this._titleSprite.y + 100, ease: Elastic.easeOut});\n\n            this._uiCarousel.animateIn();\n\n            this._playBtn.alpha = 0;\n            this._playBtn.scale = new PIXI.Point();\n            TweenMax.to(this._playBtn, 0.25, { alpha: 1, ease: Sine.easeOut, delay: 0.2 });\n            TweenMax.to(this._playBtn.scale, 0.5, { x: 1, y: 1, ease: Elastic.easeOut, delay: 0.2 });\n        }\n    }, {\n        key: \"_updateUI\",\n        value: function _updateUI() {\n            // Prev.\n            this._prevImageBtn.interactive = this._uiCarousel.selectedIndex > 0;\n            TweenMax.to(this._prevImageBtn, 0.25, { alpha: this._prevImageBtn.interactive ? 1 : 0, ease: Sine.easeOut });\n\n            // Next.\n            this._nextImageBtn.interactive = this._uiCarousel.selectedIndex < this._imageLength - 1;\n            TweenMax.to(this._nextImageBtn, 0.25, { alpha: this._nextImageBtn.interactive ? 1 : 0, ease: Sine.easeOut });\n        }\n    }, {\n        key: \"destroy\",\n        value: function destroy() {\n            _get(ImageSelectionScene.prototype.__proto__ || Object.getPrototypeOf(ImageSelectionScene.prototype), \"destroy\", this).call(this, { children: true });\n            TweenMax.killAll();\n        }\n\n        //----EVENTS----//\n\n    }, {\n        key: \"_onCarouselIndex_Changed\",\n        value: function _onCarouselIndex_Changed() {\n            this._updateUI();\n        }\n    }, {\n        key: \"_onPlayButton_Click\",\n        value: function _onPlayButton_Click() {\n\n            _CommonGame2.default.selectedImageId = this.ARR_IMAGE_SPRITE_ID[this._uiCarousel.selectedIndex];\n\n            if (_CommonGame2.default.selectedGallery === _CommonGame2.default.GALLERY_ID_DRAW_IT) {\n                _CommonGame2.default.drawItTextId = this.ARR_DRAW_IT_TEXT_ID[this._uiCarousel.selectedIndex];\n            }\n\n            // Sfx.\n            //   Common.audio.playSound(\"vo_happo_ready_00\");\n\n            this.signals.next.dispatch(this);\n        }\n    }, {\n        key: \"_onPrevImageButton_Click\",\n        value: function _onPrevImageButton_Click() {\n            this._uiCarousel.prev();\n        }\n    }, {\n        key: \"_onNextImageButton_Click\",\n        value: function _onNextImageButton_Click() {\n            this._uiCarousel.next();\n        }\n    }]);\n\n    return ImageSelectionScene;\n}(_SimpleScene3.default);\n\nexports.default = ImageSelectionScene;\n\n},{\"../Common\":3,\"../CommonGame\":4,\"../ui/UICarousel\":34,\"./SimpleScene\":32}],30:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _SimpleScene2 = require(\"./SimpleScene\");\n\nvar _SimpleScene3 = _interopRequireDefault(_SimpleScene2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar MainScene = function (_SimpleScene) {\n    _inherits(MainScene, _SimpleScene);\n\n    function MainScene() {\n        _classCallCheck(this, MainScene);\n\n        // Attributes.\n        var _this = _possibleConstructorReturn(this, (MainScene.__proto__ || Object.getPrototypeOf(MainScene)).call(this));\n\n        _this._playBtn = null;\n        _this._titleSprite = null;\n        return _this;\n    }\n\n    _createClass(MainScene, [{\n        key: \"init\",\n        value: function init() {\n\n            this._bgSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"splash_bg\")); //must go first for some reason\n            _get(MainScene.prototype.__proto__ || Object.getPrototypeOf(MainScene.prototype), \"init\", this).call(this);\n\n            // Title sprite.\n            this._titleSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"game_title\"));\n            this._titleSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._titleSprite.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5, _Common2.default.STAGE_HEIGHT * 0.5 - 45);\n            //this._titleSprite.scale.set(0.9);\n            this.addChild(this._titleSprite);\n\n            // Play button.\n            /*\r\n             const btnStatesAux = new P3.ButtonStates(\r\n             Common.assets.getTexture(\"btn_primary_large_off\"),\r\n             Common.assets.getTexture(\"btn_primary_large_over\"),\r\n             Common.assets.getTexture(\"btn_primary_large_down\"),\r\n             Common.assets.getTexture(\"icon_play_large_off\")\r\n             );*/\n\n            this._playBtn = createButton(\"play_large\", \"primary_large\");\n            this._playBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._playBtn.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5 + 325, _Common2.default.STAGE_HEIGHT - 110);\n            this._playBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._playBtn.downSoundName = \"sfx_btn_play_start_doorbell_00\";\n            this._playBtn.signals.click.addOnce(this._onPlayButton_Click, this);\n            this.addChild(this._playBtn);\n\n            _get(MainScene.prototype.__proto__ || Object.getPrototypeOf(MainScene.prototype), \"createSharedControls\", this).call(this, this);\n            this._uiTopBarSharedControls.muteBtn.visible = true;\n        }\n    }, {\n        key: \"destroy\",\n        value: function destroy() {\n            _get(MainScene.prototype.__proto__ || Object.getPrototypeOf(MainScene.prototype), \"destroy\", this).call(this, { children: true });\n            TweenMax.killAll();\n        }\n    }, {\n        key: \"animateIn\",\n        value: function animateIn() {\n            this._playBtn.alpha = 0;\n            this._playBtn.scale = new PIXI.Point();\n            TweenMax.to(this._playBtn, 0.25, { alpha: 1, ease: Sine.easeOut, delay: 0.2 });\n            TweenMax.to(this._playBtn.scale, 0.5, { x: 1, y: 1, ease: Elastic.easeOut, delay: 0.2 });\n\n            // Music.\n            _Common2.default.audio.playMusic(\"music_mainmenu_loop_00\");\n        }\n\n        //----EVENTS----//\n\n    }, {\n        key: \"_onPlayButton_Click\",\n        value: function _onPlayButton_Click() {\n            this.signals.next.dispatch(this);\n        }\n    }]);\n\n    return MainScene;\n}(_SimpleScene3.default);\n\nexports.default = MainScene;\n\n},{\"../Common\":3,\"../CommonGame\":4,\"./SimpleScene\":32}],31:[function(require,module,exports){\n/**\n *  PreloaderScene\n *\n *  Created by Legman on 7/10/2015.\n *\n */\n\n\"use strict\";\n\n//var Common = require(\"../Common\");\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Application = require(\"../Application\");\n\nvar _Application2 = _interopRequireDefault(_Application);\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * @constructor\n * @extends {P3.Scene}\n */\nfunction PreloaderScene() {\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.loaded = 0;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this._isPlayingAnim = false;\n\n    /**\n     * @type {PIXI.MovieClip}\n     * @private\n     */\n    this._logoAnimation = null;\n\n    /**\n     * @type {PIXI.Sprite}\n     * @private\n     */\n    this._bar = null;\n\n    /**\n     * @type {PIXI.Sprite}\n     * @private\n     */\n    this._barOverlay = null;\n\n    /**\n     * @type {PIXI.Text}\n     * @private\n     */\n    this._text = null;\n\n    /**\n     * @type {P3.Button}\n     * @private\n     */\n    this._playButton = null;\n\n    P3.Scene.call(this);\n\n    this.signals.onAllLoaded = new signals.Signal();\n}\nexports.default = PreloaderScene;\n//module.exports = PreloaderScene;\n\nPreloaderScene.prototype = Object.create(P3.Scene.prototype);\nPreloaderScene.prototype.constructor = PreloaderScene;\n\nPreloaderScene.prototype.init = function () {\n\n    console.log(_Common2.default);\n    console.log(_Common2.default.assets);\n\n    var g = new PIXI.Graphics();\n    g.beginFill(0x872F87);\n    g.drawRect(0, 0, _Common2.default.STAGE_WIDTH, _Common2.default.STAGE_HEIGHT);\n    g.endFill();\n    this.addChild(g);\n\n    var holder = new PIXI.Container();\n    holder.x = Math.floor(_Common2.default.STAGE_WIDTH * 0.5);\n    holder.y = Math.floor(_Common2.default.STAGE_HEIGHT * 0.5) + 50;\n    this.addChild(holder);\n\n    var logoFrames = [_Common2.default.assets.getTexture('loader_animation0001'), _Common2.default.assets.getTexture('loader_animation0002'), _Common2.default.assets.getTexture('loader_animation0003'), _Common2.default.assets.getTexture('loader_animation0004'), _Common2.default.assets.getTexture('loader_animation0005'), _Common2.default.assets.getTexture('loader_animation0006'), _Common2.default.assets.getTexture('loader_animation0007'), _Common2.default.assets.getTexture('loader_animation0008'), _Common2.default.assets.getTexture('loader_animation0009'), _Common2.default.assets.getTexture('loader_animation0010')];\n\n    this._logoAnimation = new PIXI.extras.MovieClip(logoFrames);\n    this._logoAnimation.animationSpeed = 0.4;\n    this._logoAnimation.gotoAndStop(0);\n    this._logoAnimation.stop();\n    this._logoAnimation.loop = false;\n    this._logoAnimation.anchor.x = 0.5;\n    this._logoAnimation.anchor.y = 1.0;\n    this._logoAnimation.x += 50;\n    this._logoAnimation.y -= 20;\n    holder.addChild(this._logoAnimation);\n\n    this._bar = new PIXI.Sprite(_Common2.default.assets.getTexture('preloader_bar'));\n    this._bar.anchor.y = 0.5;\n    this._bar.x -= this._bar.width * 0.5;\n    this._bar.scale.x = 0;\n    holder.addChild(this._bar);\n\n    this._barOverlay = new PIXI.Sprite(_Common2.default.assets.getTexture('preloader_overlay'));\n    this._barOverlay.anchor.y = 0.5;\n    this._barOverlay.x -= this._barOverlay.width * 0.5;\n    holder.addChild(this._barOverlay);\n\n    this._text = new PIXI.Text(\"0%\", { font: '28px Arial', 'fill': '#FFFFFF' });\n    this._text.anchor.x = 0.5;\n    this._text.position.y += 50;\n    holder.addChild(this._text);\n\n    // Start animation.\n    this._logoAnimation.gotoAndPlay(0);\n\n    var btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"btn_primary_large_off\"), _Common2.default.assets.getTexture(\"btn_primary_large_over\"), _Common2.default.assets.getTexture(\"btn_primary_large_down\"), _Common2.default.assets.getTexture(\"icon_play_large_off\"));\n    this._playButton = new P3.Button(btnStatesAux);\n    this._playButton.y += 50;\n    //this._playButton.downSoundName = \"music_menu_playbtn_start_00\";\n    this._playButton.visible = false;\n    this._playButton.signals.click.add(this._onPlayButtonClick, this);\n    holder.addChild(this._playButton);\n};\n\nPreloaderScene.prototype.destroy = function () {\n    P3.Scene.prototype.destroy.call(this);\n};\n\nPreloaderScene.prototype.appear = function () {\n    this.animateIn();\n};\n\nPreloaderScene.prototype.show = function () {};\n\nPreloaderScene.prototype.animateIn = function (callback, scope) {};\n\nPreloaderScene.prototype.animateOut = function (callback, scope) {};\n\nPreloaderScene.prototype.resize = function () {\n    this.x = (P3.View.width - _Common2.default.STAGE_WIDTH) * 0.5;\n};\n\nPreloaderScene.prototype.update = function () {\n    this._bar.scale.x = this.loaded;\n    this._text.text = Math.floor(this._bar.scale.x * 100) + '%';\n\n    if (this.loaded == 1) {\n        if (P3.Device.isMobile) {\n            if (!this._playButton.visible) {\n                this._playButton.visible = true;\n                this._playButton.alpha = 0;\n\n                TweenMax.to(this._playButton, 0.25, { alpha: 1, ease: Sine.easeOut });\n                TweenMax.to(this._bar, 0.25, { alpha: 0, ease: Sine.easeIn });\n                TweenMax.to(this._barOverlay, 0.25, { alpha: 0, ease: Sine.easeIn });\n                TweenMax.to(this._text, 0.25, { alpha: 0, ease: Sine.easeIn });\n            }\n        } else this.signals.onAllLoaded.dispatch(this);\n    }\n};\n\n/**\n * @param {P3.Button} button\n */\nPreloaderScene.prototype._onPlayButtonClick = function (button) {\n    this._playButton.interactive = false;\n\n    // Try only android fullscreen. The fullscreen API is not supported by iOS Safari.\n    if (P3.Device.isAndroid && screenfull.enabled) {\n        screenfull.request();\n        setTimeout(function () {\n            _Common2.default.view.resize();\n        }, 1000);\n    }\n\n    TweenMax.to(this._playButton, 0.25, {\n        alpha: 0,\n        ease: Sine.easeIn,\n        onComplete: _Application2.default.init,\n        onCompleteScope: this\n    });\n};\n\n},{\"../Application\":2,\"../Common\":3}],32:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _UITopBarSharedControls = require(\"../ui/UITopBarSharedControls\");\n\nvar _UITopBarSharedControls2 = _interopRequireDefault(_UITopBarSharedControls);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar SimpleScene = function (_P3$Scene) {\n    _inherits(SimpleScene, _P3$Scene);\n\n    function SimpleScene() {\n        _classCallCheck(this, SimpleScene);\n\n        // Attributes.\n        var _this = _possibleConstructorReturn(this, (SimpleScene.__proto__ || Object.getPrototypeOf(SimpleScene)).call(this));\n\n        _this._uiTopBarSharedControls = null;\n        _this._bgSprite = null;\n        return _this;\n    }\n\n    _createClass(SimpleScene, [{\n        key: \"init\",\n        value: function init() {\n            _get(SimpleScene.prototype.__proto__ || Object.getPrototypeOf(SimpleScene.prototype), \"init\", this).call(this);\n            //  P3.Scene.prototype.init.call(this);\n\n            // Bg sprite.\n            if (this._bgSprite != null) {\n                this._bgSprite.anchor = new PIXI.Point(0.5, 0.5);\n                this._bgSprite.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5, _Common2.default.STAGE_HEIGHT * 0.5);\n                this.addChild(this._bgSprite);\n            }\n        }\n    }, {\n        key: \"createSharedControls\",\n        value: function createSharedControls() {\n            // UITopBarSharedControls.\n            this._uiTopBarSharedControls = new _UITopBarSharedControls2.default();\n            this._uiTopBarSharedControls.init();\n            this.addChild(this._uiTopBarSharedControls);\n        }\n    }, {\n        key: \"resize\",\n        value: function resize() {\n            this.x = (P3.View.width - _Common2.default.STAGE_WIDTH) * 0.5;\n            this._uiTopBarSharedControls.resize();\n        }\n\n        //no need to override if your just going to call super, but I added params and kill tweens so is necessary now\n\n    }, {\n        key: \"destroy\",\n        value: function destroy() {\n            var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n            params.children = true;\n            _get(SimpleScene.prototype.__proto__ || Object.getPrototypeOf(SimpleScene.prototype), \"destroy\", this).call(this, params);\n            TweenMax.killAll();\n        }\n\n        /**\r\n         * @abstract\r\n         * @param callback\r\n         * @param scope\r\n         */\n\n    }, {\n        key: \"animateIn\",\n        value: function animateIn(callback, scope) {\n            throw new Error('You have to implement the abstract method before use : ' + this.constructor.name + '#animateIn');\n        }\n\n        /**\r\n         * @abstract\r\n         * @param callback\r\n         * @param scope\r\n         */\n\n    }, {\n        key: \"animateOut\",\n        value: function animateOut(callback, scope) {\n            throw new Error('You have to implement the abstract method before use : ' + this.constructor.name + 'animateOut');\n        }\n\n        //strange pattern. why override parent function and do nothing..\n        //// hide(callback, scope) {\n        //  }\n\n    }, {\n        key: \"bg\",\n        get: function get() {\n            return this._bgSprite;\n        }\n    }]);\n\n    return SimpleScene;\n}(P3.Scene);\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\n/*\r\n function SimpleScene() {\r\n P3.Scene.call(this);\r\n\r\n\r\n // Attributes.\r\n this._uiTopBarSharedControls = null;\r\n this._bgSprite = null;\r\n }\r\n export default SimpleScene;\r\n //module.exports = SimpleScene;\r\n SimpleScene.prototype = Object.create(P3.Scene.prototype);\r\n SimpleScene.prototype.constructor = SimpleScene;\r\n */\n\n//===================================================\n//\n// Public\n//\n//===================================================\n/*\r\n SimpleScene.prototype.init = function () {\r\n P3.Scene.prototype.init.call(this);\r\n\r\n\r\n // Bg sprite.\r\n if (this._bgSprite != null) {\r\n this._bgSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n this._bgSprite.position = new PIXI.Point(\r\n Common.STAGE_WIDTH * 0.5,\r\n Common.STAGE_HEIGHT * 0.5);\r\n this.addChild(this._bgSprite);\r\n }\r\n };\r\n */\n\n/*\r\n SimpleScene.prototype.createSharedControls = function () {\r\n // UITopBarSharedControls.\r\n this._uiTopBarSharedControls = new UITopBarSharedControls();\r\n this._uiTopBarSharedControls.init();\r\n this.addChild(this._uiTopBarSharedControls);\r\n };\r\n */\n\n/*\r\n SimpleScene.prototype.resize = function () {\r\n this.x = ( P3.View.width - Common.STAGE_WIDTH ) * 0.5;\r\n this._uiTopBarSharedControls.resize();\r\n };\r\n */\n/*\r\n SimpleScene.prototype.destroy = function () {\r\n P3.Scene.prototype.destroy.call(this);\r\n };\r\n */\n/*\r\n // Override.\r\n SimpleScene.prototype.animateIn = function (callback, scope) {\r\n };\r\n\r\n // Override.\r\n SimpleScene.prototype.animateOut = function (callback, scope) {\r\n };\r\n\r\n // Override.\r\n SimpleScene.prototype.hide = function (callback, scope) {\r\n };\r\n */\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\n// TODO:\n\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\n// TODO:\n\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nexports.default = SimpleScene;\nObject.defineProperty(SimpleScene.prototype, \"bg\", {\n    get: function get() {\n        return this._bgSprite;\n    }\n});\n\n},{\"../Common\":3,\"../CommonGame\":4,\"../ui/UITopBarSharedControls\":35}],33:[function(require,module,exports){\n\"use strict\";\n\n/**\r\n * OutlineFilter, originally by mishaa\r\n * http://www.html5gamedevs.com/topic/10640-outline-a-sprite-change-certain-colors/?p=69966\r\n * http://codepen.io/mishaa/pen/emGNRB\r\n *\r\n * @class\r\n * @param thickness {number} The tickness of the outline. Make it 2 times more for resolution 2\r\n * @param color {number} The color of the glow.\r\n *\r\n * @example\r\n *  someSprite.shader = new OutlineFilter(9, 0xFF0000);\r\n */\nfunction OutlineFilter(thickness, color) {\n    thickness = thickness || 1;\n    PIXI.Filter.call(this,\n    // vertex shader\n    \"attribute vec2 aVertexPosition;\" + \"attribute vec2 aTextureCoord;\" + \"uniform mat3 projectionMatrix;\" + \"varying vec2 vTextureCoord;\" + \"void main(void){\" + \"gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\" + \"vTextureCoord = aTextureCoord;\" + \"}\",\n    // fragment shader\n    (\"varying vec2 vTextureCoord;\" + \"uniform sampler2D uSampler;\" + \"uniform float thickness;\" + \"uniform vec4 outlineColor;\" + \"uniform vec4 filterArea;\" + \"uniform vec4 filterClamp;\" + \"vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);\" + \"void main(void) {\" + \"const float PI = 3.14159265358979323846264;\" + \"vec4 ownColor = texture2D(uSampler, vTextureCoord);\" + \"vec4 curColor;\" + \"float maxAlpha = 0.;\" + \"vec2 displaced;\" + \"for (float angle = 0.; angle < PI * 2.; angle += %THICKNESS% ) {\" + \"displaced.x = vTextureCoord.x + thickness * px.x * cos(angle);\" + \"displaced.y = vTextureCoord.y + thickness * px.y * sin(angle);\" + \"curColor = texture2D(uSampler, clamp(displaced, filterClamp.xy, filterClamp.zw));\" + \"maxAlpha = max(maxAlpha, curColor.a);\" + \"}\" + \"float resultAlpha = max(maxAlpha, ownColor.a);\" + \"gl_FragColor = vec4((ownColor.rgb + outlineColor.rgb * (1. - ownColor.a)) * resultAlpha, resultAlpha); \" + \"}\").replace(/%THICKNESS%/gi, (1.0 / thickness).toFixed(7)));\n\n    this.uniforms.thickness = thickness;\n    this.uniforms.outlineColor = new Float32Array([0, 0, 0, 1]);\n    if (color) {\n        this.color = color;\n    }\n}\n\nOutlineFilter.prototype = Object.create(PIXI.Filter.prototype);\nOutlineFilter.prototype.constructor = OutlineFilter;\nmodule.exports = OutlineFilter;\n\nObject.defineProperties(OutlineFilter.prototype, {\n    color: {\n        get: function get() {\n            return PIXI.utils.rgb2hex(this.uniforms.outlineColor);\n        },\n        set: function set(value) {\n            PIXI.utils.hex2rgb(value, this.uniforms.outlineColor);\n        }\n    }\n});\n\n},{}],34:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nfunction UICarousel() {\n    PIXI.Container.call(this);\n\n    // Constants.\n    this.PAGE_WIDTH = 800;\n    this.DEFAULT_ITEM_SCALE = 0; // To be later initialized.\n    this.UNSELECTED_ITEM_SCALE_DELTA = 0.1; // If an item is not currently selected, scale it down by this amount.\n    this.SELECTED_ITEM_EXIT_EASE_FACTOR = 0.2; // Decrease the distance of the swipe gesture for the selected item.\n\n\n    // Attributes.\n    this._pageContainer = null;\n    this._interactiveArea = null;\n    this._mask = null;\n    this._startX = 0;\n    this._lastX = 0;\n    this._currentX = 0;\n    this._itemIndex = 0;\n\n    // Signals.\n    this.signals = {};\n    this.signals.onIndexChanged = new signals.Signal();\n    this.signals.onItemSelected = new signals.Signal();\n}\nexports.default = UICarousel;\n//module.exports                  \t= UICarousel;\n\nUICarousel.prototype = Object.create(PIXI.Container.prototype);\nUICarousel.prototype.constructor = UICarousel;\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nUICarousel.prototype.init = function (items) {\n    this.position = new PIXI.Point(_Common2.default.STAGE_WIDTH * 0.5, _Common2.default.STAGE_HEIGHT * 0.5);\n\n    // Mask.\n    this._mask = new PIXI.Graphics();\n    this._mask.beginFill(0xFFFFFF, 0);\n    this._mask.drawRect(-_Common2.default.STAGE_WIDTH * 0.5, -_Common2.default.STAGE_HEIGHT * 0.5, _Common2.default.STAGE_WIDTH, _Common2.default.STAGE_HEIGHT);\n    this._mask.endFill();\n    this.addChild(this._mask);\n\n    // Interactive area.\n    this._interactiveArea = new PIXI.Sprite(_Common2.default.blankTexture);\n    this._interactiveArea.tint = 0xFFFFFF;\n    this._interactiveArea.alpha = 0;\n    this._interactiveArea.height = 400;\n    this._interactiveArea.width = _Common2.default.STAGE_WIDTH;\n    this._interactiveArea.anchor = new PIXI.Point(0.5, 0.5);\n    this._interactiveArea.buttonMode = true;\n    this._interactiveArea.interactive = true;\n    this._interactiveArea.mousedown = this._interactiveArea.touchstart = this._onMouseDown.bind(this);\n    this._interactiveArea.mouseup = this._interactiveArea.touchend = this._onMouseUp.bind(this);\n    this._interactiveArea.mouseupoutside = this._interactiveArea.touchendoutside = this._onMouseUp.bind(this);\n\n    this.addChild(this._interactiveArea);\n\n    // Item container.\n    this._pageContainer = new PIXI.Container();\n    this._pageContainer.anchor = new PIXI.Point(0.5, 0.5);\n    this._pageContainer.mask = this._mask;\n    this._pageContainer.x = -this.PAGE_WIDTH * 0.5;\n    this.addChild(this._pageContainer);\n\n    // Items.\n    var i = 0;\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n        for (var _iterator = items[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var item = _step.value;\n\n            if (this.DEFAULT_ITEM_SCALE == 0) this.DEFAULT_ITEM_SCALE = item.scale.x;\n\n            // Page.\n            var page = new PIXI.Container();\n            page.anchor = new PIXI.Point(0, 0.5);\n            this._pageContainer.addChild(page);\n            // So we can keep some distance between items.\n            var pageBg = new PIXI.Sprite(_Common2.default.blankTexture);\n            pageBg.alpha = 0;\n            pageBg.anchor = new PIXI.Point(0, 0.5);\n            pageBg.width = this.PAGE_WIDTH;\n            pageBg.height = item.height;\n            page.addChild(pageBg);\n            // Item.\n            item.x = item.width * 0.5 + (pageBg.width - item.width) * 0.5;\n            page.addChild(item);\n            // Initial scale.\n            if (i > 0) item.scale = new PIXI.Point(this.DEFAULT_ITEM_SCALE - this.UNSELECTED_ITEM_SCALE_DELTA, this.DEFAULT_ITEM_SCALE - this.UNSELECTED_ITEM_SCALE_DELTA);\n\n            page.x = i * page.width;\n\n            ++i;\n        }\n    } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n    } finally {\n        try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n                _iterator.return();\n            }\n        } finally {\n            if (_didIteratorError) {\n                throw _iteratorError;\n            }\n        }\n    }\n};\n\nUICarousel.prototype.update = function () {\n    this._updateItemHiglighting();\n};\n\nUICarousel.prototype.animateIn = function () {\n    this._pageContainer.children[0].y -= 100;\n    this._pageContainer.children[0].alpha = 0;\n    TweenMax.to(this._pageContainer.children[0], 0.25, {\n        alpha: 1,\n        y: this._pageContainer.children[0].y + 100,\n        ease: Sine.easeOut\n    });\n};\n\nUICarousel.prototype.next = function () {\n    if (this._itemIndex < this._pageContainer.children.length - 1) {\n        this._itemIndex += 1;\n\n        TweenMax.to(this._pageContainer, 0.25, {\n            x: -this._itemIndex * this.PAGE_WIDTH - this.PAGE_WIDTH * 0.5,\n            ease: Sine.easeInOut,\n            onComplete: function onComplete() {\n                this.signals.onIndexChanged.dispatch();\n            },\n            onCompleteScope: this\n        });\n\n        // Sfx.\n        _Common2.default.audio.playSound(\"sfx_ui_carousel_swipe_00\");\n    }\n};\n\nUICarousel.prototype.prev = function () {\n    if (this._itemIndex > 0) {\n        this._itemIndex -= 1;\n\n        TweenMax.to(this._pageContainer, 0.25, {\n            x: -this._itemIndex * this.PAGE_WIDTH - this.PAGE_WIDTH * 0.5,\n            ease: Sine.easeInOut,\n            onComplete: function onComplete() {\n                this.signals.onIndexChanged.dispatch();\n            },\n            onCompleteScope: this\n        });\n\n        // Sfx.\n        _Common2.default.audio.playSound(\"sfx_ui_carousel_swipe_00\");\n    }\n};\n\n//===================================================\n//\n// Private\n//\n//===================================================\n\nUICarousel.prototype._updateItemHiglighting = function () {\n    // Highlight selection.\n    var pageFactor = Math.abs(this._pageContainer.x) / this.PAGE_WIDTH;\n    var itemIndexAux = Math.floor(pageFactor);\n    // Ease changing the selection of the current item.\n    if (this._itemIndex == itemIndexAux) {\n        if (Math.abs(this._itemIndex - pageFactor) <= 0.5 - this.SELECTED_ITEM_EXIT_EASE_FACTOR && this._itemIndex > 0) itemIndexAux -= 1;else if (Math.abs(this._itemIndex - pageFactor) >= 0.5 + this.SELECTED_ITEM_EXIT_EASE_FACTOR && this._itemIndex < this._pageContainer.children.length - 1) itemIndexAux += 1;\n    }\n\n    var itemIndex = 0;\n    var _iteratorNormalCompletion2 = true;\n    var _didIteratorError2 = false;\n    var _iteratorError2 = undefined;\n\n    try {\n        for (var _iterator2 = this._pageContainer.children[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n            var page = _step2.value;\n\n            var item = page.children[1];\n            if (!TweenMax.isTweening(item.scale)) {\n                if (itemIndex == itemIndexAux && item.scale.x != this.DEFAULT_ITEM_SCALE) TweenMax.to(item.scale, 0.12, {\n                    x: this.DEFAULT_ITEM_SCALE,\n                    y: this.DEFAULT_ITEM_SCALE,\n                    ease: Sine.easeInOut\n                });else if (itemIndex != itemIndexAux && item.scale.x != this.DEFAULT_ITEM_SCALE - this.UNSELECTED_ITEM_SCALE_DELTA) TweenMax.to(item.scale, 0.12, {\n                    x: this.DEFAULT_ITEM_SCALE - this.UNSELECTED_ITEM_SCALE_DELTA,\n                    y: this.DEFAULT_ITEM_SCALE - this.UNSELECTED_ITEM_SCALE_DELTA,\n                    ease: Sine.easeInOut\n                });\n            }\n\n            ++itemIndex;\n        }\n    } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n    } finally {\n        try {\n            if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                _iterator2.return();\n            }\n        } finally {\n            if (_didIteratorError2) {\n                throw _iteratorError2;\n            }\n        }\n    }\n};\n\nUICarousel.prototype._snap = function () {\n    var pageFactor = Math.abs(this._pageContainer.x) / this.PAGE_WIDTH;\n    var newItemIndex = Math.floor(pageFactor);\n    // Ease changing the selection of the current item.\n    if (newItemIndex == this._itemIndex) {\n        if (Math.abs(newItemIndex - pageFactor) <= 0.5 - this.SELECTED_ITEM_EXIT_EASE_FACTOR && newItemIndex > 0) newItemIndex -= 1;else if (Math.abs(newItemIndex - pageFactor) >= 0.5 + this.SELECTED_ITEM_EXIT_EASE_FACTOR && newItemIndex < this._pageContainer.children.length - 1) newItemIndex += 1;\n    }\n\n    TweenMax.to(this._pageContainer, 0.25, {\n        x: -newItemIndex * this.PAGE_WIDTH - this.PAGE_WIDTH * 0.5,\n        ease: Sine.easeInOut,\n        onComplete: function onComplete(newItemIndex) {\n            this._itemIndex = newItemIndex;\n            this.signals.onIndexChanged.dispatch();\n        },\n        onCompleteScope: this,\n        onCompleteParams: [newItemIndex]\n    });\n};\n\n//===================================================\n//\n// Events\n//\n//===================================================\n\nUICarousel.prototype._onMouseDown = function (mouseData) {\n    TweenMax.killTweensOf(this._pageContainer);\n\n    var localPos = mouseData.data.getLocalPosition(this._interactiveArea);\n    this._startX = localPos.x;\n    this._lastX = this._startX;\n    this._currentX = this._startX;\n\n    this._interactiveArea.mousemove = this._interactiveArea.touchmove = this._onMouseMove.bind(this);\n};\n\nUICarousel.prototype._onMouseMove = function (mouseData) {\n    var localPos = mouseData.data.getLocalPosition(this._interactiveArea);\n\n    this._currentX = localPos.x;\n\n    this._pageContainer.x += (this._currentX - this._lastX) * _Common2.default.STAGE_WIDTH;\n    if (this._pageContainer.x > -this.PAGE_WIDTH * 0.5) this._pageContainer.x = -this.PAGE_WIDTH * 0.5;else if (this._pageContainer.x < -(this._pageContainer.children.length - 0.5) * this.PAGE_WIDTH) this._pageContainer.x = -(this._pageContainer.children.length - 0.5) * this.PAGE_WIDTH;\n\n    this._lastX = this._currentX;\n};\n\nUICarousel.prototype._onMouseUp = function (mouseData) {\n    var result = false;\n    if (Math.abs(this._startX - this._currentX) <= 0.01) {\n        var selectedItem = this._pageContainer.children[this._itemIndex].children[1];\n        var localPos = mouseData.data.getLocalPosition(selectedItem);\n        if (Math.abs(localPos.x) <= selectedItem.width * 0.8 && Math.abs(localPos.y) <= selectedItem.height * 0.8) {\n            this.signals.onItemSelected.dispatch();\n\n            result = true;\n        }\n    }\n\n    if (!result) {\n        this._interactiveArea.mousemove = this._interactiveArea.touchmove = null;\n\n        this._snap();\n\n        // Sfx.\n        _Common2.default.audio.playSound(\"sfx_ui_carousel_swipe_00\");\n    }\n};\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\nObject.defineProperty(UICarousel.prototype, \"selectedIndex\", {\n    get: function get() {\n        return this._itemIndex;\n    }\n});\n\n},{\"../Common\":3,\"../CommonGame\":4}],35:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Common = require(\"../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\n/**\r\n * @constructor\r\n */\nvar UITopBarSharedControls = function (_PIXI$Container) {\n    _inherits(UITopBarSharedControls, _PIXI$Container);\n\n    function UITopBarSharedControls() {\n        _classCallCheck(this, UITopBarSharedControls);\n\n        // Attributes.\n        var _this = _possibleConstructorReturn(this, (UITopBarSharedControls.__proto__ || Object.getPrototypeOf(UITopBarSharedControls)).call(this));\n\n        _this._homeBtn = null;\n        _this._muteBtn = null;\n        _this._backBtn = null;\n\n        // Signals.\n        _this.signals = {};\n        _this.signals.onBackBtn_Click = new signals.Signal();\n        return _this;\n    }\n\n    _createClass(UITopBarSharedControls, [{\n        key: \"init\",\n        value: function init() {\n\n            this._homeBtn = createButton(\"home\");\n            this._homeBtn.anchor = new PIXI.Point(0, 0.5);\n            this._homeBtn.position.y = this._homeBtn.height * 0.5 + 30;\n            this._homeBtn.visible = false;\n            this._homeBtn._icon.scale.x = -1;\n            this._homeBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._homeBtn.downSoundName = \"sfx_ui_click_00\";\n            this._homeBtn.signals.click.add(this._onHomeButton_Click, this);\n            this.addChild(this._homeBtn);\n\n            // Mute button.\n            this._muteBtn = createButton(\"sound\");\n            this._muteBtn.anchor = new PIXI.Point(1, 0.5);\n            this._muteBtn.position.y = this._homeBtn.position.y;\n            this._muteBtn.visible = false;\n            this._muteBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._muteBtn.downSoundName = \"sfx_ui_click_00\";\n            this._muteBtn.signals.click.add(this._onMuteButton_Click, this);\n            this.addChild(this._muteBtn);\n\n            // Back button.\n            this._backBtn = createButton(\"back\");\n            this._backBtn.anchor = new PIXI.Point(0, 0.5);\n            this._backBtn.position.y = this._homeBtn.position.y;\n            this._backBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._backBtn.downSoundName = \"sfx_ui_click_00\";\n            this._backBtn.signals.click.add(this._onBackButton_Click, this);\n            this._backBtn.visible = false;\n            this.addChild(this._backBtn);\n        }\n    }, {\n        key: \"resize\",\n        value: function resize() {\n            this._homeBtn.position.x = _Common2.default.getScreenPositionLeft() + 70;\n            this._muteBtn.position.x = _Common2.default.getScreenPositionRight() - 70;\n            this._backBtn.position.x = _Common2.default.getScreenPositionLeft() + 70;\n        }\n    }, {\n        key: \"_onHomeButton_Click\",\n        value: function _onHomeButton_Click() {\n            //todo swap for signals\n            _Common2.default.main.application.loadScene(_CommonGame2.default.SCENE_ID_MAIN);\n        }\n    }, {\n        key: \"_onMuteButton_Click\",\n        value: function _onMuteButton_Click() {\n            _Common2.default.isMute = !_Common2.default.isMute;\n\n            // TODO:\n            this._muteBtn._icon.texture = _Common2.default.assets.getTexture(_Common2.default.isMute ? \"icon_mute_off\" : \"icon_sound_off\");\n            this._muteBtn._currentIconTexture = this._muteBtn._icon.texture;\n\n            _Common2.default.audio.mute(_Common2.default.isMute);\n\n            // Sfx.\n            //Common.audio.playSound( \"sfx_small_blip\" );\n        }\n    }, {\n        key: \"_onBackButton_Click\",\n        value: function _onBackButton_Click() {\n            this.signals.onBackBtn_Click.dispatch();\n        }\n    }, {\n        key: \"homeBtn\",\n        get: function get() {\n            return this._homeBtn;\n        }\n    }, {\n        key: \"muteBtn\",\n        get: function get() {\n            return this._muteBtn;\n        }\n    }, {\n        key: \"backBtn\",\n        get: function get() {\n            return this._backBtn;\n        }\n    }]);\n\n    return UITopBarSharedControls;\n}(PIXI.Container);\n\nexports.default = UITopBarSharedControls;\n\n},{\"../Common\":3,\"../CommonGame\":4}],36:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Common = require(\"../../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar ConfirmationPanel = function (_PIXI$Container) {\n  _inherits(ConfirmationPanel, _PIXI$Container);\n\n  function ConfirmationPanel() {\n    _classCallCheck(this, ConfirmationPanel);\n\n    // Attributes.\n    var _this = _possibleConstructorReturn(this, (ConfirmationPanel.__proto__ || Object.getPrototypeOf(ConfirmationPanel)).call(this));\n\n    _this._bgSprite = null;\n    _this._messageSprite = null;\n    _this._messageText = null;\n    _this._yesBtn = null;\n    _this._noBtn = null;\n    _this._selectedBtn = null;\n\n    // Signals.\n    _this.signals = {};\n    _this.signals.onYes = new signals.Signal();\n    _this.signals.onNo = new signals.Signal();\n    return _this;\n  }\n\n  _createClass(ConfirmationPanel, [{\n    key: \"init\",\n    value: function init() {\n      // Background sprite.\n      this._bgSprite = new PIXI.Sprite(_Common2.default.blankTexture);\n      this._bgSprite.anchor = new PIXI.Point(0.5, 0.5);\n      this._bgSprite.tint = 0x000000;\n      this._bgSprite.alpha = 0.3;\n      this._bgSprite.interactive = true;\n      this._bgSprite.width = _Common2.default.STAGE_WIDTH;\n      this._bgSprite.height = _Common2.default.STAGE_HEIGHT;\n      this.addChild(this._bgSprite);\n\n      // Message sprite.\n      this._messageSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"colour_palette_big_bg\"));\n      this._messageSprite.anchor = new PIXI.Point(0.5, 0.5);\n      this.addChild(this._messageSprite);\n\n      // Message text.\n      this._messageText = P3.createText(\"COLOUR_IT\", {\n        size: \"64px\",\n        fill: [0xfff8b3, 0xfac109],\n        stroke: 0x006130,\n        stokeThickness: 5,\n        wordWrap: true,\n        wordWrapWidth: this._messageSprite.width - 200\n      }, \"truetype\");\n\n      this._messageText.anchor = new PIXI.Point(0.5, 0.5);\n      this._messageText.y = -80;\n      this._messageSprite.addChild(this._messageText);\n\n      // Yes button.\n      this._yesBtn = createButton(\"tick\", \"primary_large\");\n      this._yesBtn.anchor = new PIXI.Point(0.5, 0.5);\n      this._yesBtn.position = new PIXI.Point(100, this._messageSprite.height * 0.5 - 110);\n      this._yesBtn.overSoundName = \"sfx_ui_rollover_00\";\n      this._yesBtn.downSoundName = \"sfx_ui_click_00\";\n      this._messageSprite.addChild(this._yesBtn);\n\n      // No button.\n      this._noBtn = createButton(\"cross\", \"primary_large\");\n      this._noBtn.anchor = new PIXI.Point(0.5, 0.5);\n      this._noBtn.position = new PIXI.Point(-100, this._messageSprite.height * 0.5 - 110);\n      this._noBtn.overSoundName = \"sfx_ui_rollover_00\";\n      this._noBtn.downSoundName = \"sfx_ui_click_00\";\n      this._messageSprite.addChild(this._noBtn);\n\n      this.visible = false;\n    }\n  }, {\n    key: \"show\",\n    value: function show(message) {\n      this.visible = true;\n      this._messageText.text = message;\n\n      this._messageSprite.alpha = 0;\n      this._messageSprite.y = -100;\n      TweenMax.to(this._messageSprite, 0.25, { y: this._messageSprite.y + 100, alpha: 1, ease: Sine.easeOut });\n\n      this._bgSprite.alpha = 0;\n      TweenMax.to(this._bgSprite, 0.25, { alpha: 0.3, ease: Sine.easeOut });\n\n      this._noBtn.alpha = 0;\n      this._noBtn.scale = new PIXI.Point();\n      TweenMax.to(this._noBtn, 0.25, { alpha: 1, ease: Sine.easeOut, delay: 0.15 });\n      TweenMax.to(this._noBtn.scale, 0.5, { x: 1, y: 1, ease: Elastic.easeOut, delay: 0.15 });\n\n      this._yesBtn.alpha = 0;\n      this._yesBtn.scale = new PIXI.Point();\n      TweenMax.to(this._yesBtn, 0.25, { alpha: 1, ease: Sine.easeOut, delay: 0.3 });\n      TweenMax.to(this._yesBtn.scale, 0.5, { x: 1, y: 1, ease: Elastic.easeOut, delay: 0.3 });\n\n      // Signals.\n      this._yesBtn.signals.click.addOnce(function () {\n        this._selectedBtn = this._yesBtn;\n        this._hide();\n      }, this);\n      this._noBtn.signals.click.addOnce(function () {\n        this._selectedBtn = this._noBtn;\n        this._hide();\n      }, this);\n    }\n  }, {\n    key: \"_hide\",\n    value: function _hide() {\n      TweenMax.to(this._messageSprite, 0.25, { y: this._messageSprite.y + 100, alpha: 0, ease: Sine.easeIn });\n      TweenMax.to(this._bgSprite, 0.25, {\n        alpha: 0,\n        ease: Sine.easeIn,\n        onComplete: this._onHidden,\n        onCompleteScope: this\n      });\n\n      // Signals.\n      this._yesBtn.signals.click.removeAll();\n      this._noBtn.signals.click.removeAll();\n    }\n\n    //----EVENTS----//\n\n  }, {\n    key: \"_onHidden\",\n    value: function _onHidden() {\n      if (this._selectedBtn === this._yesBtn) {\n        // Sfx.\n        //Common.audio.playSound(\"vo_happo_ok_00\");\n\n        this.signals.onYes.dispatch();\n      } else if (this._selectedBtn === this._noBtn) {\n        this.signals.onNo.dispatch();\n      }\n\n      this._selectedBtn = null;\n\n      this.visible = false;\n\n      // Signals.\n      this.signals.onYes.removeAll();\n      this.signals.onNo.removeAll();\n    }\n  }]);\n\n  return ConfirmationPanel;\n}(PIXI.Container);\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n/*\r\n function ConfirmationPanel() {\r\n PIXI.Container.call(this);\r\n\r\n\r\n // Attributes.\r\n this._bgSprite = null;\r\n this._messageSprite = null;\r\n this._messageText = null;\r\n this._yesBtn = null;\r\n this._noBtn = null;\r\n this._selectedBtn = null;\r\n\r\n\r\n // Signals.\r\n this.signals = {};\r\n this.signals.onYes = new signals.Signal();\r\n this.signals.onNo = new signals.Signal();\r\n }\r\n\r\n export default ConfirmationPanel;\r\n //module.exports = ConfirmationPanel;\r\n ConfirmationPanel.prototype = Object.create(PIXI.Container.prototype);\r\n ConfirmationPanel.prototype.constructor = ConfirmationPanel;\r\n */\n\n//===================================================\n//\n// Public\n//\n//===================================================\n/*\r\n ConfirmationPanel.prototype.init = function () {\r\n // Background sprite.\r\n this._bgSprite = new PIXI.Sprite(Common.blankTexture);\r\n this._bgSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n this._bgSprite.tint = 0x000000;\r\n this._bgSprite.alpha = 0.3;\r\n this._bgSprite.interactive = true;\r\n this._bgSprite.width = Common.STAGE_WIDTH;\r\n this._bgSprite.height = Common.STAGE_HEIGHT;\r\n this.addChild(this._bgSprite);\r\n\r\n // Message sprite.\r\n this._messageSprite = new PIXI.Sprite(Common.assets.getTexture(\"colour_palette_big_bg\"));\r\n this._messageSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n this.addChild(this._messageSprite);\r\n\r\n // Message text.\r\n this._messageText = P3.createText(\"COLOUR_IT\", {\r\n size: \"64px\",\r\n fill: [0xfff8b3, 0xfac109],\r\n stroke: 0x4c2607,\r\n stokeThickness: 5,\r\n wordWrap: true,\r\n wordWrapWidth: this._messageSprite.width - 200\r\n }, \"truetype\");\r\n\r\n this._messageText.anchor = new PIXI.Point(0.5, 0.5);\r\n this._messageText.y = -80;\r\n this._messageSprite.addChild(this._messageText);\r\n\r\n // Yes button.\r\n var btnStatesAux = new P3.ButtonStates(\r\n Common.assets.getTexture(\"btn_primary_large_off\"),\r\n Common.assets.getTexture(\"btn_primary_large_over\"),\r\n Common.assets.getTexture(\"btn_primary_large_down\"),\r\n Common.assets.getTexture(\"icon_tick\")\r\n );\r\n btnStatesAux.iconOver = Common.assets.getTexture(\"icon_tick\");\r\n btnStatesAux.iconDown = Common.assets.getTexture(\"icon_tick\");\r\n this._yesBtn = new P3.Button(btnStatesAux);\r\n this._yesBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n this._yesBtn.position = new PIXI.Point(100, this._messageSprite.height * 0.5 - 110);\r\n this._yesBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n this._yesBtn.downSoundName = \"sfx_ui_click_00\";\r\n this._messageSprite.addChild(this._yesBtn);\r\n\r\n // No button.\r\n btnStatesAux = new P3.ButtonStates(\r\n Common.assets.getTexture(\"btn_primary_large_off\"),\r\n Common.assets.getTexture(\"btn_primary_large_over\"),\r\n Common.assets.getTexture(\"btn_primary_large_down\"),\r\n Common.assets.getTexture(\"icon_cross\")\r\n );\r\n btnStatesAux.iconOver = Common.assets.getTexture(\"icon_cross\");\r\n btnStatesAux.iconDown = Common.assets.getTexture(\"icon_cross\");\r\n this._noBtn = new P3.Button(btnStatesAux);\r\n this._noBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n this._noBtn.position = new PIXI.Point(-100, this._messageSprite.height * 0.5 - 110);\r\n this._noBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n this._noBtn.downSoundName = \"sfx_ui_click_00\";\r\n this._messageSprite.addChild(this._noBtn);\r\n\r\n this.visible = false;\r\n };\r\n */\n\n/*\r\n ConfirmationPanel.prototype.show = function (message) {\r\n this.visible = true;\r\n this._messageText.text = message;\r\n\r\n this._messageSprite.alpha = 0;\r\n this._messageSprite.y = -100;\r\n TweenMax.to(this._messageSprite, 0.25, {y: this._messageSprite.y + 100, alpha: 1, ease: Sine.easeOut});\r\n\r\n this._bgSprite.alpha = 0;\r\n TweenMax.to(this._bgSprite, 0.25, {alpha: 0.3, ease: Sine.easeOut});\r\n\r\n this._noBtn.alpha = 0;\r\n this._noBtn.scale = new PIXI.Point();\r\n TweenMax.to(this._noBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.15});\r\n TweenMax.to(this._noBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.15});\r\n\r\n this._yesBtn.alpha = 0;\r\n this._yesBtn.scale = new PIXI.Point();\r\n TweenMax.to(this._yesBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.3});\r\n TweenMax.to(this._yesBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.3});\r\n\r\n\r\n // Signals.\r\n this._yesBtn.signals.click.addOnce(function () {\r\n this._selectedBtn = this._yesBtn;\r\n this._hide();\r\n }, this);\r\n this._noBtn.signals.click.addOnce(function () {\r\n this._selectedBtn = this._noBtn;\r\n this._hide();\r\n }, this);\r\n };\r\n */\n\n//===================================================\n//\n// Private\n//\n//===================================================\n/*\r\n ConfirmationPanel.prototype._hide = function () {\r\n TweenMax.to(this._messageSprite, 0.25, {y: this._messageSprite.y + 100, alpha: 0, ease: Sine.easeIn});\r\n TweenMax.to(this._bgSprite, 0.25, {alpha: 0, ease: Sine.easeIn, onComplete: this._onHidden, onCompleteScope: this});\r\n\r\n\r\n // Signals.\r\n this._yesBtn.signals.click.removeAll();\r\n this._noBtn.signals.click.removeAll();\r\n };\r\n */\n\n//===================================================\n//\n// Events\n//\n//===================================================\n/*\r\n ConfirmationPanel.prototype._onHidden = function () {\r\n if (this._selectedBtn == this._yesBtn) {\r\n this.signals.onYes.dispatch();\r\n\r\n // Sfx.\r\n Common.audio.playSound(\"vo_happo_ok_00\");\r\n }\r\n else if (this._selectedBtn == this._noBtn)\r\n this.signals.onNo.dispatch();\r\n\r\n this._selectedBtn = null;\r\n\r\n this.visible = false;\r\n\r\n // Signals.\r\n this.signals.onYes.removeAll();\r\n this.signals.onNo.removeAll();\r\n };\r\n */\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\n// TODO:\n\n\nexports.default = ConfirmationPanel;\n\n},{\"../../Common\":3,\"../../CommonGame\":4}],37:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Common = require(\"../../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _ConfirmationPanel = require(\"./ConfirmationPanel\");\n\nvar _ConfirmationPanel2 = _interopRequireDefault(_ConfirmationPanel);\n\nvar _TrashConfirmationPanel = require(\"./TrashConfirmationPanel\");\n\nvar _TrashConfirmationPanel2 = _interopRequireDefault(_TrashConfirmationPanel);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar MenuPanel = function (_PIXI$Container) {\n    _inherits(MenuPanel, _PIXI$Container);\n\n    function MenuPanel(signals) {\n        _classCallCheck(this, MenuPanel);\n\n        var _this = _possibleConstructorReturn(this, (MenuPanel.__proto__ || Object.getPrototypeOf(MenuPanel)).call(this));\n\n        _this._gameSceneSignals = signals;\n\n        // Attributes.\n        _this._quitBtn = null;\n        _this._backBtn = null;\n        _this._printBtn = null;\n        _this._downloadBtn = null;\n        _this._muteBtn = null;\n        _this._binBtn = null;\n        _this._boxBorderSprite = null;\n        _this._popupContainer = null;\n        _this._drawingActionContainer = null;\n        _this._titleSprite = null;\n        _this._bgGradientSprite = null;\n        _this._titleText = null;\n        _this._confirmationPanel = null;\n        _this._trashConfirmationPanel = null;\n        return _this;\n    }\n\n    _createClass(MenuPanel, [{\n        key: \"init\",\n        value: function init() {\n            // Bg gradient sprite.\n            this._bgGradientSprite = new PIXI.Sprite(_Common2.default.blankTexture);\n            this._bgGradientSprite.tint = 0x000000;\n            this._bgGradientSprite.alpha = 0.6;\n            this._bgGradientSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._bgGradientSprite.scale.x = _Common2.default.STAGE_WIDTH * 1.25;\n            this._bgGradientSprite.scale.y = _Common2.default.STAGE_HEIGHT;\n            this._bgGradientSprite.interactive = true;\n            this._bgGradientSprite.click = this._bgGradientSprite.touchend = this._onBackButton_Click.bind(this);\n            this.addChild(this._bgGradientSprite);\n\n            // Popup.\n            this._popupContainer = new PIXI.Container();\n            this._popupContainer.anchor = new PIXI.Point(0.5, 0.5);\n            this.addChild(this._popupContainer);\n\n            // Bg.\n            /*\r\n             //removed due to feedback\r\n             //@deprecated\r\n             var SCALE_FACTOR = 0.985;\r\n             var popupTex = Common.assets.getTexture(\"popup_box\");\r\n               var popupBg = new PIXI.Graphics();\r\n             popupBg.beginFill(CommonGame.GALLERY_BORDER_TINT[CommonGame.selectedGallery], 1);\r\n             popupBg.drawRoundedRect(\r\n             -popupTex.width * 0.5 * SCALE_FACTOR,\r\n             -popupTex.height * 0.5 * SCALE_FACTOR,\r\n             popupTex.width * SCALE_FACTOR,\r\n             popupTex.height * SCALE_FACTOR,\r\n             35\r\n             );\r\n             popupBg.endFill();\r\n             popupBg.interactive = true;\r\n             this._popupContainer.addChild(popupBg);\r\n             */\n\n            // Border.\n            this._boxBorderSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"menu_panel\"));\n            this._boxBorderSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._popupContainer.addChild(this._boxBorderSprite);\n            this._popupContainer.scale.set(0.9, 0.9);\n\n            // Title sprite.\n            this._titleSprite = new PIXI.Sprite(PIXI.Texture.EMPTY);\n            this._titleSprite.anchor = new PIXI.Point(0.5, 0.5);\n\n            this._popupContainer.addChild(this._titleSprite);\n\n            // Title text.\n            var bkText = P3.createText(\"MENU\", {\n                fill: [0xfff8b3, 0xfac109],\n                size: \"90px\",\n                wordWrap: true,\n                wordWrapWidth: 500,\n                stroke: 0x23a838,\n                strokeThickness: 14,\n                align: \"centre\"\n            });\n\n            this._titleText = P3.createText(\"MENU\", {\n                fill: [0xfff8b3, 0xfac109],\n                size: \"90px\",\n                wordWrap: true,\n                wordWrapWidth: 500,\n                stroke: 0x006130,\n                align: \"centre\",\n                strokeThickness: 8\n            });\n\n            this._titleText.y = bkText.y = -this._boxBorderSprite.height * 0.5 + 145;\n            this._titleText.anchor = bkText.anchor = new PIXI.Point(0.5, 0.5);\n            this._titleSprite.addChild(bkText, this._titleText);\n\n            // Quit button.\n            this._quitBtn = createButton(\"home\");\n            this._quitBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._quitBtn.position = new PIXI.Point(-234, 248);\n            this._quitBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._quitBtn.downSoundName = \"sfx_ui_click_00\";\n            this._quitBtn.signals.click.add(this._onQuitButton_Click, this);\n            this._popupContainer.addChild(this._quitBtn);\n\n            // Sound button.\n            this._muteBtn = createButton(\"sound\");\n            this._muteBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._muteBtn.position = new PIXI.Point(238, 248);\n            this._muteBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._muteBtn.downSoundName = \"sfx_ui_click_00\";\n            this._muteBtn.signals.click.add(this._onSoundButton_Click, this);\n            this._popupContainer.addChild(this._muteBtn);\n\n            // Container for Print, Download and Bin buttons.\n            this._drawingActionContainer = new PIXI.Sprite(PIXI.Texture.EMPTY);\n            this._drawingActionContainer.anchor.set(0.5, 0.5);\n            this._drawingActionContainer.y = -15;\n            this._popupContainer.addChild(this._drawingActionContainer);\n\n            var btnOffset = 240;\n            var btnStatesAux = void 0;\n\n            // Print button.\n            if (_Common2.default.assets.getJSON(\"config\").menuPanel.printBtn.isVisible) {\n                btnStatesAux = new P3.ButtonStates(PIXI.Texture.EMPTY, PIXI.Texture.EMPTY, PIXI.Texture.EMPTY, _Common2.default.assets.getTexture(\"icon_print\"));\n                this._printBtn = new P3.Button(btnStatesAux);\n                this._printBtn.anchor = new PIXI.Point(0.5, 0.5);\n                this._printBtn.x = -btnOffset;\n\n                this._printBtn.signals.click.add(this._onPrintButton_Click, this);\n                this._drawingActionContainer.addChild(this._printBtn);\n            }\n\n            // Download button.\n            if (_Common2.default.assets.getJSON(\"config\").menuPanel.downloadBtn.isVisible) {\n                btnStatesAux = new P3.ButtonStates(PIXI.Texture.EMPTY, PIXI.Texture.EMPTY, PIXI.Texture.EMPTY, _Common2.default.assets.getTexture(\"icon_save\"));\n                this._downloadBtn = new P3.Button(btnStatesAux);\n                this._downloadBtn.anchor = new PIXI.Point(0.5, 0.5);\n                this._downloadBtn.x = 0; //this._drawingActionContainer.children.length * btnOffset;\n\n                this._downloadBtn.signals.click.add(this._onDownloadButton_Click, this);\n                this._drawingActionContainer.addChild(this._downloadBtn);\n            }\n\n            // Bin button.\n            if (_Common2.default.assets.getJSON(\"config\").menuPanel.binBtn.isVisible) {\n                btnStatesAux = new P3.ButtonStates(PIXI.Texture.EMPTY, PIXI.Texture.EMPTY, PIXI.Texture.EMPTY, _Common2.default.assets.getTexture(\"icon_replay\"));\n                this._binBtn = new P3.Button(btnStatesAux);\n                this._binBtn.anchor = new PIXI.Point(0.5, 0.5);\n                this._binBtn.x = btnOffset;\n\n                this._binBtn.signals.click.add(this._onBinButton_Click, this);\n                this._drawingActionContainer.addChild(this._binBtn);\n            }\n\n            // Back button.\n            this._backBtn = createButton(\"play_large\", \"primary_large\");\n            this._backBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._backBtn.position = new PIXI.Point(0, this._boxBorderSprite.height * 0.5 - 115);\n            this._backBtn.overSoundName = \"sfx_ui_rollover_00\";\n            this._backBtn.downSoundName = \"sfx_ui_click_00\";\n            this._backBtn.signals.click.add(this._onBackButton_Click, this);\n            this._popupContainer.addChild(this._backBtn);\n\n            // Confirmation panel.\n            this._confirmationPanel = new _ConfirmationPanel2.default();\n            this._confirmationPanel.anchor = new PIXI.Point(0.5, 0.5);\n            this._confirmationPanel.init();\n            this.addChild(this._confirmationPanel);\n\n            // Trash confirmation panel.\n            this._trashConfirmationPanel = new _TrashConfirmationPanel2.default();\n            this._trashConfirmationPanel.anchor = new PIXI.Point(0.5, 0.5);\n            this._trashConfirmationPanel.init();\n            this.addChild(this._trashConfirmationPanel);\n\n            this.visible = false;\n            this.alpha = 0;\n        }\n    }, {\n        key: \"show\",\n        value: function show() {\n            // Animate-in.\n            this.visible = true;\n            this._popupContainer.y = -50;\n            TweenMax.to(this, 0.25, { alpha: 1, ease: Quad.easeOut });\n            TweenMax.to(this._popupContainer, 0.25, { y: 0, ease: Quad.easeOut });\n\n            this._backBtn.alpha = 0;\n            this._backBtn.scale = new PIXI.Point();\n            TweenMax.to(this._backBtn, 0.25, { alpha: 1, ease: Sine.easeOut, delay: 0.2 });\n            TweenMax.to(this._backBtn.scale, 0.5, { x: 1, y: 1, ease: Elastic.easeOut, delay: 0.2 });\n\n            _Common2.default.game.scene.addTutorialEvent(_CommonGame2.default.TUT_EVENT.MENU_PANEL_SHOWN);\n        }\n\n        //----EVENTS----//\n\n    }, {\n        key: \"_onQuitButton_Click\",\n        value: function _onQuitButton_Click() {\n            var _this2 = this;\n\n            this._confirmationPanel.signals.onYes.addOnce(function () {\n                // Music.\n                _Common2.default.audio.stopMusic();\n                _Common2.default.audio.playMusic(\"music_mainmenu_loop_00\");\n\n                // Common.main.application.loadScene(CommonGame.SCENE_ID_IMAGE_SELECTION);\n                _this2._gameSceneSignals.previous.dispatch(_this2);\n            }, this);\n            this._confirmationPanel.show(_Common2.default.assets.getJSON(\"languages\").LEAVE_CONFIRMATION[_Common2.default.language]);\n        }\n    }, {\n        key: \"_onPrintButton_Click\",\n        value: function _onPrintButton_Click() {\n            var _this3 = this;\n\n            // Sfx.\n            _Common2.default.audio.playSound(\"sfx_ui_newpage_00\");\n\n            this.visible = false;\n            _Common2.default.game.hud.visible = false;\n\n            //--timeout is needed. otherwise window.open returns null (according to SO must be initialised by a native event)--//\n            setTimeout(function () {\n                var canvas = _Common2.default.renderer.extract.canvas(_Common2.default.game.canvas);\n                \n                if (myWindow) {\n                    myWindow.document.body.appendChild(canvas);\n\n                    var css = \"@page { size: landscape; margin-top: 1.4cm; margin-left: 2.3cm; }\";\n                    var head = myWindow.document.head || myWindow.document.getElementsByTagName(\"head\")[0];\n                    var style = document.createElement(\"style\");\n\n                    style.type = \"text/css\";\n                    style.media = \"print\";\n\n                    if (style.styleSheet) style.styleSheet.cssText = css;else style.appendChild(document.createTextNode(css));\n\n                    head.appendChild(style);\n\n                    myWindow.print();\n                    myWindow.close();\n                } else {\n                    console.error(\"unable to open new window\");\n                    console.log(myWindow);\n                }\n\n                _this3.visible = true;\n                _Common2.default.game.hud.visible = true;\n            }, 2.5);\n        }\n    }, {\n        key: \"_onDownloadButton_Click\",\n        value: function _onDownloadButton_Click() {\n            var _this4 = this;\n\n            // Sfx.\n            _Common2.default.audio.playSound(\"sfx_ui_folder_save_00\");\n\n            this.visible = false;\n            _Common2.default.game.hud.visible = false;\n\n            setTimeout(function () {\n                var canvas = _Common2.default.renderer.extract.canvas(_Common2.default.game.canvas);\n               ;\n                if (myWindow != null) myWindow.document.body.appendChild(canvas);\n\n                _this4.visible = true;\n                _Common2.default.game.hud.visible = true;\n            }, 2.5);\n        }\n    }, {\n        key: \"_onSoundButton_Click\",\n        value: function _onSoundButton_Click() {\n            _Common2.default.isMute = !_Common2.default.isMute;\n\n            // TODO:\n            this._muteBtn._icon.texture = _Common2.default.assets.getTexture(_Common2.default.isMute ? \"icon_mute_off\" : \"icon_sound_off\");\n            this._muteBtn._currentIconTexture = this._muteBtn._icon.texture;\n\n            _Common2.default.audio.mute(_Common2.default.isMute);\n        }\n    }, {\n        key: \"_onBinButton_Click\",\n        value: function _onBinButton_Click() {\n            this._trashConfirmationPanel.signals.onYes.addOnce(function () {\n                // Sfx.\n                _Common2.default.audio.playSound(\"sfx_tool_trashcan_select_00\");\n\n                _Common2.default.game.canvas.clear();\n                _Common2.default.game.undoManager.clear();\n\n                this.visible = false;\n            }, this);\n            this._trashConfirmationPanel.show(_Common2.default.assets.getJSON(\"languages\").BIN_CONFIRMATION[_Common2.default.language]);\n        }\n    }, {\n        key: \"_onBackButton_Click\",\n        value: function _onBackButton_Click() {\n            // Animate-out.\n            TweenMax.to(this, 0.25, { alpha: 0, ease: Quad.easeOut });\n            TweenMax.to(this._popupContainer, 0.25, {\n                y: 50,\n                ease: Quad.easeOut,\n                onComplete: function onComplete() {\n                    this.visible = false;\n                    _Common2.default.game.scene.addTutorialEvent(_CommonGame2.default.TUT_EVENT.MENU_PANEL_HIDDEN);\n                },\n                onCompleteScope: this\n            });\n        }\n    }]);\n\n    return MenuPanel;\n}(PIXI.Container);\n\nexports.default = MenuPanel;\n\n},{\"../../Common\":3,\"../../CommonGame\":4,\"./ConfirmationPanel\":36,\"./TrashConfirmationPanel\":39}],38:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Common = require(\"../../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar PalettePanel = function (_PIXI$Container) {\n    _inherits(PalettePanel, _PIXI$Container);\n\n    function PalettePanel() {\n        _classCallCheck(this, PalettePanel);\n\n        // Constants.\n        var _this = _possibleConstructorReturn(this, (PalettePanel.__proto__ || Object.getPrototypeOf(PalettePanel)).call(this));\n\n        _this.ITEMS_PER_ROW = 5;\n        _this.ITEMS_PER_PAGE = 15;\n        _this.PALETTE_TOOLS = _Common2.default.assets.getJSON(\"config\").palettePanel.tools;\n        _this.PALETTE_TYPE_TO_TOOL = [_this.PALETTE_TOOLS.pencil, _this.PALETTE_TOOLS.brush, _this.PALETTE_TOOLS.stamp, _this.PALETTE_TOOLS.fill, _this.PALETTE_TOOLS.ink, _this.PALETTE_TOOLS.spray, _this.PALETTE_TOOLS.fill];\n\n        // Attributes.\n        _this._bgGradientSprite = null;\n        _this._panel = null;\n        _this._boxSprite = null;\n        _this._type = null;\n        _this._nextBtn = null;\n        _this._prevBtn = null;\n        _this._pageIndex = 0;\n        _this._pageCount = 0;\n        _this._arrBtnInfo = [];\n\n        // Signals.\n        _this.signals = {};\n        _this.signals.onColourChanged = new signals.Signal();\n        _this.signals.onStampChanged = new signals.Signal();\n        return _this;\n    }\n\n    _createClass(PalettePanel, [{\n        key: \"init\",\n        value: function init() {\n            // Bg gradient sprite.\n            this._bgGradientSprite = new PIXI.Sprite(_Common2.default.blankTexture);\n            this._bgGradientSprite.tint = 0x000000;\n            this._bgGradientSprite.alpha = 0.6;\n            this._bgGradientSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._bgGradientSprite.scale.x = _Common2.default.STAGE_WIDTH * 1.25;\n            this._bgGradientSprite.scale.y = _Common2.default.STAGE_HEIGHT;\n            this._bgGradientSprite.interactive = true;\n            this._bgGradientSprite.click = this._bgGradientSprite.touchend = this.hide.bind(this);\n            this.addChild(this._bgGradientSprite);\n\n            // Panel.\n            this._panel = new PIXI.Container();\n            this.addChild(this._panel);\n\n            // Box sprite.\n            this._boxSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"colour_palette_big_bg\"));\n            this._boxSprite.interactive = true;\n            this._boxSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._panel.addChild(this._boxSprite);\n\n            // Next button.\n            var btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_next_off\"), _Common2.default.assets.getTexture(\"icon_next_over\"), _Common2.default.assets.getTexture(\"icon_next_down\"));\n            this._nextBtn = new P3.Button(btnStatesAux);\n            this._nextBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._nextBtn.scale = new PIXI.Point(1.5, 1.5);\n            this._nextBtn.defaultScale = new PIXI.Point(1.5, 1.5);\n            this._nextBtn.position.x = this._boxSprite.width * 0.5 + 50;\n            this._nextBtn.alpha = 0;\n            this._nextBtn.interactive = false;\n            this._nextBtn.signals.click.add(this._onNextButton_Click, this);\n            this._panel.addChild(this._nextBtn);\n\n            // Prev button.\n            btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(\"icon_next_off\"), _Common2.default.assets.getTexture(\"icon_next_over\"), _Common2.default.assets.getTexture(\"icon_next_down\"));\n            this._prevBtn = new P3.Button(btnStatesAux);\n            this._prevBtn.anchor = new PIXI.Point(0.5, 0.5);\n            this._prevBtn.scale = new PIXI.Point(-1.5, 1.5);\n            this._prevBtn.defaultScale = new PIXI.Point(-1.5, 1.5);\n            this._prevBtn.position.x = -this._boxSprite.width * 0.5 - 50;\n            this._prevBtn.alpha = 0;\n            this._prevBtn.interactive = false;\n            this._prevBtn.signals.click.add(this._onPrevButton_Click, this);\n            this._panel.addChild(this._prevBtn);\n\n            this.visible = false;\n        }\n    }, {\n        key: \"show\",\n        value: function show(toolType) {\n            this._type = toolType;\n\n            this._arrBtnInfo = this._findItems(this._type);\n\n            this._pageIndex = 0;\n            this._updateNavControls();\n\n            this._createItems(this._arrBtnInfo);\n\n            // Animate-in.\n            this.visible = true;\n            this.alpha = 0;\n            this._panel.y = -50;\n            TweenMax.to(this._panel, 0.25, { y: 0, ease: Quad.easeOut });\n            TweenMax.to(this, 0.25, { alpha: 1, ease: Quad.easeOut });\n\n            // Sfx.\n            _Common2.default.audio.playSound(\"sfx_palette_select_00\");\n        }\n    }, {\n        key: \"changeType\",\n        value: function changeType(toolType) {\n            if (this._type === toolType) return;\n\n            this._type = toolType;\n\n            this._removeItems();\n            this._pageIndex = 0;\n            this._arrBtnInfo = this._findItems(this._type);\n\n            this._updateNavControls();\n\n            this._createItems(this._arrBtnInfo);\n        }\n    }, {\n        key: \"hide\",\n        value: function hide() {\n            // Animate-out.\n            TweenMax.to(this._panel, 0.25, { y: 50, ease: Quad.easeOut });\n            TweenMax.to(this, 0.25, {\n                alpha: 0,\n                ease: Quad.easeOut,\n                onComplete: function onComplete() {\n                    this.visible = false;\n\n                    this._boxSprite.removeChildren();\n\n                    // Tutorial\n                    _Common2.default.game.scene.addTutorialEvent(_CommonGame2.default.TUT_EVENT.PALETTE_PANEL_HIDDEN);\n                },\n                onCompleteScope: this\n            });\n\n            // Sfx.\n            _Common2.default.audio.playSound(\"sfx_palette_close_00\");\n        }\n    }, {\n        key: \"_removeItems\",\n        value: function _removeItems() {\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n                for (var _iterator = this._boxSprite.children[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var menuButton = _step.value;\n\n                    menuButton.interactive = false;\n                    TweenMax.to(menuButton.scale, 0.2, {\n                        x: 0,\n                        y: 0,\n                        ease: Sine.easeIn,\n                        delay: Math.random() * 0.2,\n                        onComplete: function onComplete(menuBtn) {\n                            this._boxSprite.removeChild(menuBtn);\n                        },\n                        onCompleteScope: this,\n                        onCompleteParams: [menuButton]\n                    });\n                }\n            } catch (err) {\n                _didIteratorError = true;\n                _iteratorError = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                        _iterator.return();\n                    }\n                } finally {\n                    if (_didIteratorError) {\n                        throw _iteratorError;\n                    }\n                }\n            }\n        }\n    }, {\n        key: \"_findItems\",\n        value: function _findItems(paletteType) {\n            var result = [];\n\n            var PALETTE_PAGES = _Common2.default.assets.getJSON(\"config\").palettePanel.pages;\n            var arrPageIndex = this.PALETTE_TYPE_TO_TOOL[paletteType];\n\n            var _iteratorNormalCompletion2 = true;\n            var _didIteratorError2 = false;\n            var _iteratorError2 = undefined;\n\n            try {\n                for (var _iterator2 = arrPageIndex[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n                    var pageIndex = _step2.value;\n\n                    result.push([]);\n                    var _iteratorNormalCompletion3 = true;\n                    var _didIteratorError3 = false;\n                    var _iteratorError3 = undefined;\n\n                    try {\n                        for (var _iterator3 = PALETTE_PAGES[pageIndex][Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n                            var item = _step3.value;\n\n                            if (item.indexOf(\"#\") == 0)\n                                // Colour.\n                                result[result.length - 1].push({\n                                    out: \"btns_colour_white\",\n                                    over: \"btns_colour_white\",\n                                    down: \"btns_colour_white\",\n                                    tint: parseInt(\"0x\" + item.substring(1)),\n                                    isShine: true\n                                });else if (item.indexOf(_CommonGame2.default.TEXTURE_SPRITE_BASE_ID) != -1) {\n                                // Texture.\n                                var spriteId = _CommonGame2.default.TEXTURE_BUTTON_BASE_ID + item.substring(item.length - 2);\n                                result[result.length - 1].push({ out: spriteId, over: spriteId, down: spriteId, isShine: true });\n                            } else\n                                // Stamp.\n                                result[result.length - 1].push({ out: item, over: item, down: item, isShine: false });\n                        }\n                    } catch (err) {\n                        _didIteratorError3 = true;\n                        _iteratorError3 = err;\n                    } finally {\n                        try {\n                            if (!_iteratorNormalCompletion3 && _iterator3.return) {\n                                _iterator3.return();\n                            }\n                        } finally {\n                            if (_didIteratorError3) {\n                                throw _iteratorError3;\n                            }\n                        }\n                    }\n                }\n            } catch (err) {\n                _didIteratorError2 = true;\n                _iteratorError2 = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                        _iterator2.return();\n                    }\n                } finally {\n                    if (_didIteratorError2) {\n                        throw _iteratorError2;\n                    }\n                }\n            }\n\n            return result;\n        }\n    }, {\n        key: \"_createItems\",\n        value: function _createItems(arrBtnInfo) {\n            // Create buttons for the selected page.\n            var arrCurPageBtnInfo = this._arrBtnInfo[this._pageIndex];\n            var btnIndex = 0;\n            var colIndex = 0;\n            var rowIndex = 0;\n            var arcHeight = 7;\n            var rowCount = Math.ceil(arrCurPageBtnInfo.length / this.ITEMS_PER_ROW);\n            var startingX = -this._boxSprite.width * 0.5 + (this._boxSprite.width - this._findItemCount(rowIndex, arrCurPageBtnInfo.length) * 135 + 125) * 0.5;\n            var startingY = -this._boxSprite.height * 0.5 + (this._boxSprite.height - (rowCount - 1) * 130) * 0.5;\n            // TODO: Set starting X and Y according to the number of items for the given row and the number of rows.\n            var _iteratorNormalCompletion4 = true;\n            var _didIteratorError4 = false;\n            var _iteratorError4 = undefined;\n\n            try {\n                for (var _iterator4 = arrCurPageBtnInfo[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n                    var btnInfo = _step4.value;\n\n                    var btnStatesAux = new P3.ButtonStates(_Common2.default.assets.getTexture(btnInfo.out), _Common2.default.assets.getTexture(btnInfo.over), _Common2.default.assets.getTexture(btnInfo.down));\n                    var menuButton = new P3.Button(btnStatesAux);\n                    menuButton.tint = btnInfo.tint != null ? btnInfo.tint : 0xffffff;\n                    menuButton.anchor = new PIXI.Point(0.5, 0.5);\n                    menuButton.x = startingX + colIndex * 135;\n                    menuButton.y = startingY + rowIndex * 125;\n                    if (colIndex % 2 != 0) {\n                        menuButton.y += arcHeight;\n                        arcHeight *= -1;\n                    }\n                    menuButton.index = btnIndex;\n                    menuButton.signals.click.addOnce(this._onMenuButton_Click, this);\n                    this._boxSprite.addChild(menuButton);\n\n                    // Shine overlay.\n                    if (btnInfo.isShine) {\n                        var shineOverlay = new PIXI.Sprite(_Common2.default.assets.getTexture(\"btns_colour_overlay\"));\n                        shineOverlay.anchor = new PIXI.Point(0.5, 0.5);\n                        shineOverlay.alpha = 0.4;\n                        shineOverlay.blendMode = PIXI.BLEND_MODES.ADD;\n                        menuButton.addChild(shineOverlay);\n                    }\n\n                    ++btnIndex;\n\n                    ++colIndex;\n                    if (colIndex >= this.ITEMS_PER_ROW) {\n                        colIndex = 0;\n                        ++rowIndex;\n\n                        startingX = -this._boxSprite.width * 0.5 + (this._boxSprite.width - this._findItemCount(rowIndex, arrCurPageBtnInfo.length) * 135 + 125) * 0.5;\n                    }\n\n                    // Animate the button.\n                    menuButton.scale = new PIXI.Point();\n                    TweenMax.to(menuButton.scale, 0.2, { x: 1, y: 1, ease: Sine.easeOut, delay: Math.random() * 0.2 });\n                }\n            } catch (err) {\n                _didIteratorError4 = true;\n                _iteratorError4 = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion4 && _iterator4.return) {\n                        _iterator4.return();\n                    }\n                } finally {\n                    if (_didIteratorError4) {\n                        throw _iteratorError4;\n                    }\n                }\n            }\n        }\n    }, {\n        key: \"_findItemCount\",\n        value: function _findItemCount(rowIndex, btnCount) {\n            var result = 0;\n\n            var remainingBtnCount = btnCount - rowIndex * this.ITEMS_PER_ROW;\n            if (remainingBtnCount / this.ITEMS_PER_ROW >= 1) result = this.ITEMS_PER_ROW;else result = remainingBtnCount % this.ITEMS_PER_ROW;\n\n            return result;\n        }\n    }, {\n        key: \"_updateNavControls\",\n        value: function _updateNavControls() {\n            if (this._prevBtn.alpha === 0) {\n                if (this._pageIndex > 0) {\n                    TweenMax.to(this._prevBtn, 0.25, { alpha: 1, ease: Sine.easeOut });\n                    this._prevBtn.interactive = true;\n                }\n            } else {\n                if (this._pageIndex === 0) {\n                    TweenMax.to(this._prevBtn, 0.25, { alpha: 0, ease: Sine.easeIn });\n                    this._prevBtn.interactive = false;\n                }\n            }\n\n            if (this._nextBtn.alpha === 0) {\n                if (this._pageIndex < this._arrBtnInfo.length - 1) {\n                    TweenMax.to(this._nextBtn, 0.25, { alpha: 1, ease: Sine.easeOut });\n                    this._nextBtn.interactive = true;\n                }\n            } else {\n                if (this._pageIndex === this._arrBtnInfo.length - 1) {\n                    TweenMax.to(this._nextBtn, 0.25, { alpha: 0, ease: Sine.easeIn });\n                    this._nextBtn.interactive = false;\n                }\n            }\n        }\n\n        //----EVENTS----//\n\n    }, {\n        key: \"_onPageIndex_Changed\",\n        value: function _onPageIndex_Changed() {\n            // Navigation controls.\n            this._updateNavControls();\n\n            // Menu buttons.\n            this._removeItems();\n            this._createItems(this._arrBtnInfo);\n        }\n    }, {\n        key: \"_onNextButton_Click\",\n        value: function _onNextButton_Click() {\n            if (this._pageIndex < this._arrBtnInfo.length - 1) {\n                this._pageIndex += 1;\n\n                this._onPageIndex_Changed();\n            }\n        }\n    }, {\n        key: \"_onPrevButton_Click\",\n        value: function _onPrevButton_Click() {\n            if (this._pageIndex > 0) {\n                this._pageIndex -= 1;\n\n                this._onPageIndex_Changed();\n            }\n        }\n    }, {\n        key: \"_onMenuButton_Click\",\n        value: function _onMenuButton_Click(btn) {\n            switch (this._type) {\n                case _CommonGame2.default.TOOL.PENCIL:\n                case _CommonGame2.default.TOOL.BRUSH:\n                case _CommonGame2.default.TOOL.BUCKET:\n                case _CommonGame2.default.TOOL.INK_POT:\n                case _CommonGame2.default.TOOL.SPRAY:\n                    {\n                        this.signals.onColourChanged.dispatch(_Common2.default.assets.getJSON(\"config\").palettePanel.pages[this.PALETTE_TYPE_TO_TOOL[this._type][this._pageIndex]][btn.index], this.PALETTE_TYPE_TO_TOOL[this._type][this._pageIndex], btn.index);\n\n                        break;\n                    }\n\n                case _CommonGame2.default.TOOL.STAMP:\n                    {\n                        this.signals.onStampChanged.dispatch(_Common2.default.assets.getJSON(\"config\").palettePanel.pages[this.PALETTE_TYPE_TO_TOOL[this._type][this._pageIndex]][btn.index], this.PALETTE_TYPE_TO_TOOL[this._type][this._pageIndex], btn.index);\n\n                        break;\n                    }\n            }\n\n            this.hide();\n\n            // Sfx.\n            _Common2.default.audio.playSound(\"sfx_generic_colour_type_change_00\");\n        }\n    }]);\n\n    return PalettePanel;\n}(PIXI.Container);\n\nexports.default = PalettePanel;\n\n},{\"../../Common\":3,\"../../CommonGame\":4}],39:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _Common = require(\"../../Common\");\n\nvar _Common2 = _interopRequireDefault(_Common);\n\nvar _CommonGame = require(\"../../CommonGame\");\n\nvar _CommonGame2 = _interopRequireDefault(_CommonGame);\n\nvar _ConfirmationPanel2 = require(\"./ConfirmationPanel\");\n\nvar _ConfirmationPanel3 = _interopRequireDefault(_ConfirmationPanel2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar TrashConfirmationPanel = function (_ConfirmationPanel) {\n    _inherits(TrashConfirmationPanel, _ConfirmationPanel);\n\n    function TrashConfirmationPanel() {\n        _classCallCheck(this, TrashConfirmationPanel);\n\n        // Attributes.\n        var _this = _possibleConstructorReturn(this, (TrashConfirmationPanel.__proto__ || Object.getPrototypeOf(TrashConfirmationPanel)).call(this));\n\n        _this._canvasContainer = null;\n        _this._trashBgSprite = null;\n        _this._trashFgSprite = null;\n        return _this;\n    }\n\n    _createClass(TrashConfirmationPanel, [{\n        key: \"init\",\n        value: function init() {\n            _get(TrashConfirmationPanel.prototype.__proto__ || Object.getPrototypeOf(TrashConfirmationPanel.prototype), \"init\", this).call(this);\n            //  ConfirmationPanel.prototype.init.call(this);\n            this._messageText.y += 20;\n\n            // Trash bg sprite.\n            this._trashBgSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"icon_replay_bg\"));\n            this._trashBgSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._trashBgSprite.y = this._messageText.y - 150;\n            this._messageSprite.addChild(this._trashBgSprite);\n\n            // Canvas container.\n            this._canvasContainer = new PIXI.Container();\n            this._canvasContainer.anchor = new PIXI.Point(0.5, 0.5);\n            this._canvasContainer.scale = new PIXI.Point(0.11, 0.11);\n            this._canvasContainer.y = this._messageText.y - 250;\n            this._canvasContainer.rotation = Math.PI * 0.5;\n            this._messageSprite.addChild(this._canvasContainer);\n\n            this._canvasContainer.addChild(_CommonGame2.default.createCanvasBg());\n\n            var galleryKey = \"drawing\";\n            if (_CommonGame2.default.selectedGallery === 1) galleryKey = \"colouring\";\n\n            // Border.\n            var borderSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"canvas_\" + galleryKey));\n            borderSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._canvasContainer.addChild(borderSprite);\n            // Sprite.\n            var contentSprite = new PIXI.Sprite(_Common2.default.blankTexture);\n            contentSprite.tint = 0xffffff;\n            contentSprite.width = _CommonGame2.default.CANVAS_WIDTH;\n            contentSprite.height = _CommonGame2.default.CANVAS_HEIGHT;\n            contentSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._canvasContainer.addChild(contentSprite);\n\n            // Trash fg sprite.\n            this._trashFgSprite = new PIXI.Sprite(_Common2.default.assets.getTexture(\"icon_replay_fg\"));\n            this._trashFgSprite.anchor = new PIXI.Point(0.5, 0.5);\n            this._trashFgSprite.x = this._trashBgSprite.x;\n            this._trashFgSprite.y = this._trashBgSprite.y;\n            this._messageSprite.addChild(this._trashFgSprite);\n        }\n    }, {\n        key: \"show\",\n        value: function show(message) {\n            _get(TrashConfirmationPanel.prototype.__proto__ || Object.getPrototypeOf(TrashConfirmationPanel.prototype), \"show\", this).call(this, message);\n\n            this._canvasContainer.y = this._messageText.y - 250;\n            this._canvasContainer.alpha = 1;\n            this._trashFgSprite.scale = new PIXI.Point(1, 1);\n            this._trashBgSprite.scale = new PIXI.Point(1, 1);\n\n            TweenMax.to(this._canvasContainer, 1, {\n                y: this._trashBgSprite.y,\n                ease: Sine.easeOut,\n                repeat: -1,\n                repeatDelay: 0.5,\n                onRepeat: function onRepeat() {\n                    this._canvasContainer.alpha = 1;\n                },\n                onRepeatScope: this\n            });\n            TweenMax.to(this._canvasContainer, 0.5, { alpha: 0, ease: Sine.easeOut, repeat: -1, repeatDelay: 1, delay: 0.5 });\n            TweenMax.fromTo(this._trashBgSprite.scale, 0.5, { x: 0.99, y: 0.99 }, {\n                x: 1,\n                y: 1,\n                ease: Back.easeOut.config(100),\n                repeat: -1,\n                delay: 0.75,\n                repeatDelay: 1\n            });\n            TweenMax.fromTo(this._trashFgSprite.scale, 0.5, { x: 0.99, y: 0.99 }, {\n                x: 1,\n                y: 1,\n                ease: Back.easeOut.config(100),\n                repeat: -1,\n                delay: 0.75,\n                repeatDelay: 1\n            });\n        }\n    }, {\n        key: \"_hide\",\n        value: function _hide() {\n            _get(TrashConfirmationPanel.prototype.__proto__ || Object.getPrototypeOf(TrashConfirmationPanel.prototype), \"_hide\", this).call(this);\n\n            TweenMax.killTweensOf(this._canvasContainer);\n            TweenMax.killTweensOf(this._trashBgSprite.scale);\n            TweenMax.killTweensOf(this._trashFgSprite.scale);\n        }\n    }]);\n\n    return TrashConfirmationPanel;\n}(_ConfirmationPanel3.default);\n\nexports.default = TrashConfirmationPanel;\n\n},{\"../../Common\":3,\"../../CommonGame\":4,\"./ConfirmationPanel\":36}]},{},[25])\n\n","\"use strict\";\n\nimport Common from \"./Common\";\nimport GallerySelectionScene from \"./scenes/GallerySelectionScene\";\nimport ImageSelectionScene from \"./scenes/ImageSelectionScene\";\nimport GameScene from \"./scenes/GameScene\";\nimport MainScene from \"./scenes/MainScene\";\nimport SavedData from \"./SavedData\";\n\n/*\n\n var AudioParams = require(\"./AudioParams\");\n var Common = require(\"./Common\");\n var CommonGame = require(\"./CommonGame\");\n var SavedData = require(\"./SavedData\");\n var MainScene = require(\"./scenes/MainScene\");\n var GameScene = require(\"./scenes/GameScene\");\n var ImageSelectionScene = require(\"./scenes/ImageSelectionScene\");\n var GallerySelectionScene = require(\"./scenes/GallerySelectionScene\");\n */\nexport default class Application {\n    constructor() {\n\n    }\n\n    static init() {\n        Common.assets.texture = Common.assets.texture.bind(Common.assets);\n\n        Application.showMainScene();\n\n        Common.savedData = new SavedData();\n        Common.savedData.init();\n    }\n\n    /**\n     * @returns {Scene}\n     */\n    static showMainScene() {\n\n        Common.paused = false;\n\n        const scene = new MainScene();\n\n        scene.signals.next.add(function () {\n            Application.showGallerySelectionScene();\n        }, this);\n\n        Common.scene.show(scene);\n\n        return scene;\n\n    }\n\n    static showGameScene() {\n\n        const scene = new GameScene();\n\n        scene.signals.next.add(function (scene) {\n            Application.showGameScene();\n        }, this);\n\n        scene.signals.previous.add(function (scene) {\n            Application.showImageSelectionScene();\n        }, this);\n\n        scene.signals.home.add(function (scene) {\n            Application.showMainScene();\n        }, this);\n\n        Common.scene.show(scene);\n\n        return scene;\n    }\n\n    static showImageSelectionScene() {\n\n        const scene = new ImageSelectionScene();\n\n        scene.signals.next.add(function (scene) {\n            Application.showGameScene();\n        }, this);\n\n        scene.signals.previous.add(function (scene) {\n            Application.showGallerySelectionScene();\n        }, this);\n\n        scene.signals.home.add(function (scene) {\n            Application.showMainScene();\n        }, this);\n\n        Common.scene.show(scene);\n\n        return scene;\n    }\n\n    static showGallerySelectionScene() {\n\n        const scene = new GallerySelectionScene();\n\n        scene.signals.next.add(function (scene) {\n            Application.showImageSelectionScene();\n        }, this);\n\n        scene.signals.previous.add(function (scene) {\n            Application.showMainScene();\n        }, this);\n\n        scene.signals.home.add(function (scene) {\n            Application.showMainScene();\n        }, this);\n\n        Common.scene.show(scene);\n\n        return scene;\n    }\n\n}","\"use strict\";\n//import Button from \"./Button\";\nimport Application from \"./Application\";\n\nfunction Common() {\n}\nexport default Common;\n\n//====================================//\n//=====PROJECT SPECIFIC VARIABLES=====//\n//====================================//\n\n/**\n * Wrapper for legacy of jons old happo paint game\n * @type {{assetRes: number}}\n */\nCommon.main = {assetRes: 1};\n\n/**\n * Currently selected intellectual property\n * @type {string}\n */\nCommon.themeIndex = 0;\n\n/**\n * @type {signals.Signal}\n */\nCommon.killGlowSignal = new signals.Signal();\n\n/**\n * @type {signals.Signal}\n */\nCommon.toggleCurrentGlowSignal = new signals.Signal();\n\n/**\n * @param arr\n */\nCommon.buttonsAppear = function (arr) {\n    for (let i = 0; i < arr.length; i++) {\n        arr[i].scale.set(0);\n        TweenMax.to(arr[i].scale, 0.34, {\n            x: 1,\n            y: 1,\n            ease: Back.easeOut,\n            easeParams: [2],\n            delay: i * 0.15 + 0.25\n        });\n    }\n};\n\n//====================================//\n//========PROJECT SPECIFIC END========//\n//====================================//\n\n/**\n * @type {null|P3.AssetManager}\n */\nCommon.assets = null;\n\n/**\n * @type {P3.View}\n */\nCommon.view = null;\n\n/**\n * @type {number}\n */\nCommon.paused = false;\n\n/**\n * @type {boolean}\n */\nCommon.isWebGL = false;\n\n/**\n * @type {boolean}\n */\nCommon.isFirstPlay = true;\n\n/**\n * @type {boolean}\n */\nCommon.isDebug = false;\n\n/**\n * @type {boolean}\n */\nCommon.isMute = false;\n\n//===============//\n//==static vars==//\n//===============//\n\n/**\n * Semi unique key used as an identifier for save files, followed by the version\n * (useful if you want players to start a new game, increment version number)\n * @static\n * @type {string}\n */\nCommon.game_key = \"rozhc7o7-dsn-create-v1.0\";\n\n/**\n * @static\n * @type {AudioManager}\n */\nCommon.audio = null;\n\n/**\n * @static\n * @type {P3.Camera}\n */\nCommon.camera = null;\n\n/**\n * @static\n * @type {number}\n * @const\n */\nCommon.PHYSICS_TICK = 1.0 / 30.0;\n\n/**\n * @static\n * @type {object}\n */\nCommon.copy = null;\n\n/**\n * @static\n * @type {object}\n */\nCommon.config = null;\n\n/**\n * @type {string}\n * @static\n */\nCommon.language = \"\";\n\n/**\n * @static\n * @const\n * @type {number}\n */\nCommon.STAGE_WIDTH = 1664;\n\n/**\n * @static\n * @const\n * @type {number}\n */\nCommon.STAGE_HEIGHT = 768;\n\n/**\n * @static\n * @type {PIXI.Container}\n */\nCommon.stage = null;\n\n/**\n * @static\n * @type {PIXI.CanvasRenderer|PIXI.WebGLRenderer}\n */\nCommon.renderer = null;\n\n//===============//\n//==static ends==//\n//===============//\n\n//================================//\n//=====save and load functions====//\n//================================//\n\nCommon.saveMute = function () {\n    const data = {isMute: Common.isMute};\n    localStorage.setItem(Common.game_key + \"_isMute\", JSON.stringify(data));\n};\n\nCommon.loadMute = function () {\n    const data = JSON.parse(localStorage.getItem(Common.game_key + \"_isMute\"));\n    if (data) {\n        Common.isMute = data.isMute;\n        Common.audio.mute(Common.isMute);\n    }\n};\n\nCommon.saveGame = function () {\n    const gameData = {highestScore: Common.highestScore};\n    localStorage.setItem(Common.game_key, JSON.stringify(gameData));\n};\n\nCommon.loadGame = function () {\n    const gameData = JSON.parse(localStorage.getItem(Common.game_key));\n    if (gameData) {\n        Common.highestScore = gameData.highestScore;\n        Common.isFirstPlay = false;\n    } else {\n        Common.isFirstPlay = true;\n    }\n};\n\n//=========================================================//\n//=============Rest is all util type functions=============//\n//=========================================================//\n\n/**\n * Knuth shuffle variant\n * @param string\n * @returns {string}\n */\nCommon.shuffleString = function (string) {\n    const a = string.split(\"\"); //our array\n    const n = a.length; //number of elements\n    for (var i = n - 1; i > 0; i--) {\n        let j = Math.floor(Math.random() * (i + 1));\n        let tmp = a[i];\n        a[i] = a[j];\n        a[j] = tmp;\n    }\n    return a.join(\"\");\n};\n\n/**\n * Knuth shuffle\n * @param a\n * @returns {*}\n */\nCommon.shuffleArr = function (a) {\n    for (let i = a.length; i; i--) {\n        let j = Math.floor(Math.random() * i);\n        [a[i - 1], a[j]] = [a[j], a[i - 1]];\n    }\n    return a;\n};\n\n/**\n * Generates a random string for use as a semi unique ID for save data\n * @param strLen - Desired length of random string\n * @returns {string}\n */\nCommon.randomID = function (strLen) {\n    strLen = strLen || 8;\n    return Math.random().toString(36).substr(2, strLen);\n};\n\n/**\n * Returns the angle between two points, where 0 is 3 o clock, 90 degrees is 6 o clock, etc.\n * @param x1 {number}\n * @param y1 {number}\n * @param x2 {number}\n * @param y2 {number}\n * @returns {number}\n */\nCommon.angle = function (x1, y1, x2, y2) {\n    var dy = y2 - y1;\n    var dx = x2 - x1;\n    return Math.atan2(dy, dx);\n};\n\n/**\n * @param {number} x1 - Coordinate X of 1st point\n * @param {number} y1 - Coordinate Y of 1st point\n * @param {number} x2 - Coordinate X of 2nd point\n * @param {number} y2 - Coordinate Y of 2nd point\n * @returns {number} distance - Euclidean distance between the two points\n */\nCommon.distance = function (x1, y1, x2, y2) {\n    return Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));\n};\n\n/**\n * @param {number} deg\n * @returns {number} rad\n */\nCommon.deg2rad = function (deg) {\n    return deg * (Math.PI / 180);\n};\n\n/**\n * @param rad\n * @returns {number}\n */\nCommon.rad2deg = function (rad) {\n    return rad * 180 / Math.PI; // rads to degs, range (-180, 180]\n};\n\n/**\n * Returns a new keyboard object that listens for keyboard input\n * @param keyCode\n * @returns {{}}\n */\nCommon.keyboard = function (keyCode) {\n    var key = {};\n    key.code = keyCode;\n    key.isDown = false;\n    key.isUp = true;\n    key.down = undefined;\n    key.up = undefined;\n    //The `downHandler`\n    key.downHandler = function (event) {\n        if (event.keyCode === key.code) {\n            if (key.isUp && key.down) key.down();\n            key.isDown = true;\n            key.isUp = false;\n        }\n        event.preventDefault();\n    };\n\n    //The `upHandler`\n    key.upHandler = function (event) {\n        if (event.keyCode === key.code) {\n            if (key.isDown && key.up) key.up();\n            key.isDown = false;\n            key.isUp = true;\n        }\n        event.preventDefault();\n    };\n\n    //Attach event listeners\n    window.addEventListener(\n        \"keydown\", key.downHandler.bind(key), false\n    );\n    window.addEventListener(\n        \"keyup\", key.upHandler.bind(key), false\n    );\n    return key;\n};\n\n/**\n * @param width\n * @param height\n * @param colour\n * @param shape\n * @returns {Texture}\n */\nCommon.genTex = function (width, height, colour, shape) {\n    let g = new PIXI.Graphics();\n    if (colour) g.beginFill(colour);\n    else g.beginFill(0x000fff);\n    if (shape === \"rect\") g.drawRect(0, 0, width, height);\n    else if (shape === \"circle\") g.drawEllipse(0, 0, width, height);\n    else g.drawRect(0, 0, width, height);//fallback to rect\n    g.endFill();\n    return Common.renderer.generateTexture(g);\n};\n\n/**\n * Returns a new sprite that uses a texture generated using pixi graphics, mostly for debug and prototyping etc.\n * @param width\n * @param height\n * @param colour\n * @param retTexture - should we return a texture or a sprite?\n * @returns {PIXI.Sprite|String}\n */\nCommon.generateRect = function (width, height, colour, retTexture) {\n    let g = new PIXI.Graphics();\n    if (colour) g.beginFill(colour);\n    else g.beginFill(0x000fff);\n    g.lineStyle(5, 0xd9d9d9);\n    g.drawRect(0, 0, width, height);\n    g.endFill();\n    let texture = Common.renderer.generateTexture(g);\n    let sprite = new PIXI.Sprite(texture);\n    sprite.anchor = {x: 0.5, y: 0.5};\n    g.destroy();\n    if (!retTexture) return sprite;\n    sprite.destroy();\n    return texture;\n};\n\n/**\n * Returns a new sprite that uses a texture generated using pixi graphics, mostly for debug and prototyping etc.\n * @param width\n * @param height\n * @param colour\n * @param retTexture - Should we return a texture or a sprite?\n * @returns {PIXI.Sprite|PIXI.Texture}\n */\nCommon.generateEllipse = function (width, height, colour, retTexture) {\n    let g = new PIXI.Graphics();\n    if (colour) g.beginFill(colour);\n    else g.beginFill(0xfff000);\n    g.drawEllipse(0, 0, width, height);\n    g.endFill();\n    let texture = Common.renderer.generateTexture(g);\n    let sprite = new PIXI.Sprite(texture);\n    sprite.anchor.set(0.5);\n    g.destroy();\n    if (!retTexture) return sprite;\n    else return texture;\n};\n\n/**\n * Centres all sprites passed to it\n * @param sprite\n */\nCommon.centreAnchor = function (sprite) {\n    for (let i = 0; i < arguments.length; i++) arguments[i].anchor.set(0.5);\n};\n\n/**\n * Returns a matrix of defined size with optional initial values\n * @param {number} numRows - Number rows in matrix\n * @param {number} numCols - Number of columns in matrix\n * @param initial - Optional initial value\n * @returns {Array}\n */\nCommon.matrix = function (numRows, numCols, initial) {\n    const arr = [];\n    for (let i = 0; i < numRows; i++) {\n        const columns = [];\n        for (let j = 0; j < numCols; j++) columns[j] = initial;\n        arr[i] = columns;\n    }\n    return arr;\n};\n\n/**\n * Returns array of defined size with optional initial values\n * @param {number} size\n * @param initial\n * @returns {Array}\n */\nCommon.array = function (size, initial) {\n    const arr = [];\n    for (let i = 0; i < size; i++) arr.push(initial);\n    return arr;\n};\n\n/**\n * Uses quick sort to sort an array, with optional flag to sort high to low\n * @param array\n * @param highToLow\n * @returns {*}\n */\nCommon.sort = function (array, highToLow) {\n    const size = array.length - 1;\n    quickSort(0, size);\n    return array;\n\n    function quickSort(first, last) {\n\n        if (first < last) {\n            const pivotIndex = partition();\n            quickSort(first, pivotIndex - 1);\n            quickSort(pivotIndex + 1, last);\n        }\n\n        function swap(p, q) {\n            const temp = array[p];\n            array[p] = array[q];\n            array[q] = temp;\n        }\n\n        function partition() {\n            let pivot = array[first], index = first;\n            swap(index, last);\n            for (let i = first; i < last; i++) {\n                if (!highToLow && array[i] < pivot) swap(index++, i);\n                else if (highToLow && array[i] > pivot)swap(index++, i);\n            }\n            swap(index, last);\n            return index;\n        }\n    }\n};\n\n/**\n * Sorts tiles (or any display object) by x, y coordinates so they are ordered lowest top to bottom , left to right\n * @param array\n * @returns {*}\n */\nCommon.sortTiles = function (array) {\n    array.sort(function (a, b) {\n        if (a.y == b.y) return a.x - b.x;\n        else return a.y - b.y;\n    });\n    return array;\n};\n\n/**\n * Sorts object with an x or y property (such as sprites) by x or y dependant on flag\n * @param array - array to sort\n * @param highToLow - sort high to low?\n * @param sortX - flag to choose whether to sort by x or y\n * @returns {*}\n */\nCommon.sortBy = (array, highToLow, sortX) => {\n\n    const size = array.length - 1;\n    quickSort(0, size);\n    return array;\n\n    function quickSort(first, last) {\n        if (first < last) {\n            const pivotIndex = partition();\n            quickSort(first, pivotIndex - 1);\n            quickSort(pivotIndex + 1, last);\n        }\n        function swap(p, q) {\n            const temp = array[p];\n            array[p] = array[q];\n            array[q] = temp;\n        }\n\n        function partition() {\n            let pivot = array[first], index = first;\n            swap(index, last);\n            for (let i = first; i < last; i++) {\n                if (!highToLow) {\n                    if (x) {\n                        if (array[i].x < pivot.x) swap(index++, i);\n                    } else {\n                        if (array[i].y < pivot.y) swap(index++, i);\n                    }\n                }\n                else {\n                    if (x) {\n                        if (array[i].x > pivot.x) swap(index++, i);\n                    } else {\n                        if (array[i].y > pivot.y) swap(index++, i);\n                    }\n                }\n            }\n            swap(index, last);\n            return index;\n        }\n    }\n};\n\n/**\n * Sorts object with a distance property\n * @param array - array to sort\n * @param highToLow - sort high to low?\n * @returns {*}\n */\nCommon.sortDistances = (array, highToLow) => {\n\n    highToLow = highToLow || false;\n\n    const size = array.length - 1;\n    quickSort(0, size);\n    return array;\n\n    function quickSort(first, last) {\n        if (first < last) {\n            const pivotIndex = partition();\n            quickSort(first, pivotIndex - 1);\n            quickSort(pivotIndex + 1, last);\n        }\n        function swap(p, q) {\n            const temp = array[p];\n            array[p] = array[q];\n            array[q] = temp;\n        }\n\n        function partition() {\n            let pivot = array[first], index = first;\n            swap(index, last);\n            for (let i = first; i < last; i++) {\n                if (!highToLow) {\n                    if (array[i].distance < pivot.x) swap(index++, i);\n                }\n                else {\n                    if (array[i].distance > pivot.distance) swap(index++, i);\n                }\n            }\n            swap(index, last);\n            return index;\n        }\n    }\n};\n\nCommon.compareXY = function (point1, point2) {\n    return (Math.round(point1.x) === Math.round(point2.x) && Math.round(point1.y) === Math.round(point2.y));\n};\n\nCommon.lerpAxis = function (start, end, percent) {\n    return ((end - start) * percent) + start;\n};\n\nCommon.lerpVector = function (start, end, percent) {\n    return Common.Vector.add((Common.Vector.scale((Common.Vector.sub(start, end)), percent)), start);\n};\n\nCommon.Vector = {\n    add: (a, b)=> {\n        if (a.x === undefined || b.x === undefined) throw new Error('Vector.add() must be passed a pair of vectors');\n        return {x: a.x + b.x, y: a.y + b.y};\n    },\n    sub: (a, b)=> {\n        if (a.x === undefined || b.x === undefined) throw new Error('Vector.sub() must be passed a pair of vectors');\n        return {x: a.x - b.x, y: a.y - b.y};\n    },\n    mult: (a, b)=> {\n        if (a.x === undefined || b.x === undefined) throw new Error('Vector.mult() must be passed a pair of vectors');\n        return {x: a.x * b.x, y: a.y * b.y};\n    },\n    div: (a, b)=> {\n        if (a.x === undefined || b.x === undefined) throw new Error('Vector.div() must be passed a pair of vectors');\n        return {x: a.x / b.x, y: a.y / b.y};\n    },\n    scale: (a, scalePerc)=> {\n        if (a.x === undefined) throw new Error('Vector.scale() must be passed a vector for first arg');\n        return {x: a.x * scalePerc, y: a.y * scalePerc};\n    }\n};\n\nCommon.lookAt = function (sprite, target, update) {\n    const rotation = (Math.atan2(target.y - sprite.y, target.x - sprite.x));\n    if (update) sprite.rotation = rotation;\n    return rotation;\n};\n\n//--from stackoverflow-- https://stackoverflow.com/questions/14962018/detecting-and-fixing-circular-references-in-javascript //\nCommon.detectCircularRef = function (obj) {\n\n    return detectCircularReferences(obj);\n\n    function detectCircularReferences(toBeStringifiedValue, serializationKeyStack = []) {\n        Object.keys(toBeStringifiedValue).forEach(key => {\n            var value = toBeStringifiedValue[key];\n            var serializationKeyStackWithNewKey = serializationKeyStack.slice();\n            serializationKeyStackWithNewKey.push(key);\n            try {\n                JSON.stringify(value);\n            }\n            catch (error) {\n                var isCircularValue;\n                var circularExcludingStringifyResult = \"\";\n                try {\n                    circularExcludingStringifyResult = JSON.stringify(value, replaceRootStringifyReplacer(value), 2);\n                    isCircularValue = true;\n                }\n                catch (error) {\n                    detectCircularReferences(value, serializationKeyStackWithNewKey);\n                    isCircularValue = false;\n                }\n                if (isCircularValue) {\n                    throw new Error(`Circular reference detected:\\nCircularly referenced value is value under path \"${joinStrings(serializationKeyStackWithNewKey)}\" of the given root object\\n` +\n                        `Calling stringify on this value but replacing itself with [Circular object --- fix me] ( <-- search for this string) results in:\\n${circularExcludingStringifyResult}\\n`);\n                }\n            }\n        });\n    }\n\n    function replaceRootStringifyReplacer(toBeStringifiedValue) {\n        var serializedObjectCounter = 0;\n        return function (key, value) {\n            if (serializedObjectCounter !== 0 && typeof (toBeStringifiedValue) === 'object' && toBeStringifiedValue === value) {\n                return '[Circular object --- fix me]';\n            }\n            serializedObjectCounter++;\n            return value;\n        };\n    }\n\n    function joinStrings(arr, separator = \":\") {\n        if (arr.length === 0)\n            return \"\";\n        return arr.reduce((v1, v2) => `${v1}${separator}${v2}`);\n    }\n};\n\n//from github pixi-simple-gestures\nCommon.pinchable = function (sprite, inertia) {\n\n    sprite.interactive = true;\n    sprite.on('touchstart', start);\n    sprite.on('touchend', end);\n    sprite.on('touchendoutside', end);\n\n    function start(e) {\n        sprite.on('touchmove', move)\n    }\n\n    function move(e) {\n        let t = e.data.originalEvent.targetTouches;\n        if (!t || t.length < 2) {\n            return\n        }\n        let dx = t[0].clientX - t[1].clientX;\n        let dy = t[0].clientY - t[1].clientY;\n        let distance = Math.sqrt(dx * dx + dy * dy);\n        if (!sprite._pinch) {\n            sprite._pinch = {\n                p: {\n                    distance: distance,\n                    date: new Date()\n                }\n            };\n            sprite.emit('pinchstart');\n            return\n        }\n        let now = new Date();\n        let interval = now - sprite._pinch.p.date;\n        if (interval < 12) {\n            return\n        }\n        let center = {\n            x: (t[0].clientX + t[1].clientX) / 2,\n            y: (t[0].clientY + t[1].clientY) / 2\n        };\n        let event = {\n            scale: distance / sprite._pinch.p.distance,\n            velocity: distance / interval,\n            center: center,\n            data: e.data\n        };\n        sprite.emit('pinchmove', event);\n        sprite._pinch.pp = {\n            distance: sprite._pinch.p.distance,\n            date: sprite._pinch.p.date\n        };\n        sprite._pinch.p = {\n            distance: distance,\n            date: now\n        }\n    }\n\n    function end(e) {\n        sprite.removeListener('touchmove', move);\n        if (!sprite._pinch) {\n            return\n        }\n        if (inertia && sprite._pinch.pp) {\n            if (sprite._pinch.intervalId) {\n                return\n            }\n            let interval = new Date() - sprite._pinch.p.date;\n            let velocity = (sprite._pinch.p.distance - sprite._pinch.pp.distance) / interval;\n            let center = sprite._pinch.p.center;\n            let distance = sprite._pinch.p.distance;\n            sprite._pinch.intervalId = setInterval(() => {\n                if (Math.abs(velocity) < 0.04) {\n                    clearInterval(sprite._pinch.intervalId);\n                    sprite.emit('pinchend');\n                    sprite._pinch = null;\n                    return\n                }\n                let updatedDistance = distance + velocity * 12;\n                let event = {\n                    scale: updatedDistance / distance,\n                    velocity: velocity,\n                    center: center,\n                    data: e.data\n                };\n                sprite.emit('pinchmove', event);\n                distance = updatedDistance;\n                velocity *= 0.8;\n            }, 12)\n        } else {\n            sprite.emit('pinchend');\n            sprite._pinch = null\n        }\n    }\n};\n\n//from https://stackoverflow.com/questions/7184573/pick-up-the-android-version-in-the-browser-by-javascript\nCommon.getAndroidVersion = function (ua) {\n    ua = (ua || navigator.userAgent).toLowerCase();\n    const match = ua.match(/android\\s([0-9\\.]*)/);\n    return match ? match[1] : false;\n};\n\n/**\n * Custom tween\n * @param obj\n * @param time\n * @param params\n * @returns {TweenLite|TweenMax|TimelineLite|*}\n */\nCommon.erraticTween = function (obj, time, params = {delay: 0}) {\n    params.ease = CustomEase.create(\"custom\", \"M0,0,C0,0,0.065,0.167,0.08,0.205,0.09,0.2,0.124,0.182,0.135,0.176,0.157,0.223,0.21,0.59,0.22,0.608,0.223,0.585,0.298,0.12,0.3,0.111,0.3,0.118,0.309,0.262,0.315,0.345,0.322,0.36,0.325,0.372,0.335,0.388,0.352,0.417,0.372,0.439,0.39,0.463,0.391,0.502,0.394,0.58,0.395,0.583,0.396,0.578,0.418,0.461,0.43,0.399,0.431,0.397,0.463,0.611,0.464,0.61,0.475,0.621,0.488,0.448,0.495,0.455,0.495,0.449,0.498,0.417,0.5,0.404,0.512,0.401,0.562,0.262,0.572,0.26,0.577,0.293,0.568,0.499,0.58,0.568,0.597,0.639,0.603,0.787,0.608,0.806,0.616,0.794,0.698,0.64,0.705,0.63,0.705,0.638,0.708,0.685,0.71,0.72,0.711,0.734,0.713,0.745,0.715,0.756,0.719,0.759,0.737,0.781,0.742,0.784,0.746,0.83,0.743,0.912,0.745,0.925,0.756,0.907,0.863,0.732,0.88,0.705,0.894,0.741,1,1,1,1\");\n    return TweenMax.to(obj, time, params);\n};\n\n/**\n * Dijkstra implementation of a path finder. Prefer this over A* if you have multiple agents with same starting position\n * and you are using a weighted graph. For non weighted graphics use BFS. For a single agent with a known single target destination use A*.\n * Or alternatively if you are unsure what your target is you can calc the path to all nodes, and then just retrieve the path to the target\n * node once you know it which could be useful depending on use case.\n *\n * @class\n */\nclass Dijkstra {\n    constructor() {\n        /**\n         * @type {null}\n         * @private\n         */\n        this._graph = null;\n\n        /**\n         * @type {null}\n         * @private\n         */\n        this._source = null;\n\n        //todo - add findPath() function which terminates when u === v\n        /**\n         * @type {null}\n         * @private\n         */\n        this._target = null;//note we may want to target if we only have one agent, but A* is probably better for this case so prefer that if you don't need to guarantee the shortest path\n\n        /**\n         * Vertex set Q\n         * @type {Array}\n         * @private\n         */\n        this._verts = [];\n\n        /**\n         * @type {null}\n         * @private\n         */\n        this._paths = null;\n    }\n\n    init() {\n\n        if (!this._graph) throw new Error('must set graph before init');\n        if (!this._source) throw new Error('must set source before init');\n\n        //--create vertex set Q--//\n        for (let x = 0; x < this._graph.length; x++) {\n            for (let y = 0; y < this._graph[x].length; y++) {\n                // All nodes initially in Q (unvisited nodes)\n                const vert = this._graph[x][y];\n\n                vert.distance = Number.POSITIVE_INFINITY;\n                vert.prev = null;\n                vert.neighbours = [];\n\n                if (x > 0) vert.neighbours.push(this._graph[x - 1][y]);//grid sq left\n                if (x < this._graph.length - 1) vert.neighbours.push(this._graph[x + 1][y]);//grid sq right\n                if (y > 0)vert.neighbours.push(this._graph[x][y - 1]);//grid sq above\n                if (y < this._graph[x].length - 1)vert.neighbours.push(this._graph[x][y + 1]);//grid sq below\n\n                this._verts.push(vert);\n            }\n        }\n        let s = this._source;\n        this._verts[this._graph.length * s.x + s.y].distance = 0;//set source to source distance as zero (ensures this is first in our list becaue it has the lowest dist)\n    }\n\n    findPaths() {\n\n        const descending = (a, b) => b.distance - a.distance;//descending sort function\n\n        const paths = [];\n\n        while (this._verts.length > 0) {\n\n            //TODO can we take the sort out for optimisation?\n\n            //--find node with least dist by sorting--//\n            // this._verts = Common.sortDistances(this._verts, true);   //highToLow\n            this._verts.sort(descending); //way outperforms my quick sort function (100 to 300 percent quicker)\n\n            const u = this._verts[this._verts.length - 1];//take last element which is the one with the shortest distance\n\n            this._verts.pop();//remove u from vert list (Q)\n\n            //--for each neighbour v of u--//\n            for (let i = 0; i < u.neighbours.length; i++) {\n                const v = u.neighbours[i];\n                const sourceToV = u.distance + Common.distance(u.x, u.y, v.x, v.y);\n                if (sourceToV < v.distance) {\n                    //we found a new shortest distance to this node v\n                    v.distance = sourceToV;//store dist\n                    v.prev = u;//store prev node\n\n                    paths.push(v);\n                }\n            }\n        }\n\n        this._paths = paths;\n\n        return paths;\n    }\n\n    /**\n     * Fetches the path from the this._paths pre calculated paths to all nodes\n     * @param pos\n     */\n    retrievePathTo(pos) {\n        let node;\n        for (let i = 0; i < this._paths.length; i++) {\n            if (Common.compareXY(pos, this._paths[i])) {\n                node = this._paths[i];\n            }\n        }\n\n        if (!node) {\n            throw new Error(\"can't retrieve path, position not on graph\");\n        }\n\n        const path = [];\n\n        //--trace back to start node to create the path--//\n        var recurse = ()=> {   //using a little recursive function to trace the path backwards\n            path.push({x: node.x, y: node.y});\n            if (node.prev) {\n                node = node.prev;\n                recurse();\n            }\n        };\n        recurse();\n\n        return path;\n    }\n\n    reset() {\n        this.init();\n    }\n\n    test(scene) {\n\n        const tWid = 50;\n        const holder = new PIXI.Container();\n        const gridSize = 15;\n        const graph = Common.matrix(gridSize, gridSize);\n        holder.x = Common.STAGE_WIDTH * 0.5 - tWid * (gridSize * 0.5);\n        scene.addChild(holder);\n\n        for (let x = 0; x < gridSize; x++) {\n            for (let y = 0; y < gridSize; y++) {\n\n                let sp = P3.createSprite(PIXI.Texture.WHITE, holder);\n                sp.x = x * tWid;\n                sp.y = y * tWid;\n\n                sp.width = tWid - 2;\n                sp.height = tWid - 2;\n\n                sp.tint = 0xD8D8D8;\n\n                graph[x][y] = {x: x, y: y};//grid should be stored as int and we will multiply out to get tile pos\n            }\n        }\n\n        this.graph = graph;\n        this.source = graph[0][0]; //set source to be top left\n\n        let t0 = performance.now();\n        this.init();\n        const paths = this.findPaths();\n        let t1 = performance.now();\n        console.warn(\"found paths in : \" + (t1 - t0));\n\n        const path = this.retrievePathTo({x: gridSize - 1, y: gridSize - 1}); //retrieve path to bottom right\n\n        console.log(paths);\n        console.log(path);\n\n        let sp = P3.createSprite(PIXI.Texture.WHITE, holder);\n        sp.anchor.set(0.5);\n        sp.position.set(graph[0][0].x, graph[0][0].y);\n        sp.width = tWid * 0.5;\n        sp.height = tWid * 0.5;\n\n        followPath(sp, tWid, path);\n\n        function followPath(sprite, tWid, path) {\n            let node = path[path.length - 1];\n            TweenMax.to(sprite, 0.5, {\n                x: node.x * tWid,\n                y: node.y * tWid + tWid * 0.5,\n                ease: Power0.easeNone,\n                onComplete: ()=> {\n                    path.pop();\n                    if (path.length > 0) followPath(sprite, tWid, path);\n                }\n            })\n        }\n    }\n\n    set graph(value) {\n        this._graph = value;\n    }\n\n    set source(value) {\n        this._source = value;\n    }\n\n    set target(value) {\n        this._target = value;\n    }\n}\nCommon.PathD = new Dijkstra();\n\n/**\n * Best performing path finding algorithm in cases where node distances are all the same (unweighted graph / grid).\n * Could be adapted to use without a target in which case it will find path to every node,\n * a possible use for this could be enemies in an RTS game.\n * @class\n */\nclass BreadthFirst {\n    constructor() {\n        /**\n         * @type {null}\n         * @private\n         */\n        this._graph = null;\n\n        /**\n         * @type {null}\n         * @private\n         */\n        this._source = null;\n\n        /**\n         * @type {null}\n         * @private\n         */\n        this._target = null;\n\n        /**\n         * List of nodes currently being explored\n         * @type {Array}\n         * @private\n         */\n        this._openList = [];\n    }\n\n    init() {\n\n        if (!this._graph) throw new Error('must set graph before init');\n        if (!this._source) throw new Error('must set source before init');\n\n        let startNode;\n\n        for (let x = 0; x < this._graph.length; x++) {\n            for (let y = 0; y < this._graph[x].length; y++) {\n                let vert = this._graph[x][y];\n\n                vert.neighbours = [];\n                vert.prev = null;\n\n                if (x > 0) vert.neighbours.push(this._graph[x - 1][y]);//grid sq left\n                if (x < this._graph.length - 1) vert.neighbours.push(this._graph[x + 1][y]);//grid sq right\n                if (y > 0)vert.neighbours.push(this._graph[x][y - 1]);//grid sq above\n                if (y < this._graph[x].length - 1)vert.neighbours.push(this._graph[x][y + 1]);//grid sq below\n\n                if (Common.compareXY({x: x, y: y}, this._source)) {//if node is source node we can immediately mark as visited\n                    vert.visited = true;\n                    startNode = vert;\n                }\n            }\n        }\n\n        //--we want the list to be fifo--//\n        this._openList.reverse();\n        this._openList.push(startNode);\n\n    }\n\n    find() {\n\n        /*\n         -PSUEDOCODE-\n         unmark all vertices\n         choose some starting vertex x\n         mark x\n         list L = x\n         tree T = x\n         while L nonempty\n         choose some vertex u from front of list\n         visit u\n         for each unmarked neighbor v\n         mark v\n         add it to end of list\n         add edge uv to T\n         */\n\n        if (!this._target) throw new Error('must set target before performing BFS');\n\n        let endNode;\n\n        let arr = [];\n        while (this._openList.length > 0) {\n            const u = this._openList[this._openList.length - 1];//get our first vertex\n            this._openList.pop();\n            u.visited = true;//mark as visited\n\n            if (Common.compareXY(u, this._target)) {\n                console.warn(\"found target\");\n                endNode = u;\n                break;\n            }\n\n            for (let i = 0; i < u.neighbours.length; i++) {\n                const v = u.neighbours[i];\n                if (!v.visited) {\n                    v.visited = true;\n                    v.prev = u;\n\n                    this._openList.unshift(v);//fifo\n\n                    const edge = {start: u, end: v};\n                    arr.push(edge);\n                }\n            }\n        }\n\n        // console.log(this._closedList);\n\n        // console.log(arr);\n\n        let path = [];\n\n        let node = endNode;\n        //--trace back to start node to create the path--//\n        var recurse = ()=> {   //using a little recursive function to trace the path backwards\n            path.push({x: node.x, y: node.y});\n            if (node.prev) {\n                node = node.prev;\n                recurse();\n            }\n        };\n        recurse();\n\n\n        return path;\n    }\n\n    test(scene) {\n\n        const tWid = 25;\n        const holder = new PIXI.Container();\n        const gridSize = 25;\n        const graph = Common.matrix(gridSize, gridSize);\n        holder.x = Common.STAGE_WIDTH * 0.5 - tWid * (gridSize * 0.5);\n        scene.addChild(holder);\n\n        for (let x = 0; x < gridSize; x++) {\n            for (let y = 0; y < gridSize; y++) {\n\n                let sp = P3.createSprite(PIXI.Texture.WHITE, holder);\n                sp.x = x * tWid;\n                sp.y = y * tWid;\n\n                sp.width = tWid - 2;\n                sp.height = tWid - 2;\n\n                sp.tint = 0xD8D8D8;\n\n                graph[x][y] = {x: x, y: y};//grid should be stored as int and we will multiply out to get tile pos\n            }\n        }\n\n        this.graph = graph;\n        this.source = graph[0][0]; //set source to be top left\n        this.target = {x: gridSize - 1, y: gridSize - 1};\n\n        let t0 = performance.now();\n        this.init();\n        const path = this.find();\n        let t1 = performance.now();\n        console.warn(\"found paths in : \" + (t1 - t0));\n\n        // const path = Common.Path.retrievePathTo({x: gridSize - 1, y: gridSize - 1}); //retrieve path to bottom right\n\n        // return;\n        //  console.log(paths);\n        console.log(path);\n\n        let sp = P3.createSprite(PIXI.Texture.WHITE, holder);\n        sp.anchor.set(0.5);\n        sp.position.set(graph[0][0].x, graph[0][0].y);\n        sp.width = tWid * 0.5;\n        sp.height = tWid * 0.5;\n\n        followPath(sp, tWid, path);\n\n        function followPath(sprite, tWid, path) {\n            let node = path[path.length - 1];\n            TweenMax.to(sprite, 0.5, {\n                x: node.x * tWid,\n                y: node.y * tWid + tWid * 0.5,\n                ease: Power0.easeNone,\n                onComplete: ()=> {\n                    path.pop();\n                    if (path.length > 0) followPath(sprite, tWid, path);\n                }\n            })\n        }\n    }\n\n    set graph(value) {\n        this._graph = value;\n    }\n\n    set source(value) {\n        this._source = value;\n    }\n\n    set target(value) {\n        this._target = value;\n    }\n}\nCommon.PathBFS = new BreadthFirst();\n\n//===================================================\n//\n// Jon's Methods\n//\n//===================================================\n\n/**\n * @type {boolean}\n * @static\n */\nCommon.randBool = function () {\n    return Math.random() > 0.5;\n};\n\n/**\n * @type {boolean}\n * @static\n */\nCommon.toOneDecimalStr = function (a) {\n    var result = a.toFixed(1);\n    if (result[result.indexOf(\".\") + 1] == \"0\")\n        result = result.substr(0, result.indexOf(\".\"));\n\n    return result;\n};\n\n/**\n * @type {number}\n * @static\n */\nCommon.randomInt = function (min, max) {\n    return Math.floor(Math.random() * ( max - min + 1 ) + min);\n};\n\n/**\n * @type {Array<object>}\n * @static\n */\nCommon.heapPermutations = function (arrElement) {\n    var arr = arrElement.slice();\n    var permutations = [];\n\n    function swap(a, b) {\n        var tmp = arr[a];\n        arr[a] = arr[b];\n        arr[b] = tmp;\n    }\n\n    function generate(n) {\n        if (n == 1)\n            permutations.push(arr.slice());\n        else {\n            for (var i = 0; i != n; ++i) {\n                generate(n - 1);\n                swap(n % 2 ? 0 : i, n - 1);\n            }\n        }\n    }\n\n    generate(arr.length);\n\n    return permutations;\n};\n\n/**\n * @returns Number\n */\nCommon.getScreenPositionLeft = function () {\n    return Math.max(0, Common.STAGE_WIDTH * 0.5 - P3.View.width * 0.5);\n};\n\n/**\n * @returns Number\n */\nCommon.getScreenPositionRight = function () {\n    return Math.min(Common.STAGE_WIDTH, Common.STAGE_WIDTH * 0.5 + P3.View.width * 0.5);\n};\n\nCommon.distanceBetween = function (point1, point2) {\n    return Math.sqrt(Math.pow(point2.x - point1.x, 2) + Math.pow(point2.y - point1.y, 2));\n};\n\nCommon.angleBetween = function (point1, point2) {\n    return Math.atan2(point2.x - point1.x, point2.y - point1.y);\n};\n\nCommon.randomFloat = function (min, max) {\n    return Math.random() * ( max - min ) + min;\n};\n\nCommon.midPointBtw = function (p1, p2) {\n    return {\n        x: p1.x + ( p2.x - p1.x ) / 2,\n        y: p1.y + ( p2.y - p1.y ) / 2\n    };\n};\n\nCommon.hexToRgb = function (hex) {\n    var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n\n    return result ? {\n        r: parseInt(result[1], 16),\n        g: parseInt(result[2], 16),\n        b: parseInt(result[3], 16)\n    } : null;\n};\n\n/**\n * @type {number}\n * @static\n */\nCommon.findPositionInScene = function (sprite, scene) {\n    var result = new PIXI.Point(sprite.x, sprite.y);\n\n    var parent = sprite.parent;\n    while (parent != scene) {\n        result.x += parent.x;\n        result.y += parent.y;\n\n        parent = parent.parent;\n    }\n\n    return result;\n};\n\nwindow.Common = Common;","\"use strict\";\n\nimport Common from \"./Common\";\n\nfunction CommonGame() {\n}\nexport default CommonGame;\n\n//===================================================\n//\n// Enumerators\n//\n//===================================================\n\n// Scene types.\nCommonGame.SCENE_ID_MAIN = 0;\nCommonGame.SCENE_ID_GAME = 1;\nCommonGame.SCENE_ID_IMAGE_SELECTION = 2;\nCommonGame.SCENE_ID_GALLERY_SELECTION = 3;\n\n// Layer types.\nCommonGame.LAYER_ID_FILL = 0;\nCommonGame.LAYER_ID_DRAW = 1;\n\n// Gallery types.\nCommonGame.GALLERY_ID_DRAW_IT = 0;\nCommonGame.GALLERY_ID_COLOUR_IT = 1;\n\nCommonGame.ARR_COLOUR_IT_SPRITE_ID = [\n    \"colour_image_1\",\n    \"colour_image_2\",\n    \"colour_image_3\",\n    \"colour_image_4\",\n    \"colour_image_5\",\n    \"colour_image_6\",\n    \"colour_image_7\",\n    \"colour_image_8\",\n    \"colour_image_9\",\n    \"colour_image_10\"\n];\n\nCommonGame.ARR_DRAW_IT_SPRITE_ID = [\n    \"draw_image_1\",\n    \"draw_image_2\",\n    \"draw_image_3\",\n    \"draw_image_4\",\n    \"draw_image_5\",\n    \"draw_image_6\",\n    \"draw_image_7_\",\n    \"draw_image_8\",\n    \"draw_image_9\",\n    \"draw_image_10\"\n];\n\nCommonGame.TUT_EVENT = {\n    TOOL_BAR_HIDDEN: 0,\n    TOOL_BAR_VISIBLE: 1,\n    PALETTE_SELECTED: 2,\n    PALETTE_PANEL_HIDDEN: 3,\n    TOOL_SELECTED: 4,\n    CANVAS_DRAWN: 5,\n    CANVAS_VISIBLE: 6,\n    PALETTE_BUTTON_ENABLED: 7,\n    PALETTE_BUTTON_DISABLED: 8,\n    MENU_PANEL_SHOWN: 9,\n    MENU_PANEL_HIDDEN: 10\n};\n\nCommonGame.TOOL =\n{\n    PENCIL: 0,\n    BRUSH: 1,\n    STAMP: 2,\n    BUCKET: 3,\n    INK_POT: 4,\n    SPRAY: 5,\n    ERASER: 6\n};\n\n\n//===================================================\n//\n// Constants\n//\n//===================================================\n\nCommonGame.GALLERY_BORDER_TINT = [\n    0x87d027, // Draw it!\n    0x1e84c9 // Colour it!\n];\n\nCommonGame.TEXTURE_BUTTON_BASE_ID = \"btns_colour_texture\";\nCommonGame.TEXTURE_SPRITE_BASE_ID = \"texture_fill\";\n\nCommonGame.CANVAS_HEIGHT = 612;\nCommonGame.CANVAS_WIDTH = 870;\n\n\n//===================================================\n//\n// Attributes\n//\n//===================================================\n\nCommonGame.selectedGallery = null;\nCommonGame.selectedImageId = null;\nCommonGame.drawItTextId = null;\n\n//===================================================\n//\n// Methods\n//\n//===================================================\n\nCommonGame.createCanvasBg = function () {\n    var SCALE_FACTOR = 0.979;\n\n    let galleryKey = \"drawing\";\n    if (CommonGame.selectedGallery === 1) galleryKey = \"colouring\";\n\n    var canvasTex = Common.assets.getTexture(\"canvas_\" + galleryKey);\n    var canvasBg = new PIXI.Graphics();\n    canvasBg.beginFill(CommonGame.GALLERY_BORDER_TINT[CommonGame.selectedGallery], 1);\n    canvasBg.drawRoundedRect(\n        -canvasTex.width * 0.5 * SCALE_FACTOR,\n        -canvasTex.height * 0.5 * SCALE_FACTOR,\n        canvasTex.width * SCALE_FACTOR,\n        canvasTex.height * SCALE_FACTOR,\n        30);\n    canvasBg.endFill();\n\n    return canvasBg;\n};\n\nCommonGame.findColourCode = function (selection) {\n    var result = {r: 0, g: 0, b: 1};\n\n    var pages = Common.assets.getJSON(\"config\").palettePanel.pages;\n    for (var i = 0; i < pages.length; ++i) {\n        var itemIndex = pages[i].indexOf(selection);\n        if (itemIndex != -1) {\n            result.r = i;\n            result.g = itemIndex;\n\n            break;\n        }\n    }\n\n    return result;\n};","\"use strict\";\r\nimport Application      from \"./Application\";\r\nimport PreloaderScene   from \"./scenes/PreloaderScene\";\r\nimport Common           from \"./Common\";\r\nimport isMobile         from \"ismobilejs\";\r\nimport MultiStyleText   from \"./pixi-multistyle-text\";\r\n\r\nexport default class Main {\r\n    /**\r\n     * @param {number} width\r\n     * @param {number} height\r\n     */\r\n    constructor(width, height) {\r\n        /**\r\n         * @member {!number}\r\n         * @private\r\n         */\r\n        this._width = width;\r\n\r\n        /**\r\n         * @member {!number}\r\n         * @private\r\n         */\r\n        this._height = height;\r\n\r\n        /**\r\n         * @member {PreloaderScene}\r\n         * @private\r\n         */\r\n        this._preloader = null;\r\n    }\r\n\r\n    init(language) {\r\n\r\n        Common.blankTexture = PIXI.Texture.WHITE;\r\n\r\n        Common.assets = new P3.AssetManager();\r\n        Common.audio = P3.Button.audio = new P3.AudioManager();\r\n        Common.language = language;\r\n\r\n        Common.assets.texture.bind(Common.assets);\r\n\r\n        //--for legacy--//\r\n        P3.Device = {};\r\n        P3.Device.isMobile = isMobile.any;\r\n\r\n        //wrapped to make compatible with p3lib v5\r\n        Common.assets.getTexture = (name)=> {\r\n            return Common.assets.texture(name);\r\n        };\r\n        Common.assets.getJSON = (name)=> {\r\n            return Common.assets.json(name);\r\n        };\r\n        Common.assets.hasTexture = (name)=> {\r\n            let bool = true;\r\n            try {\r\n                PIXI.Texture.fromFrame(name + \".png\");\r\n            } catch (err) {\r\n                bool = false;\r\n            }\r\n            return (bool);\r\n        };\r\n\r\n        //Common.loadMute();\r\n        //Common.loadGame();\r\n\r\n        const isPortrait = false;\r\n\r\n        const params = {};\r\n        params.holderId = \"game\";\r\n        params.width = this._width;\r\n        params.height = this._height;\r\n        params.portrait = isPortrait;\r\n        params.aspectRatioFillHeight = !isPortrait;\r\n        params.rotateImageUrl = \"./assets/images/localisation/rotate/rotate_screen_\" + language + \".jpg\";\r\n        params.rotateImageColor = \"#000000\";\r\n\r\n        PIXI.settings.RETINA_PREFIX = /\\_(?=[^_]*$)(.+)x/;\r\n\r\n        TweenMax.defaultOverwrite = \"none\";\r\n        TweenMax.ticker.fps(60);\r\n\r\n        const view = new P3.View(params);\r\n        view.signals.ready.addOnce(function (canvas) {\r\n\r\n            const options = {};\r\n            options.view = canvas;\r\n            options.transparent = false;\r\n            options.antialias = false;\r\n            options.preserveDrawingBuffer = false;\r\n            options.resolution = 1.0;\r\n\r\n            Common.stage = new PIXI.Container();\r\n\r\n            // hotfix\r\n            canvas.screencanvas = true;\r\n\r\n            // const input = new Input();\r\n            // input.init(stage, canvas);\r\n            //  Common.input = input;\r\n\r\n            //on clicking the document focus on canvas, fix for buttons not working on mobile\r\n            document.onclick = () => {\r\n                canvas.focus();\r\n            };\r\n\r\n            const renderer = PIXI.autoDetectRenderer(this._width, this._height, options);\r\n            renderer.backgroundColor = 0x000000;\r\n            Common.renderer = renderer;\r\n            Common.isWebGL = (renderer instanceof PIXI.WebGLRenderer);\r\n\r\n            const scene = new P3.SceneManager(renderer);\r\n            scene.updateAll = true;\r\n            Common.scene = scene;\r\n            Common.stage.addChild(scene.view);\r\n\r\n            PIXI.ticker.shared.add(function (deltaTime) {\r\n\r\n                window.P3.deltaTime = window.deltaTime = deltaTime / PIXI.settings.TARGET_FPMS / 1000;\r\n                P3.Timestep.deltaTime = window.deltaTime;\r\n                scene.update();\r\n                renderer.render(Common.stage);\r\n            }, this);\r\n\r\n            window.delay = function (callback, delay, scope) {\r\n                TweenMax.delayedCall(delay, callback, [], scope);\r\n            };\r\n            window.translate = function (str) {\r\n                let s = Common.config.strings[str];\r\n                s = s && s[Common.language];\r\n                return (typeof s !== \"undefined\") ? s : str;\r\n            };\r\n\r\n            this.loadPreloader();\r\n        }, this);\r\n        view.signals.resize.add(this.onCanvasResize, this);\r\n        Common.view = view;\r\n    }\r\n\r\n    loadPreloader() {\r\n        const files = [\r\n            //sprite sheets\r\n            {name: \"ui_default_0_1x\", url: \"images/\" + \"ui_default_0_1x\" + \".json\"},\r\n            {name: \"ui_default_1_1x\", url: \"images/\" + \"ui_default_1_1x\" + \".json\"},\r\n            {name: \"preloader\", url: \"images/\" + \"preloader_1x\" + \".json\"},\r\n            {name: \"aeromaticslight_50\", url: \"fonts/\" + \"aeromaticslight_50\" + \".xml\"} //preloader font\r\n        ];\r\n        const sounds = [];\r\n        if (files.length) {\r\n            Common.assets.addFiles(files, \"assets/\");\r\n            Common.assets.signals.complete.addOnce(function () {\r\n                this.createConfig();\r\n                this.loadAssets();\r\n            }, this);\r\n            Common.assets.load();\r\n            Common.audio.addSounds(sounds, [\".mp3\", \".ogg\"], \"\");\r\n        } else {\r\n            this.loadAssets();\r\n        }\r\n    }\r\n\r\n    loadAssets() {\r\n\r\n        let files = [\r\n            // json.\r\n            {name: \"languages\", url: \"data/\" + \"languages\" + \".json\"},\r\n            {name: \"config\", url: \"data/\" + \"config\" + \".json\"},\r\n            {name: \"draw_it\", url: \"data/\" + \"draw_it\" + \".json\"},\r\n            // texture sheets.\r\n            {name: \"ui_default_0_1x\", url: \"images/\" + \"ui_default_0_1x\" + \".json\"},\r\n            {name: \"ui_default_1_1x\", url: \"images/\" + \"ui_default_1_1x\" + \".json\"},\r\n            // raw images.\r\n            {name: \"game_title\", url: \"images/localisation/title/\" + \"title_\" + Common.language + \".png\"},\r\n\r\n            {name: \"colour_image_1\", url: \"images/outlines/colour_it/\" + \"image_1\" + \".png\"},\r\n            {name: \"colour_image_2\", url: \"images/outlines/colour_it/\" + \"image_2\" + \".png\"},\r\n            {name: \"colour_image_3\", url: \"images/outlines/colour_it/\" + \"image_3\" + \".png\"},\r\n            {name: \"colour_image_4\", url: \"images/outlines/colour_it/\" + \"image_4\" + \".png\"},\r\n            {name: \"colour_image_5\", url: \"images/outlines/colour_it/\" + \"image_5\" + \".png\"},\r\n            {name: \"colour_image_6\", url: \"images/outlines/colour_it/\" + \"image_6\" + \".png\"},\r\n            {name: \"colour_image_7\", url: \"images/outlines/colour_it/\" + \"image_7\" + \".png\"},\r\n            {name: \"colour_image_8\", url: \"images/outlines/colour_it/\" + \"image_8\" + \".png\"},\r\n            {name: \"colour_image_9\", url: \"images/outlines/colour_it/\" + \"image_9\" + \".png\"},\r\n            {name: \"colour_image_10\", url: \"images/outlines/colour_it/\" + \"image_10\" + \".png\"},\r\n\r\n            {name: \"draw_image_1\", url: \"images/outlines/draw_it/\" + \"image_1\" + \".png\"},\r\n            {name: \"draw_image_2\", url: \"images/outlines/draw_it/\" + \"image_2\" + \".png\"},\r\n            {name: \"draw_image_3\", url: \"images/outlines/draw_it/\" + \"image_3\" + \".png\"},\r\n            {name: \"draw_image_4\", url: \"images/outlines/draw_it/\" + \"image_4\" + \".png\"},\r\n            {name: \"draw_image_5\", url: \"images/outlines/draw_it/\" + \"image_5\" + \".png\"},\r\n            {name: \"draw_image_6\", url: \"images/outlines/draw_it/\" + \"image_6\" + \".png\"},\r\n            {name: \"draw_image_7\", url: \"images/outlines/draw_it/\" + \"image_7\" + \".png\"},\r\n            {name: \"draw_image_8\", url: \"images/outlines/draw_it/\" + \"image_8\" + \".png\"},\r\n            {name: \"draw_image_9\", url: \"images/outlines/draw_it/\" + \"image_9\" + \".png\"},\r\n            {name: \"draw_image_10\", url: \"images/outlines/draw_it/\" + \"image_10\" + \".png\"},\r\n\r\n            // bgs.\r\n            {name: \"splash_bg\", url: \"images/bg/\" + \"splash_bg\" + \".jpg\"},\r\n            {name: \"bg\", url: \"images/bg/\" + \"bg_1x\" + \".jpg\"},\r\n            // fonts.\r\n\r\n            // particles.\r\n            {name: \"eraser_ps\", url: \"particles/\" + \"particle_emitter_eraser_loop_00\" + \".json\"},\r\n            {name: \"ink_ps\", url: \"particles/\" + \"particle_emitter_ink_loop_00\" + \".json\"},\r\n            {name: \"ink_splatter_ps\", url: \"particles/\" + \"particle_emitter_inksplatter_loop_01\" + \".json\"},\r\n            {name: \"brush_ps\", url: \"particles/\" + \"particle_emitter_paintbrush_loop_00\" + \".json\"},\r\n            {name: \"pencil_ps\", url: \"particles/\" + \"particle_emitter_pencil_loop_00\" + \".json\"},\r\n            {name: \"spray_ps\", url: \"particles/\" + \"particle_emitter_spray_loop_00\" + \".json\"},\r\n            {name: \"stamp_ps\", url: \"particles/\" + \"particle_emitter_stamo_burst_00\" + \".json\"},\r\n            {name: \"fill_ps\", url: \"particles/\" + \"particle_paintfill_burst_00\" + \".json\"},\r\n\r\n            //--spine--//\r\n            {name: \"tutorial_hand\", url: \"images/\" + \"tutorial_hand\" + \".json\"}\r\n        ];\r\n        var music = [\r\n            \"music_mainmenu_loop_00\",\r\n            \"music_ready_loop_012\"\r\n        ];\r\n        var genericSfx = [\r\n            \"sfx_ambient_desert_loop_00\",\r\n            \"sfx_drawer_hide_00\",\r\n            \"sfx_drawer_reveal_00\",\r\n            \"sfx_generic_colour_type_change_00\",\r\n            \"sfx_tool_eraser_loop_03\",\r\n            \"sfx_tool_eraser_select_00\",\r\n            \"sfx_tool_inkpot_select_00\",\r\n            \"sfx_tool_inkpot_use_splat_00\",\r\n            \"sfx_tool_magictape_select_00\",\r\n            \"sfx_tool_magictape_use_end_only_00\",\r\n            \"sfx_tool_magictape_use_loop_00\",\r\n            \"sfx_tool_paintbrush_dry_use_loop_00\",\r\n            \"sfx_tool_paintbrush_select_00\",\r\n            \"sfx_tool_paintbrush_wet_use_loop_00\",\r\n            \"sfx_tool_paintpot_fill_select_01\",\r\n            \"sfx_tool_paintpot_fill_use_02\",\r\n            \"sfx_tool_pencil_select_00\",\r\n            \"sfx_tool_pencil_use_loop_00\",\r\n            \"sfx_tool_spraycan_select_00\",\r\n            \"sfx_tool_spraycan_use_loop_00\",\r\n            \"sfx_tool_stamp_use_00\",\r\n            \"sfx_tool_stamps_select_00\",\r\n            \"sfx_tool_sticker_end_only\",\r\n            \"sfx_tool_sticker_place_00\",\r\n            \"sfx_tool_sticker_use_00\",\r\n            \"sfx_tool_stickers_select_00\",\r\n            \"sfx_tool_trashcan_confirm_00\",\r\n            \"sfx_tool_trashcan_select_00\",\r\n            \"sfx_tool_undo_step_back_00\",\r\n            \"sfx_ui_folder_save_00\",\r\n            \"sfx_ui_newpage_00\",\r\n            \"sfx_palette_select_00\",\r\n            \"sfx_palette_close_00\",\r\n            \"sfx_ui_carousel_swipe_00\",\r\n            \"sfx_ui_click_00\",\r\n            \"sfx_ui_rollover_00\",\r\n            //  \"vo_happo_ok_00\",\r\n            //   \"vo_happo_ooh_00\",\r\n            //   \"vo_happo_ready_00\",\r\n            \"sfx_btn_play_start_doorbell_00\"\r\n        ];\r\n        if (files.length) {\r\n            this._preloader = new PreloaderScene();\r\n            Common.scene.add(this._preloader);\r\n\r\n            Common.assets.addFiles(files, \"assets/\");\r\n            Common.assets.signals.progress.add(this.onLoadingProgress, this);\r\n            Common.assets.signals.complete.addOnce(this.onLoadingCompleted, this);\r\n            Common.assets.load();\r\n\r\n            Common.audio.addSounds(music, [\".m4a\", \".ogg\", \".mp3\"], \"assets/audio/music/\");\r\n            Common.audio.addSounds(genericSfx, [\".m4a\", \".ogg\", \".mp3\"], \"assets/audio/sfx/\");\r\n        } else {\r\n            this.startGame();\r\n        }\r\n    }\r\n\r\n    createConfig() {\r\n        const assets = Common.assets;\r\n\r\n        const config = {};\r\n        Common.config = config;\r\n    }\r\n\r\n    startGame() {\r\n\r\n        delay(function () {\r\n            if (!isMobile.any) Application.init();\r\n        }, 1.0, this);\r\n\r\n    }\r\n\r\n    onLoadingProgress(event) {\r\n        this._preloader.loaded = event.progress / 100.0;\r\n    }\r\n\r\n    onLoadingCompleted() {\r\n        Common.assets.signals.progress.removeAll();\r\n        Common.assets.signals.complete.removeAll();\r\n        Common.finishedLoading = true;\r\n        this._preloader.loaded = 1;\r\n\r\n        this.startGame(1);\r\n    }\r\n\r\n    /**\r\n     * @param {boolean} correct\r\n     */\r\n    onCanvasResize(correct) {\r\n        if (correct) {\r\n            Common.renderer.resize(P3.View.width, P3.View.height);\r\n            if (Common.scene) {\r\n                Common.scene.resize();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nwindow.Main = Main;\r\n\r\n/**\r\n *\r\n * @param copy\r\n * @param fontName\r\n * @param size\r\n * @param holder\r\n * @param colour\r\n * @returns {PIXI.Text}\r\n */\r\nfunction simpleText(copy, fontName, size, holder, colour) {\r\n    const col = colour | 0x000000;\r\n    const textView = new PIXI.Text(copy, {fontFamily: fontName, fontSize: size, fill: col});\r\n    textView.anchor.x = 0.5;\r\n    if (holder) holder.addChild(textView);\r\n    return textView;\r\n}\r\nP3.simpleText = simpleText;\r\n\r\n/**\r\n * Creates and returns a new UI button\r\n * @param point {PIXI.Point}\r\n * @param type\r\n * @param callback\r\n * @param scope\r\n * @param params\r\n * @returns {Button}\r\n */\r\n/*\r\n function createButton(point, type, callback, scope, params = {holder: null, text: null, icon: null}) {\r\n\r\n const states = new P3.ButtonStates();\r\n\r\n if (!type || type === \"blank\") {\r\n\r\n states.normal = PIXI.Texture.EMPTY;\r\n states.down = PIXI.Texture.EMPTY;\r\n\r\n } else if (typeof type === \"string\") {\r\n\r\n if (Common.assets.hasTexture(\"btn_\" + type + \"_up\")) {\r\n states.normal = Common.assets.texture(\"btn_\" + type + \"_up\");\r\n } else if (Common.assets.hasTexture(\"buttons/ui_\" + \"btn_\" + type + \"_up\")) {\r\n states.normal = Common.assets.texture(\"buttons/ui_\" + \"btn_\" + type + \"_up\");\r\n }\r\n\r\n if (Common.assets.hasTexture(\"btn_\" + type + \"_down\")) {\r\n states.down = Common.assets.texture(\"btn_\" + type + \"_down\");\r\n } else if (Common.assets.texture(\"buttons/ui_\" + \"btn_\" + type + \"_down\")) {\r\n states.down = Common.assets.texture(\"buttons/ui_\" + \"btn_\" + type + \"_down\");\r\n }\r\n\r\n if (Common.assets.hasTexture(\"btn_\" + type + \"_over\")) {\r\n states.over = Common.assets.texture(\"btn_\" + type + \"_over\");\r\n }\r\n\r\n } else {\r\n\r\n states.normal = type;\r\n\r\n }\r\n\r\n const button = new Button(states);\r\n button.x = point.x;\r\n button.y = point.y;\r\n button.anchor = new PIXI.Point(0.5, 0.5);\r\n button.animate = true;\r\n\r\n button.signals.click.add(callback, scope);\r\n\r\n //  buttons/ui_icon_close\r\n\r\n if (params) {\r\n if (params.holder) {\r\n params.holder.addChild(button);\r\n }\r\n if (params.icon) {\r\n let sp;\r\n if (Common.assets.hasTexture(params.icon)) {\r\n sp = P3.createSprite(params.icon);\r\n } else {\r\n sp = P3.createSprite(\"buttons/ui_\" + params.icon);\r\n }\r\n sp.anchor.set(0.5);\r\n button.addChild(sp);\r\n button.icon = sp;\r\n }\r\n if (params.text) {\r\n let txtView = P3.simpleText(params.text, \"consolas\", 45, button, 0xffffff);//new PIXI.extras.BitmapText(text, {font: \"45px Calibri\"});\r\n txtView.anchor = {x: 0.5, y: 0.5};\r\n button.txtView = txtView;\r\n }\r\n }\r\n\r\n return button;\r\n }\r\n P3.createButton = createButton;\r\n */\r\n\r\n/**\r\n * @param copy {string}\r\n * @param config {object}\r\n * @param override {string} - overrides default language font type\r\n * @param jsonName\r\n * @returns {PIXI.Text|PIXI.BitmapText}\r\n */\r\nfunction createText(copy, config, override, jsonName) {\r\n    var textView, conf;\r\n    var str = jsonName || \"languages\";\r\n    if (Common.language === \"ar\") {\r\n        conf = {\r\n            font: config.size + \" Noto Kufi Arabic\",\r\n            fill: config.fill,\r\n            align: \"center\",\r\n            //  letterSpacing: 5,\r\n            padding: config.padding || 0\r\n        };\r\n        if (config.wordWrapWidth) {\r\n            conf.wordWrap = true;\r\n            conf.wordWrapWidth = config.wordWrapWidth;\r\n        }\r\n        if (config.stroke) {\r\n            conf.stroke = config.stroke;\r\n            conf.strokeThickness = 4 || config.strokeThickness;\r\n        }\r\n        Object.assign(conf, config);\r\n        textView = new PIXI.Text(Common.assets.getJSON(str)[copy][Common.language], conf);\r\n    } else {\r\n        conf = {\r\n            font: config.size + \" Duality\",\r\n            fill: config.fill,\r\n            align: \"center\",\r\n            letterSpacing: 4,\r\n            padding: config.padding || 0,\r\n            lineJoin: \"round\"\r\n        };\r\n        if (config.wordWrapWidth) {\r\n            conf.wordWrap = true;\r\n            conf.wordWrapWidth = config.wordWrapWidth;\r\n        }\r\n        if (config.stroke) {\r\n            conf.stroke = config.stroke;\r\n            conf.strokeThickness = 8;\r\n        }\r\n        Object.assign(conf, config);\r\n        textView = new PIXI.Text(Common.assets.getJSON(str)[copy][Common.language], conf);\r\n    }\r\n\r\n    return textView;\r\n}\r\nP3.createText = createText;\r\n\r\n/**\r\n * @param copy {string}\r\n * @param config\r\n */\r\nfunction createMultiText(copy, config) {\r\n    var textView, conf;\r\n    var str = \"languages\";\r\n    if (Common.language === \"ar\") {\r\n        conf = {\r\n            font: config.size + \" Noto Kufi Arabic\",\r\n            fill: config.fill,\r\n            align: \"center\",\r\n            padding: config.padding || 0\r\n        };\r\n        if (config.wordWrapWidth) {\r\n            conf.wordWrap = true;\r\n            conf.wordWrapWidth = config.wordWrapWidth;\r\n        }\r\n        if (config.stroke) {\r\n            conf.stroke = config.stroke;\r\n            conf.strokeThickness = 4 || config.strokeThickness;\r\n        }\r\n        textView = new PIXI.Text(Common.assets.getJSON(str)[copy][Common.language], conf);\r\n    } else {\r\n        conf = {\r\n            font: config.size + \" Duality\",\r\n            fill: 0xffffff,\r\n            align: \"center\",\r\n            letterSpacing: 4,\r\n            padding: config.padding || 0,\r\n            lineJoin: \"round\"\r\n        };\r\n        if (config.wordWrapWidth) {\r\n            conf.wordWrap = true;\r\n            conf.wordWrapWidth = config.wordWrapWidth;\r\n        }\r\n        if (config.stroke) {\r\n            conf.stroke = config.stroke;\r\n            conf.strokeThickness = 8;\r\n        }\r\n\r\n        //LOL...\r\n        let confCopy = Object.assign({}, conf);\r\n        delete confCopy.fill;\r\n        let realConfig = {//deliberately made larger than needs to be, trying to ovoid overflow\r\n            \"default\": conf,\r\n            \"s0\": Object.assign({fill: \"#fff200\"}, confCopy),//\r\n            \"s1\": Object.assign({fill: \"#00bff3\"}, confCopy),//\r\n            \"s2\": Object.assign({fill: \"#00a650\"}, confCopy),//\r\n            \"s3\": Object.assign({fill: \"#00bff3\"}, confCopy),//\r\n            \"s4\": Object.assign({fill: \"#ff4b96\"}, confCopy),//\r\n            \"s5\": Object.assign({fill: \"#ff2600\"}, confCopy),//red\r\n            \"s6\": Object.assign({fill: \"#f26522\"}, confCopy),//orange\r\n            \"s7\": Object.assign({fill: \"#fff200\"}, confCopy),//yellow\r\n            \"s8\": Object.assign({fill: \"#00a650\"}, confCopy),//green\r\n            \"s9\": Object.assign({fill: \"#fff200\"}, confCopy),\r\n            \"s10\": Object.assign({fill: \"#00bff3\"}, confCopy),\r\n            \"s11\": Object.assign({fill: \"#00a650\"}, confCopy),\r\n            \"s12\": Object.assign({fill: \"#00bff3\"}, confCopy),\r\n            \"s13\": Object.assign({fill: \"#ff4b96\"}, confCopy),\r\n            \"s14\": Object.assign({fill: \"#f26522\"}, confCopy),\r\n            \"s15\": Object.assign({fill: \"#fff200\"}, confCopy),\r\n            \"s16\": Object.assign({fill: \"#00a650\"}, confCopy),\r\n            \"s17\": Object.assign({fill: \"#ff2600\"}, confCopy),\r\n            \"s18\": Object.assign({fill: \"#00a650\"}, confCopy),\r\n            \"s19\": Object.assign({fill: \"#00a650\"}, confCopy),\r\n            \"s20\": Object.assign({fill: \"#00a650\"}, confCopy),\r\n            \"s21\": Object.assign({fill: \"#00a650\"}, confCopy),\r\n            \"s22\": Object.assign({fill: \"#00a650\"}, confCopy),\r\n            \"s23\": Object.assign({fill: \"#00a650\"}, confCopy)\r\n        };\r\n\r\n        let realCopy = Common.assets.getJSON(str)[copy][Common.language];\r\n        let copyArr = realCopy.split(\"\");\r\n        let finalCopy = \"\";\r\n        for (let i = 0; i < copyArr.length; i++) {\r\n            finalCopy += \"<s\" + i + \">\";\r\n            finalCopy += copyArr[i];\r\n            finalCopy += \"</s\" + i + \">\";\r\n        }\r\n\r\n        //--create the text--//\r\n        textView = new MultiStyleText(finalCopy, realConfig);\r\n    }\r\n\r\n    return textView;\r\n}\r\nP3.createMultiText = createMultiText;\r\n\r\nfunction createButton(icon, type) {\r\n    type = type || 'primary_small';\r\n    const buttonStates = new P3.ButtonStates(\r\n        Common.assets.getTexture('btn_' + type + '_off'),\r\n        Common.assets.getTexture('btn_' + type + '_over'),\r\n        Common.assets.getTexture('btn_' + type + '_down'),\r\n        Common.assets.getTexture(\"icon_\" + icon + '_off')\r\n    );\r\n\r\n    buttonStates.iconOver = Common.assets.getTexture(\"icon_\" + icon + '_over');\r\n    buttonStates.iconDown = Common.assets.getTexture(\"icon_\" + icon + '_down');\r\n\r\n    let button;\r\n    if (icon === 'sound') {\r\n        buttonStates.iconAlt = Common.assets.getTexture('icon_' + \"mute\" + '_off');\r\n        buttonStates.iconOverAlt = Common.assets.getTexture('icon_' + \"mute\" + '_over');\r\n        buttonStates.iconDownAlt = Common.assets.getTexture('icon_' + \"mute\" + '_down');\r\n        button = new P3.MuteButton(buttonStates);\r\n    }\r\n    else {\r\n        button = new P3.Button(buttonStates);\r\n    }\r\n    return button;\r\n}\r\n\r\nwindow.createButton = createButton;\r\n\r\nfunction Timestep() {\r\n\r\n}\r\nTimestep.deltaTime = 0;\r\nP3.Timestep = Timestep;\r\n","var Common = require( \"./Common\" );\nvar CommonGame = require( \"./CommonGame\" );\n\n\n//===================================================\n//\n// Constructor\n//\n//===================================================\n\nfunction SavedData()\n{\n\tvar assetManager = P3.AssetManager.instance;\n\n\t/**\n\t * @type {String}\n\t * @const\n\t */\n\tthis.SAVE_NAME = \"customer_focus\";\n\tthis.SAVE_VERSION = \"0.0.18\";\n\tthis.SAVE_SEED = \"y5k0Eo6R177mUkb\";\n\n\t/**\n\t * @type {Boolean}\n\t */\n\tthis._isToolTutorial = true;\n\tthis._isDrawTutorial = true;\n\tthis._isPaletteTutorial = true;\n}\nmodule.exports = SavedData;\n\n\n//===================================================\n//\n// Public\n//\n//===================================================\n\nSavedData.prototype.init = function()\n{\t\n\tif ( !window.localStorage[ this.SAVE_NAME + \"_\" + this.SAVE_VERSION ] )\n\t{\n\t\t//console.log( 'reset' );\n\t\tthis.reset();\n\t\tthis.save();\n\t}\n\telse\n\t{\n\t\t//console.log( 'load' );\n\t\tthis.load();\n\t}\n};\n\nSavedData.prototype.reset = function()\n{\n\tthis._isToolTutorial = true;\n\tthis._isDrawTutorial = true;\n\tthis._isPaletteTutorial = true;\n};\n\nSavedData.prototype.load = function()\n{\n\tvar data = window.localStorage[ this.SAVE_NAME + \"_\" + this.SAVE_VERSION ];\n\tdata = JSON.parse( data );\n\n\tthis._isToolTutorial \t\t\t= data.isToolTutorial;\n\tthis._isDrawTutorial \t\t\t= data.isDrawTutorial;\n\tthis._isPaletteTutorial \t\t= data.isPaletteTutorial;\n};\n\nSavedData.prototype.save = function()\n{\n\t//console.log( 'save' );\n\tvar data = {};\n\tdata.isToolTutorial \t\t= this._isToolTutorial;\n\tdata.isDrawTutorial \t\t= this._isDrawTutorial;\n\tdata.isPaletteTutorial \t\t= this._isPaletteTutorial;\n\n\tvar json = JSON.stringify( data );\n\tdata.hash = md5( json + this.SAVE_SEED );\n\n\twindow.localStorage[ this.SAVE_NAME + \"_\" + this.SAVE_VERSION ] = JSON.stringify( data );\n};\n\n\n//===================================================\n//\n// Getters / Setters\n//\n//===================================================\n\t\nObject.defineProperty(\n\tSavedData.prototype, \n\t\"isToolTutorial\", \n\t{ \tget: function() { return this._isToolTutorial; },\n\t\tset: function( a ) { this._isToolTutorial = a; } } );\n\nObject.defineProperty(\n\tSavedData.prototype, \n\t\"isDrawTutorial\", \n\t{ \tget: function() { return this._isDrawTutorial; },\n\t\tset: function( a ) { this._isDrawTutorial = a; } } );\n\t\t\nObject.defineProperty(\n\tSavedData.prototype, \n\t\"isPaletteTutorial\", \n\t{ \tget: function() { return this._isPaletteTutorial; },\n\t\tset: function( a ) { this._isPaletteTutorial = a; } } );","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport PalettePanel from \"../ui/overlays/PalettePanel\";\r\nimport MagicBrush from \"./MagicBrush\";\r\nimport ColourBrush from \"./ColourBrush\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction Brush() {\r\n    // Attributes.\r\n    this._drawLayer = null;\r\n    this._magicBrush = null;\r\n    this._colourBrush = null;\r\n    this._paletteItem = null;\r\n    this._curBrush = null;\r\n    this._audio = null;\r\n}\r\nexport default Brush;\r\n//module.exports = Brush;\r\nBrush.prototype.constructor = Brush;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nBrush.prototype.init = function (drawLayer) {\r\n    this._drawLayer = drawLayer;\r\n\r\n    // Magic brush.\r\n    this._magicBrush = new MagicBrush();\r\n    this._magicBrush.init(drawLayer);\r\n\r\n    // Colour brush.\r\n    this._colourBrush = new ColourBrush();\r\n    this._colourBrush.init(drawLayer);\r\n\r\n    // Set initial brush.\r\n    this._curBrush = this._colourBrush;\r\n    this._curBrush.colour = Common.assets.getJSON(\"config\").palettePanel.pages[0][0];\r\n    this._paletteItem = this._curBrush.colour;\r\n\r\n    // Signals.\r\n    Common.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\r\n};\r\n\r\nBrush.prototype._stopAudio = function () {\r\n    this._audio.howl.stop(this._audio.id);\r\n    this._audio = null;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nBrush.prototype._draw = function (from, to) {\r\n    // TEST: DYN_OUT:\r\n    var dynOutlineContext = Common.game.canvas.drawLayer.dynOutlineContext;\r\n    dynOutlineContext.beginPath();\r\n    dynOutlineContext.strokeStyle = \"black\";\r\n    dynOutlineContext.lineWidth = this._curBrush.LINE_THICKNESS;\r\n    dynOutlineContext.lineJoin = \"round\";\r\n    dynOutlineContext.moveTo(from.x, from.y);\r\n    dynOutlineContext.lineTo(to.x, to.y);\r\n    dynOutlineContext.closePath();\r\n    dynOutlineContext.stroke();\r\n};\r\n\r\nBrush.prototype._stopAudio = function () {\r\n    this._audio.howl.stop(this._audio.id);\r\n    this._audio = null;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nBrush.prototype.onDrawBegan = function (point) {\r\n    this._curBrush.onDrawBegan(point);\r\n    // TEST: DYN_OUT:\r\n    this._draw(point, new PIXI.Point(point.x + 0.1, point.y + 0.1));\r\n};\r\n\r\nBrush.prototype.onDrawMoved = function (from, to) {\r\n    // Sfx.\r\n    if (this._audio == null)\r\n        this._audio = Common.audio.playSound(\"sfx_tool_paintbrush_wet_use_loop_00\", {\"loop\": true});\r\n    TweenMax.killDelayedCallsTo(this._stopAudio);\r\n    TweenMax.delayedCall(0.25, this._stopAudio, null, this);\r\n\r\n\r\n    this._curBrush.onDrawMoved(from, to);\r\n    // TEST: DYN_OUT:\r\n    this._draw(from, to);\r\n};\r\n\r\nBrush.prototype.onDrawEnded = function () {\r\n    // Sfx.\r\n    TweenMax.killDelayedCallsTo(this._stopAudio);\r\n    if (this._audio != null)\r\n        this._stopAudio();\r\n\r\n    // TEST: DYN_OUT:\r\n    Common.game.canvas.drawLayer.dynOutlineData = Common.game.canvas.drawLayer.dynOutlineContext.getImageData(0, 0, Common.game.canvas.WIDTH, Common.game.canvas.HEIGHT);\r\n};\r\n\r\nBrush.prototype._onColour_Changed = function (selection) {\r\n    if (selection.indexOf(\"#\") == 0) {\r\n        this._curBrush = this._colourBrush;\r\n        this._colourBrush.colour = selection;\r\n    }\r\n    else {\r\n        this._curBrush = this._magicBrush;\r\n        this._magicBrush.textureId = selection;\r\n    }\r\n\r\n    this._paletteItem = selection;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    Brush.prototype,\r\n    \"paletteItem\",\r\n    {\r\n        get: function () {\r\n            return this._paletteItem;\r\n        }\r\n    });","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport MyGame from  \"./MyGame\";\r\nimport FillLayer from  \"./FillLayer\";\r\nimport DrawLayer from  \"./DrawLayer\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction Canvas() {\r\n    PIXI.Container.call(this);\r\n\r\n\r\n    // Attributes.\r\n    this._fillLayer = null;\r\n    this._drawLayer = null;\r\n\r\n    // Sprites.\r\n    this._bgSprite = null;\r\n    this._borderSprite = null;\r\n\r\n\r\n    // Constants.\r\n    this.WIDTH = CommonGame.CANVAS_WIDTH;//Common.STAGE_WIDTH\r\n    this.HEIGHT = CommonGame.CANVAS_HEIGHT;//Common.STAGE_HEIGHT\r\n}\r\nexport default Canvas;\r\n//module.exports = Canvas;\r\nCanvas.prototype = Object.create(PIXI.Container.prototype);\r\nCanvas.prototype.constructor = Canvas;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nCanvas.prototype.init = function () {\r\n    // Bg.\r\n    this.addChild(CommonGame.createCanvasBg());\r\n\r\n    this._bgSprite = new PIXI.Sprite(Common.blankTexture);\r\n    this._bgSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n    this._bgSprite.width = this.WIDTH;\r\n    this._bgSprite.height = this.HEIGHT;\r\n    this._bgSprite.tint = 0xffffff;\r\n\r\n    this.addChild(this._bgSprite);\r\n\r\n    // Layers.\r\n    // Fill.\r\n    this._fillLayer = new FillLayer();\r\n    this._fillLayer.init();\r\n    this.addChild(this._fillLayer);\r\n    // Draw.\r\n    this._drawLayer = new DrawLayer();\r\n    this._drawLayer.init();\r\n    this.addChild(this._drawLayer);\r\n\r\n    let galleryKey = \"drawing\";\r\n    if (CommonGame.selectedGallery === 1) galleryKey = \"colouring\";\r\n\r\n    // Border.\r\n    this._borderSprite = new PIXI.Sprite(Common.assets.getTexture(\"canvas_\" + galleryKey));\r\n    this._borderSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n    this.addChild(this._borderSprite);\r\n\r\n    // Listen to HUD controls.\r\n    Common.game.hud.signals.onDrawModeChanged.add(this._onDrawMode_Changed, this);\r\n\r\n    // Start with the pencil\r\n    this._onDrawMode_Changed(CommonGame.TOOL.PENCIL);\r\n};\r\n\r\nCanvas.prototype.update = function () {\r\n    this._fillLayer.update();\r\n    this._drawLayer.update();\r\n};\r\n\r\nCanvas.prototype.animateIn = function () {\r\n    this.y -= 100;\r\n    this.alpha = 0;\r\n    TweenMax.to(this, 0.25, {\r\n        alpha: 1,\r\n        y: this.y + 100,\r\n        ease: Sine.easeOut,\r\n        onComplete: function () {\r\n            Common.game.scene.addTutorialEvent(CommonGame.TUT_EVENT.CANVAS_VISIBLE);\r\n        },\r\n        onCompleteScope: this\r\n    });\r\n};\r\n\r\nCanvas.prototype.clear = function () {\r\n    this._fillLayer.clear();\r\n    this._drawLayer.clear();\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\n// TODO:\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nCanvas.prototype._onDrawMode_Changed = function (selection) {\r\n    if (selection == CommonGame.TOOL.PENCIL\r\n        || selection == CommonGame.TOOL.BRUSH\r\n        || selection == CommonGame.TOOL.SPRAY\r\n        || selection == CommonGame.TOOL.STAMP\r\n        || selection == CommonGame.TOOL.INK_POT\r\n        || selection == CommonGame.TOOL.ERASER) {\r\n        this._drawLayer.setEnabled(true);\r\n        this._fillLayer.setEnabled(false);\r\n    }\r\n    else if (selection == CommonGame.TOOL.BUCKET) {\r\n        this._drawLayer.setEnabled(false);\r\n        this._fillLayer.setEnabled(true);\r\n    }\r\n\r\n    // Sfx.\r\n    Common.audio.playSound(\"sfx_tool_paintbrush_select_00\");\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    Canvas.prototype,\r\n    \"fillLayer\",\r\n    {\r\n        get: function () {\r\n            return this._fillLayer;\r\n        }\r\n    });\r\n\r\nObject.defineProperty(\r\n    Canvas.prototype,\r\n    \"drawLayer\",\r\n    {\r\n        get: function () {\r\n            return this._drawLayer;\r\n        }\r\n    });","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction ColourBrush() {\r\n    // Constants.\r\n    this.LINE_THICKNESS = 10;\r\n\r\n\r\n    // Attributes.\r\n    this._drawLayer = null;\r\n    this._colour = null;\r\n}\r\nexport default ColourBrush;\r\n//module.exports               \t\t= ColourBrush;\r\nColourBrush.prototype.constructor = ColourBrush;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nColourBrush.prototype.init = function (drawLayer) {\r\n    this._drawLayer = drawLayer;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nColourBrush.prototype._draw = function (start, end) {\r\n    const dist = Math.round(Common.distanceBetween(start, end));\r\n    const angle = Common.angleBetween(start, end);\r\n\r\n    let lastX = Math.round(start.x + ( Math.sin(angle) * dist)), lastY = Math.round(start.y + ( Math.cos(angle) * dist ));\r\n\r\n    for (let i = 0; i < dist; i += 3) {\r\n        let x = Math.round(start.x + ( Math.sin(angle) * i ));\r\n        let y = Math.round(start.y + ( Math.cos(angle) * i ));\r\n\r\n        var radGrad = this._drawLayer.context.createRadialGradient(lastX, lastY, this.LINE_THICKNESS, x, y, 0);\r\n        var rgbColour = Common.hexToRgb(this._colour);\r\n        radGrad.addColorStop(0, \"rgba( \" + rgbColour.r + \",\" + rgbColour.g + \",\" + rgbColour.b + \", 0 )\");\r\n        radGrad.addColorStop(1, \"rgba( \" + rgbColour.r + \",\" + rgbColour.g + \",\" + rgbColour.b + \", 1 )\");\r\n\r\n        this._drawLayer.context.fillStyle = radGrad;\r\n        this._drawLayer.context.fillRect(x - this.LINE_THICKNESS, y - this.LINE_THICKNESS, this.LINE_THICKNESS * 2, this.LINE_THICKNESS * 2);\r\n\r\n        lastX = x;\r\n        lastY = y;\r\n    }\r\n\r\n    this._drawLayer.onContext_Changed();\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nColourBrush.prototype.onDrawBegan = function (point) {\r\n    this._draw(point, new PIXI.Point(point.x + 0.1, point.y + 0.1));\r\n};\r\n\r\nColourBrush.prototype.onDrawMoved = function (from, to) {\r\n    this._draw(from, to);\r\n};\r\n\r\nColourBrush.prototype.onDrawEnded = function () {\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    ColourBrush.prototype,\r\n    \"colour\",\r\n    {\r\n        get: function () {\r\n            return this._colour;\r\n        },\r\n        set: function (a) {\r\n            this._colour = a;\r\n        }\r\n    });","\"use strict\";\r\n\r\nvar Common            \t= require( \"../Common\" );\r\nvar CommonGame         \t= require( \"../CommonGame\" );\r\n\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction ColourPencil() \r\n{\r\n\t// Constants.\r\n\tthis.LINE_THICKNESS = 5;\r\n\t\r\n\r\n\t// Attributes.\r\n\tthis._drawLayer = null;\t\r\n\tthis._colour = null;\r\n}\r\nmodule.exports               \t\t= ColourPencil;\r\nColourPencil.prototype.constructor \t= ColourPencil;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nColourPencil.prototype.init = function( drawLayer ) \r\n{\t\r\n\tthis._drawLayer = drawLayer;\t\t\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nColourPencil.prototype._draw = function( from, to ) \r\n{  \r\n\tthis._drawLayer.context.beginPath();\r\n\tthis._drawLayer.context.strokeStyle = this._colour;\r\n\tthis._drawLayer.context.lineWidth = this.LINE_THICKNESS;\r\n\tthis._drawLayer.context.lineJoin = \"round\";\r\n\tthis._drawLayer.context.moveTo( from.x, from.y );\r\n\tthis._drawLayer.context.lineTo( to.x, to.y );\r\n\tthis._drawLayer.context.closePath();\r\n\tthis._drawLayer.context.stroke();\t\t\r\n\r\n\tthis._drawLayer.onContext_Changed();\t\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nColourPencil.prototype.onDrawBegan = function( point ) \r\n{  \r\n\tthis._draw( point, new PIXI.Point( point.x + 0.1, point.y + 0.1 ) );\r\n};\r\n\r\nColourPencil.prototype.onDrawMoved = function( from, to ) \r\n{  \r\n\tthis._draw( from, to );\r\n};\r\n\r\nColourPencil.prototype.onDrawEnded = function() {};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n\tColourPencil.prototype, \r\n\t\"colour\", \r\n\t{ \tget: function() { return this._colour; },\r\n\t\tset: function( a ) { this._colour = a; } } );","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport Pencil  from \"./Pencil\";\r\nimport InkPot  from \"./InkPot\";\r\nimport Brush  from \"./Brush\";\r\nimport Spray  from \"./Spray\";\r\nimport Stamp from \"./Stamp\";\r\nimport Eraser from \"./Eraser\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction DrawLayer() {\r\n    PIXI.Container.call(this);\r\n\r\n\r\n    // States.\r\n    this.STATE = {\r\n        IDLE: 0,\r\n        DRAWING: 1\r\n    };\r\n\r\n\r\n    // Attributes.\r\n    this._state = this.STATE.IDLE;\r\n\r\n    this._canvas2d = null;\r\n    this._context = null;\r\n\r\n    // TEST: DYN_OUT:\r\n    this._dynOutline_c2d = null;\r\n    this._dynOutlineContext = null;\r\n    this._dynOutlineLayerData = null;\r\n\r\n    this._pencil = null;\r\n    this._brush = null;\r\n    this._spray = null;\r\n    this._stamp = null;\r\n    this._inkPot = null;\r\n    this._drawingTool = null;\r\n    this._eraser = null;\r\n\r\n    this._drawPS = null;\r\n\r\n    // Sprites.\r\n    this._layerSprite = null;\r\n\r\n    // Input.\r\n    this._lastInputLocalPosition = new PIXI.Point();\r\n    this._updateInputLocalPosition = new PIXI.Point();\r\n}\r\nexport default DrawLayer;\r\n//module.exports = DrawLayer;\r\nDrawLayer.prototype = Object.create(PIXI.Container.prototype);\r\nDrawLayer.prototype.constructor = DrawLayer;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nDrawLayer.prototype.init = function () {\r\n    // Canvas.\r\n    this._canvas2d = document.createElement('canvas');\r\n    this._canvas2d.width = Common.game.canvas.WIDTH;\r\n    this._canvas2d.height = Common.game.canvas.HEIGHT;\r\n\r\n    // Context.\r\n    this._context = this._canvas2d.getContext('2d');\r\n\r\n    // TEST: DYN_OUT:\r\n    this._dynOutline_c2d = document.createElement('canvas');\r\n    this._dynOutline_c2d.width = Common.game.canvas.WIDTH;\r\n    this._dynOutline_c2d.height = Common.game.canvas.HEIGHT;\r\n\r\n    this._dynOutlineContext = this._dynOutline_c2d.getContext('2d');\r\n    this._dynOutlineContext.fillStyle = 'rgba(0, 0, 0, 0)';\r\n    this._dynOutlineContext.fillRect(0, 0, this._dynOutline_c2d.width, this._dynOutline_c2d.height);\r\n\r\n    this._dynOutlineLayerData = this._dynOutlineContext.getImageData(0, 0, this._dynOutline_c2d.width, this._dynOutline_c2d.height);\r\n\r\n    // Tools.\r\n    // Pencil.\r\n    this._pencil = new Pencil();\r\n    this._pencil.init(this);\r\n    // Brush.\r\n    this._brush = new Brush();\r\n    this._brush.init(this);\r\n    // Spray.\r\n    this._spray = new Spray();\r\n    this._spray.init(this);\r\n    // Stamp.\r\n    this._stamp = new Stamp();\r\n    this._stamp.init(this);\r\n    // Ink pot.\r\n    this._inkPot = new InkPot();\r\n    this._inkPot.init(this);\r\n    // Eraser.\r\n    this._eraser = new Eraser();\r\n    this._eraser.init(this, Common.game.canvas.fillLayer);\r\n\r\n    // Layer.\r\n    this._layerSprite = new PIXI.Sprite(PIXI.Texture.fromCanvas(this._canvas2d));\r\n    this._layerSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n    this._layerSprite.interactive = true;\r\n    this._layerSprite.mousedown = this._layerSprite.touchstart = this._onDrawLayer_MouseDown.bind(this);\r\n    this._layerSprite.mousemove = this._layerSprite.touchmove = this._onDrawLayer_MouseMove.bind(this);\r\n    this._layerSprite.mouseup = this._layerSprite.touchend = this._onDrawLayer_MouseUp.bind(this);\r\n    this._layerSprite.mouseupoutside = this._layerSprite.touchendoutside = this._onDrawLayer_MouseOut.bind(this);\r\n    this.addChild(this._layerSprite);\r\n\r\n    // Default tool.\r\n    this._onDrawMode_Changed(CommonGame.TOOL.PENCIL);\r\n\r\n    // Listen to HUD controls.\r\n    Common.game.hud.signals.onDrawModeChanged.add(this._onDrawMode_Changed, this);\r\n    Common.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\r\n};\r\n\r\nDrawLayer.prototype.setEnabled = function (isEnabled) {\r\n    this._layerSprite.interactive = isEnabled;\r\n};\r\n\r\nDrawLayer.prototype.update = function () {\r\n    // Vfx.\r\n    this._drawPS.update(P3.Timestep.deltaTime);\r\n\r\n    if (this._drawingTool != this._spray\r\n        && this._drawPS.emit\r\n        && this._lastInputLocalPosition.x == this._updateInputLocalPosition.x\r\n        && this._lastInputLocalPosition.y == this._updateInputLocalPosition.y)\r\n        this._drawPS.emit = false;\r\n\r\n    this._updateInputLocalPosition.x = this._lastInputLocalPosition.x;\r\n    this._updateInputLocalPosition.y = this._lastInputLocalPosition.y;\r\n};\r\n\r\nDrawLayer.prototype.setLayerData = function (data, dynOutlineData) {\r\n    this._context.putImageData(data, 0, 0);\r\n\r\n    this._dynOutlineLayerData = dynOutlineData;\r\n    this._dynOutlineContext.putImageData(dynOutlineData, 0, 0);\r\n\r\n\r\n    this._layerSprite.texture.update();\r\n};\r\n\r\nDrawLayer.prototype.clear = function () {\r\n    this._dynOutlineContext.clearRect(0, 0, this._canvas2d.width, this._canvas2d.height);\r\n    this._dynOutlineLayerData = this._dynOutlineContext.getImageData(0, 0, this._dynOutline_c2d.width, this._dynOutline_c2d.height);\r\n\r\n    this._context.clearRect(0, 0, this._canvas2d.width, this._canvas2d.height);\r\n\r\n    this._layerSprite.texture.update();\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\n// TODO:\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nDrawLayer.prototype.onContext_Changed = function () {\r\n    // Tutorial.\r\n    Common.game.scene.addTutorialEvent(CommonGame.TUT_EVENT.CANVAS_DRAWN);\r\n\r\n    this._layerSprite.texture.update();\r\n};\r\n\r\nDrawLayer.prototype._onDrawLayer_MouseDown = function (mouseData) {\r\n    //console.log( \"mousedown\" );\r\n\r\n    // Undo manager.\r\n    Common.game.undoManager.save();\r\n\r\n\r\n    // Use canvas' left-top corner as origin.\r\n    var localCoordsPosition = mouseData.data.getLocalPosition(this._layerSprite);\r\n    var ctxCoordPosition = new PIXI.Point();\r\n    ctxCoordPosition.x = Math.floor(localCoordsPosition.x + Common.game.canvas.WIDTH * 0.5);\r\n    ctxCoordPosition.y = Math.floor(localCoordsPosition.y + Common.game.canvas.HEIGHT * 0.5);\r\n\r\n    this._lastInputLocalPosition = new PIXI.Point(ctxCoordPosition.x, ctxCoordPosition.y);\r\n    this._state = this.STATE.DRAWING;\r\n\r\n    this._drawingTool.onDrawBegan(ctxCoordPosition);\r\n\r\n\r\n    // Vfx.\r\n    if (this._drawingTool == this._stamp\r\n        || this._drawingTool == this._spray) {\r\n        this._drawPS.spawnPos = new PIXI.Point(localCoordsPosition.x, localCoordsPosition.y);\r\n        this._drawPS.emit = true;\r\n    }\r\n};\r\n\r\nDrawLayer.prototype._onDrawLayer_MouseMove = function (mouseData) {\r\n    //console.log( \"mousemove\" );\r\n\r\n    if (this._state != this.STATE.DRAWING) return;\r\n\r\n    // Use canvas' left-top corner as origin.\r\n    var localCoordsPosition = mouseData.data.getLocalPosition(this._layerSprite);\r\n    var ctxCoordPosition = new PIXI.Point();\r\n    ctxCoordPosition.x = Math.floor(localCoordsPosition.x + Common.game.canvas.WIDTH * 0.5);\r\n    ctxCoordPosition.y = Math.floor(localCoordsPosition.y + Common.game.canvas.HEIGHT * 0.5);\r\n\r\n    this._drawingTool.onDrawMoved(this._lastInputLocalPosition, ctxCoordPosition);\r\n\r\n    this._lastInputLocalPosition.x = ctxCoordPosition.x;\r\n    this._lastInputLocalPosition.y = ctxCoordPosition.y;\r\n\r\n    // Vfx.\r\n    if (this._drawingTool != this._stamp) {\r\n        if (!this._drawPS.emit) {\r\n            this._drawPS.resetPositionTracking();\r\n            this._drawPS.spawnPos = new PIXI.Point(localCoordsPosition.x, localCoordsPosition.y);\r\n            this._drawPS.emit = true;\r\n        }\r\n        else\r\n            this._drawPS.updateSpawnPos(localCoordsPosition.x, localCoordsPosition.y);\r\n    }\r\n};\r\n\r\nDrawLayer.prototype._onDrawLayer_MouseUp = function (mouseData) {\r\n    //console.log( \"mouseup\" );\r\n\r\n    if (this._state == this.STATE.DRAWING) {\r\n        this._drawingTool.onDrawEnded();\r\n\r\n        this._state = this.STATE.IDLE;\r\n\r\n        // Vfx.\r\n        if (this._drawingTool != this._stamp)\r\n            this._drawPS.emit = false;\r\n    }\r\n};\r\n\r\nDrawLayer.prototype._onDrawLayer_MouseOut = function (mouseData) {\r\n    //console.log( \"mouseout\" );\r\n\r\n    if (this._state == this.STATE.DRAWING) {\r\n        this._drawingTool.onDrawEnded();\r\n\r\n        this._state = this.STATE.IDLE;\r\n    }\r\n\r\n    // Vfx.\r\n    this._drawPS.emit = false;\r\n};\r\n\r\nDrawLayer.prototype._onThickness_Changed = function (selection) {\r\n    this._thickness = this.BASE_LINE_THICKNESS * ( selection + 1 );\r\n};\r\n\r\nDrawLayer.prototype._onColour_Changed = function (selection) {\r\n    if (this._drawingTool == this._pencil\r\n        || this._drawingTool == this._brush\r\n        || this._drawingTool == this._spray\r\n        || this._drawingTool == this._inkPot) {\r\n        var rgbColour = {r: 255, g: 255, b: 255};\r\n\r\n        if (this._drawingTool.paletteItem.indexOf(\"#\") == 0)\r\n            rgbColour = Common.hexToRgb(this._drawingTool.paletteItem);\r\n\r\n        this._drawPS.startColor = [rgbColour.r, rgbColour.g, rgbColour.b];\r\n        this._drawPS.endColor = this._drawPS.startColor;\r\n    }\r\n};\r\n\r\nDrawLayer.prototype._onDrawMode_Changed = function (selection) {\r\n    var rgbColour = {r: 255, g: 255, b: 255};\r\n\r\n    switch (selection) {\r\n        case CommonGame.TOOL.PENCIL:\r\n        {\r\n            this._drawingTool = this._pencil;\r\n\r\n            // Vfx.\r\n            if (this._drawingTool.paletteItem.indexOf(\"#\") == 0)\r\n                rgbColour = Common.hexToRgb(this._drawingTool.paletteItem);\r\n            this._drawPS = new PIXI.particles.Emitter(this, [Common.assets.getTexture(\"particle_draw\")], Common.assets.getJSON(\"pencil_ps\"));\r\n            this._drawPS.emitterLifetime = -1;\r\n\r\n            // Sfx.\r\n            //Common.audio.playSound( \"sfx_tool_pencil_select_00\" );\r\n            break;\r\n        }\r\n\r\n        case CommonGame.TOOL.BRUSH:\r\n        {\r\n            this._drawingTool = this._brush;\r\n\r\n            // Vfx.\r\n            if (this._drawingTool.paletteItem.indexOf(\"#\") == 0)\r\n                rgbColour = Common.hexToRgb(this._drawingTool.paletteItem);\r\n            this._drawPS = new PIXI.particles.Emitter(this, [Common.assets.getTexture(\"particle_paintbrush\")], Common.assets.getJSON(\"brush_ps\"));\r\n            this._drawPS.emitterLifetime = -1;\r\n\r\n            // Sfx.\r\n            //Common.audio.playSound( \"sfx_tool_paintbrush_select_00\" );\r\n            break;\r\n        }\r\n\r\n        case CommonGame.TOOL.SPRAY:\r\n        {\r\n            this._drawingTool = this._spray;\r\n\r\n            // Vfx.\r\n            if (this._drawingTool.paletteItem.indexOf(\"#\") == 0)\r\n                rgbColour = Common.hexToRgb(this._drawingTool.paletteItem);\r\n            this._drawPS = new PIXI.particles.Emitter(this, [Common.assets.getTexture(\"particle_spray\")], Common.assets.getJSON(\"spray_ps\"));\r\n            this._drawPS.emitterLifetime = -1;\r\n\r\n            // Sfx.\r\n            //Common.audio.playSound( \"sfx_tool_spraycan_select_00\" );\r\n            break;\r\n        }\r\n\r\n        case CommonGame.TOOL.STAMP:\r\n        {\r\n            this._drawingTool = this._stamp;\r\n\r\n            // Vfx.\r\n            rgbColour = Common.hexToRgb(\"#ffe400\");\r\n            this._drawPS = new PIXI.particles.Emitter(this, [Common.assets.getTexture(\"particle_stamp\")], Common.assets.getJSON(\"stamp_ps\"));\r\n            this._drawPS.emitterLifetime = 0.1;\r\n\r\n            // Sfx.\r\n            //Common.audio.playSound( \"sfx_tool_stamps_select_00\" );\r\n            break;\r\n        }\r\n\r\n        case CommonGame.TOOL.INK_POT:\r\n        {\r\n            this._drawingTool = this._inkPot;\r\n\r\n            // Vfx.\r\n            if (this._drawingTool.paletteItem.indexOf(\"#\") == 0)\r\n                rgbColour = Common.hexToRgb(this._drawingTool.paletteItem);\r\n            this._drawPS = new PIXI.particles.Emitter(this, [Common.assets.getTexture(\"particle_ink_splatter\")], Common.assets.getJSON(\"ink_splatter_ps\"));\r\n            this._drawPS.emitterLifetime = -1;\r\n\r\n            // Sfx.\r\n            //Common.audio.playSound( \"sfx_tool_inkpot_select_00\" );\r\n            break;\r\n        }\r\n\r\n        case CommonGame.TOOL.ERASER:\r\n        {\r\n            this._drawingTool = this._eraser;\r\n\r\n            // Vfx.\r\n            rgbColour = Common.hexToRgb(\"#fd93bd\");\r\n            this._drawPS = new PIXI.particles.Emitter(this, [Common.assets.getTexture(\"particle_erase\")], Common.assets.getJSON(\"eraser_ps\"));\r\n            this._drawPS.emitterLifetime = -1;\r\n\r\n            // Sfx.\r\n            //Common.audio.playSound( \"sfx_tool_eraser_select_00\" );\r\n            break;\r\n        }\r\n    }\r\n\r\n    this._drawPS.startColor = [rgbColour.r, rgbColour.g, rgbColour.b];\r\n    this._drawPS.endColor = this._drawPS.startColor;\r\n    this._drawPS.emit = false;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    DrawLayer.prototype,\r\n    \"context\",\r\n    {\r\n        get: function () {\r\n            return this._context;\r\n        }\r\n    });\r\n\r\nObject.defineProperty(\r\n    DrawLayer.prototype,\r\n    \"dynOutlineContext\",\r\n    {\r\n        get: function () {\r\n            return this._dynOutlineContext;\r\n        }\r\n    });\r\n\r\nObject.defineProperty(\r\n    DrawLayer.prototype,\r\n    \"state\",\r\n    {\r\n        get: function () {\r\n            return this._state;\r\n        }\r\n    });\r\n\r\nObject.defineProperty(\r\n    DrawLayer.prototype,\r\n    \"drawingTool\",\r\n    {\r\n        get: function () {\r\n            return this._drawingTool;\r\n        }\r\n    });\r\n\r\nObject.defineProperty(\r\n    DrawLayer.prototype,\r\n    \"dynOutlineData\",\r\n    {\r\n        get: function () {\r\n            return this._dynOutlineLayerData;\r\n        },\r\n        set: function (a) {\r\n            return this._dynOutlineLayerData = a;\r\n        }\r\n    });","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction Eraser() {\r\n    // Constants.\r\n    this.LINE_THICKNESS = 10;\r\n\r\n    // Attributes.\r\n    this._drawLayer = null;\r\n    this._fillLayer = null;\r\n    this._audio = null;\r\n    this._arrCanvasContext = [];\r\n}\r\nexport default Eraser;\r\n//module.exports               \t= Eraser;\r\nEraser.prototype.constructor = Eraser;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nEraser.prototype.init = function (drawLayer, fillLayer) {\r\n    this._drawLayer = drawLayer;\r\n    this._fillLayer = fillLayer;\r\n\r\n    this._arrCanvasContext.push(this._drawLayer.context);\r\n    this._arrCanvasContext.push(this._fillLayer._colourContext);\r\n    this._arrCanvasContext.push(this._fillLayer._colourCodeContext);\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nEraser.prototype._draw = function (context, from, to) {\r\n    context.beginPath();\r\n    context.lineWidth = this.LINE_THICKNESS;\r\n    context.lineJoin = \"round\";\r\n    context.moveTo(from.x, from.y);\r\n    context.lineTo(to.x, to.y);\r\n    context.closePath();\r\n    context.stroke();\r\n};\r\n\r\nEraser.prototype._stopAudio = function () {\r\n    this._audio.howl.stop(this._audio.id);\r\n    this._audio = null;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nEraser.prototype.onDrawBegan = function (point) {\r\n    for (var context of this._arrCanvasContext) {\r\n        context.save();\r\n        context.globalCompositeOperation = \"destination-out\";\r\n        context.strokeStyle = \"rgba( 255, 255, 255, 255 )\";\r\n\r\n        this._draw(context, point, new PIXI.Point(point.x + 0.1, point.y + 0.1));\r\n    }\r\n\r\n    // TEST: DYN_OUT:\r\n    var dynOutlineContext = Common.game.canvas.drawLayer.dynOutlineContext;\r\n    dynOutlineContext.save();\r\n    dynOutlineContext.globalCompositeOperation = \"destination-out\";\r\n    dynOutlineContext.beginPath();\r\n    dynOutlineContext.strokeStyle = \"rgba( 255, 255, 255, 255 )\";\r\n    dynOutlineContext.lineWidth = this.LINE_THICKNESS;\r\n    dynOutlineContext.lineJoin = \"round\";\r\n    dynOutlineContext.moveTo(point.x, point.y);\r\n    dynOutlineContext.lineTo(point.x + 0.1, point.y + 0.1);\r\n    dynOutlineContext.closePath();\r\n    dynOutlineContext.stroke();\r\n\r\n    this._drawLayer.onContext_Changed();\r\n    this._fillLayer.onContext_Changed();\r\n};\r\n\r\nEraser.prototype.onDrawMoved = function (from, to) {\r\n    // Sfx.\r\n    if (this._audio == null)\r\n        this._audio = Common.audio.playSound(\"sfx_tool_eraser_loop_03\", {\"loop\": true});\r\n    TweenMax.killDelayedCallsTo(this._stopAudio);\r\n    TweenMax.delayedCall(0.25, this._stopAudio, null, this);\r\n\r\n\r\n    this._lastPosition = Common.renderer.plugins.interaction.mouse.global;\r\n\r\n    for (var context of this._arrCanvasContext)\r\n        this._draw(context, from, to);\r\n\r\n    this._drawLayer.onContext_Changed();\r\n    this._fillLayer.onContext_Changed();\r\n\r\n    // TEST: DYN_OUT:\r\n    var dynOutlineContext = Common.game.canvas.drawLayer.dynOutlineContext;\r\n    dynOutlineContext.beginPath();\r\n    dynOutlineContext.lineWidth = this.LINE_THICKNESS;\r\n    dynOutlineContext.lineJoin = \"round\";\r\n    dynOutlineContext.moveTo(from.x, from.y);\r\n    dynOutlineContext.lineTo(to.x, to.y);\r\n    dynOutlineContext.closePath();\r\n    dynOutlineContext.stroke();\r\n};\r\n\r\nEraser.prototype.onDrawEnded = function () {\r\n    // Sfx.\r\n    TweenMax.killDelayedCallsTo(this._stopAudio);\r\n    if (this._audio != null)\r\n        this._stopAudio();\r\n\r\n\r\n    for (var context of this._arrCanvasContext)\r\n        context.restore();\r\n\r\n    // TEST: DYN_OUT:\r\n    var dynOutlineContext = Common.game.canvas.drawLayer.dynOutlineContext;\r\n    dynOutlineContext.restore();\r\n    Common.game.canvas.drawLayer._dynOutlineLayerData = dynOutlineContext.getImageData(0, 0, Common.game.canvas.WIDTH, Common.game.canvas.HEIGHT);\r\n\r\n    this._fillLayer.updateContextData();\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\n// TODO:","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport PalettePanel from \"../ui/overlays/PalettePanel\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction FillLayer() {\r\n    PIXI.Container.call(this);\r\n\r\n\r\n    // Enumerators.\r\n    this.STATE =\r\n    {\r\n        IDLE: 0,\r\n        FILL_ANIM: 1\r\n    };\r\n\r\n\r\n    // Attributes.\r\n    this._state = this.STATE.IDLE;\r\n    this._paletteItem = null;\r\n\r\n    this._colour_c2d = null;\r\n    this._colourCode_c2d = null;\r\n    this._fillAnim_c2d = null;\r\n\r\n    this._colourContext = null;\r\n    this._colourCodeContext = null;\r\n    this._fillAnimContext = null;\r\n\r\n    this._curColour = null;\r\n\r\n    this._outlineImage = new Image();\r\n\r\n    // Buffers.\r\n    this._fillAnimLayerData = null;\r\n    this._colourLayerData = null; // Contains the pixel colour for the painted areas (no outline) as they are seen on the screen.\r\n    this._outlineLayerData = null; // Contains the pixel colour for the outline. Its content is not displayed.\r\n    this._colourCodeLayerData = null; // Contains the pixel colour CODE for the painted areas (no outline). Its content is not displayed.\r\n    // The flood fill algorithm implemented uses plain colours, so to make it compatible with textures it is necessary to use this auxiliary buffer.\r\n\r\n    // Sprites.\r\n    this._colourLayerSprite = null;\r\n    this._fillAnimLayerSprite = null;\r\n    this._outlineLayerSprite = null;\r\n    this._fillAnimMask = null;\r\n\r\n    // Input.\r\n    this._lastInputGlobalPosition = new PIXI.Point();\r\n\r\n    // Fill animation.\r\n    this._fillAnimRadius = 0;\r\n    this._fillAnimMaxDeltaX = 0;\r\n    this._fillAnimMaxDeltaY = 0;\r\n    this._textureStartPixelPos = -1; // The pixel position (as an index in colourLayerData ) where the selected texture is applied.\r\n\r\n    this._drawPS = null;\r\n}\r\nexport default FillLayer;\r\n//module.exports               \t\t= FillLayer;\r\nFillLayer.prototype = Object.create(PIXI.Container.prototype);\r\nFillLayer.prototype.constructor = FillLayer;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nFillLayer.prototype.init = function () {\r\n    // Canvas.\r\n    this._colour_c2d = document.createElement('canvas');\r\n    this._colour_c2d.width = Common.game.canvas.WIDTH;\r\n    this._colour_c2d.height = Common.game.canvas.HEIGHT;\r\n\r\n    this._colourCode_c2d = document.createElement('canvas');\r\n    this._colourCode_c2d.width = Common.game.canvas.WIDTH;\r\n    this._colourCode_c2d.height = Common.game.canvas.HEIGHT;\r\n\r\n    this._fillAnim_c2d = document.createElement('canvas');\r\n    this._fillAnim_c2d.width = Common.game.canvas.WIDTH;\r\n    this._fillAnim_c2d.height = Common.game.canvas.HEIGHT;\r\n\r\n    // Context.\r\n    this._colourContext = this._colour_c2d.getContext('2d');\r\n    this._colourCodeContext = this._colourCode_c2d.getContext('2d');\r\n    this._fillAnimContext = this._fillAnim_c2d.getContext('2d');\r\n\r\n    // Layers.\r\n    // Fill colour.\r\n    this._colourLayerSprite = new PIXI.Sprite(PIXI.Texture.fromCanvas(this._colour_c2d));\r\n    this._colourLayerSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n    this._colourLayerSprite.interactive = true;\r\n    this._colourLayerSprite.click = this._colourLayerSprite.touchend = this._onFillLayer_Click.bind(this);\r\n    this.addChild(this._colourLayerSprite);\r\n    // Fill animation.\r\n    this._fillAnimMask = new PIXI.Graphics();\r\n    this.addChild(this._fillAnimMask);\r\n    this._fillAnimLayerSprite = new PIXI.Sprite(PIXI.Texture.fromCanvas(this._fillAnim_c2d));\r\n    this._fillAnimLayerSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n    this._fillAnimLayerSprite.mask = this._fillAnimMask;\r\n    this.addChild(this._fillAnimLayerSprite);\r\n    // Outline.\r\n    var outlineTexture = PIXI.Texture.fromImage(\"assets/images/outlines/\" + ( CommonGame.selectedGallery == CommonGame.GALLERY_ID_DRAW_IT ? \"draw_it/\" : \"colour_it/\" ) + CommonGame.selectedImageId + \".png\");\r\n    this._outlineLayerSprite = new PIXI.Sprite(outlineTexture);\r\n    var croppedOutlineTexture = new PIXI.Texture(outlineTexture, new PIXI.Rectangle(outlineTexture.width * 0.5 - Common.game.canvas.WIDTH * 0.5, outlineTexture.height * 0.5 - Common.game.canvas.HEIGHT * 0.5, Common.game.canvas.WIDTH, Common.game.canvas.HEIGHT));\r\n    this._outlineLayerSprite.setTexture(croppedOutlineTexture);\r\n\r\n    //this._outlineLayerSprite = new PIXI.Sprite( Common.assets.getTexture( CommonGame.selectedImageId ) );\r\n    this._outlineLayerSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n    this.addChild(this._outlineLayerSprite);\r\n\r\n    // Buffers.\r\n    this._colourContext.clearRect(0, 0, this._colour_c2d.width, this._colour_c2d.height);\r\n    // Fill animation.\r\n    this._fillAnimLayerData = this._fillAnimContext.getImageData(0, 0, this._fillAnim_c2d.width, this._fillAnim_c2d.height);\r\n    // Colour.\r\n    this._colourLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\r\n    // Colour code.\r\n    this._colourCodeLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\r\n    // Outline.\r\n    this._outlineImage.src = \"assets/images/outlines/\" + ( CommonGame.selectedGallery == CommonGame.GALLERY_ID_DRAW_IT ? \"draw_it/\" : \"colour_it/\" ) + CommonGame.selectedImageId + \".png\";\r\n    this._colourContext.drawImage(\r\n        this._outlineImage,\r\n        this._colourLayerSprite.width * 0.5 - this._outlineImage.width * 0.5 * this._outlineLayerSprite.scale.x,\r\n        this._colourLayerSprite.height * 0.5 - this._outlineImage.height * 0.5 * this._outlineLayerSprite.scale.y,\r\n        this._outlineImage.width * this._outlineLayerSprite.scale.x,\r\n        this._outlineImage.height * this._outlineLayerSprite.scale.y);\r\n    this._outlineLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\r\n\r\n    //this._colourContext.fillStyle = 'white';\r\n    //this._colourContext.fillRect( 0, 0, this._colour_c2d.width, this._colour_c2d.height );\r\n\r\n    // TODO: ???\r\n    this._colourContext.clearRect(0, 0, this._colourContext.canvas.width, this._colourContext.canvas.height);\r\n\r\n    // Initial empty canvas .\r\n    this._colourContext.clearRect(0, 0, this._colour_c2d.width, this._colour_c2d.height);\r\n\r\n    // Default colour.\r\n    this._onColour_Changed(Common.assets.getJSON(\"config\").palettePanel.pages[0][0], 0, 0);\r\n\r\n    // Vfx.\r\n    this._drawPS = new PIXI.particles.Emitter(this._outlineLayerSprite, [Common.assets.getTexture(\"particle_paintfill\")], Common.assets.getJSON(\"fill_ps\"));\r\n    this._drawPS.emit = false;\r\n    this._drawPS.emitterLifetime = 0.1;\r\n\r\n    // Listen to HUD controls.\r\n    Common.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\r\n};\r\n\r\nFillLayer.prototype.update = function () {\r\n    // Vfx.\r\n    this._drawPS.update(P3.Timestep.deltaTime);\r\n};\r\n\r\nFillLayer.prototype.setEnabled = function (isEnabled) {\r\n    this._colourLayerSprite.interactive = isEnabled;\r\n};\r\n\r\nFillLayer.prototype.setLayerData = function (data, colourCodeData) {\r\n    this._colourCodeLayerData = colourCodeData;\r\n    this._colourCodeContext.putImageData(colourCodeData, 0, 0);\r\n    //this._colourCodeLayerData = this._colourCodeContext.getImageData( 0, 0, this._colourCode_c2d.width, this._colourCode_c2d.height );\r\n\r\n    this._colourLayerData = data;\r\n    this._colourContext.putImageData(data, 0, 0);\r\n\r\n\r\n    this._colourLayerSprite.texture.update();\r\n};\r\n\r\nFillLayer.prototype.clear = function () {\r\n    this._colourContext.clearRect(0, 0, this._colour_c2d.width, this._colour_c2d.height);\r\n    this._colourLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\r\n\r\n    this._colourCodeLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\r\n\r\n\r\n    this._colourLayerSprite.texture.update();\r\n};\r\n\r\nFillLayer.prototype.updateContextData = function () {\r\n    this._colourCodeLayerData = this._colourCodeContext.getImageData(0, 0, this._colourCode_c2d.width, this._colourCode_c2d.height);\r\n    this._colourLayerData = this._colourContext.getImageData(0, 0, this._colour_c2d.width, this._colour_c2d.height);\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nFillLayer.prototype._fillAt = function (startX, startY) {\r\n    //console.log( \"_fillAt :: ini\" );\r\n\r\n    // Check same colour.\r\n    var pixelIndex = ( startY * this._colour_c2d.width + startX ) * 4;\r\n    var r = this._colourCodeLayerData.data[pixelIndex];\r\n    var g = this._colourCodeLayerData.data[pixelIndex + 1];\r\n    var b = this._colourCodeLayerData.data[pixelIndex + 2];\r\n    var a = this._colourCodeLayerData.data[pixelIndex + 3];\r\n\r\n    if (r == this._curColour.colourCode.r\r\n        && g == this._curColour.colourCode.g\r\n        && b == this._curColour.colourCode.b) {\r\n        // Return because trying to fill with the same colour\r\n        //console.log( \"same colour!\" );\r\n\r\n        return;\r\n    }\r\n\r\n    // Check outline.\r\n    a = this._outlineLayerData.data[pixelIndex + 3];\r\n    if (a > 0) {\r\n        // Return because clicked outline\r\n        //console.log( \"outline!\" );\r\n\r\n        return;\r\n    }\r\n\r\n    // Check dynamic outline.\r\n    a = Common.game.canvas.drawLayer.dynOutlineData.data[pixelIndex + 3];\r\n    if (a > 0) {\r\n        // Return because clicked dyn outline\r\n        //console.log( \"dyn outline!\" );\r\n\r\n        return;\r\n    }\r\n\r\n\r\n    // Flood fill.\r\n    this._textureStartPixelPos = pixelIndex;\r\n    this._floodFill(startX, startY);\r\n\r\n\r\n    // Redraw.\r\n    this._colourContext.clearRect(0, 0, this._colourContext.canvas.width, this._colourContext.canvas.height);\r\n    this._colourContext.putImageData(this._colourLayerData, 0, 0);\r\n    //this._colourLayerSprite.texture.update();\r\n\r\n    // Filling animation.\r\n    var targetRadius = Math.sqrt(Math.pow(this._fillAnimMaxDeltaX, 2) + Math.pow(this._fillAnimMaxDeltaY, 2));\r\n    TweenMax.to(\r\n        this,\r\n        targetRadius / 600,\r\n        {\r\n            _fillAnimRadius: targetRadius,\r\n            ease: Linear.easeInOut,\r\n            onComplete: function () {\r\n                this._updateFillAnimMask();\r\n\r\n                this._fillAnimMaxDeltaX = 0;\r\n                this._fillAnimMaxDeltaY = 0;\r\n                this._fillAnimRadius = 0;\r\n                this._state = this.STATE.IDLE;\r\n\r\n                // Update layers and buffers.\r\n                this._colourLayerSprite.texture.update();\r\n\r\n                this._fillAnimMask.clear();\r\n\r\n                this._fillAnimContext.clearRect(0, 0, this._fillAnim_c2d.width, this._fillAnim_c2d.height);\r\n                this._fillAnimLayerData = this._fillAnimContext.getImageData(0, 0, this._fillAnim_c2d.width, this._fillAnim_c2d.height);\r\n                this._fillAnimLayerSprite.texture.update();\r\n            },\r\n            onCompleteScope: this,\r\n            onUpdate: function () {\r\n                this._updateFillAnimMask();\r\n            },\r\n            onUpdateScope: this\r\n        });\r\n\r\n    this._fillAnimContext.putImageData(this._fillAnimLayerData, 0, 0);\r\n    this._fillAnimLayerSprite.texture.update();\r\n\r\n    this._state = this.STATE.FILL_ANIM;\r\n\r\n\r\n    //console.log( \"_fillAt :: end\" );\r\n};\r\n\r\nFillLayer.prototype._floodFill = function (startX, startY) {\r\n    var newPos,\r\n        x,\r\n        y,\r\n        pixelIndex,\r\n        reachLeft,\r\n        reachRight,\r\n        drawingBoundLeft = 0,\r\n        drawingBoundTop = 0,\r\n        drawingBoundRight = Common.game.canvas.WIDTH - 1,\r\n        drawingBoundBottom = Common.game.canvas.HEIGHT - 1,\r\n        pixelStack = [[startX, startY]];\r\n\r\n    while (pixelStack.length) {\r\n        newPos = pixelStack.pop();\r\n        x = newPos[0];\r\n        y = newPos[1];\r\n\r\n        //console.log( \"dx = \" + dx );\r\n        var dx = x - startX;\r\n        var dy = y - startY;\r\n\r\n        // Update limits for filling animation.\r\n        if (Math.abs(dy) > this._fillAnimMaxDeltaY)\r\n            this._fillAnimMaxDeltaY = Math.abs(dy);\r\n        if (Math.abs(dx) > this._fillAnimMaxDeltaX)\r\n            this._fillAnimMaxDeltaX = Math.abs(dx);\r\n\r\n        // Get current pixel index inside image data.\r\n        pixelIndex = ( y * this._colour_c2d.width + x ) * 4;\r\n\r\n        // Go up as long as the colour matches and are inside the canvas.\r\n        while (y >= drawingBoundTop && this._isPixelToFill(pixelIndex)) {\r\n            y -= 1;\r\n            pixelIndex -= this._colour_c2d.width * 4;\r\n        }\r\n\r\n        pixelIndex += this._colour_c2d.width * 4;\r\n        y += 1;\r\n        reachLeft = false;\r\n        reachRight = false;\r\n\r\n        // Go down as long as the colour matches and in inside the canvas.\r\n        while (y <= drawingBoundBottom && this._isPixelToFill(pixelIndex)) {\r\n            this._paintPixel(pixelIndex);\r\n\r\n            //console.log( \"_floodFill :: pixelIndex = \" + pixelIndex );\r\n\r\n            if (x > drawingBoundLeft) {\r\n                if (this._isPixelToFill(pixelIndex - 4)) {\r\n                    if (!reachLeft) {\r\n                        // Add pixel to stack\r\n                        pixelStack.push([x - 1, y]);\r\n                        reachLeft = true;\r\n                    }\r\n                }\r\n                else if (reachLeft)\r\n                    reachLeft = false;\r\n            }\r\n\r\n            if (x < drawingBoundRight) {\r\n                if (this._isPixelToFill(pixelIndex + 4)) {\r\n                    if (!reachRight) {\r\n                        // Add pixel to stack\r\n                        pixelStack.push([x + 1, y]);\r\n                        reachRight = true;\r\n                    }\r\n                }\r\n                else if (reachRight)\r\n                    reachRight = false;\r\n            }\r\n\r\n            y += 1;\r\n            pixelIndex += this._colour_c2d.width * 4;\r\n\r\n            // Update limits for filling animation.\r\n            dy = y - startY;\r\n            if (Math.abs(dy) > this._fillAnimMaxDeltaY)\r\n                this._fillAnimMaxDeltaY = Math.abs(dy);\r\n        }\r\n    }\r\n};\r\n\r\nFillLayer.prototype._isPixelToFill = function (pixelIndex) {\r\n    var result = true;\r\n\r\n    // If given pixel is not part of the outline.\r\n    var r = this._outlineLayerData.data[pixelIndex];\r\n    var g = this._outlineLayerData.data[pixelIndex + 1];\r\n    var b = this._outlineLayerData.data[pixelIndex + 2];\r\n    var a = this._outlineLayerData.data[pixelIndex + 3];\r\n\r\n    // TODO: Adjust tolerance as necessary.\r\n    result = a <= 255 * 0.5;\r\n\r\n    // If current pixel doesn't match the new colour.\r\n    if (result) {\r\n        r = this._colourCodeLayerData.data[pixelIndex];\r\n        g = this._colourCodeLayerData.data[pixelIndex + 1];\r\n        b = this._colourCodeLayerData.data[pixelIndex + 2];\r\n\r\n        result = r != this._curColour.colourCode.r\r\n            || g != this._curColour.colourCode.g\r\n            || b != this._curColour.colourCode.b;\r\n    }\r\n\r\n    // TEST: DYN_OUT:\r\n    // If current pixel is not part of the dynamic outline.\r\n    if (result) {\r\n        a = Common.game.canvas.drawLayer.dynOutlineData.data[pixelIndex + 3];\r\n        // TODO: Adjust tolerance as necessary.\r\n        result = a < 255;\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\nFillLayer.prototype._paintPixel = function (pixelIndex) {\r\n    // Find pixel colour.\r\n    var r, g, b, a;\r\n    if (this._curColour.isTexture) {\r\n        // pixelIndex is not in canvas coordinates, but image data coordinates! Divide by 4 ( r + g + b + a ) to make the conversion.\r\n        var dy = Math.floor(pixelIndex / 4 / this._colour_c2d.width) - Math.floor(this._textureStartPixelPos / 4 / this._colour_c2d.width);\r\n        var dx = Math.floor(pixelIndex / 4 % this._colour_c2d.width) - Math.floor(this._textureStartPixelPos / 4 % this._colour_c2d.width);\r\n\r\n        var textureY = dy % this._curColour.data.height;\r\n        if (textureY < 0)\r\n            textureY += this._curColour.data.height;\r\n        var textureX = dx % this._curColour.data.height;\r\n        if (textureX < 0)\r\n            textureX += this._curColour.data.height;\r\n        var basePixelPos = ( this._curColour.data.height * textureY + textureX ) * 4;\r\n\r\n        //console.log( \"dx,dy = \" + dx + \" :: \" + dy );\r\n\r\n        r = this._curColour.data.data[basePixelPos];\r\n        g = this._curColour.data.data[basePixelPos + 1];\r\n        b = this._curColour.data.data[basePixelPos + 2];\r\n        a = this._curColour.data.data[basePixelPos + 3] !== undefined ? this._curColour.data.data[basePixelPos + 3] : 255;\r\n    }\r\n    else {\r\n        r = this._curColour.r;\r\n        g = this._curColour.g;\r\n        b = this._curColour.b;\r\n        a = this._curColour.a !== undefined ? this._curColour.a : 255;\r\n    }\r\n\r\n    // Buffers.\r\n    // Colour.\r\n    this._colourLayerData.data[pixelIndex] = r;\r\n    this._colourLayerData.data[pixelIndex + 1] = g;\r\n    this._colourLayerData.data[pixelIndex + 2] = b;\r\n    this._colourLayerData.data[pixelIndex + 3] = a;\r\n    // Filling.\r\n    this._fillAnimLayerData.data[pixelIndex] = r;\r\n    this._fillAnimLayerData.data[pixelIndex + 1] = g;\r\n    this._fillAnimLayerData.data[pixelIndex + 2] = b;\r\n    this._fillAnimLayerData.data[pixelIndex + 3] = a;\r\n    // Colour code.\r\n    this._colourCodeLayerData.data[pixelIndex] = this._curColour.colourCode.r;\r\n    this._colourCodeLayerData.data[pixelIndex + 1] = this._curColour.colourCode.g;\r\n    this._colourCodeLayerData.data[pixelIndex + 2] = this._curColour.colourCode.b;\r\n    this._colourCodeLayerData.data[pixelIndex + 3] = 255;\r\n};\r\n\r\nFillLayer.prototype._updateFillAnimMask = function () {\r\n    this._fillAnimMask.clear();\r\n    this._fillAnimMask.beginFill();\r\n    this._fillAnimMask.drawCircle(this._lastInputGlobalPosition.x, this._lastInputGlobalPosition.y, this._fillAnimRadius);\r\n    this._fillAnimMask.endFill();\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nFillLayer.prototype.onContext_Changed = function () {\r\n    this._colourLayerSprite.texture.update();\r\n};\r\n\r\nFillLayer.prototype._onColour_Changed = function (selection, pageIndex, itemIndex) {\r\n    this._paletteItem = selection;\r\n    if (selection.indexOf(\"#\") == 0) {\r\n        // Colour.\r\n        var rgbColour = Common.hexToRgb(selection);\r\n\r\n        this._curColour =\r\n        {\r\n            r: rgbColour.r,\r\n            g: rgbColour.g,\r\n            b: rgbColour.b,\r\n            isTexture: false,\r\n            colourCode: {r: pageIndex, g: itemIndex, b: 1} // { r: 0, g: 0, b: 0 } is reserved to represent no colour code, so make sure to not use it! That's why b: 1.\r\n        };\r\n    }\r\n    else {\r\n        // Texture.\r\n        var texture = Common.assets.getTexture(selection);\r\n        var frame = texture.frame;\r\n        var canvas = document.createElement('canvas');\r\n        canvas.width = frame.width;\r\n        canvas.height = frame.height;\r\n        var context = canvas.getContext('2d');\r\n        context.drawImage(\r\n            texture.baseTexture.source,\r\n            frame.x * Common.main.assetRes,\r\n            frame.y * Common.main.assetRes,\r\n            frame.width * Common.main.assetRes,\r\n            frame.height * Common.main.assetRes,\r\n            0, 0,\r\n            frame.width, frame.height);\r\n\r\n        this._curColour =\r\n        {\r\n            data: context.getImageData(0, 0, canvas.width, canvas.height),\r\n            isTexture: true,\r\n            colourCode: {r: pageIndex, g: itemIndex, b: 1} // { r: 0, g: 0, b: 0 } is reserved to represent no colour code, so make sure to not use it! That's why b: 1.\r\n        }\r\n    }\r\n};\r\n\r\nFillLayer.prototype._onFillLayer_Click = function (mouseData) {\r\n    if (this._state == this.STATE.FILL_ANIM) return;\r\n\r\n    // Undo manager.\r\n    this._colourCodeContext.putImageData(this._colourCodeLayerData, 0, 0);\r\n    Common.game.undoManager.save();\r\n\r\n\r\n    // Use canvas' left-top corner as origin.\r\n    var localCoordsPosition = mouseData.data.getLocalPosition(this._colourLayerSprite);\r\n    var ctxCoordPosition = new PIXI.Point();\r\n    ctxCoordPosition.x = Math.floor(localCoordsPosition.x + Common.game.canvas.WIDTH * 0.5);\r\n    ctxCoordPosition.y = Math.floor(localCoordsPosition.y + Common.game.canvas.HEIGHT * 0.5);\r\n    //console.log( localCoordsPosition.x + \" :: \" + localCoordsPosition.y );\r\n\r\n    this._fillAt(Math.floor(ctxCoordPosition.x), Math.floor(ctxCoordPosition.y));\r\n\r\n    this._lastInputGlobalPosition = new PIXI.Point(\r\n        mouseData.data.global.x - Common.game.scene.x - Common.game.canvas.x,\r\n        mouseData.data.global.y - Common.game.canvas.y);\r\n\r\n    // Vfx.\r\n    var rgbColour = {r: 255, g: 255, b: 255};\r\n    if (this._paletteItem.indexOf(\"#\") == 0)\r\n        rgbColour = Common.hexToRgb(this._paletteItem);\r\n    this._drawPS.startColor = [rgbColour.r, rgbColour.g, rgbColour.b];\r\n    this._drawPS.endColor = this._drawPS.startColor;\r\n    this._drawPS.spawnPos = new PIXI.Point(localCoordsPosition.x, localCoordsPosition.y);\r\n    this._drawPS.emit = true;\r\n\r\n    // Sfx.\r\n    Common.audio.playSound(\"sfx_tool_paintpot_fill_use_02\");\r\n\r\n    // Tutorial.\r\n    Common.game.scene.addTutorialEvent(CommonGame.TUT_EVENT.CANVAS_DRAWN);\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    FillLayer.prototype,\r\n    \"colourContext\",\r\n    {\r\n        get: function () {\r\n            return this._colourContext;\r\n        }\r\n    });\r\n\r\nObject.defineProperty(\r\n    FillLayer.prototype,\r\n    \"colourCodeContext\",\r\n    {\r\n        get: function () {\r\n            return this._colourCodeContext;\r\n        }\r\n    });\r\n\r\nObject.defineProperty(\r\n    FillLayer.prototype,\r\n    \"state\",\r\n    {\r\n        get: function () {\r\n            return this._state;\r\n        }\r\n    });\r\n\r\nObject.defineProperty(\r\n    FillLayer.prototype,\r\n    \"paletteItem\",\r\n    {\r\n        get: function () {\r\n            return this._paletteItem;\r\n        }\r\n    });","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport PalettePanel from \"../ui/overlays/PalettePanel\";\r\nimport PaletteButton from \"./PaletteButton\";\r\nimport OutlineFilter from \"../shaders/OutlineFilter\";\r\n\r\nexport default class HUD extends PIXI.Container {\r\n    constructor() {\r\n        super();\r\n\r\n        // Attributes.\r\n        this._leftBarContainer = null;\r\n        this._rightBarContainer = null;\r\n        this._leftBarSprite = null;\r\n        this._rightBarSprite = null;\r\n        this._menuBtn = null;\r\n        this._undoBtn = null;\r\n        this._lastToolBtn = null;\r\n\r\n        this._pencilButton = null;\r\n        this._brushButton = null;\r\n        this._bucketButton = null;\r\n        this._stampButton = null;\r\n        this._inkPotButton = null;\r\n        this._sprayButton = null;\r\n        this._eraserButton = null;\r\n        this._paletteButton = null;\r\n\r\n        this._drawItText = null;\r\n        this._palettePanel = null;\r\n\r\n        this._drawMode = CommonGame.TOOL.PENCIL;\r\n\r\n        // Signals.\r\n        this.signals = {};\r\n        this.signals.onMenuClick = new signals.Signal();\r\n        this.signals.onPaletteClick = new signals.Signal();\r\n        this.signals.onDrawModeChanged = new signals.Signal();\r\n    }\r\n\r\n    init() {\r\n\r\n        console.assert(Common.game.scene.palettePanel != null, \"Initialization failed: Common.game.scene.palettePanel is null.\");\r\n        this._palettePanel = Common.game.scene.palettePanel;\r\n\r\n        // Left bar.\r\n        // Container.\r\n        this._leftBarContainer = new PIXI.Container();\r\n        this._leftBarContainer.anchor = new PIXI.Point(0, 0.5);\r\n        this._leftBarContainer.x = Common.getScreenPositionLeft() - this.x;\r\n        this.addChild(this._leftBarContainer);\r\n        // Sprite.\r\n        this._leftBarSprite = new PIXI.Sprite(Common.assets.getTexture(\"panel_l\"));\r\n        this._leftBarSprite.anchor = new PIXI.Point(0, 0.5);\r\n        this._leftBarContainer.addChild(this._leftBarSprite);\r\n        // Right bar.\r\n        // Container.\r\n        this._rightBarContainer = new PIXI.Container();\r\n        this._rightBarContainer.anchor = new PIXI.Point(0, 0.5);\r\n        this._rightBarContainer.x = Common.getScreenPositionRight() - this.x;\r\n        this.addChild(this._rightBarContainer);\r\n        // Sprite.\r\n        this._rightBarSprite = new PIXI.Sprite(Common.assets.getTexture(\"panel_r\"));\r\n        this._rightBarSprite.anchor = new PIXI.Point(1, 0.5);\r\n        this._rightBarContainer.addChild(this._rightBarSprite);\r\n\r\n        //--buttons--//\r\n        const buttonOffset = 90;//made an offset variable to use to offset the buttons\r\n\r\n        // Menu button.\r\n        //  var btnStatesAux = new P3.ButtonStates(\r\n        ///     Common.assets.getTexture(\"btn_primary_small_off\"),\r\n        //     Common.assets.getTexture(\"btn_primary_small_over\"),\r\n        //    Common.assets.getTexture(\"btn_primary_small_down\"),\r\n        //    Common.assets.getTexture(\"icon_menu\"));\r\n        this._menuBtn = createButton(\"menu\");\r\n        this._menuBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._menuBtn.y = -280;\r\n        this._menuBtn.x = buttonOffset;\r\n        this._menuBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._menuBtn.downSoundName = \"sfx_ui_click_00\";\r\n        this._menuBtn.signals.click.add(this._onMenuButton_Click, this);\r\n        this._leftBarSprite.addChild(this._menuBtn);\r\n\r\n        // Undo button.\r\n        var btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_undo\"),\r\n            Common.assets.getTexture(\"icon_undo\"),\r\n            Common.assets.getTexture(\"icon_undo\"));\r\n        this._undoBtn = new P3.Button(btnStatesAux);\r\n        this._undoBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._undoBtn.y = -280;\r\n        this._undoBtn.x = -buttonOffset;\r\n        this._undoBtn.signals.click.add(this._onUndoButton_Click, this);\r\n        this._rightBarSprite.addChild(this._undoBtn);\r\n\r\n        this._undoBtn.interactive = false;\r\n        this._undoBtn.alpha = 0.5;\r\n\r\n        // Tool buttons.\r\n        // Left.\r\n        // Palette.\r\n        this._paletteButton = new PaletteButton();\r\n        this._paletteButton.init();\r\n        this._paletteButton.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._paletteButton.y = 260;\r\n        this._paletteButton.x = buttonOffset;\r\n        this._paletteButton.scale.x = -1;\r\n        this._paletteButton.signals.onClick.add(this._onPaletteBtn_Click, this);\r\n        this._leftBarSprite.addChild(this._paletteButton);\r\n        //this._arrToolBtn.push( this._colourPaletteButton );\r\n        this._paletteButton.setup(Common.assets.getJSON(\"config\").palettePanel.pages[0][0], CommonGame.TOOL.PENCIL);\r\n        // Pencil.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_pencil\"),\r\n            Common.assets.getTexture(\"icon_pencil\"),\r\n            Common.assets.getTexture(\"icon_pencil\"));\r\n        this._pencilButton = new P3.Button(btnStatesAux);\r\n        this._pencilButton.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._pencilButton.y = 110;\r\n        this._pencilButton.x = buttonOffset;\r\n        this._pencilButton.drawMode = CommonGame.TOOL.PENCIL;\r\n        this._pencilButton.signals.click.add(this._onDrawMode_Changed, this);\r\n        this._leftBarSprite.addChild(this._pencilButton);\r\n        // Brush.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_brush\"),\r\n            Common.assets.getTexture(\"icon_brush\"),\r\n            Common.assets.getTexture(\"icon_brush\"));\r\n        this._brushButton = new P3.Button(btnStatesAux);\r\n        this._brushButton.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._brushButton.y = -10;\r\n        this._brushButton.x = buttonOffset;\r\n        this._brushButton.drawMode = CommonGame.TOOL.BRUSH;\r\n        this._brushButton.signals.click.add(this._onDrawMode_Changed, this);\r\n        this._leftBarSprite.addChild(this._brushButton);\r\n        // Bucket.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_fill\"),\r\n            Common.assets.getTexture(\"icon_fill\"),\r\n            Common.assets.getTexture(\"icon_fill\"));\r\n        this._bucketButton = new P3.Button(btnStatesAux);\r\n        this._bucketButton.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._bucketButton.y = -130;\r\n        this._bucketButton.x = buttonOffset;\r\n        this._bucketButton.drawMode = CommonGame.TOOL.BUCKET;\r\n        this._bucketButton.signals.click.add(this._onDrawMode_Changed, this);\r\n        this._leftBarSprite.addChild(this._bucketButton);\r\n        // Right.\r\n        // Stamp.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_stamp\"),\r\n            Common.assets.getTexture(\"icon_stamp\"),\r\n            Common.assets.getTexture(\"icon_stamp\"));\r\n        this._stampButton = new P3.Button(btnStatesAux);\r\n        this._stampButton.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._stampButton.scale.x = -1;\r\n        this._stampButton.defaultScale.x = this._stampButton.scale.x;\r\n        this._stampButton.y = 230;\r\n        this._stampButton.x = -buttonOffset;\r\n        this._stampButton.drawMode = CommonGame.TOOL.STAMP;\r\n        this._stampButton.signals.click.add(this._onDrawMode_Changed, this);\r\n        this._rightBarSprite.addChild(this._stampButton);\r\n        // Ink pot.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_ink\"),\r\n            Common.assets.getTexture(\"icon_ink\"),\r\n            Common.assets.getTexture(\"icon_ink\"));\r\n        this._inkPotButton = new P3.Button(btnStatesAux);\r\n        this._inkPotButton.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._inkPotButton.y = 110;\r\n        this._inkPotButton.x = -buttonOffset;\r\n        this._inkPotButton.drawMode = CommonGame.TOOL.INK_POT;\r\n        this._inkPotButton.signals.click.add(this._onDrawMode_Changed, this);\r\n        this._rightBarSprite.addChild(this._inkPotButton);\r\n        // Spray.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_spray\"),\r\n            Common.assets.getTexture(\"icon_spray\"),\r\n            Common.assets.getTexture(\"icon_spray\"));\r\n        this._sprayButton = new P3.Button(btnStatesAux);\r\n        this._sprayButton.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._sprayButton.y = -10;\r\n        this._sprayButton.x = -buttonOffset;\r\n        this._sprayButton.drawMode = CommonGame.TOOL.SPRAY;\r\n        this._sprayButton.signals.click.add(this._onDrawMode_Changed, this);\r\n        this._rightBarSprite.addChild(this._sprayButton);\r\n        // Eraser.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_eraser\"),\r\n            Common.assets.getTexture(\"icon_eraser\"),\r\n            Common.assets.getTexture(\"icon_eraser\"));\r\n        this._eraserButton = new P3.Button(btnStatesAux);\r\n        this._eraserButton.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._eraserButton.y = -130;\r\n        this._eraserButton.x = -buttonOffset;\r\n        this._eraserButton.drawMode = CommonGame.TOOL.ERASER;\r\n        this._eraserButton.signals.click.add(this._onDrawMode_Changed, this);\r\n        this._rightBarSprite.addChild(this._eraserButton);\r\n\r\n        // Draw it text (only for Draw It! mode).\r\n        if (CommonGame.selectedGallery === CommonGame.GALLERY_ID_DRAW_IT) {\r\n            this._drawItText = P3.createText(CommonGame.drawItTextId, {\r\n                size: \"64px\",\r\n                fill: [0xfff8b3, 0xfac109],\r\n                stroke: 0x4c2607,\r\n                strokeThickness: 4,\r\n                padding: 20,\r\n                wordWrapWidth: P3.View.width * 0.65\r\n            }, \"truetype\", \"draw_it\");\r\n\r\n            this._drawItText.y = -Common.STAGE_HEIGHT * 0.5 + 15;\r\n            this._drawItText.anchor = new PIXI.Point(0.5, 0);\r\n            this.addChild(this._drawItText);\r\n\r\n            // Scale down.\r\n            if (this._drawItText.width > Common.STAGE_MIN_WIDTH * 0.8) {\r\n                var scaleFactor = ( Common.STAGE_MIN_WIDTH * 0.8 ) / this._drawItText.width;\r\n                this._drawItText.y += ( 1 - scaleFactor ) * this._drawItText.height * 0.5;\r\n                this._drawItText.scale = new PIXI.Point(scaleFactor, scaleFactor);\r\n            }\r\n        }\r\n\r\n        // Initial state.\r\n        this._highlightToolBtn(this._pencilButton);\r\n\r\n        // Signals.\r\n        Common.game.undoManager.signals.onStackEmpty.add(this._onUndoStack_Empty, this);\r\n        Common.game.undoManager.signals.onStackIncreased.add(this._onUndoStack_Increased, this);\r\n\r\n        this._palettePanel.signals.onColourChanged.add(this._onPaletteSelection_Changed, this);\r\n        this._palettePanel.signals.onStampChanged.add(this._onPaletteSelection_Changed, this);\r\n    }\r\n\r\n    resize() {\r\n        this._leftBarContainer.x = Common.getScreenPositionLeft() - this.x;\r\n        this._rightBarContainer.x = Common.getScreenPositionRight() - this.x;\r\n    }\r\n\r\n    getPaletteBtnPosition() {\r\n        return Common.findPositionInScene(this._paletteButton, Common.game.scene);\r\n    }\r\n\r\n    getBrushBtnPosition() {\r\n        return Common.findPositionInScene(this._brushButton, Common.game.scene);\r\n    }\r\n\r\n    _highlightToolBtn(btn) {\r\n        if (this._lastToolBtn) {\r\n            // Remove outline.\r\n            this._lastToolBtn.filters = [];\r\n\r\n            TweenMax.killTweensOf(this._lastToolBtn.scale);\r\n            this._lastToolBtn.animate = true;\r\n            TweenMax.to(this._lastToolBtn.scale, 0.25, {\r\n                x: this._lastToolBtn.scale.x < 0 ? -1 : 1,\r\n                y: 1,\r\n                ease: Sine.easeOut,\r\n                onComplete: function (btn) {\r\n                    btn.interactive = true;\r\n                },\r\n                onCompleteParams: [this._lastToolBtn]\r\n            });\r\n        }\r\n\r\n        btn.animate = false;\r\n        btn.interactive = false;\r\n        btn.stopAnimations();\r\n        TweenMax.to(btn.scale, 0.5, {\r\n            x: 1.1 * ( btn.scale.x < 0 ? -1 : 1 ),\r\n            y: 1.1,\r\n            ease: Sine.easeInOut,\r\n            yoyo: true,\r\n            repeat: -1\r\n        });\r\n\r\n        this._lastToolBtn = btn;\r\n\r\n        // Add outline.\r\n        this._lastToolBtn.filters = [new OutlineFilter(9, 0xFFFFFF)];\r\n    }\r\n\r\n    //----EVENTS----//\r\n\r\n    _onMenuButton_Click() {\r\n        this.signals.onMenuClick.dispatch();\r\n    }\r\n\r\n    _onUndoButton_Click() {\r\n        Common.game.undoManager.undo();\r\n\r\n\r\n        // Sfx.\r\n        Common.audio.playSound(\"sfx_tool_undo_step_back_00\");\r\n    }\r\n\r\n    _onDrawMode_Changed(btn) {\r\n        // Highlight selected button.\r\n        this._highlightToolBtn(btn);\r\n\r\n        this._drawMode = btn.drawMode;\r\n\r\n        this.signals.onDrawModeChanged.dispatch(btn.drawMode);\r\n\r\n        // Palette button.\r\n        if (btn.drawMode == CommonGame.TOOL.ERASER)\r\n        // Disable it if the eraser is selected.\r\n            this._paletteButton.setInteractive(false);\r\n        else {\r\n            // Otherwise, enable it.\r\n            this._paletteButton.setInteractive(true);\r\n\r\n            // Update visual elements.\r\n            if (btn.drawMode == CommonGame.TOOL.BUCKET)\r\n                this._paletteButton.setup(Common.game.canvas.fillLayer.paletteItem, btn.drawMode);\r\n            else\r\n                this._paletteButton.setup(Common.game.canvas.drawLayer.drawingTool.paletteItem, btn.drawMode);\r\n        }\r\n\r\n\r\n        // Tutorial.\r\n        Common.game.scene.addTutorialEvent(CommonGame.TUT_EVENT.TOOL_SELECTED);\r\n        if (btn.drawMode != CommonGame.TOOL.ERASER)\r\n            Common.game.scene.addTutorialEvent(CommonGame.TUT_EVENT.PALETTE_BUTTON_ENABLED);\r\n        else\r\n            Common.game.scene.addTutorialEvent(CommonGame.TUT_EVENT.PALETTE_BUTTON_DISABLED);\r\n    }\r\n\r\n    _onUndoStack_Empty() {\r\n        this._undoBtn.interactive = false;\r\n        this._undoBtn.alpha = 0.5;\r\n    }\r\n\r\n    _onUndoStack_Increased() {\r\n        this._undoBtn.interactive = true;\r\n        this._undoBtn.alpha = 1;\r\n    }\r\n\r\n    _onPaletteBtn_Click() {\r\n        this.signals.onPaletteClick.dispatch(this._paletteButton.type);\r\n    }\r\n\r\n    _onPaletteSelection_Changed(selection, paletteType) {\r\n        this._paletteButton.setup(selection, this._paletteButton.type);\r\n    }\r\n}","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction InkPot() {\r\n    // Constants.\r\n    this.MIN_RADIUS = 5;\r\n    this.MAX_RADIUS = 20;\r\n\r\n\r\n    // Attributes.\r\n    this._drawLayer = null;\r\n    this._colour = null;\r\n}\r\nexport default InkPot;\r\n//module.exports               \t= InkPot;\r\nInkPot.prototype.constructor = InkPot;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nInkPot.prototype.init = function (drawLayer) {\r\n    this._drawLayer = drawLayer;\r\n    this._colour = Common.assets.getJSON(\"config\").palettePanel.pages[0][0];\r\n\r\n    // Signals.\r\n    Common.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nInkPot.prototype._draw = function (from, to) {\r\n    this._drawLayer.context.beginPath();\r\n    this._drawLayer.context.globalAlpha = Math.random() * 0.25 + 0.15;\r\n    this._drawLayer.context.arc(\r\n        to.x, to.y, Common.randomInt(this.MIN_RADIUS, this.MAX_RADIUS), false, Math.PI * 2, false);\r\n    this._drawLayer.context.fill();\r\n\r\n    this._drawLayer.onContext_Changed();\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nInkPot.prototype.onDrawBegan = function (point) {\r\n    this._drawLayer.context.save();\r\n\r\n    this._drawLayer.context.lineJoin = this._drawLayer.context.lineCap = 'round';\r\n    this._drawLayer.context.fillStyle = this._colour;\r\n\r\n    this._draw(point, point);\r\n\r\n    // Sfx.\r\n    Common.audio.playSound(\"sfx_tool_inkpot_use_splat_00\");\r\n};\r\n\r\nInkPot.prototype.onDrawMoved = function (from, to) {\r\n    this._draw(from, to);\r\n};\r\n\r\nInkPot.prototype.onDrawEnded = function () {\r\n    this._drawLayer.context.restore();\r\n};\r\n\r\nInkPot.prototype._onColour_Changed = function (selection) {\r\n    if (selection.indexOf(\"#\") == 0)\r\n        this._colour = selection;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    InkPot.prototype,\r\n    \"paletteItem\",\r\n    {\r\n        get: function () {\r\n            return this._colour;\r\n        }\r\n    });","\"use strict\";\r\n\r\nvar Common            = require( \"../Common\" );\r\nvar CommonGame        = require( \"../CommonGame\" );\r\n\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction MagicBrush() \r\n{\r\n\t// Constants.\r\n\tthis.LINE_THICKNESS = 20;\r\n\r\n\t\r\n\t// Attributes.\r\n\tthis._drawLayer = null;\r\n\tthis._textureId = null;\r\n}\r\nmodule.exports               \t\t= MagicBrush;\r\nMagicBrush.prototype.constructor \t= MagicBrush;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nMagicBrush.prototype.init = function( drawLayer ) \r\n{\t\r\n\tthis._drawLayer = drawLayer;\t\t\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nMagicBrush.prototype._draw = function( from, to ) \r\n{  \r\n\tthis._drawLayer.context.beginPath();\r\n\tthis._drawLayer.context.moveTo( from.x, from.y );\r\n\tthis._drawLayer.context.lineTo( to.x, to.y );\r\n\tthis._drawLayer.context.stroke();\r\n\r\n\tthis._drawLayer.onContext_Changed();\t\r\n};\r\n\r\nMagicBrush.prototype._createPattern = function() \r\n{  \r\n\tvar patternCanvas = document.createElement( 'canvas' );\r\n\tvar ctx = patternCanvas.getContext( '2d' );\r\n\tvar texture = Common.assets.getTexture( this._textureId );\r\n\tvar frame = texture.frame;\r\n\tpatternCanvas.width = patternCanvas.height = frame.width;\r\n\t\r\n\tctx.drawImage( texture.baseTexture.source, frame.x, frame.y, frame.width, frame.height, 0, 0, frame.width, frame.height );\r\n\t\r\n\treturn ctx.createPattern( patternCanvas, 'repeat' );\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nMagicBrush.prototype.onDrawBegan = function( point ) \r\n{  \r\n\tthis._drawLayer.context.lineWidth = this.LINE_THICKNESS;\r\n\tthis._drawLayer.context.lineJoin = this._drawLayer.context.lineCap = 'round';\r\n\tthis._drawLayer.context.strokeStyle = this._createPattern();\r\n\t\r\n\tthis._draw( point, point );\r\n};\r\n\r\nMagicBrush.prototype.onDrawMoved = function( from, to ) \r\n{  \r\n\tthis._draw( from, to );\r\n};\r\n\r\nMagicBrush.prototype.onDrawEnded = function() {};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n\tMagicBrush.prototype, \r\n\t\"textureId\", \r\n\t{ set: function( a ) { this._textureId = a; } } );","\"use strict\";\r\n\r\nvar Common            = require( \"../Common\" );\r\nvar CommonGame        = require( \"../CommonGame\" );\r\n\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction MagicPencil() \r\n{\r\n\t// Constants.\r\n\tthis.LINE_THICKNESS = 5;\r\n\r\n\t\r\n\t// Attributes.\r\n\tthis._drawLayer = null;\r\n\tthis._textureId = null;\r\n}\r\nmodule.exports               \t\t= MagicPencil;\r\nMagicPencil.prototype.constructor \t= MagicPencil;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nMagicPencil.prototype.init = function( drawLayer ) \r\n{\t\r\n\tthis._drawLayer = drawLayer;\t\t\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nMagicPencil.prototype._draw = function( from, to ) \r\n{  \r\n\tthis._drawLayer.context.beginPath();\r\n\tthis._drawLayer.context.moveTo( from.x, from.y );\r\n\tthis._drawLayer.context.lineTo( to.x, to.y );\r\n\tthis._drawLayer.context.stroke();\r\n\r\n\tthis._drawLayer.onContext_Changed();\r\n};\r\n\r\nMagicPencil.prototype._createPattern = function() \r\n{  \r\n\tvar patternCanvas = document.createElement( 'canvas' );\r\n\tvar ctx = patternCanvas.getContext( '2d' );\r\n\tvar texture = Common.assets.getTexture( this._textureId );\r\n\tvar frame = texture.frame;\r\n\tpatternCanvas.width = patternCanvas.height = frame.width;\r\n\t\r\n\tctx.drawImage( texture.baseTexture.source, frame.x, frame.y, frame.width, frame.height, 0, 0, frame.width, frame.height );\r\n\t\r\n\treturn ctx.createPattern( patternCanvas, 'repeat' );\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nMagicPencil.prototype.onDrawBegan = function( point ) \r\n{  \r\n\tthis._drawLayer.context.lineWidth = this.LINE_THICKNESS;\r\n\tthis._drawLayer.context.lineJoin = this._drawLayer.context.lineCap = 'round';\r\n\tthis._drawLayer.context.strokeStyle = this._createPattern();\r\n\t\r\n\tthis._draw( point, point );\r\n};\r\n\r\nMagicPencil.prototype.onDrawMoved = function( from, to ) \r\n{  \r\n\tthis._draw( from, to );\r\n};\r\n\r\nMagicPencil.prototype.onDrawEnded = function() {};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n\tMagicPencil.prototype, \r\n\t\"textureId\", \r\n\t{ set: function( a ) { this._textureId = a; } } );","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport HUD from \"./HUD\";\r\nimport UndoManager  from \"./UndoManager\";\r\nimport Canvas   from \"./Canvas\";\r\n\r\nexport default class MyGame {\r\n    constructor() {\r\n        // TODO:\r\n\r\n        // Attributes.\r\n        this._scene = null;\r\n        this._decoration = null;\r\n        this._hud = null;\r\n        this._canvas = null;\r\n        this._undoManager = null;\r\n    }\r\n\r\n    init() {\r\n        console.assert(this._scene != null, \"Initialization failed: this._scene is null.\");\r\n\r\n        // Undo manager.\r\n        this._undoManager = new UndoManager();\r\n\r\n        // Decoration.\r\n        this._decoration = new PIXI.Container();\r\n        this._initDecoration();\r\n\r\n        // HUD.\r\n        this._hud = new HUD();\r\n        this._hud.position = new PIXI.Point(Common.STAGE_WIDTH * 0.5, Common.STAGE_HEIGHT * 0.5);\r\n        this._hud.init();\r\n\r\n        // Canvas.\r\n        // - Initialization dependencies: HUD.\r\n        this._canvas = new Canvas();\r\n        this._canvas.position = new PIXI.Point(Common.STAGE_WIDTH * 0.5, Common.STAGE_HEIGHT * 0.5);\r\n        this._canvas.init();\r\n\r\n        this._scene.gameLayer.addChild(this._canvas);\r\n        this._scene.gameLayer.addChild(this._decoration);\r\n        this._scene.gameLayer.addChild(this._hud);\r\n\r\n        //--add an extra overlay so the drawn / colouring is underneath the black lines--//\r\n        const outlineTexture = PIXI.Texture.fromImage(\"assets/images/outlines/\" + ( CommonGame.selectedGallery == CommonGame.GALLERY_ID_DRAW_IT ? \"draw_it/\" : \"colour_it/\" ) + CommonGame.selectedImageId + \".png\");\r\n        let sp = new PIXI.Sprite(outlineTexture);\r\n        sp.anchor.set(0.5);\r\n        this._canvas.addChild(sp);\r\n    }\r\n\r\n    update() {\r\n        this._canvas.update();\r\n    }\r\n\r\n    animateIn() {\r\n        this._canvas.animateIn();\r\n    }\r\n\r\n    resize() {\r\n        this._hud.resize();\r\n    }\r\n\r\n    _initDecoration() {\r\n\r\n        const t = Common.assets.texture;\r\n\r\n        const topFlowers = new PIXI.Sprite(t(\"leaves\"));\r\n        const offset = topFlowers.height * 0.5;\r\n\r\n        topFlowers.anchor.set(0.5, 0.5);\r\n        topFlowers.x = Common.STAGE_WIDTH * 0.5;\r\n        topFlowers.y = -offset;\r\n\r\n        const botFlowers = new PIXI.Sprite(t(\"leaves\"));\r\n        botFlowers.anchor.set(0.5, 0.5);\r\n        botFlowers.scale.y = -1;\r\n        botFlowers.x = Common.STAGE_WIDTH * 0.5;\r\n        botFlowers.y = Common.STAGE_HEIGHT + offset;\r\n\r\n        this._decoration.addChild(topFlowers, botFlowers);\r\n\r\n        TweenMax.to(topFlowers, 2 + Math.random() * 0.5, {\r\n            y: 0,\r\n            ease: Elastic.easeOut.config(1, 0.3 - 0.1 * Math.random()),\r\n            delay: Math.random() * 0.25\r\n        });\r\n\r\n        TweenMax.to(botFlowers, 2 + Math.random() * 0.5, {\r\n            y: Common.STAGE_HEIGHT,\r\n            ease: Elastic.easeOut.config(1, 0.3 - 0.1 * Math.random()),\r\n            delay: Math.random() * 0.25\r\n        });\r\n    }\r\n\r\n    get scene() {\r\n        return this._scene;\r\n    }\r\n\r\n    set scene(value) {\r\n        this._scene = value;\r\n    }\r\n\r\n    get hud() {\r\n        return this._hud;\r\n    }\r\n\r\n    get canvas() {\r\n        return this._canvas;\r\n    }\r\n\r\n    get undoManager() {\r\n        return this._undoManager;\r\n    }\r\n}\r\n","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport PalettePanel from \"../ui/overlays/PalettePanel\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\nfunction PaletteButton() {\r\n    PIXI.Container.call(this);\r\n\r\n\r\n    // Attributes\r\n    this._button = null;\r\n    this._selectionSprite = null;\r\n    this._shineOverlay = null;\r\n    this._type = null;\r\n\r\n\r\n    // Signals.\r\n    this.signals = {};\r\n    this.signals.onClick = new signals.Signal();\r\n}\r\n\r\nexport default PaletteButton;\r\n//module.exports = PaletteButton;\r\nPaletteButton.prototype = Object.create(PIXI.Container.prototype);\r\nPaletteButton.prototype.constructor = PaletteButton;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nPaletteButton.prototype.init = function () {\r\n    // Button.\r\n    var btnStatesAux = new P3.ButtonStates(\r\n        Common.assets.getTexture(\"icon_colour_palette_bg\"),\r\n        Common.assets.getTexture(\"icon_colour_palette_bg\"),\r\n        Common.assets.getTexture(\"icon_colour_palette_bg\"));\r\n    this._button = new P3.Button(btnStatesAux);\r\n    this._button.anchor = new PIXI.Point(0.5, 0.5);\r\n    this._button.signals.click.add(this.signals.onClick.dispatch, this);\r\n    this.addChild(this._button);\r\n\r\n    // Selection sprite.\r\n    this._selectionSprite = new PIXI.Sprite(Common.blankTexture);\r\n    this._selectionSprite.x = -60;\r\n    this._selectionSprite.y = 21;\r\n    this._selectionSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n    this._button.addChild(this._selectionSprite);\r\n\r\n    this._shineOverlay = new PIXI.Sprite(Common.assets.getTexture(\"btns_colour_overlay\"));\r\n    this._shineOverlay.anchor = new PIXI.Point(0.5, 0.5);\r\n    this._shineOverlay.blendMode = PIXI.BLEND_MODES.ADD;\r\n    this._shineOverlay.alpha = 0.4;\r\n    this._selectionSprite.addChild(this._shineOverlay);\r\n};\r\n\r\nPaletteButton.prototype.setup = function (selection, toolType) {\r\n    this._type = toolType;\r\n\r\n    this._selectionSprite.tint = 0xffffff;\r\n\r\n    switch (this._type) {\r\n        case CommonGame.TOOL.BRUSH:\r\n        case CommonGame.TOOL.PENCIL:\r\n        case CommonGame.TOOL.INK_POT:\r\n        case CommonGame.TOOL.SPRAY:\r\n        case CommonGame.TOOL.BUCKET:\r\n        {\r\n            this._shineOverlay.visible = true;\r\n\r\n            this._button._currentNormalTexture = Common.assets.getTexture(\"icon_colour_palette_bg\");\r\n            this._button._currentOverTexture = Common.assets.getTexture(\"icon_colour_palette_bg\");\r\n            this._button._currentDownTexture = Common.assets.getTexture(\"icon_colour_palette_bg\");\r\n            this._button._background.texture = this._button._currentNormalTexture;\r\n\r\n            if (selection.indexOf(\"#\") == 0) {\r\n                this._selectionSprite.texture = Common.assets.getTexture(\"btns_colour_white\");\r\n                this._selectionSprite.tint = parseInt(\"0x\" + selection.substring(1));\r\n            }\r\n            else\r\n                this._selectionSprite.texture = Common.assets.getTexture(CommonGame.TEXTURE_BUTTON_BASE_ID + selection.substring(selection.length - 2));\r\n\r\n            this._selectionSprite.scale.x = -0.8;\r\n            this._selectionSprite.scale.y = 0.8;\r\n\r\n            break;\r\n        }\r\n\r\n        case CommonGame.TOOL.STAMP:\r\n        {\r\n            this._shineOverlay.visible = false;\r\n\r\n            this._button._currentNormalTexture = Common.assets.getTexture(\"icon_stamp_palette_bg\");\r\n            this._button._currentOverTexture = Common.assets.getTexture(\"icon_stamp_palette_bg\");\r\n            this._button._currentDownTexture = Common.assets.getTexture(\"icon_stamp_palette_bg\");\r\n            this._button._background.texture = this._button._currentNormalTexture;\r\n\r\n            this._selectionSprite.texture = Common.assets.getTexture(selection);\r\n            this._selectionSprite.scale.x = -1;\r\n            this._selectionSprite.scale.y = 0.8;\r\n\r\n            break;\r\n        }\r\n    }\r\n};\r\n\r\nPaletteButton.prototype.setInteractive = function (isInteractive) {\r\n    this._button.interactive = isInteractive;\r\n    this._button.alpha = isInteractive ? 1 : 0.5;\r\n    this._selectionSprite.alpha = this._button.alpha;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\n// TODO:\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\n// TODO:\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    PaletteButton.prototype,\r\n    \"type\",\r\n    {\r\n        get: function () {\r\n            return this._type;\r\n        }\r\n    });","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport PalettePanel from \"../ui/overlays/PalettePanel\";\r\nimport MagicPencil from \"./MagicPencil\";\r\nimport ColourPencil from \"./ColourPencil\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction Pencil() {\r\n    // Attributes.\r\n    this._drawLayer = null;\r\n    this._magicPencil = null;\r\n    this._colourPencil = null;\r\n    this._paletteItem = null;\r\n    this._curPencil = null;\r\n    this._audio = null;\r\n}\r\nexport default Pencil;\r\n//module.exports = Pencil;\r\nPencil.prototype.constructor = Pencil;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nPencil.prototype.init = function (drawLayer) {\r\n    this._drawLayer = drawLayer;\r\n\r\n    // Magic pencil.\r\n    this._magicPencil = new MagicPencil();\r\n    this._magicPencil.init(drawLayer);\r\n\r\n    // Colour pencil.\r\n    this._colourPencil = new ColourPencil();\r\n    this._colourPencil.init(drawLayer);\r\n\r\n    // Set initial pencil.\r\n    this._curPencil = this._colourPencil;\r\n    this._curPencil.colour = Common.assets.getJSON(\"config\").palettePanel.pages[0][0];\r\n    this._paletteItem = this._curPencil.colour;\r\n\r\n    // Signals.\r\n    Common.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nPencil.prototype._draw = function (from, to) {\r\n    // TEST: DYN_OUT:\r\n    Common.game.canvas.drawLayer._dynOutlineContext.beginPath();\r\n    Common.game.canvas.drawLayer._dynOutlineContext.strokeStyle = \"black\";\r\n    Common.game.canvas.drawLayer._dynOutlineContext.lineWidth = this._curPencil.LINE_THICKNESS;\r\n    Common.game.canvas.drawLayer._dynOutlineContext.lineJoin = \"round\";\r\n    Common.game.canvas.drawLayer._dynOutlineContext.moveTo(from.x, from.y);\r\n    Common.game.canvas.drawLayer._dynOutlineContext.lineTo(to.x, to.y);\r\n    Common.game.canvas.drawLayer._dynOutlineContext.closePath();\r\n    Common.game.canvas.drawLayer._dynOutlineContext.stroke();\r\n};\r\n\r\nPencil.prototype._stopAudio = function () {\r\n    this._audio.howl.stop(this._audio.id);\r\n    this._audio = null;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nPencil.prototype.onDrawBegan = function (point) {\r\n    this._curPencil.onDrawBegan(point);\r\n    // TEST: DYN_OUT:\r\n    this._draw(point, new PIXI.Point(point.x + 0.1, point.y + 0.1));\r\n};\r\n\r\nPencil.prototype.onDrawMoved = function (from, to) {\r\n    // Sfx.\r\n    if (this._audio == null)\r\n        this._audio = Common.audio.playSound(\"sfx_tool_pencil_use_loop_00\", {\"loop\": true});\r\n    TweenMax.killDelayedCallsTo(this._stopAudio);\r\n    TweenMax.delayedCall(0.25, this._stopAudio, null, this);\r\n\r\n\r\n    this._curPencil.onDrawMoved(from, to);\r\n    // TEST: DYN_OUT:\r\n    this._draw(from, to);\r\n};\r\n\r\nPencil.prototype.onDrawEnded = function () {\r\n    // Sfx.\r\n    TweenMax.killDelayedCallsTo(this._stopAudio);\r\n    if (this._audio != null)\r\n        this._stopAudio();\r\n\r\n    // TEST: DYN_OUT:\r\n    Common.game.canvas.drawLayer.dynOutlineData = Common.game.canvas.drawLayer._dynOutlineContext.getImageData(0, 0, Common.game.canvas.WIDTH, Common.game.canvas.HEIGHT);\r\n};\r\n\r\nPencil.prototype._onColour_Changed = function (selection) {\r\n    if (selection.indexOf(\"#\") == 0) {\r\n        this._curPencil = this._colourPencil;\r\n        this._colourPencil.colour = selection;\r\n    }\r\n    else {\r\n        this._curPencil = this._magicPencil;\r\n        this._magicPencil.textureId = selection;\r\n    }\r\n\r\n    this._paletteItem = selection;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    Pencil.prototype,\r\n    \"paletteItem\",\r\n    {\r\n        get: function () {\r\n            return this._paletteItem;\r\n        }\r\n    });","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction Spray() {\r\n    // Constants.\r\n    this.DENSITY = 40;\r\n    this.PERIOD = 0.05;\r\n    this.RADIUS = 15;\r\n\r\n\r\n    // Attributes.\r\n    this._drawLayer = null;\r\n    this._drawPosition = null;\r\n    this._colour = null;\r\n    this._audio = null;\r\n}\r\nexport default Spray;\r\n//module.exports               \t= Spray;\r\nSpray.prototype.constructor = Spray;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nSpray.prototype.init = function (drawLayer) {\r\n    this._drawLayer = drawLayer;\r\n    this._colour = Common.assets.getJSON(\"config\").palettePanel.pages[0][0];\r\n\r\n    // Signals.\r\n    Common.game.scene.palettePanel.signals.onColourChanged.add(this._onColour_Changed, this);\r\n};\r\n\r\nSpray.prototype._stopAudio = function () {\r\n    this._audio.howl.stop(this._audio.id);\r\n    this._audio = null;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nSpray.prototype._draw = function () {\r\n    if (this._drawPosition == null)\r\n        return;\r\n\r\n    for (var i = this.DENSITY; i--;) {\r\n        this._drawLayer.context.save();\r\n\r\n        this._drawColour();\r\n\r\n        this._drawLayer.context.restore();\r\n    }\r\n\r\n    TweenMax.delayedCall(this.PERIOD, this._draw, null, this);\r\n\r\n    this._drawLayer.onContext_Changed();\r\n};\r\n\r\nSpray.prototype._drawColour = function () {\r\n    var angle = Common.randomFloat(0, Math.PI * 2);\r\n    var radius = Common.randomFloat(0, this.RADIUS);\r\n\r\n    this._drawLayer.context.fillStyle = this._colour;\r\n    this._drawLayer.context.globalAlpha = Math.random();\r\n    this._drawLayer.context.fillRect(\r\n        this._drawPosition.x + radius * Math.cos(angle),\r\n        this._drawPosition.y + radius * Math.sin(angle),\r\n        Common.randomFloat(1, 2), Common.randomFloat(1, 2));\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nSpray.prototype.onDrawBegan = function (point) {\r\n    this._drawPosition = new PIXI.Point(point.x, point.y);\r\n\r\n    this._drawLayer.context.lineJoin = this._drawLayer.context.lineCap = 'round';\r\n\r\n    this._draw();\r\n\r\n    // Sfx.\r\n    this._audio = Common.audio.playSound(\"sfx_tool_spraycan_use_loop_00\", {\"loop\": true});\r\n};\r\n\r\nSpray.prototype.onDrawMoved = function (from, to) {\r\n    this._drawPosition.x = to.x;\r\n    this._drawPosition.y = to.y;\r\n};\r\n\r\nSpray.prototype.onDrawEnded = function () {\r\n    TweenMax.killTweensOf(this);\r\n    this._drawPosition = null;\r\n\r\n\r\n    // Sfx.\r\n    this._stopAudio();\r\n};\r\n\r\nSpray.prototype._onColour_Changed = function (selection) {\r\n    if (selection.indexOf(\"#\") == 0)\r\n        this._colour = selection;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    Spray.prototype,\r\n    \"paletteItem\",\r\n    {\r\n        get: function () {\r\n            return this._colour;\r\n        }\r\n    });","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction Stamp() {\r\n    // Attributes.\r\n    this._drawLayer = null;\r\n    this._paletteItem = null;\r\n}\r\nexport default Stamp;\r\n//module.exports = Stamp;\r\nStamp.prototype.constructor = Stamp;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nStamp.prototype.init = function (drawLayer) {\r\n    this._drawLayer = drawLayer;\r\n    this._paletteItem = Common.assets.getJSON(\"config\").palettePanel.pages[Common.assets.getJSON(\"config\").palettePanel.tools.stamp[0]][0];\r\n\r\n\r\n    // Listen to HUD controls.\r\n    Common.game.scene.palettePanel.signals.onStampChanged.add(this._onStamp_Changed, this);\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\n// TODO:\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nStamp.prototype.onDrawBegan = function (point) {\r\n    var scaleFactor = Math.random();\r\n\r\n    this._drawLayer.context.save();\r\n    this._drawLayer.context.translate(point.x, point.y);\r\n    //this._drawLayer.context.scale( 0.6 + 0.4 * scaleFactor, 0.6 + 0.4 * scaleFactor );\r\n    //this._drawLayer.context.rotate( Math.PI * 2 * Math.random() );\r\n    //this._drawLayer.context.drawImage( this._image, -this._image.width * 0.5, -this._image.height * 0.5 );\r\n    var texture = Common.assets.getTexture(this._paletteItem);\r\n    var frame = texture.frame;\r\n    this._drawLayer.context.drawImage(\r\n        texture.baseTexture.source,\r\n        frame.x * Common.main.assetRes,\r\n        frame.y * Common.main.assetRes,\r\n        frame.width * Common.main.assetRes,\r\n        frame.height * Common.main.assetRes,\r\n        0.5 * -frame.width,\r\n        0.5 * -frame.height,\r\n        frame.width,\r\n        frame.height);\r\n    this._drawLayer.context.restore();\r\n\r\n    this._drawLayer.onContext_Changed();\r\n\r\n\r\n    // Sfx.\r\n    Common.audio.playSound(\"sfx_tool_stamp_use_00\");\r\n};\r\n\r\nStamp.prototype.onDrawMoved = function (from, to) {\r\n};\r\n\r\nStamp.prototype.onDrawEnded = function () {\r\n};\r\n\r\nStamp.prototype._onStamp_Changed = function (selection) {\r\n    this._paletteItem = selection;\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    Stamp.prototype,\r\n    \"paletteItem\",\r\n    {\r\n        get: function () {\r\n            return this._paletteItem;\r\n        }\r\n    });","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport PalettePanel from \"../ui/overlays/PalettePanel\";\r\nimport PaletteButton from \"./PaletteButton\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\nfunction Tutorial() {\r\n    PIXI.Container.call(this);\r\n\r\n\r\n    // Enumerators.\r\n    this.STATE = {\r\n        DRAW: 0,\r\n        TOOL: 1,\r\n        PALETTE: 2,\r\n        IDLE: 3\r\n    };\r\n\r\n\r\n    // Constants.\r\n    this.TUT_STEP_DELAY = 3;\r\n\r\n\r\n    // Attributes.\r\n    this._isPaused = false;\r\n    this._tutorialStepTimer = 0;\r\n    this._tutorialHand = null;\r\n    this._state = this.STATE.IDLE;\r\n    this._arrEvent = [];\r\n    this._arrTutorialStep = [\r\n        {\r\n            state: this.STATE.DRAW,\r\n            isValid: false,\r\n            isDone: !Common.savedData.isDrawTutorial\r\n        },\r\n        {\r\n            state: this.STATE.TOOL,\r\n            isValid: true,\r\n            isDone: !Common.savedData.isToolTutorial\r\n        },\r\n        {\r\n            state: this.STATE.PALETTE,\r\n            isValid: false,\r\n            isDone: !Common.savedData.isPaletteTutorial\r\n        }];\r\n\r\n\r\n    // Signals.\r\n    this.signals = {};\r\n    this.signals.onCompleted = new signals.Signal();\r\n}\r\n\r\nexport default Tutorial;\r\n//module.exports = Tutorial;\r\nTutorial.prototype = Object.create(PIXI.Container.prototype);\r\nTutorial.prototype.constructor = Tutorial;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nTutorial.prototype.init = function () {\r\n \r\n    this._tutorialHand = new PIXI.spine.Spine(Common.assets.spineData(\"tutorial_hand\"));\r\n    this._tutorialHand.skeleton.setToSetupPose();\r\n    this._tutorialHand.skeleton.setSkin(null);\r\n    this._tutorialHand.skeleton.setSkinByName(\"default\");\r\n    this._tutorialHand.autoUpdate = false;\r\n    this._tutorialHand.scale = new PIXI.Point(0.7, 0.7);\r\n    this._tutorialHand.alpha = 0;\r\n    this.addChild(this._tutorialHand);\r\n\r\n    this._tutorialHand.state.setAnimationByName(0, \"still_\" + ( P3.Device.isMobile ? \"mobile\" : \"desktop\" ), true);\r\n    this._tutorialHand.update(deltaTime);\r\n};\r\n\r\nTutorial.prototype.end = function () {\r\n    this.removeChild(this._tutorialHand);\r\n    this._tutorialHand.destroy();\r\n    this._tutorialHand = null;\r\n};\r\n\r\nTutorial.prototype.update = function () {\r\n    if (this._tutorialHand == null) return;\r\n\r\n\r\n    this._tutorialHand.update(deltaTime);\r\n\r\n    this._processEvents();\r\n\r\n    // Delayed tutorial step activation.\r\n    if (!this._isPaused) {\r\n        this._tutorialStepTimer += deltaTime;\r\n        if (this._tutorialStepTimer >= this.TUT_STEP_DELAY && this._state == this.STATE.IDLE) {\r\n            for (var tutorialStep of this._arrTutorialStep) {\r\n                if (tutorialStep.isValid && !tutorialStep.isDone) {\r\n                    this._state = tutorialStep.state;\r\n\r\n                    switch (this._state) {\r\n                        case this.STATE.DRAW:\r\n                        {\r\n                            this._tutorialHand.state.setAnimationByName(0, \"drag_\" + ( P3.Device.isMobile ? \"mobile\" : \"desktop\" ), true);\r\n                            this._tutorialHand.position = new PIXI.Point(Common.STAGE_WIDTH * 0.5, Common.STAGE_HEIGHT * 0.5);\r\n\r\n                            this._showHand();\r\n\r\n                            break;\r\n                        }\r\n\r\n                        case this.STATE.TOOL:\r\n                        {\r\n                            this._tutorialHand.state.setAnimationByName(0, \"tap_\" + ( P3.Device.isMobile ? \"mobile\" : \"desktop\" ), true);\r\n                            this._tutorialHand.position = Common.game.hud.getBrushBtnPosition();\r\n\r\n                            this._showHand();\r\n\r\n                            break;\r\n                        }\r\n\r\n                        case this.STATE.PALETTE:\r\n                        {\r\n                            this._tutorialHand.state.setAnimationByName(0, \"tap_\" + ( P3.Device.isMobile ? \"mobile\" : \"desktop\" ), true);\r\n                            this._tutorialHand.position = Common.game.hud.getPaletteBtnPosition();\r\n\r\n                            this._showHand();\r\n\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (!tutorialStep.isDone)\r\n                    break;\r\n            }\r\n\r\n            this._tutorialStepTimer = 0;\r\n        }\r\n    }\r\n};\r\n\r\nTutorial.prototype.addEvent = function (tutorialEvent) {\r\n    this._arrEvent.push(tutorialEvent);\r\n};\r\n\r\nTutorial.prototype.resize = function () {\r\n    if (this._tutorialHand == null) return;\r\n\r\n\r\n    if (this._state == this.STATE.DRAW)\r\n        this._tutorialHand.position = new PIXI.Point(Common.STAGE_WIDTH * 0.5, Common.STAGE_HEIGHT * 0.5);\r\n    else if (this._state == this.STATE.TOOL)\r\n        this._tutorialHand.position = Common.game.hud.getBrushBtnPosition();\r\n    else if (this._state == this.STATE.PALETTE)\r\n        this._tutorialHand.position = Common.game.hud.getPaletteBtnPosition();\r\n};\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nTutorial.prototype._processEvents = function () {\r\n    for (var tutorialEvent of this._arrEvent) {\r\n        switch (tutorialEvent) {\r\n            case CommonGame.TUT_EVENT.CANVAS_VISIBLE:\r\n            {\r\n                this._arrTutorialStep[this.STATE.DRAW].isValid = true;\r\n\r\n                break;\r\n            }\r\n\r\n            case CommonGame.TUT_EVENT.PALETTE_SELECTED:\r\n            {\r\n                if (this._state == this.STATE.DRAW\r\n                    || this._state == this.STATE.TOOL)\r\n                    this._hideHand();\r\n                else if (this._state == this.STATE.PALETTE) {\r\n                    this._hideHand(this._checkTutorialEnd);\r\n\r\n                    this._state = this.STATE.IDLE;\r\n                }\r\n\r\n                if (Common.savedData.isPaletteTutorial) {\r\n                    this._arrTutorialStep[this.STATE.PALETTE].isDone = true;\r\n\r\n                    Common.savedData.isPaletteTutorial = false;\r\n                    Common.savedData.save();\r\n                }\r\n\r\n                this._isPaused = true;\r\n                this._tutorialStepTimer = 0;\r\n\r\n                break;\r\n            }\r\n\r\n            case CommonGame.TUT_EVENT.MENU_PANEL_SHOWN:\r\n            {\r\n                if (this._state != this.STATE.IDLE)\r\n                    this._hideHand();\r\n\r\n                this._isPaused = true;\r\n                this._tutorialStepTimer = 0;\r\n\r\n                break;\r\n            }\r\n\r\n            case CommonGame.TUT_EVENT.MENU_PANEL_HIDDEN:\r\n            case CommonGame.TUT_EVENT.PALETTE_PANEL_HIDDEN:\r\n            {\r\n                if (this._state != this.STATE.IDLE)\r\n                    this._showHand();\r\n\r\n                this._isPaused = false;\r\n                this._tutorialStepTimer = 0;\r\n\r\n                break;\r\n            }\r\n\r\n            case CommonGame.TUT_EVENT.PALETTE_BUTTON_ENABLED:\r\n            {\r\n                this._arrTutorialStep[this.STATE.PALETTE].isValid = true;\r\n\r\n                if (this._state == this.STATE.PALETTE)\r\n                    this._showHand();\r\n\r\n                break;\r\n            }\r\n\r\n            case CommonGame.TUT_EVENT.PALETTE_BUTTON_DISABLED:\r\n            {\r\n                this._arrTutorialStep[this.STATE.PALETTE].isValid = false;\r\n\r\n                if (this._state == this.STATE.PALETTE)\r\n                    this._hideHand();\r\n\r\n                break;\r\n            }\r\n\r\n            case CommonGame.TUT_EVENT.TOOL_SELECTED:\r\n            {\r\n                if (this._state == this.STATE.TOOL) {\r\n                    this._hideHand(this._checkTutorialEnd);\r\n\r\n                    this._state = this.STATE.IDLE;\r\n                }\r\n\r\n                if (Common.savedData.isToolTutorial) {\r\n                    this._arrTutorialStep[this.STATE.TOOL].isDone = true;\r\n\r\n                    Common.savedData.isToolTutorial = false;\r\n                    Common.savedData.save();\r\n                }\r\n\r\n                this._tutorialStepTimer = 0;\r\n\r\n                break;\r\n            }\r\n\r\n            case CommonGame.TUT_EVENT.CANVAS_DRAWN:\r\n            {\r\n                if (this._state == this.STATE.DRAW) {\r\n                    this._hideHand(this._checkTutorialEnd);\r\n\r\n                    this._state = this.STATE.IDLE;\r\n                }\r\n\r\n                if (Common.savedData.isDrawTutorial) {\r\n                    this._arrTutorialStep[this.STATE.DRAW].isDone = true;\r\n\r\n                    Common.savedData.isDrawTutorial = false;\r\n                    Common.savedData.save();\r\n                }\r\n\r\n                this._tutorialStepTimer = 0;\r\n\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    this._arrEvent = [];\r\n};\r\n\r\nTutorial.prototype._showHand = function () {\r\n    TweenMax.to(this._tutorialHand, 0.25, {alpha: 1});\r\n};\r\n\r\nTutorial.prototype._hideHand = function (onComplete) {\r\n    var tm = TweenMax.to(this._tutorialHand, 0.25, {alpha: 0});\r\n\r\n    if (onComplete != null)\r\n        tm.eventCallback(\"onComplete\", onComplete, null, this);\r\n};\r\n\r\nTutorial.prototype._checkTutorialEnd = function () {\r\n    if (!Common.savedData.isDrawTutorial && !Common.savedData.isToolTutorial && !Common.savedData.isPaletteTutorial)\r\n        this.signals.onCompleted.dispatch();\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\n// TODO:\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\n// TODO:","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\nfunction UndoManager() {\r\n    // Constants.\r\n    this.MAX_STACK_SIZE = 3;\r\n\r\n\r\n    // Attributes.\r\n    this._arrLayerState = [];\r\n\r\n\r\n    // Signals.\r\n    this.signals = {};\r\n    this.signals.onStackEmpty = new signals.Signal();\r\n    this.signals.onStackIncreased = new signals.Signal();\r\n}\r\nexport default UndoManager;\r\n//module.exports = UndoManager;\r\nUndoManager.prototype.constructor = UndoManager;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nUndoManager.prototype.save = function () {\r\n    var drawlayerData = Common.game.canvas.drawLayer.context.getImageData(0, 0, Common.game.canvas.WIDTH, Common.game.canvas.HEIGHT);\r\n    var drawDynOutlineData = Common.game.canvas.drawLayer.dynOutlineContext.getImageData(0, 0, Common.game.canvas.WIDTH, Common.game.canvas.HEIGHT);\r\n    var fillLayerData = Common.game.canvas.fillLayer.colourContext.getImageData(0, 0, Common.game.canvas.WIDTH, Common.game.canvas.HEIGHT);\r\n    var fillColourCodeData = Common.game.canvas.fillLayer.colourCodeContext.getImageData(0, 0, Common.game.canvas.WIDTH, Common.game.canvas.HEIGHT);\r\n\r\n    if (this._arrLayerState.length == this.MAX_STACK_SIZE)\r\n        this._arrLayerState.splice(0, 1);\r\n\r\n    this._arrLayerState.push({\r\n        drawlayerData: drawlayerData,\r\n        drawDynOutlineData: drawDynOutlineData,\r\n        fillLayerData: fillLayerData,\r\n        fillColourCodeData: fillColourCodeData\r\n    });\r\n\r\n    // Signals.\r\n    this.signals.onStackIncreased.dispatch();\r\n};\r\n\r\nUndoManager.prototype.undo = function () {\r\n    if (this._arrLayerState.length == 0) return;\r\n\r\n    var layerState = this._arrLayerState.splice(this._arrLayerState.length - 1, 1)[0];\r\n\r\n    Common.game.canvas.fillLayer.setLayerData(layerState.fillLayerData, layerState.fillColourCodeData);\r\n    Common.game.canvas.drawLayer.setLayerData(layerState.drawlayerData, layerState.drawDynOutlineData);\r\n\r\n    // Signals.\r\n    if (this._arrLayerState.length == 0)\r\n        this.signals.onStackEmpty.dispatch();\r\n};\r\n\r\nUndoManager.prototype.clear = function () {\r\n    this._arrLayerState = [];\r\n\r\n    this.signals.onStackEmpty.dispatch();\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\n// TODO:\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\n// TODO:\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\n// TODO:","module.exports = require(\"./pixi-multistyle-text\").default;","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/// <reference types=\"pixi.js\" />\n\n\"use strict\";\n\nexport interface ExtendedTextStyle extends PIXI.TextStyleOptions {\n\tvalign?: \"top\" | \"middle\" | \"bottom\" | \"baseline\" | number;\n\tdebug?: boolean;\n}\n\nexport interface TextStyleSet {\n\t[key: string]: ExtendedTextStyle;\n}\n\ninterface FontProperties {\n\tascent: number;\n\tdescent: number;\n\tfontSize: number;\n}\n\ninterface TextData {\n\ttext: string;\n\tstyle: ExtendedTextStyle;\n\twidth: number;\n\theight: number;\n\tfontProperties: FontProperties;\n\ttagName: string;\n}\n\ninterface TextDrawingData {\n\ttext: string;\n\tstyle: ExtendedTextStyle;\n\tx: number;\n\ty: number;\n\twidth: number;\n\tascent: number;\n\tdescent: number;\n\ttagName: string;\n}\n\nexport interface MstDebugOptions {\n\tspans: {\n\t\tenabled?: boolean;\n\t\tbaseline?: string;\n\t\ttop?: string;\n\t\tbottom?: string;\n\t\tbounding?: string;\n\t\ttext?: boolean;\n\t};\n\tobjects: {\n\t\tenabled?: boolean;\n\t\tbounding?: string;\n\t\ttext?: boolean;\n\t}\n}\n\nexport default class MultiStyleText extends PIXI.Text {\n\tprivate static DEFAULT_TAG_STYLE: ExtendedTextStyle = {\n\t\talign: \"left\",\n\t\tbreakWords: false,\n\t\t// debug intentionally not included\n\t\tdropShadow: false,\n\t\tdropShadowAngle: Math.PI / 6,\n\t\tdropShadowBlur: 0,\n\t\tdropShadowColor: \"#000000\",\n\t\tdropShadowDistance: 5,\n\t\tfill: \"black\",\n\t\tfillGradientType: PIXI.TEXT_GRADIENT.LINEAR_VERTICAL,\n\t\tfontFamily: \"Arial\",\n\t\tfontSize: 26,\n\t\tfontStyle: \"normal\",\n\t\tfontVariant: \"normal\",\n\t\tfontWeight: \"normal\",\n\t\tletterSpacing: 0,\n\t\tlineHeight: 0,\n\t\tlineJoin: \"miter\",\n\t\tmiterLimit: 10,\n\t\tpadding: 0,\n\t\tstroke: \"black\",\n\t\tstrokeThickness: 0,\n\t\ttextBaseline: \"alphabetic\",\n\t\tvalign: \"baseline\",\n\t\twordWrap: false,\n\t\twordWrapWidth: 100\n\t};\n\n\tpublic static debugOptions: MstDebugOptions = {\n\t\tspans: {\n\t\t\tenabled: false,\n\t\t\tbaseline: \"#44BB44\",\n\t\t\ttop: \"#BB4444\",\n\t\t\tbottom: \"#4444BB\",\n\t\t\tbounding: \"rgba(255, 255, 255, 0.1)\",\n\t\t\ttext: true\n\t\t},\n\t\tobjects: {\n\t\t\tenabled: false,\n\t\t\tbounding: \"rgba(255, 255, 255, 0.05)\",\n\t\t\ttext: true\n\t\t}\n\t};\n\n\tprivate textStyles: TextStyleSet;\n\n\tconstructor(text: string, styles: TextStyleSet) {\n\t\tsuper(text);\n\n\t\tthis.styles = styles;\n\t}\n\n\tpublic set styles(styles: TextStyleSet) {\n\t\tthis.textStyles = {};\n\n\t\tthis.textStyles[\"default\"] = this.assign({}, MultiStyleText.DEFAULT_TAG_STYLE);\n\n\t\tfor (let style in styles) {\n\t\t\tif (style === \"default\") {\n\t\t\t\tthis.assign(this.textStyles[\"default\"], styles[style]);\n\t\t\t} else {\n\t\t\t\tthis.textStyles[style] = this.assign({}, styles[style]);\n\t\t\t}\n\t\t}\n\n\t\tthis._style = new PIXI.TextStyle(this.textStyles[\"default\"]);\n\t\tthis.dirty = true;\n\t}\n\n\tpublic setTagStyle(tag: string, style: ExtendedTextStyle): void {\n\t\tif (tag in this.textStyles) {\n\t\t\tthis.assign(this.textStyles[tag], style);\n\t\t} else {\n\t\t\tthis.textStyles[tag] = this.assign({}, style);\n\t\t}\n\n\t\tthis._style = new PIXI.TextStyle(this.textStyles[\"default\"]);\n\t\tthis.dirty = true;\n\t}\n\n\tpublic deleteTagStyle(tag: string): void {\n\t\tif (tag === \"default\") {\n\t\t\tthis.textStyles[\"default\"] = this.assign({}, MultiStyleText.DEFAULT_TAG_STYLE);\n\t\t} else {\n\t\t\tdelete this.textStyles[tag];\n\t\t}\n\n\t\tthis._style = new PIXI.TextStyle(this.textStyles[\"default\"]);\n\t\tthis.dirty = true;\n\t}\n\n\tprivate _getTextDataPerLine (lines: string[]) {\n\t\tlet outputTextData: TextData[][] = [];\n\t\tlet tags = Object.keys(this.textStyles).join(\"|\");\n\t\tlet re = new RegExp(`<\\/?(${tags})>`, \"g\");\n\n\t\tlet styleStack = [this.assign({}, this.textStyles[\"default\"])];\n\t\tlet tagNameStack = [\"default\"];\n\n\t\t// determine the group of word for each line\n\t\tfor (let i = 0; i < lines.length; i++) {\n\t\t\tlet lineTextData: TextData[] = [];\n\n\t\t\t// find tags inside the string\n\t\t\tlet matches: RegExpExecArray[] = [];\n\t\t\tlet matchArray: RegExpExecArray;\n\n\t\t\twhile (matchArray = re.exec(lines[i])) {\n\t\t\t\tmatches.push(matchArray);\n\t\t\t}\n\n\t\t\t// if there is no match, we still need to add the line with the default style\n\t\t\tif (matches.length === 0) {\n\t\t\t\tlineTextData.push(this.createTextData(lines[i], styleStack[styleStack.length - 1], tagNameStack[tagNameStack.length - 1]));\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// We got a match! add the text with the needed style\n\t\t\t\tlet currentSearchIdx = 0;\n\t\t\t\tfor (let j = 0; j < matches.length; j++) {\n\t\t\t\t\t// if index > 0, it means we have characters before the match,\n\t\t\t\t\t// so we need to add it with the default style\n\t\t\t\t\tif (matches[j].index > currentSearchIdx) {\n\t\t\t\t\t\tlineTextData.push(this.createTextData(\n\t\t\t\t\t\t\tlines[i].substring(currentSearchIdx, matches[j].index),\n\t\t\t\t\t\t\tstyleStack[styleStack.length - 1],\n\t\t\t\t\t\t\ttagNameStack[tagNameStack.length - 1]\n\t\t\t\t\t\t));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (matches[j][0][1] === \"/\") { // reset the style if end of tag\n\t\t\t\t\t\tif (styleStack.length > 1) {\n\t\t\t\t\t\t\tstyleStack.pop();\n\t\t\t\t\t\t\ttagNameStack.pop();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else { // set the current style\n\t\t\t\t\t\tstyleStack.push(this.assign({}, styleStack[styleStack.length - 1], this.textStyles[matches[j][1]]));\n\t\t\t\t\t\ttagNameStack.push(matches[j][1]);\n\t\t\t\t\t}\n\n\t\t\t\t\t// update the current search index\n\t\t\t\t\tcurrentSearchIdx = matches[j].index + matches[j][0].length;\n\t\t\t\t}\n\n\t\t\t\t// is there any character left?\n\t\t\t\tif (currentSearchIdx < lines[i].length) {\n\t\t\t\t\tlineTextData.push(this.createTextData(\n\t\t\t\t\t\tlines[i].substring(currentSearchIdx),\n\t\t\t\t\t\tstyleStack[styleStack.length - 1],\n\t\t\t\t\t\ttagNameStack[tagNameStack.length - 1]\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\toutputTextData.push(lineTextData);\n\t\t}\n\n\t\treturn outputTextData;\n\t}\n\n\tprivate getFontString(style: ExtendedTextStyle): string {\n\t\treturn new PIXI.TextStyle(style).toFontString();\n\t}\n\n\tprivate createTextData(text: string, style: ExtendedTextStyle, tagName: string): TextData {\n\t\treturn {\n\t\t\ttext,\n\t\t\tstyle,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tfontProperties: undefined,\n\t\t\ttagName\n\t\t};\n\t}\n\n\tprivate getDropShadowPadding(): number {\n\t\tlet maxDistance = 0;\n\t\tlet maxBlur = 0;\n\n\t\t Object.keys(this.textStyles).forEach((styleKey) => {\n\t\t\tlet { dropShadowDistance, dropShadowBlur } = this.textStyles[styleKey];\n\t\t\tmaxDistance = Math.max(maxDistance, dropShadowDistance || 0);\n\t\t\tmaxBlur = Math.max(maxBlur, dropShadowBlur || 0);\n\t\t});\n\n\t\treturn maxDistance + maxBlur;\n\t}\n\n\tpublic updateText(): void {\n\t\tif (!this.dirty) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.texture.baseTexture.resolution = this.resolution;\n\t\tlet textStyles = this.textStyles;\n\t\tlet outputText = this.text;\n\n\t\tif(this._style.wordWrap) {\n\t\t\toutputText = this.wordWrap(this.text);\n\t\t}\n\n\t\t// split text into lines\n\t\tlet lines = outputText.split(/(?:\\r\\n|\\r|\\n)/);\n\n\t\t// get the text data with specific styles\n\t\tlet outputTextData = this._getTextDataPerLine(lines);\n\n\t\t// calculate text width and height\n\t\tlet lineWidths: number[] = [];\n\t\tlet lineYMins: number[] = [];\n\t\tlet lineYMaxs: number[] = [];\n\t\tlet baselines: number[] = [];\n\t\tlet maxLineWidth = 0;\n\n\t\tfor (let i = 0; i < lines.length; i++) {\n\t\t\tlet lineWidth = 0;\n\t\t\tlet lineYMin = 0;\n\t\t\tlet lineYMax = 0;\n\t\t\tlet baseline = 0;\n\t\t\tfor (let j = 0; j < outputTextData[i].length; j++) {\n\t\t\t\tlet sty = outputTextData[i][j].style;\n\n\t\t\t\tthis.context.font = this.getFontString(sty);\n\n\t\t\t\t// save the width\n\t\t\t\toutputTextData[i][j].width = this.context.measureText(outputTextData[i][j].text).width;\n\n\t\t\t\tif (outputTextData[i][j].text.length === 0) {\n\t\t\t\t\toutputTextData[i][j].width += (outputTextData[i][j].text.length - 1) * sty.letterSpacing;\n\n\t\t\t\t\tif (j > 0) {\n\t\t\t\t\t\tlineWidth += sty.letterSpacing / 2; // spacing before first character\n\t\t\t\t\t}\n\n\t\t\t\t\tif (j < outputTextData[i].length - 1) {\n\t\t\t\t\t\tlineWidth += sty.letterSpacing / 2; // spacing after last character\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlineWidth += outputTextData[i][j].width;\n\n\t\t\t\t// save the font properties\n\t\t\t\toutputTextData[i][j].fontProperties = PIXI.TextMetrics.measureFont(this.context.font);\n\n\t\t\t\t// save the height\n\t\t\t\toutputTextData[i][j].height =\n\t\t\t\t\t\toutputTextData[i][j].fontProperties.fontSize + outputTextData[i][j].style.strokeThickness;\n\n\t\t\t\tif (typeof sty.valign === \"number\") {\n\t\t\t\t\tlineYMin = Math.min(lineYMin, sty.valign - outputTextData[i][j].fontProperties.descent);\n\t\t\t\t\tlineYMax = Math.max(lineYMax, sty.valign + outputTextData[i][j].fontProperties.ascent);\n\t\t\t\t} else {\n\t\t\t\t\tlineYMin = Math.min(lineYMin, -outputTextData[i][j].fontProperties.descent);\n\t\t\t\t\tlineYMax = Math.max(lineYMax, outputTextData[i][j].fontProperties.ascent);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlineWidths[i] = lineWidth;\n\t\t\tlineYMins[i] = lineYMin;\n\t\t\tlineYMaxs[i] = lineYMax;\n\t\t\tmaxLineWidth = Math.max(maxLineWidth, lineWidth);\n\t\t}\n\n\t\t// transform styles in array\n\t\tlet stylesArray = Object.keys(textStyles).map((key) => textStyles[key]);\n\n\t\tlet maxStrokeThickness = stylesArray.reduce((prev, cur) => Math.max(prev, cur.strokeThickness || 0), 0);\n\n\t\tlet dropShadowPadding = this.getDropShadowPadding();\n\n\t\tlet totalHeight = lineYMaxs.reduce((prev, cur) => prev + cur, 0) - lineYMins.reduce((prev, cur) => prev + cur, 0);\n\n\t\t// define the right width and height\n\t\tlet width = maxLineWidth + maxStrokeThickness + 2 * dropShadowPadding;\n\t\tlet height = totalHeight + 2 * dropShadowPadding;\n\n\t\tthis.canvas.width = (width + this.context.lineWidth) * this.resolution;\n\t\tthis.canvas.height = height * this.resolution;\n\n\t\tthis.context.scale(this.resolution, this.resolution);\n\n\t\tthis.context.textBaseline = \"alphabetic\";\n\t\tthis.context.lineJoin = \"round\";\n\n\t\tlet basePositionY = dropShadowPadding;\n\n\t\tlet drawingData: TextDrawingData[] = [];\n\n\t\t// Compute the drawing data\n\t\tfor (let i = 0; i < outputTextData.length; i++) {\n\t\t\tlet line = outputTextData[i];\n\t\t\tlet linePositionX: number;\n\n\t\t\tswitch (this._style.align) {\n\t\t\t\tcase \"left\":\n\t\t\t\t\tlinePositionX = dropShadowPadding;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"center\":\n\t\t\t\t\tlinePositionX = dropShadowPadding + (maxLineWidth - lineWidths[i]) / 2;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"right\":\n\t\t\t\t\tlinePositionX = dropShadowPadding + maxLineWidth - lineWidths[i];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tfor (let j = 0; j < line.length; j++) {\n\t\t\t\tlet { style, text, fontProperties, width, height, tagName } = line[j];\n\n\t\t\t\tlinePositionX += maxStrokeThickness / 2;\n\n\t\t\t\tlet linePositionY = maxStrokeThickness / 2 + basePositionY + fontProperties.ascent;\n\n\t\t\t\tswitch (style.valign) {\n\t\t\t\t\tcase \"top\":\n\t\t\t\t\t\t// no need to do anything\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"baseline\":\n\t\t\t\t\t\tlinePositionY += lineYMaxs[i] - fontProperties.ascent;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"middle\":\n\t\t\t\t\t\tlinePositionY += (lineYMaxs[i] - lineYMins[i] - fontProperties.ascent - fontProperties.descent) / 2;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"bottom\":\n\t\t\t\t\t\tlinePositionY += lineYMaxs[i] - lineYMins[i] - fontProperties.ascent - fontProperties.descent;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t// A number - offset from baseline, positive is higher\n\t\t\t\t\t\tlinePositionY += lineYMaxs[i] - fontProperties.ascent - style.valign;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (style.letterSpacing === 0) {\n\t\t\t\t\tdrawingData.push({\n\t\t\t\t\t\ttext,\n\t\t\t\t\t\tstyle,\n\t\t\t\t\t\tx: linePositionX,\n\t\t\t\t\t\ty: linePositionY,\n\t\t\t\t\t\twidth,\n\t\t\t\t\t\tascent: fontProperties.ascent,\n\t\t\t\t\t\tdescent: fontProperties.descent,\n\t\t\t\t\t\ttagName\n\t\t\t\t\t});\n\n\t\t\t\t\tlinePositionX += line[j].width;\n\t\t\t\t} else {\n\t\t\t\t\tthis.context.font = this.getFontString(line[j].style);\n\n\t\t\t\t\tfor (let k = 0; k < text.length; k++) {\n\t\t\t\t\t\tif (k > 0 || j > 0) {\n\t\t\t\t\t\t\tlinePositionX += style.letterSpacing / 2;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdrawingData.push({\n\t\t\t\t\t\t\ttext: text.charAt(k),\n\t\t\t\t\t\t\tstyle,\n\t\t\t\t\t\t\tx: linePositionX,\n\t\t\t\t\t\t\ty: linePositionY,\n\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\tascent: fontProperties.ascent,\n\t\t\t\t\t\t\tdescent: fontProperties.descent,\n\t\t\t\t\t\t\ttagName\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tlinePositionX += this.context.measureText(text.charAt(k)).width;\n\n\t\t\t\t\t\tif (k < text.length - 1 || j < line.length - 1) {\n\t\t\t\t\t\t\tlinePositionX += style.letterSpacing / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlinePositionX -= maxStrokeThickness / 2;\n\t\t\t}\n\n\t\t\tbasePositionY += lineYMaxs[i] - lineYMins[i];\n\t\t}\n\n\t\tthis.context.save();\n\n\t\t// First pass: draw the shadows only\n\t\tdrawingData.forEach(({ style, text, x, y }) => {\n\t\t\tif (!style.dropShadow) {\n\t\t\t\treturn; // This text doesn't have a shadow\n\t\t\t}\n\n\t\t\tthis.context.font = this.getFontString(style);\n\n\t\t\tlet dropFillStyle = style.dropShadowColor;\n\t\t\tif (typeof dropFillStyle === \"number\") {\n\t\t\t\tdropFillStyle = PIXI.utils.hex2string(dropFillStyle);\n\t\t\t}\n\t\t\tthis.context.shadowColor = dropFillStyle;\n\t\t\tthis.context.shadowBlur = style.dropShadowBlur;\n\t\t\tthis.context.shadowOffsetX = Math.cos(style.dropShadowAngle) * style.dropShadowDistance * this.resolution;\n\t\t\tthis.context.shadowOffsetY = Math.sin(style.dropShadowAngle) * style.dropShadowDistance * this.resolution;\n\n\t\t\tthis.context.fillText(text, x, y);\n\t\t});\n\n\t\tthis.context.restore();\n\n\t\t// Second pass: draw strokes and fills\n\t\tdrawingData.forEach(({ style, text, x, y, width, ascent, descent, tagName }) => {\n\t\t\tthis.context.font = this.getFontString(style);\n\n\t\t\tlet strokeStyle = style.stroke;\n\t\t\tif (typeof strokeStyle === \"number\") {\n\t\t\t\tstrokeStyle = PIXI.utils.hex2string(strokeStyle);\n\t\t\t}\n\n\t\t\tthis.context.strokeStyle = strokeStyle;\n\t\t\tthis.context.lineWidth = style.strokeThickness;\n\n\t\t\t// set canvas text styles\n\t\t\tlet fillStyle = style.fill;\n\t\t\tif (typeof fillStyle === \"number\") {\n\t\t\t\tfillStyle = PIXI.utils.hex2string(fillStyle);\n\t\t\t} else if (Array.isArray(fillStyle)) {\n\t\t\t\tfor (let i = 0; i < fillStyle.length; i++) {\n\t\t\t\t\tlet fill = fillStyle[i];\n\t\t\t\t\tif (typeof fill === \"number\") {\n\t\t\t\t\t\tfillStyle[i] = PIXI.utils.hex2string(fill);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.context.fillStyle = this._generateFillStyle(new PIXI.TextStyle(style), [text]) as string | CanvasGradient;\n\t\t\t// Typecast required for proper typechecking\n\n\t\t\tif (style.stroke && style.strokeThickness) {\n\t\t\t\tthis.context.strokeText(text, x, y);\n\t\t\t}\n\n\t\t\tif (style.fill) {\n\t\t\t\tthis.context.fillText(text, x, y);\n\t\t\t}\n\n\t\t\tlet debugSpan = style.debug === undefined\n\t\t\t\t? MultiStyleText.debugOptions.spans.enabled\n\t\t\t\t: style.debug;\n\n\t\t\tif (debugSpan) {\n\t\t\t\tthis.context.lineWidth = 1;\n\n\t\t\t\tif (MultiStyleText.debugOptions.spans.bounding) {\n\t\t\t\t\tthis.context.fillStyle = MultiStyleText.debugOptions.spans.bounding;\n\t\t\t\t\tthis.context.strokeStyle = MultiStyleText.debugOptions.spans.bounding;\n\t\t\t\t\tthis.context.beginPath();\n\t\t\t\t\tthis.context.rect(x, y - ascent, width, ascent + descent);\n\t\t\t\t\tthis.context.fill();\n\t\t\t\t\tthis.context.stroke();\n\t\t\t\t\tthis.context.stroke(); // yes, twice\n\t\t\t\t}\n\n\t\t\t\tif (MultiStyleText.debugOptions.spans.baseline) {\n\t\t\t\t\tthis.context.strokeStyle = MultiStyleText.debugOptions.spans.baseline;\n\t\t\t\t\tthis.context.beginPath();\n\t\t\t\t\tthis.context.moveTo(x, y);\n\t\t\t\t\tthis.context.lineTo(x + width, y);\n\t\t\t\t\tthis.context.closePath();\n\t\t\t\t\tthis.context.stroke();\n\t\t\t\t}\n\n\t\t\t\tif (MultiStyleText.debugOptions.spans.top) {\n\t\t\t\t\tthis.context.strokeStyle = MultiStyleText.debugOptions.spans.top;\n\t\t\t\t\tthis.context.beginPath();\n\t\t\t\t\tthis.context.moveTo(x, y - ascent);\n\t\t\t\t\tthis.context.lineTo(x + width, y - ascent);\n\t\t\t\t\tthis.context.closePath();\n\t\t\t\t\tthis.context.stroke();\n\t\t\t\t}\n\n\t\t\t\tif (MultiStyleText.debugOptions.spans.bottom) {\n\t\t\t\t\tthis.context.strokeStyle = MultiStyleText.debugOptions.spans.bottom;\n\t\t\t\t\tthis.context.beginPath();\n\t\t\t\t\tthis.context.moveTo(x, y + descent);\n\t\t\t\t\tthis.context.lineTo(x + width, y + descent);\n\t\t\t\t\tthis.context.closePath();\n\t\t\t\t\tthis.context.stroke();\n\t\t\t\t}\n\n\t\t\t\tif (MultiStyleText.debugOptions.spans.text) {\n\t\t\t\t\tthis.context.fillStyle = \"#ffffff\";\n\t\t\t\t\tthis.context.strokeStyle = \"#000000\";\n\t\t\t\t\tthis.context.lineWidth = 2;\n\t\t\t\t\tthis.context.font = \"8px monospace\";\n\t\t\t\t\tthis.context.strokeText(tagName, x, y - ascent + 8);\n\t\t\t\t\tthis.context.fillText(tagName, x, y - ascent + 8);\n\t\t\t\t\tthis.context.strokeText(`${width.toFixed(2)}x${(ascent + descent).toFixed(2)}`, x, y - ascent + 16);\n\t\t\t\t\tthis.context.fillText(`${width.toFixed(2)}x${(ascent + descent).toFixed(2)}`, x, y - ascent + 16);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (MultiStyleText.debugOptions.objects.enabled) {\n\t\t\tif (MultiStyleText.debugOptions.objects.bounding) {\n\t\t\t\tthis.context.fillStyle = MultiStyleText.debugOptions.objects.bounding;\n\t\t\t\tthis.context.beginPath();\n\t\t\t\tthis.context.rect(0, 0, width, height);\n\t\t\t\tthis.context.fill();\n\t\t\t}\n\n\t\t\tif (MultiStyleText.debugOptions.objects.text) {\n\t\t\t\tthis.context.fillStyle = \"#ffffff\";\n\t\t\t\tthis.context.strokeStyle = \"#000000\";\n\t\t\t\tthis.context.lineWidth = 2;\n\t\t\t\tthis.context.font = \"8px monospace\";\n\t\t\t\tthis.context.strokeText(`${width.toFixed(2)}x${height.toFixed(2)}`, 0, 8, width);\n\t\t\t\tthis.context.fillText(`${width.toFixed(2)}x${height.toFixed(2)}`, 0, 8, width);\n\t\t\t}\n\t\t}\n\n\t\tthis.updateTexture();\n\t}\n\n\tprotected wordWrap(text: string): string {\n\t\t// Greedy wrapping algorithm that will wrap words as the line grows longer than its horizontal bounds.\n\t\tlet result = '';\n\t\tlet tags = Object.keys(this.textStyles).join(\"|\");\n\t\tlet re = new RegExp(`(<\\/?(${tags})>)`, \"g\");\n\n\t\tconst lines = text.split(\"\\n\");\n\t\tconst wordWrapWidth = this._style.wordWrapWidth;\n\t\tlet styleStack = [this.assign({}, this.textStyles[\"default\"])];\n\t\tthis.context.font = this.getFontString(this.textStyles[\"default\"]);\n\n\t\tfor (let i = 0; i < lines.length; i++) {\n\t\t\tlet spaceLeft = wordWrapWidth;\n\t\t\tconst words = lines[i].split(\" \");\n\n\t\t\tfor (let j = 0; j < words.length; j++) {\n\t\t\t\tconst parts = words[j].split(re);\n\n\t\t\t\tfor (let k = 0; k < parts.length; k++) {\n\t\t\t\t\tif (re.test(parts[k])) {\n\t\t\t\t\t\tresult += parts[k];\n\t\t\t\t\t\tif (parts[k][1] === \"/\") {\n\t\t\t\t\t\t\tk++;\n\t\t\t\t\t\t\tstyleStack.pop();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tk++;\n\t\t\t\t\t\t\tstyleStack.push(this.assign({}, styleStack[styleStack.length - 1], this.textStyles[parts[k]]));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.context.font = this.getFontString(styleStack[styleStack.length - 1]);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst partWidth = this.context.measureText(parts[k]).width;\n\n\t\t\t\t\tif (this._style.breakWords && partWidth > spaceLeft) {\n\t\t\t\t\t\t// Part should be split in the middle\n\t\t\t\t\t\tconst characters = parts[k].split('');\n\n\t\t\t\t\t\tif (j > 0 && k === 0) {\n\t\t\t\t\t\t\tresult += \" \";\n\t\t\t\t\t\t\tspaceLeft -= this.context.measureText(\" \").width;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (let c = 0; c < characters.length; c++) {\n\t\t\t\t\t\t\tconst characterWidth = this.context.measureText(characters[c]).width;\n\n\t\t\t\t\t\t\tif (characterWidth > spaceLeft) {\n\t\t\t\t\t\t\t\tresult += `\\n${characters[c]}`;\n\t\t\t\t\t\t\t\tspaceLeft = wordWrapWidth - characterWidth;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (j > 0 && k === 0 && c === 0) {\n\t\t\t\t\t\t\t\t\tresult += \" \";\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresult += characters[c];\n\t\t\t\t\t\t\t\tspaceLeft -= characterWidth;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if(this._style.breakWords) {\n\t\t\t\t\t\tresult += parts[k];\n\t\t\t\t\t\tspaceLeft -= partWidth;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst paddedPartWidth =\n\t\t\t\t\t\t\tpartWidth + (k === 0 ? this.context.measureText(\" \").width : 0);\n\n\t\t\t\t\t\tif (j === 0 || paddedPartWidth > spaceLeft) {\n\t\t\t\t\t\t\t// Skip printing the newline if it's the first word of the line that is\n\t\t\t\t\t\t\t// greater than the word wrap width.\n\t\t\t\t\t\t\tif (j > 0) {\n\t\t\t\t\t\t\t\tresult += \"\\n\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresult += parts[k];\n\t\t\t\t\t\t\tspaceLeft = wordWrapWidth - partWidth;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tspaceLeft -= paddedPartWidth;\n\n\t\t\t\t\t\t\tif (k === 0) {\n\t\t\t\t\t\t\t\tresult += \" \";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresult += parts[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i < lines.length - 1) {\n\t\t\t\tresult += '\\n';\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprotected updateTexture() {\n\t\tconst texture = this._texture;\n\n\t\tlet dropShadowPadding = this.getDropShadowPadding();\n\n\t\ttexture.baseTexture.hasLoaded = true;\n\t\ttexture.baseTexture.resolution = this.resolution;\n\n\t\ttexture.baseTexture.realWidth = this.canvas.width;\n\t\ttexture.baseTexture.realHeight = this.canvas.height;\n\t\ttexture.baseTexture.width = this.canvas.width / this.resolution;\n\t\ttexture.baseTexture.height = this.canvas.height / this.resolution;\n\t\ttexture.trim.width = texture.frame.width = this.canvas.width / this.resolution;\n\t\ttexture.trim.height = texture.frame.height = this.canvas.height / this.resolution;\n\n\t\ttexture.trim.x = -this._style.padding - dropShadowPadding;\n\t\ttexture.trim.y = -this._style.padding - dropShadowPadding;\n\n\t\ttexture.orig.width = texture.frame.width - (this._style.padding + dropShadowPadding) * 2;\n\t\ttexture.orig.height = texture.frame.height - (this._style.padding + dropShadowPadding) * 2;\n\n\t\t// call sprite onTextureUpdate to update scale if _width or _height were set\n\t\tthis._onTextureUpdate();\n\n\t\ttexture.baseTexture.emit('update', texture.baseTexture);\n\n\t\tthis.dirty = false;\n\t}\n\n\t// Lazy fill for Object.assign\n\tprivate assign(destination: any, ...sources: any[]): any {\n\t\tfor (let source of sources) {\n\t\t\tfor (let key in source) {\n\t\t\t\tdestination[key] = source[key];\n\t\t\t}\n\t\t}\n\n\t\treturn destination;\n\t}\n}\n","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport SimpleScene from \"./SimpleScene\";\r\n\r\nexport default class GallerySelectionScene extends SimpleScene {\r\n    constructor() {\r\n        super();\r\n\r\n        // Attributes.\r\n        this._colourItBtn = null;\r\n        this._drawItBtn = null;\r\n        this._colourItText = null;\r\n        this._drawItText = null;\r\n        this._titleSprite = null;\r\n        this._titleText = null;\r\n        this._colourItSprite = null;\r\n        this._drawItSprite = null;\r\n    }\r\n\r\n    init() {\r\n\r\n        this._bgSprite = new PIXI.Sprite(Common.assets.getTexture(\"bg\"));//not sure why this is like this, but must create background first\r\n        super.init();\r\n\r\n\r\n        /*\r\n         deprecated title sprite and text\r\n         */\r\n\r\n        // Title sprite.\r\n        // this._titleSprite = new PIXI.Sprite(Common.assets.getTexture(\"popup_box_title_bg\"));\r\n        //  this._titleSprite.y = this._titleSprite.height * 0.5;\r\n        //  this._titleSprite.x = Common.STAGE_WIDTH * 0.5;\r\n        //  this._titleSprite.anchor = new PIXI.Point(0.5, 0.75);\r\n        //  this.addChild(this._titleSprite);\r\n\r\n        // Title text.\r\n        /*\r\n         let bkText = P3.createText(\"GAMES\", {\r\n         fill: [0xfff8b3, 0xfac109],\r\n         size: \"90px\",\r\n         wordWrap: true,\r\n         wordWrapWidth: 500,\r\n         stroke: 0x23a838,\r\n         strokeThickness: 14,\r\n         align: \"centre\"\r\n         });\r\n\r\n         this._titleText = P3.createText(\"GAMES\", {\r\n         fill: [0xfff8b3, 0xfac109],\r\n         size: \"90px\",\r\n         wordWrap: true,\r\n         wordWrapWidth: 500,\r\n         stroke: 0x006130,\r\n         align: \"centre\",\r\n         strokeThickness: 8\r\n         });\r\n\r\n         this._titleText.anchor = bkText.anchor = new PIXI.Point(0.5, 0.5);\r\n         this._titleText.y = bkText.y = -45;\r\n         this._titleSprite.addChild(bkText, this._titleText);\r\n         */\r\n\r\n        // Colour gallery.\r\n        // Image.\r\n        let btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"game_colour\"),\r\n            Common.assets.getTexture(\"game_colour\"),\r\n            Common.assets.getTexture(\"game_colour\")\r\n        );\r\n        this._colourItSprite = new P3.Button(btnStatesAux);\r\n        this._colourItSprite.signals.click.addOnce(this._onColourGalleryButton_Click, this);\r\n        this._colourItSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._colourItSprite.position = new PIXI.Point(\r\n            Common.STAGE_WIDTH * 0.5 - 255,\r\n            Common.STAGE_HEIGHT * 0.5);\r\n        this.addChild(this._colourItSprite);\r\n\r\n        const colourItTextConf = {\r\n            size: \"75px\",\r\n            fill: \"#3992ff\",\r\n            stroke: \"#2c1812\",\r\n            wordWrapWidth: 400\r\n        };\r\n        this._colourItText = P3.createMultiText(\"COLOUR_IT\", colourItTextConf);\r\n\r\n        this._colourItText.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._colourItText.y = -this._colourItSprite.height * 0.5 + 15;\r\n        this._colourItSprite.addChild(this._colourItText);\r\n\r\n        // Button.\r\n        this._colourItBtn = createButton(\"play_large\", \"primary_large\");\r\n        this._colourItBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._colourItBtn.y = this._colourItSprite.y + this._colourItSprite.height * 0.5;\r\n        this._colourItBtn.x = this._colourItSprite.x;\r\n        this._colourItBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._colourItBtn.downSoundName = \"sfx_btn_play_start_doorbell_00\";\r\n        this._colourItBtn.signals.click.addOnce(this._onColourGalleryButton_Click, this);\r\n        this.addChild(this._colourItBtn);\r\n\r\n        // Draw gallery.\r\n        // Image.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"game_draw\"),\r\n            Common.assets.getTexture(\"game_draw\"),\r\n            Common.assets.getTexture(\"game_draw\")\r\n        );\r\n        this._drawItSprite = new P3.Button(btnStatesAux);\r\n        this._drawItSprite.signals.click.addOnce(this._onDrawGalleryButton_Click, this);\r\n\r\n        this._drawItSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._drawItSprite.position = new PIXI.Point(\r\n            Common.STAGE_WIDTH * 0.5 + 255,\r\n            Common.STAGE_HEIGHT * 0.5);\r\n        this.addChild(this._drawItSprite);\r\n\r\n        this._drawItText = P3.createText(\"DRAW_IT\", {\r\n            size: \"75px\",\r\n            fill: \"white\",\r\n            stroke: \"#2c1812\",\r\n            stokeThickness: 6,\r\n            wordWrap: true,\r\n            wordWrapWidth: 300\r\n        }, \"truetype\");\r\n\r\n        this._drawItText.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._drawItText.y = -this._drawItSprite.height * 0.5 + 15;\r\n        this._drawItSprite.addChild(this._drawItText);\r\n        // Button.\r\n\r\n        this._drawItBtn = createButton(\"play_large\", \"primary_large\");\r\n        this._drawItBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._drawItBtn.position.y = this._drawItSprite.y + this._drawItSprite.height * 0.5;\r\n        this._drawItBtn.position.x = this._drawItSprite.x;\r\n        this._drawItBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._drawItBtn.downSoundName = \"sfx_btn_play_start_doorbell_00\";\r\n        this._drawItBtn.signals.click.addOnce(this._onDrawGalleryButton_Click, this);\r\n        this.addChild(this._drawItBtn);\r\n\r\n        super.createSharedControls(this);\r\n        this._uiTopBarSharedControls.muteBtn.visible = true;\r\n        this._uiTopBarSharedControls.backBtn.visible = true;\r\n        this._uiTopBarSharedControls.signals.onBackBtn_Click.addOnce(function () {\r\n            this.signals.previous.dispatch(this);\r\n        }, this);\r\n    }\r\n\r\n    destroy() {\r\n        super.destroy({children: true});\r\n        TweenMax.killAll();\r\n    }\r\n\r\n    animateIn() {\r\n        //this._titleSprite.y -= 100;\r\n        // TweenMax.to(this._titleSprite, 1.5, {y: this._titleSprite.y + 100, ease: Elastic.easeOut});\r\n\r\n        this._drawItSprite.x += 100;\r\n        this._drawItSprite.alpha = 0;\r\n        TweenMax.to(this._drawItSprite, 0.25, {alpha: 1, x: this._drawItSprite.x - 100, ease: Sine.easeOut});\r\n\r\n        this._colourItSprite.x -= 100;\r\n        this._colourItSprite.alpha = 0;\r\n        TweenMax.to(this._colourItSprite, 0.25, {alpha: 1, x: this._colourItSprite.x + 100, ease: Sine.easeOut});\r\n\r\n        this._drawItBtn.alpha = 0;\r\n        this._drawItBtn.scale = new PIXI.Point();\r\n        TweenMax.to(this._drawItBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.2});\r\n        TweenMax.to(this._drawItBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.2});\r\n\r\n        this._colourItBtn.alpha = 0;\r\n        this._colourItBtn.scale = new PIXI.Point();\r\n        TweenMax.to(this._colourItBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.35});\r\n        TweenMax.to(this._colourItBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.35});\r\n    }\r\n\r\n    //----EVENTS----//\r\n\r\n    _onColourGalleryButton_Click() {\r\n        CommonGame.selectedGallery = CommonGame.GALLERY_ID_COLOUR_IT;\r\n        this.signals.next.dispatch(this);\r\n    }\r\n\r\n    _onDrawGalleryButton_Click() {\r\n        CommonGame.selectedGallery = CommonGame.GALLERY_ID_DRAW_IT;\r\n        this.signals.next.dispatch(this);\r\n    }\r\n}\r\n","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport MyGame from \"../game/MyGame\";\r\nimport Tutorial from \"../game/Tutorial\";\r\nimport MenuPanel from \"../ui/overlays/MenuPanel\";\r\nimport PalettePanel from \"../ui/overlays/PalettePanel\";\r\nimport PaletteButton from \"../game/PaletteButton\";\r\nimport SimpleScene  from \"./SimpleScene\";\r\n\r\nexport default class GameScene extends SimpleScene {\r\n    constructor() {\r\n        super();\r\n\r\n        // Attributes.\r\n        this._menuPanel = null;\r\n        this._tutorial = null;\r\n\r\n        this._gameLayer = null;\r\n        this._tutorialLayer = null;\r\n        this._overlayLayer = null;\r\n    }\r\n\r\n    init() {\r\n\r\n        this._bgSprite = new PIXI.Sprite(Common.assets.getTexture(\"bg\"));//not sure why this is like this, but must create background first\r\n        super.init();\r\n\r\n        // Layers.\r\n        this._gameLayer = new PIXI.Container();\r\n        this.addChild(this._gameLayer);\r\n        this._tutorialLayer = new PIXI.Container();\r\n        this.addChild(this._tutorialLayer);\r\n        this._overlayLayer = new PIXI.Container();\r\n        this.addChild(this._overlayLayer);\r\n\r\n        // Overlay initialization. Order is important due to dependencies.\r\n        // Menu.\r\n        this._menuPanel = new MenuPanel(this.signals);\r\n        this._menuPanel.position = new PIXI.Point(Common.STAGE_WIDTH * 0.5, Common.STAGE_HEIGHT * 0.5);\r\n        this._menuPanel.init();\r\n        this._overlayLayer.addChild(this._menuPanel);\r\n\r\n        // Palette.\r\n        this._palettePanel = new PalettePanel();\r\n        this._palettePanel.position = new PIXI.Point(Common.STAGE_WIDTH * 0.5, Common.STAGE_HEIGHT * 0.5);\r\n        this._palettePanel.init();\r\n        this._overlayLayer.addChild(this._palettePanel);\r\n\r\n        // Game.\r\n        Common.game = new MyGame();\r\n        Common.game.scene = this;\r\n        Common.game.init();\r\n\r\n        // Tutorial.\r\n        if (Common.savedData.isDrawTutorial || Common.savedData.isToolTutorial || Common.savedData.isPaletteTutorial) {\r\n            this._tutorial = new Tutorial();\r\n            this._tutorial.init();\r\n            this._tutorial.signals.onCompleted.addOnce(\r\n                function () {\r\n                    this._tutorial.end();\r\n                    this._tutorial.destroy();\r\n                    this._tutorial = null;\r\n                },\r\n                this);\r\n            this._tutorialLayer.addChild(this._tutorial);\r\n        }\r\n\r\n        // Signals.\r\n        // Link the panels to the HUD buttons that show them.\r\n        Common.game.hud.signals.onMenuClick.add(this._onMenuBtn_Click, this);\r\n        Common.game.hud.signals.onPaletteClick.add(this._onPaletteBtn_Click, this);\r\n\r\n        this.createSharedControls();\r\n    }\r\n\r\n    update() {\r\n        if (this._tutorial) this._tutorial.update();\r\n        Common.game.update();\r\n    }\r\n\r\n    animateIn() {\r\n        // Music.\r\n        Common.audio.stopMusic();\r\n        Common.audio.playMusic(\"sfx_ambient_desert_loop_00\");\r\n\r\n        Common.game.animateIn();\r\n    }\r\n\r\n    resize() {\r\n        this.x = ( P3.View.width - Common.STAGE_WIDTH ) * 0.5;\r\n\r\n        Common.game.resize();\r\n        if (this._tutorial) this._tutorial.resize();\r\n    }\r\n\r\n    addTutorialEvent(tutorialEvent) {\r\n        if (this._tutorial) this._tutorial.addEvent(tutorialEvent);\r\n    }\r\n\r\n    //----EVENTS----//\r\n\r\n    _onMenuBtn_Click() {\r\n        this._menuPanel.show();\r\n    }\r\n\r\n    _onPaletteBtn_Click(toolType) {\r\n        // Show palette panel.\r\n        this._palettePanel.show(toolType);\r\n\r\n        // Tutorial.\r\n        Common.game.scene.addTutorialEvent(CommonGame.TUT_EVENT.PALETTE_SELECTED);\r\n    }\r\n\r\n    get gameLayer() {\r\n        return this._gameLayer;\r\n    }\r\n\r\n    get palettePanel() {\r\n        return this._palettePanel;\r\n    }\r\n}\r\n","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport SimpleScene from \"./SimpleScene\";\r\nimport UICarousel from \"../ui/UICarousel\";\r\n\r\nexport default class ImageSelectionScene extends SimpleScene {\r\n    constructor() {\r\n        super();\r\n\r\n        // Constants.\r\n        this.ARR_DRAW_IT_TEXT_ID = [\r\n            \"1\",\r\n            \"2\",\r\n            \"3\",\r\n            \"4\",\r\n            \"5\",\r\n            \"6\",\r\n            \"7\",\r\n            \"8\",\r\n            \"9\",\r\n            \"10\"\r\n        ];\r\n        this.ARR_IMAGE_SPRITE_ID = [];//from legacy project, working around//--\r\n        this._imageLength = this.ARR_DRAW_IT_TEXT_ID.length;\r\n\r\n        for (let i = 0; i < this._imageLength; i++) {\r\n            this.ARR_IMAGE_SPRITE_ID.push(\"image_\" + (i + 1));//--\r\n        }\r\n\r\n        // Attributes.\r\n        this._titleSprite = null;\r\n        this._titleText = null;\r\n\r\n        // UI.\r\n        this._playBtn = null;\r\n        this._prevImageBtn = null;\r\n        this._nextImageBtn = null;\r\n        this._uiCarousel = null;\r\n    }\r\n\r\n    init() {\r\n\r\n        this._bgSprite = new PIXI.Sprite(Common.assets.getTexture(\"bg\"));//for some reason bg must be created before super is called\r\n        super.init();\r\n\r\n        this.imagePrefix = CommonGame.selectedGallery == CommonGame.GALLERY_ID_COLOUR_IT ? \"colour_\" : \"draw_\";\r\n        /*\r\n         // Title sprite.\r\n         this._titleSprite = new PIXI.Sprite(Common.assets.getTexture(\"popup_box_title_bg\"));\r\n         this._titleSprite.y = this._titleSprite.height * 0.5;\r\n         this._titleSprite.x = Common.STAGE_WIDTH * 0.5;\r\n         this._titleSprite.anchor = new PIXI.Point(0.5, 0.75);\r\n         this.addChild(this._titleSprite);\r\n\r\n         // Title text.\r\n\r\n         // Title text.\r\n         let bkText = P3.createText(\"DRAWINGS\", {\r\n         fill: [0xfff8b3, 0xfac109],\r\n         size: \"90px\",\r\n         wordWrap: true,\r\n         wordWrapWidth: 500,\r\n         stroke: 0x23a838,\r\n         strokeThickness: 14,\r\n         align: \"centre\"\r\n         });\r\n\r\n         this._titleText = P3.createText(\"DRAWINGS\", {\r\n         fill: [0xfff8b3, 0xfac109],\r\n         size: \"90px\",\r\n         wordWrap: true,\r\n         wordWrapWidth: 500,\r\n         stroke: 0x006130,\r\n         align: \"centre\",\r\n         strokeThickness: 8\r\n         });\r\n\r\n         this._titleText.y = bkText.y = -45;\r\n         this._titleText.anchor = bkText.anchor = new PIXI.Point(0.5, 0.5);\r\n         this._titleSprite.addChild(bkText, this._titleText);\r\n         */\r\n        // Carousel items.\r\n        var arrCarouselItem = [];\r\n        for (let i = 0; i < this._imageLength; i++) {\r\n            // Container.\r\n            var carouselItem = new PIXI.Container();\r\n            carouselItem.scale = new PIXI.Point(0.6, 0.6);\r\n            carouselItem.anchor = new PIXI.Point(0.5, 0.5);\r\n\r\n            carouselItem.addChild(CommonGame.createCanvasBg());\r\n\r\n            // Bg.\r\n            var bgSprite = new PIXI.Sprite(Common.blankTexture);\r\n            bgSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n            bgSprite.width = CommonGame.CANVAS_WIDTH;\r\n            bgSprite.height = CommonGame.CANVAS_HEIGHT;\r\n            bgSprite.tint = 0xffffff;\r\n\r\n            carouselItem.addChild(bgSprite);\r\n\r\n            let galleryKey = \"drawing\";\r\n            if (CommonGame.selectedGallery === 1) galleryKey = \"colouring\";\r\n\r\n            // Border.\r\n            var borderSprite = new PIXI.Sprite(Common.assets.getTexture(\"canvas_\" + galleryKey));\r\n            borderSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n            carouselItem.addChild(borderSprite);\r\n            // Sprite.\r\n            var imageSprite = new PIXI.Sprite(Common.assets.getTexture(this.imagePrefix + \"image_\" + (i + 1)));\r\n            imageSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n            carouselItem.addChild(imageSprite);\r\n\r\n            arrCarouselItem.push(carouselItem);\r\n        }\r\n\r\n        // UICarousel.\r\n        this._uiCarousel = new UICarousel();\r\n        this._uiCarousel.init(arrCarouselItem);\r\n        this._uiCarousel.signals.onIndexChanged.add(this._onCarouselIndex_Changed, this);\r\n        this._uiCarousel.signals.onItemSelected.add(this._onPlayButton_Click, this);\r\n        this.addChild(this._uiCarousel);\r\n\r\n        // Play button.\r\n        let btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"btn_primary_large_off\"),\r\n            Common.assets.getTexture(\"btn_primary_large_over\"),\r\n            Common.assets.getTexture(\"btn_primary_large_down\"),\r\n            Common.assets.getTexture(\"icon_play_large_off\")\r\n        );\r\n        this._playBtn = createButton(\"play_large\", \"primary_large\");\r\n        this._playBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._playBtn.position = new PIXI.Point(\r\n            Common.STAGE_WIDTH * 0.5,\r\n            Common.STAGE_HEIGHT * 0.5 + 220\r\n        );\r\n        this._playBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._playBtn.downSoundName = \"sfx_btn_play_start_doorbell_00\";\r\n        this._playBtn.signals.click.addOnce(this._onPlayButton_Click, this);\r\n        this.addChild(this._playBtn);\r\n\r\n        // Next image button.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_next_off\"),\r\n            Common.assets.getTexture(\"icon_next_over\"),\r\n            Common.assets.getTexture(\"icon_next_down\")\r\n        );\r\n\r\n        this._nextImageBtn = new P3.Button(btnStatesAux);\r\n        this._nextImageBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._nextImageBtn.scale = new PIXI.Point(1.5, 1.5);\r\n        this._nextImageBtn.defaultScale = new PIXI.Point(1.5, 1.5);\r\n        this._nextImageBtn.position = new PIXI.Point(\r\n            Common.STAGE_WIDTH * 0.5 + 400,\r\n            Common.STAGE_HEIGHT * 0.5);\r\n        this._nextImageBtn.signals.click.add(this._onNextImageButton_Click, this);\r\n        this.addChild(this._nextImageBtn);\r\n\r\n        // Prev image button.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_next_off\"),\r\n            Common.assets.getTexture(\"icon_next_over\"),\r\n            Common.assets.getTexture(\"icon_next_down\")\r\n        );\r\n\r\n        this._prevImageBtn = new P3.Button(btnStatesAux);\r\n        this._prevImageBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._prevImageBtn.scale = new PIXI.Point(-1.5, 1.5);\r\n        this._prevImageBtn.alpha = 0;\r\n\r\n        this._prevImageBtn.defaultScale = new PIXI.Point(-1.5, 1.5);\r\n        this._prevImageBtn.position = new PIXI.Point(\r\n            Common.STAGE_WIDTH * 0.5 - 400,\r\n            Common.STAGE_HEIGHT * 0.5);\r\n        this._prevImageBtn.signals.click.add(this._onPrevImageButton_Click, this);\r\n        this.addChild(this._prevImageBtn);\r\n\r\n        this._updateUI();\r\n\r\n        super.createSharedControls.call(this);\r\n        this._uiTopBarSharedControls.muteBtn.visible = true;\r\n        this._uiTopBarSharedControls.backBtn.visible = true;\r\n        this._uiTopBarSharedControls.signals.onBackBtn_Click.addOnce(function () {\r\n            this.signals.previous.dispatch(this);\r\n        }, this);\r\n    }\r\n\r\n    update() {\r\n        this._uiCarousel.update();\r\n    }\r\n\r\n    animateIn() {\r\n       // this._titleSprite.y -= 100;\r\n       // TweenMax.to(this._titleSprite, 1.5, {y: this._titleSprite.y + 100, ease: Elastic.easeOut});\r\n\r\n        this._uiCarousel.animateIn();\r\n\r\n        this._playBtn.alpha = 0;\r\n        this._playBtn.scale = new PIXI.Point();\r\n        TweenMax.to(this._playBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.2});\r\n        TweenMax.to(this._playBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.2});\r\n    }\r\n\r\n    _updateUI() {\r\n        // Prev.\r\n        this._prevImageBtn.interactive = this._uiCarousel.selectedIndex > 0;\r\n        TweenMax.to(this._prevImageBtn, 0.25, {alpha: this._prevImageBtn.interactive ? 1 : 0, ease: Sine.easeOut});\r\n\r\n        // Next.\r\n        this._nextImageBtn.interactive = this._uiCarousel.selectedIndex < this._imageLength - 1;\r\n        TweenMax.to(this._nextImageBtn, 0.25, {alpha: this._nextImageBtn.interactive ? 1 : 0, ease: Sine.easeOut});\r\n    }\r\n\r\n    destroy() {\r\n        super.destroy({children: true});\r\n        TweenMax.killAll();\r\n    }\r\n\r\n    //----EVENTS----//\r\n\r\n    _onCarouselIndex_Changed() {\r\n        this._updateUI();\r\n    }\r\n\r\n    _onPlayButton_Click() {\r\n\r\n        CommonGame.selectedImageId = this.ARR_IMAGE_SPRITE_ID[this._uiCarousel.selectedIndex];\r\n\r\n        if (CommonGame.selectedGallery === CommonGame.GALLERY_ID_DRAW_IT) {\r\n            CommonGame.drawItTextId = this.ARR_DRAW_IT_TEXT_ID[this._uiCarousel.selectedIndex];\r\n        }\r\n\r\n        // Sfx.\r\n        //   Common.audio.playSound(\"vo_happo_ready_00\");\r\n\r\n        this.signals.next.dispatch(this);\r\n    }\r\n\r\n    _onPrevImageButton_Click() {\r\n        this._uiCarousel.prev();\r\n    }\r\n\r\n    _onNextImageButton_Click() {\r\n        this._uiCarousel.next();\r\n    }\r\n\r\n}\r\n","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport SimpleScene from \"./SimpleScene\";\r\n\r\nexport default class MainScene extends SimpleScene {\r\n    constructor() {\r\n        super();\r\n\r\n        // Attributes.\r\n        this._playBtn = null;\r\n        this._titleSprite = null;\r\n    }\r\n\r\n    init() {\r\n\r\n        this._bgSprite = new PIXI.Sprite(Common.assets.getTexture(\"splash_bg\"));//must go first for some reason\r\n        super.init();\r\n\r\n        // Title sprite.\r\n        this._titleSprite = new PIXI.Sprite(Common.assets.getTexture(\"game_title\"));\r\n        this._titleSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._titleSprite.position = new PIXI.Point(Common.STAGE_WIDTH * 0.5, Common.STAGE_HEIGHT * 0.5 - 45);\r\n        //this._titleSprite.scale.set(0.9);\r\n        this.addChild(this._titleSprite);\r\n\r\n        // Play button.\r\n        /*\r\n         const btnStatesAux = new P3.ButtonStates(\r\n         Common.assets.getTexture(\"btn_primary_large_off\"),\r\n         Common.assets.getTexture(\"btn_primary_large_over\"),\r\n         Common.assets.getTexture(\"btn_primary_large_down\"),\r\n         Common.assets.getTexture(\"icon_play_large_off\")\r\n         );*/\r\n\r\n        this._playBtn = createButton(\"play_large\", \"primary_large\");\r\n        this._playBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._playBtn.position = new PIXI.Point(\r\n            Common.STAGE_WIDTH * 0.5 + 325,\r\n            Common.STAGE_HEIGHT - 110);\r\n        this._playBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._playBtn.downSoundName = \"sfx_btn_play_start_doorbell_00\";\r\n        this._playBtn.signals.click.addOnce(this._onPlayButton_Click, this);\r\n        this.addChild(this._playBtn);\r\n\r\n        super.createSharedControls(this);\r\n        this._uiTopBarSharedControls.muteBtn.visible = true;\r\n\r\n    }\r\n\r\n    destroy() {\r\n        super.destroy({children: true});\r\n        TweenMax.killAll();\r\n    }\r\n\r\n    animateIn() {\r\n        this._playBtn.alpha = 0;\r\n        this._playBtn.scale = new PIXI.Point();\r\n        TweenMax.to(this._playBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.2});\r\n        TweenMax.to(this._playBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.2});\r\n\r\n        // Music.\r\n        Common.audio.playMusic(\"music_mainmenu_loop_00\");\r\n    }\r\n\r\n    //----EVENTS----//\r\n\r\n    _onPlayButton_Click() {\r\n        this.signals.next.dispatch(this);\r\n    }\r\n}\r\n","/**\n *  PreloaderScene\n *\n *  Created by Legman on 7/10/2015.\n *\n */\n\n\"use strict\";\n\n//var Common = require(\"../Common\");\nimport Application      from \"../Application\";\nimport Common from \"../Common\";\n\n/**\n * @constructor\n * @extends {P3.Scene}\n */\nfunction PreloaderScene() {\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.loaded = 0;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this._isPlayingAnim = false;\n\n    /**\n     * @type {PIXI.MovieClip}\n     * @private\n     */\n    this._logoAnimation = null;\n\n    /**\n     * @type {PIXI.Sprite}\n     * @private\n     */\n    this._bar = null;\n\n    /**\n     * @type {PIXI.Sprite}\n     * @private\n     */\n    this._barOverlay = null;\n\n    /**\n     * @type {PIXI.Text}\n     * @private\n     */\n    this._text = null;\n\n    /**\n     * @type {P3.Button}\n     * @private\n     */\n    this._playButton = null;\n\n\n    P3.Scene.call(this);\n\n\n    this.signals.onAllLoaded = new signals.Signal();\n}\nexport default PreloaderScene;\n//module.exports = PreloaderScene;\nPreloaderScene.prototype = Object.create(P3.Scene.prototype);\nPreloaderScene.prototype.constructor = PreloaderScene;\n\nPreloaderScene.prototype.init = function () {\n\n    console.log(Common);\n    console.log(Common.assets);\n\n    var g = new PIXI.Graphics();\n    g.beginFill(0x872F87);\n    g.drawRect(0, 0, Common.STAGE_WIDTH, Common.STAGE_HEIGHT);\n    g.endFill();\n    this.addChild(g);\n\n    var holder = new PIXI.Container();\n    holder.x = Math.floor(Common.STAGE_WIDTH * 0.5);\n    holder.y = Math.floor(Common.STAGE_HEIGHT * 0.5) + 50;\n    this.addChild(holder);\n\n    var logoFrames = [Common.assets.getTexture('loader_animation0001'),\n        Common.assets.getTexture('loader_animation0002'),\n        Common.assets.getTexture('loader_animation0003'),\n        Common.assets.getTexture('loader_animation0004'),\n        Common.assets.getTexture('loader_animation0005'),\n        Common.assets.getTexture('loader_animation0006'),\n        Common.assets.getTexture('loader_animation0007'),\n        Common.assets.getTexture('loader_animation0008'),\n        Common.assets.getTexture('loader_animation0009'),\n        Common.assets.getTexture('loader_animation0010')\n    ];\n\n    this._logoAnimation = new PIXI.extras.MovieClip(logoFrames);\n    this._logoAnimation.animationSpeed = 0.4;\n    this._logoAnimation.gotoAndStop(0);\n    this._logoAnimation.stop();\n    this._logoAnimation.loop = false;\n    this._logoAnimation.anchor.x = 0.5;\n    this._logoAnimation.anchor.y = 1.0;\n    this._logoAnimation.x += 50;\n    this._logoAnimation.y -= 20;\n    holder.addChild(this._logoAnimation);\n\n    this._bar = new PIXI.Sprite(Common.assets.getTexture('preloader_bar'));\n    this._bar.anchor.y = 0.5;\n    this._bar.x -= this._bar.width * 0.5;\n    this._bar.scale.x = 0;\n    holder.addChild(this._bar);\n\n    this._barOverlay = new PIXI.Sprite(Common.assets.getTexture('preloader_overlay'));\n    this._barOverlay.anchor.y = 0.5;\n    this._barOverlay.x -= this._barOverlay.width * 0.5;\n    holder.addChild(this._barOverlay);\n\n    this._text = new PIXI.Text(\"0%\", {font: '28px Arial', 'fill': '#FFFFFF'});\n    this._text.anchor.x = 0.5;\n    this._text.position.y += 50;\n    holder.addChild(this._text);\n\n    // Start animation.\n    this._logoAnimation.gotoAndPlay(0);\n\n    var btnStatesAux = new P3.ButtonStates(\n        Common.assets.getTexture(\"btn_primary_large_off\"),\n        Common.assets.getTexture(\"btn_primary_large_over\"),\n        Common.assets.getTexture(\"btn_primary_large_down\"),\n        Common.assets.getTexture(\"icon_play_large_off\"));\n    this._playButton = new P3.Button(btnStatesAux);\n    this._playButton.y += 50;\n    //this._playButton.downSoundName = \"music_menu_playbtn_start_00\";\n    this._playButton.visible = false;\n    this._playButton.signals.click.add(this._onPlayButtonClick, this);\n    holder.addChild(this._playButton);\n};\n\nPreloaderScene.prototype.destroy = function () {\n    P3.Scene.prototype.destroy.call(this);\n};\n\nPreloaderScene.prototype.appear = function () {\n    this.animateIn();\n};\n\nPreloaderScene.prototype.show = function () {\n};\n\nPreloaderScene.prototype.animateIn = function (callback, scope) {\n\n};\n\nPreloaderScene.prototype.animateOut = function (callback, scope) {\n};\n\nPreloaderScene.prototype.resize = function () {\n    this.x = (P3.View.width - Common.STAGE_WIDTH) * 0.5;\n};\n\nPreloaderScene.prototype.update = function () {\n    this._bar.scale.x = this.loaded;\n    this._text.text = Math.floor(this._bar.scale.x * 100) + '%';\n\n    if (this.loaded == 1) {\n        if (P3.Device.isMobile) {\n            if (!this._playButton.visible) {\n                this._playButton.visible = true;\n                this._playButton.alpha = 0;\n\n                TweenMax.to(this._playButton, 0.25, {alpha: 1, ease: Sine.easeOut});\n                TweenMax.to(this._bar, 0.25, {alpha: 0, ease: Sine.easeIn});\n                TweenMax.to(this._barOverlay, 0.25, {alpha: 0, ease: Sine.easeIn});\n                TweenMax.to(this._text, 0.25, {alpha: 0, ease: Sine.easeIn});\n            }\n        }\n        else\n            this.signals.onAllLoaded.dispatch(this);\n    }\n};\n\n/**\n * @param {P3.Button} button\n */\nPreloaderScene.prototype._onPlayButtonClick = function (button) {\n    this._playButton.interactive = false;\n\n    // Try only android fullscreen. The fullscreen API is not supported by iOS Safari.\n    if (P3.Device.isAndroid && screenfull.enabled) {\n        screenfull.request();\n        setTimeout(function () {\n            Common.view.resize();\n        }, 1000);\n    }\n\n    TweenMax.to(this._playButton, 0.25, {\n        alpha: 0,\n        ease: Sine.easeIn,\n        onComplete: Application.init,\n        onCompleteScope: this\n    });\n};\n","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\nimport UITopBarSharedControls from \"../ui/UITopBarSharedControls\"\r\n\r\nexport default class SimpleScene extends P3.Scene {\r\n    constructor() {\r\n        super();\r\n\r\n        // Attributes.\r\n        this._uiTopBarSharedControls = null;\r\n        this._bgSprite = null;\r\n    }\r\n\r\n    init() {\r\n        super.init();\r\n        //  P3.Scene.prototype.init.call(this);\r\n\r\n        // Bg sprite.\r\n        if (this._bgSprite != null) {\r\n            this._bgSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n            this._bgSprite.position = new PIXI.Point(\r\n                Common.STAGE_WIDTH * 0.5,\r\n                Common.STAGE_HEIGHT * 0.5);\r\n            this.addChild(this._bgSprite);\r\n        }\r\n    }\r\n\r\n    createSharedControls() {\r\n        // UITopBarSharedControls.\r\n        this._uiTopBarSharedControls = new UITopBarSharedControls();\r\n        this._uiTopBarSharedControls.init();\r\n        this.addChild(this._uiTopBarSharedControls);\r\n    }\r\n\r\n    resize() {\r\n        this.x = ( P3.View.width - Common.STAGE_WIDTH ) * 0.5;\r\n        this._uiTopBarSharedControls.resize();\r\n    }\r\n\r\n    //no need to override if your just going to call super, but I added params and kill tweens so is necessary now\r\n    destroy(params = {}) {\r\n        params.children = true;\r\n        super.destroy(params);\r\n        TweenMax.killAll();\r\n    }\r\n\r\n    /**\r\n     * @abstract\r\n     * @param callback\r\n     * @param scope\r\n     */\r\n    animateIn(callback, scope) {\r\n        throw new Error('You have to implement the abstract method before use : ' + this.constructor.name + '#animateIn');\r\n    }\r\n\r\n    /**\r\n     * @abstract\r\n     * @param callback\r\n     * @param scope\r\n     */\r\n    animateOut(callback, scope) {\r\n        throw new Error('You have to implement the abstract method before use : ' + this.constructor.name + 'animateOut');\r\n    }\r\n\r\n    //strange pattern. why override parent function and do nothing..\r\n    //// hide(callback, scope) {\r\n    //  }\r\n\r\n    get bg() {\r\n        return this._bgSprite;\r\n    }\r\n\r\n}\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\n/*\r\n function SimpleScene() {\r\n P3.Scene.call(this);\r\n\r\n\r\n // Attributes.\r\n this._uiTopBarSharedControls = null;\r\n this._bgSprite = null;\r\n }\r\n export default SimpleScene;\r\n //module.exports = SimpleScene;\r\n SimpleScene.prototype = Object.create(P3.Scene.prototype);\r\n SimpleScene.prototype.constructor = SimpleScene;\r\n */\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n/*\r\n SimpleScene.prototype.init = function () {\r\n P3.Scene.prototype.init.call(this);\r\n\r\n\r\n // Bg sprite.\r\n if (this._bgSprite != null) {\r\n this._bgSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n this._bgSprite.position = new PIXI.Point(\r\n Common.STAGE_WIDTH * 0.5,\r\n Common.STAGE_HEIGHT * 0.5);\r\n this.addChild(this._bgSprite);\r\n }\r\n };\r\n */\r\n\r\n/*\r\n SimpleScene.prototype.createSharedControls = function () {\r\n // UITopBarSharedControls.\r\n this._uiTopBarSharedControls = new UITopBarSharedControls();\r\n this._uiTopBarSharedControls.init();\r\n this.addChild(this._uiTopBarSharedControls);\r\n };\r\n */\r\n\r\n/*\r\n SimpleScene.prototype.resize = function () {\r\n this.x = ( P3.View.width - Common.STAGE_WIDTH ) * 0.5;\r\n this._uiTopBarSharedControls.resize();\r\n };\r\n */\r\n/*\r\n SimpleScene.prototype.destroy = function () {\r\n P3.Scene.prototype.destroy.call(this);\r\n };\r\n */\r\n/*\r\n // Override.\r\n SimpleScene.prototype.animateIn = function (callback, scope) {\r\n };\r\n\r\n // Override.\r\n SimpleScene.prototype.animateOut = function (callback, scope) {\r\n };\r\n\r\n // Override.\r\n SimpleScene.prototype.hide = function (callback, scope) {\r\n };\r\n */\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\n// TODO:\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\n// TODO:\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    SimpleScene.prototype,\r\n    \"bg\",\r\n    {\r\n        get: function () {\r\n            return this._bgSprite;\r\n        }\r\n    });","/**\r\n * OutlineFilter, originally by mishaa\r\n * http://www.html5gamedevs.com/topic/10640-outline-a-sprite-change-certain-colors/?p=69966\r\n * http://codepen.io/mishaa/pen/emGNRB\r\n *\r\n * @class\r\n * @param thickness {number} The tickness of the outline. Make it 2 times more for resolution 2\r\n * @param color {number} The color of the glow.\r\n *\r\n * @example\r\n *  someSprite.shader = new OutlineFilter(9, 0xFF0000);\r\n */\r\nfunction OutlineFilter(thickness, color) {\r\n    thickness = thickness || 1;\r\n    PIXI.Filter.call(this,\r\n        // vertex shader\r\n        \"attribute vec2 aVertexPosition;\"\r\n\t\t+ \"attribute vec2 aTextureCoord;\"\r\n\r\n\t\t+ \"uniform mat3 projectionMatrix;\"\r\n\t\t+ \"varying vec2 vTextureCoord;\"\r\n\r\n\t\t+ \"void main(void){\"\r\n\t\t+ \"gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\"\r\n\t\t+ \"vTextureCoord = aTextureCoord;\"\r\n\t\t+ \"}\",\r\n\t\t// fragment shader\r\n\t\t( \"varying vec2 vTextureCoord;\"\r\n\t\t+ \"uniform sampler2D uSampler;\"\r\n\r\n\t\t+ \"uniform float thickness;\"\r\n\t\t+ \"uniform vec4 outlineColor;\"\r\n\t\t+ \"uniform vec4 filterArea;\"\r\n\t\t+ \"uniform vec4 filterClamp;\"\r\n\t\t+ \"vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);\"\r\n\r\n\t\t+ \"void main(void) {\"\r\n\t\t+ \"const float PI = 3.14159265358979323846264;\"\r\n\t\t+ \"vec4 ownColor = texture2D(uSampler, vTextureCoord);\"\r\n\t\t+ \"vec4 curColor;\"\r\n\t\t+ \"float maxAlpha = 0.;\"\r\n\t\t+ \"vec2 displaced;\"\r\n\t\t+ \"for (float angle = 0.; angle < PI * 2.; angle += %THICKNESS% ) {\"\r\n        + \"displaced.x = vTextureCoord.x + thickness * px.x * cos(angle);\"\r\n        + \"displaced.y = vTextureCoord.y + thickness * px.y * sin(angle);\"\r\n        + \"curColor = texture2D(uSampler, clamp(displaced, filterClamp.xy, filterClamp.zw));\"\r\n        + \"maxAlpha = max(maxAlpha, curColor.a);\"\r\n\t\t+ \"}\"\r\n\t\t+ \"float resultAlpha = max(maxAlpha, ownColor.a);\"\r\n\t\t+ \"gl_FragColor = vec4((ownColor.rgb + outlineColor.rgb * (1. - ownColor.a)) * resultAlpha, resultAlpha); \"\r\n\t\t+ \"}\" ).replace(/%THICKNESS%/gi, (1.0 / thickness).toFixed(7))\r\n    );\r\n\r\n    this.uniforms.thickness = thickness;\r\n    this.uniforms.outlineColor = new Float32Array([0, 0, 0, 1]);\r\n    if (color) {\r\n        this.color = color;\r\n    }\r\n}\r\n\r\nOutlineFilter.prototype = Object.create(PIXI.Filter.prototype);\r\nOutlineFilter.prototype.constructor = OutlineFilter;\r\nmodule.exports = OutlineFilter;\r\n\r\nObject.defineProperties(OutlineFilter.prototype, {\r\n    color: {\r\n        get: function () {\r\n            return PIXI.utils.rgb2hex(this.uniforms.outlineColor);\r\n        },\r\n        set: function (value) {\r\n            PIXI.utils.hex2rgb(value, this.uniforms.outlineColor);\r\n        }\r\n    }\r\n});","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\n\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction UICarousel() {\r\n    PIXI.Container.call(this);\r\n\r\n\r\n    // Constants.\r\n    this.PAGE_WIDTH = 800;\r\n    this.DEFAULT_ITEM_SCALE = 0; // To be later initialized.\r\n    this.UNSELECTED_ITEM_SCALE_DELTA = 0.1; // If an item is not currently selected, scale it down by this amount.\r\n    this.SELECTED_ITEM_EXIT_EASE_FACTOR = 0.2; // Decrease the distance of the swipe gesture for the selected item.\r\n\r\n\r\n    // Attributes.\r\n    this._pageContainer = null;\r\n    this._interactiveArea = null;\r\n    this._mask = null;\r\n    this._startX = 0;\r\n    this._lastX = 0;\r\n    this._currentX = 0;\r\n    this._itemIndex = 0;\r\n\r\n\r\n    // Signals.\r\n    this.signals = {};\r\n    this.signals.onIndexChanged = new signals.Signal();\r\n    this.signals.onItemSelected = new signals.Signal();\r\n}\r\nexport default UICarousel;\r\n//module.exports                  \t= UICarousel;\r\nUICarousel.prototype = Object.create(PIXI.Container.prototype);\r\nUICarousel.prototype.constructor = UICarousel;\r\n\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n\r\nUICarousel.prototype.init = function (items) {\r\n    this.position = new PIXI.Point(Common.STAGE_WIDTH * 0.5, Common.STAGE_HEIGHT * 0.5);\r\n\r\n    // Mask.\r\n    this._mask = new PIXI.Graphics();\r\n    this._mask.beginFill(0xFFFFFF, 0);\r\n    this._mask.drawRect(-Common.STAGE_WIDTH * 0.5, -Common.STAGE_HEIGHT * 0.5, Common.STAGE_WIDTH, Common.STAGE_HEIGHT);\r\n    this._mask.endFill();\r\n    this.addChild(this._mask);\r\n\r\n    // Interactive area.\r\n    this._interactiveArea = new PIXI.Sprite(Common.blankTexture);\r\n    this._interactiveArea.tint = 0xFFFFFF;\r\n    this._interactiveArea.alpha = 0;\r\n    this._interactiveArea.height = 400;\r\n    this._interactiveArea.width = Common.STAGE_WIDTH;\r\n    this._interactiveArea.anchor = new PIXI.Point(0.5, 0.5);\r\n    this._interactiveArea.buttonMode = true;\r\n    this._interactiveArea.interactive = true;\r\n    this._interactiveArea.mousedown = this._interactiveArea.touchstart = this._onMouseDown.bind(this);\r\n    this._interactiveArea.mouseup = this._interactiveArea.touchend = this._onMouseUp.bind(this);\r\n    this._interactiveArea.mouseupoutside = this._interactiveArea.touchendoutside = this._onMouseUp.bind(this);\r\n\r\n    this.addChild(this._interactiveArea);\r\n\r\n    // Item container.\r\n    this._pageContainer = new PIXI.Container();\r\n    this._pageContainer.anchor = new PIXI.Point(0.5, 0.5);\r\n    this._pageContainer.mask = this._mask;\r\n    this._pageContainer.x = -this.PAGE_WIDTH * 0.5;\r\n    this.addChild(this._pageContainer);\r\n\r\n    // Items.\r\n    var i = 0;\r\n    for (var item of items) {\r\n        if (this.DEFAULT_ITEM_SCALE == 0)\r\n            this.DEFAULT_ITEM_SCALE = item.scale.x;\r\n\r\n        // Page.\r\n        var page = new PIXI.Container();\r\n        page.anchor = new PIXI.Point(0, 0.5);\r\n        this._pageContainer.addChild(page);\r\n        // So we can keep some distance between items.\r\n        var pageBg = new PIXI.Sprite(Common.blankTexture);\r\n        pageBg.alpha = 0;\r\n        pageBg.anchor = new PIXI.Point(0, 0.5);\r\n        pageBg.width = this.PAGE_WIDTH;\r\n        pageBg.height = item.height;\r\n        page.addChild(pageBg);\r\n        // Item.\r\n        item.x = item.width * 0.5 + ( pageBg.width - item.width ) * 0.5;\r\n        page.addChild(item);\r\n        // Initial scale.\r\n        if (i > 0)\r\n            item.scale = new PIXI.Point(\r\n                this.DEFAULT_ITEM_SCALE - this.UNSELECTED_ITEM_SCALE_DELTA,\r\n                this.DEFAULT_ITEM_SCALE - this.UNSELECTED_ITEM_SCALE_DELTA);\r\n\r\n        page.x = i * page.width;\r\n\r\n        ++i;\r\n    }\r\n};\r\n\r\nUICarousel.prototype.update = function () {\r\n    this._updateItemHiglighting();\r\n};\r\n\r\nUICarousel.prototype.animateIn = function () {\r\n    this._pageContainer.children[0].y -= 100;\r\n    this._pageContainer.children[0].alpha = 0;\r\n    TweenMax.to(this._pageContainer.children[0], 0.25, {\r\n        alpha: 1,\r\n        y: this._pageContainer.children[0].y + 100,\r\n        ease: Sine.easeOut\r\n    });\r\n};\r\n\r\nUICarousel.prototype.next = function () {\r\n    if (this._itemIndex < this._pageContainer.children.length - 1) {\r\n        this._itemIndex += 1;\r\n\r\n        TweenMax.to(this._pageContainer, 0.25, {\r\n            x: -this._itemIndex * this.PAGE_WIDTH - this.PAGE_WIDTH * 0.5,\r\n            ease: Sine.easeInOut,\r\n            onComplete: function () {\r\n                this.signals.onIndexChanged.dispatch();\r\n            },\r\n            onCompleteScope: this\r\n        });\r\n\r\n        // Sfx.\r\n        Common.audio.playSound(\"sfx_ui_carousel_swipe_00\");\r\n    }\r\n};\r\n\r\nUICarousel.prototype.prev = function () {\r\n    if (this._itemIndex > 0) {\r\n        this._itemIndex -= 1;\r\n\r\n        TweenMax.to(this._pageContainer, 0.25, {\r\n            x: -this._itemIndex * this.PAGE_WIDTH - this.PAGE_WIDTH * 0.5,\r\n            ease: Sine.easeInOut,\r\n            onComplete: function () {\r\n                this.signals.onIndexChanged.dispatch();\r\n            },\r\n            onCompleteScope: this\r\n        });\r\n\r\n        // Sfx.\r\n        Common.audio.playSound(\"sfx_ui_carousel_swipe_00\");\r\n    }\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n\r\nUICarousel.prototype._updateItemHiglighting = function () {\r\n    // Highlight selection.\r\n    var pageFactor = Math.abs(this._pageContainer.x) / this.PAGE_WIDTH;\r\n    var itemIndexAux = Math.floor(pageFactor);\r\n    // Ease changing the selection of the current item.\r\n    if (this._itemIndex == itemIndexAux) {\r\n        if (Math.abs(this._itemIndex - pageFactor) <= 0.5 - this.SELECTED_ITEM_EXIT_EASE_FACTOR\r\n            && this._itemIndex > 0)\r\n            itemIndexAux -= 1;\r\n        else if (Math.abs(this._itemIndex - pageFactor) >= 0.5 + this.SELECTED_ITEM_EXIT_EASE_FACTOR\r\n            && this._itemIndex < this._pageContainer.children.length - 1)\r\n            itemIndexAux += 1;\r\n    }\r\n\r\n    var itemIndex = 0;\r\n    for (var page of this._pageContainer.children) {\r\n        var item = page.children[1];\r\n        if (!TweenMax.isTweening(item.scale)) {\r\n            if (itemIndex == itemIndexAux && item.scale.x != this.DEFAULT_ITEM_SCALE)\r\n                TweenMax.to(item.scale, 0.12, {\r\n                    x: this.DEFAULT_ITEM_SCALE,\r\n                    y: this.DEFAULT_ITEM_SCALE,\r\n                    ease: Sine.easeInOut\r\n                });\r\n            else if (itemIndex != itemIndexAux && item.scale.x != this.DEFAULT_ITEM_SCALE - this.UNSELECTED_ITEM_SCALE_DELTA)\r\n                TweenMax.to(item.scale, 0.12, {\r\n                    x: this.DEFAULT_ITEM_SCALE - this.UNSELECTED_ITEM_SCALE_DELTA,\r\n                    y: this.DEFAULT_ITEM_SCALE - this.UNSELECTED_ITEM_SCALE_DELTA,\r\n                    ease: Sine.easeInOut\r\n                });\r\n        }\r\n\r\n        ++itemIndex;\r\n    }\r\n};\r\n\r\nUICarousel.prototype._snap = function () {\r\n    var pageFactor = Math.abs(this._pageContainer.x) / this.PAGE_WIDTH;\r\n    var newItemIndex = Math.floor(pageFactor);\r\n    // Ease changing the selection of the current item.\r\n    if (newItemIndex == this._itemIndex) {\r\n        if (Math.abs(newItemIndex - pageFactor) <= 0.5 - this.SELECTED_ITEM_EXIT_EASE_FACTOR\r\n            && newItemIndex > 0)\r\n            newItemIndex -= 1;\r\n        else if (Math.abs(newItemIndex - pageFactor) >= 0.5 + this.SELECTED_ITEM_EXIT_EASE_FACTOR\r\n            && newItemIndex < this._pageContainer.children.length - 1)\r\n            newItemIndex += 1;\r\n    }\r\n\r\n    TweenMax.to(this._pageContainer, 0.25, {\r\n        x: -newItemIndex * this.PAGE_WIDTH - this.PAGE_WIDTH * 0.5,\r\n        ease: Sine.easeInOut,\r\n        onComplete: function (newItemIndex) {\r\n            this._itemIndex = newItemIndex;\r\n            this.signals.onIndexChanged.dispatch();\r\n        },\r\n        onCompleteScope: this,\r\n        onCompleteParams: [newItemIndex]\r\n    });\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n\r\nUICarousel.prototype._onMouseDown = function (mouseData) {\r\n    TweenMax.killTweensOf(this._pageContainer);\r\n\r\n    var localPos = mouseData.data.getLocalPosition(this._interactiveArea);\r\n    this._startX = localPos.x;\r\n    this._lastX = this._startX;\r\n    this._currentX = this._startX;\r\n\r\n    this._interactiveArea.mousemove = this._interactiveArea.touchmove = this._onMouseMove.bind(this);\r\n};\r\n\r\nUICarousel.prototype._onMouseMove = function (mouseData) {\r\n    var localPos = mouseData.data.getLocalPosition(this._interactiveArea);\r\n\r\n    this._currentX = localPos.x;\r\n\r\n    this._pageContainer.x += ( this._currentX - this._lastX ) * Common.STAGE_WIDTH;\r\n    if (this._pageContainer.x > -this.PAGE_WIDTH * 0.5)\r\n        this._pageContainer.x = -this.PAGE_WIDTH * 0.5;\r\n    else if (this._pageContainer.x < -( this._pageContainer.children.length - 0.5 ) * this.PAGE_WIDTH)\r\n        this._pageContainer.x = -( this._pageContainer.children.length - 0.5 ) * this.PAGE_WIDTH;\r\n\r\n    this._lastX = this._currentX;\r\n};\r\n\r\nUICarousel.prototype._onMouseUp = function (mouseData) {\r\n    var result = false;\r\n    if (Math.abs(this._startX - this._currentX) <= 0.01) {\r\n        var selectedItem = this._pageContainer.children[this._itemIndex].children[1];\r\n        var localPos = mouseData.data.getLocalPosition(selectedItem);\r\n        if (Math.abs(localPos.x) <= selectedItem.width * 0.8\r\n            && Math.abs(localPos.y) <= selectedItem.height * 0.8) {\r\n            this.signals.onItemSelected.dispatch();\r\n\r\n            result = true;\r\n        }\r\n    }\r\n\r\n    if (!result) {\r\n        this._interactiveArea.mousemove = this._interactiveArea.touchmove = null;\r\n\r\n        this._snap();\r\n\r\n\r\n        // Sfx.\r\n        Common.audio.playSound(\"sfx_ui_carousel_swipe_00\");\r\n    }\r\n};\r\n\r\n\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\nObject.defineProperty(\r\n    UICarousel.prototype,\r\n    \"selectedIndex\",\r\n    {\r\n        get: function () {\r\n            return this._itemIndex;\r\n        }\r\n    });","\"use strict\";\r\n\r\nimport Common from \"../Common\";\r\nimport CommonGame from \"../CommonGame\";\r\n\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n\r\n/**\r\n * @constructor\r\n */\r\nexport default class UITopBarSharedControls extends PIXI.Container {\r\n    constructor() {\r\n        super();\r\n\r\n        // Attributes.\r\n        this._homeBtn = null;\r\n        this._muteBtn = null;\r\n        this._backBtn = null;\r\n\r\n        // Signals.\r\n        this.signals = {};\r\n        this.signals.onBackBtn_Click = new signals.Signal();\r\n    }\r\n\r\n    init() {\r\n\r\n        this._homeBtn = createButton(\"home\");\r\n        this._homeBtn.anchor = new PIXI.Point(0, 0.5);\r\n        this._homeBtn.position.y = this._homeBtn.height * 0.5 + 30;\r\n        this._homeBtn.visible = false;\r\n        this._homeBtn._icon.scale.x = -1;\r\n        this._homeBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._homeBtn.downSoundName = \"sfx_ui_click_00\";\r\n        this._homeBtn.signals.click.add(this._onHomeButton_Click, this);\r\n        this.addChild(this._homeBtn);\r\n\r\n        // Mute button.\r\n        this._muteBtn = createButton(\"sound\");\r\n        this._muteBtn.anchor = new PIXI.Point(1, 0.5);\r\n        this._muteBtn.position.y = this._homeBtn.position.y;\r\n        this._muteBtn.visible = false;\r\n        this._muteBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._muteBtn.downSoundName = \"sfx_ui_click_00\";\r\n        this._muteBtn.signals.click.add(this._onMuteButton_Click, this);\r\n        this.addChild(this._muteBtn);\r\n\r\n        // Back button.\r\n        this._backBtn = createButton(\"back\");\r\n        this._backBtn.anchor = new PIXI.Point(0, 0.5);\r\n        this._backBtn.position.y = this._homeBtn.position.y;\r\n        this._backBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._backBtn.downSoundName = \"sfx_ui_click_00\";\r\n        this._backBtn.signals.click.add(this._onBackButton_Click, this);\r\n        this._backBtn.visible = false;\r\n        this.addChild(this._backBtn);\r\n    }\r\n\r\n    resize() {\r\n        this._homeBtn.position.x = Common.getScreenPositionLeft() + 70;\r\n        this._muteBtn.position.x = Common.getScreenPositionRight() - 70;\r\n        this._backBtn.position.x = Common.getScreenPositionLeft() + 70;\r\n    }\r\n\r\n    _onHomeButton_Click() {\r\n        //todo swap for signals\r\n        Common.main.application.loadScene(CommonGame.SCENE_ID_MAIN);\r\n    }\r\n\r\n    _onMuteButton_Click() {\r\n        Common.isMute = !Common.isMute;\r\n\r\n        // TODO:\r\n        this._muteBtn._icon.texture = Common.assets.getTexture(Common.isMute ? \"icon_mute_off\" : \"icon_sound_off\");\r\n        this._muteBtn._currentIconTexture = this._muteBtn._icon.texture;\r\n\r\n        Common.audio.mute(Common.isMute);\r\n\r\n        // Sfx.\r\n        //Common.audio.playSound( \"sfx_small_blip\" );\r\n    }\r\n\r\n    _onBackButton_Click() {\r\n        this.signals.onBackBtn_Click.dispatch();\r\n    }\r\n\r\n    get homeBtn() {\r\n        return this._homeBtn;\r\n    }\r\n\r\n    get muteBtn() {\r\n        return this._muteBtn;\r\n    }\r\n\r\n    get backBtn() {\r\n        return this._backBtn;\r\n    }\r\n}\r\n","\"use strict\";\r\n\r\nimport Common from \"../../Common\";\r\nimport CommonGame from \"../../CommonGame\";\r\n\r\nexport default class ConfirmationPanel extends PIXI.Container {\r\n    constructor() {\r\n        super();\r\n\r\n        // Attributes.\r\n        this._bgSprite = null;\r\n        this._messageSprite = null;\r\n        this._messageText = null;\r\n        this._yesBtn = null;\r\n        this._noBtn = null;\r\n        this._selectedBtn = null;\r\n\r\n        // Signals.\r\n        this.signals = {};\r\n        this.signals.onYes = new signals.Signal();\r\n        this.signals.onNo = new signals.Signal();\r\n    }\r\n\r\n    init() {\r\n        // Background sprite.\r\n        this._bgSprite = new PIXI.Sprite(Common.blankTexture);\r\n        this._bgSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._bgSprite.tint = 0x000000;\r\n        this._bgSprite.alpha = 0.3;\r\n        this._bgSprite.interactive = true;\r\n        this._bgSprite.width = Common.STAGE_WIDTH;\r\n        this._bgSprite.height = Common.STAGE_HEIGHT;\r\n        this.addChild(this._bgSprite);\r\n\r\n        // Message sprite.\r\n        this._messageSprite = new PIXI.Sprite(Common.assets.getTexture(\"colour_palette_big_bg\"));\r\n        this._messageSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this.addChild(this._messageSprite);\r\n\r\n        // Message text.\r\n        this._messageText = P3.createText(\"COLOUR_IT\", {\r\n            size: \"64px\",\r\n            fill: [0xfff8b3, 0xfac109],\r\n            stroke: 0x006130,\r\n            stokeThickness: 5,\r\n            wordWrap: true,\r\n            wordWrapWidth: this._messageSprite.width - 200\r\n        }, \"truetype\");\r\n\r\n        this._messageText.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._messageText.y = -80;\r\n        this._messageSprite.addChild(this._messageText);\r\n\r\n        // Yes button.\r\n        this._yesBtn = createButton(\"tick\", \"primary_large\");\r\n        this._yesBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._yesBtn.position = new PIXI.Point(100, this._messageSprite.height * 0.5 - 110);\r\n        this._yesBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._yesBtn.downSoundName = \"sfx_ui_click_00\";\r\n        this._messageSprite.addChild(this._yesBtn);\r\n\r\n        // No button.\r\n        this._noBtn = createButton(\"cross\", \"primary_large\");\r\n        this._noBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._noBtn.position = new PIXI.Point(-100, this._messageSprite.height * 0.5 - 110);\r\n        this._noBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._noBtn.downSoundName = \"sfx_ui_click_00\";\r\n        this._messageSprite.addChild(this._noBtn);\r\n\r\n        this.visible = false;\r\n    }\r\n\r\n    show(message) {\r\n        this.visible = true;\r\n        this._messageText.text = message;\r\n\r\n        this._messageSprite.alpha = 0;\r\n        this._messageSprite.y = -100;\r\n        TweenMax.to(this._messageSprite, 0.25, {y: this._messageSprite.y + 100, alpha: 1, ease: Sine.easeOut});\r\n\r\n        this._bgSprite.alpha = 0;\r\n        TweenMax.to(this._bgSprite, 0.25, {alpha: 0.3, ease: Sine.easeOut});\r\n\r\n        this._noBtn.alpha = 0;\r\n        this._noBtn.scale = new PIXI.Point();\r\n        TweenMax.to(this._noBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.15});\r\n        TweenMax.to(this._noBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.15});\r\n\r\n        this._yesBtn.alpha = 0;\r\n        this._yesBtn.scale = new PIXI.Point();\r\n        TweenMax.to(this._yesBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.3});\r\n        TweenMax.to(this._yesBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.3});\r\n\r\n        // Signals.\r\n        this._yesBtn.signals.click.addOnce(function () {\r\n            this._selectedBtn = this._yesBtn;\r\n            this._hide();\r\n        }, this);\r\n        this._noBtn.signals.click.addOnce(function () {\r\n            this._selectedBtn = this._noBtn;\r\n            this._hide();\r\n        }, this);\r\n    }\r\n\r\n    _hide() {\r\n        TweenMax.to(this._messageSprite, 0.25, {y: this._messageSprite.y + 100, alpha: 0, ease: Sine.easeIn});\r\n        TweenMax.to(this._bgSprite, 0.25, {\r\n            alpha: 0,\r\n            ease: Sine.easeIn,\r\n            onComplete: this._onHidden,\r\n            onCompleteScope: this\r\n        });\r\n\r\n        // Signals.\r\n        this._yesBtn.signals.click.removeAll();\r\n        this._noBtn.signals.click.removeAll();\r\n    }\r\n\r\n    //----EVENTS----//\r\n\r\n    _onHidden() {\r\n        if (this._selectedBtn === this._yesBtn) {\r\n            // Sfx.\r\n            //Common.audio.playSound(\"vo_happo_ok_00\");\r\n\r\n            this.signals.onYes.dispatch();\r\n        }\r\n        else if (this._selectedBtn === this._noBtn) {\r\n            this.signals.onNo.dispatch();\r\n        }\r\n\r\n        this._selectedBtn = null;\r\n\r\n        this.visible = false;\r\n\r\n        // Signals.\r\n        this.signals.onYes.removeAll();\r\n        this.signals.onNo.removeAll();\r\n    }\r\n}\r\n\r\n//===================================================\r\n//\r\n// Constructor\r\n//\r\n//===================================================\r\n/*\r\n function ConfirmationPanel() {\r\n PIXI.Container.call(this);\r\n\r\n\r\n // Attributes.\r\n this._bgSprite = null;\r\n this._messageSprite = null;\r\n this._messageText = null;\r\n this._yesBtn = null;\r\n this._noBtn = null;\r\n this._selectedBtn = null;\r\n\r\n\r\n // Signals.\r\n this.signals = {};\r\n this.signals.onYes = new signals.Signal();\r\n this.signals.onNo = new signals.Signal();\r\n }\r\n\r\n export default ConfirmationPanel;\r\n //module.exports = ConfirmationPanel;\r\n ConfirmationPanel.prototype = Object.create(PIXI.Container.prototype);\r\n ConfirmationPanel.prototype.constructor = ConfirmationPanel;\r\n */\r\n\r\n//===================================================\r\n//\r\n// Public\r\n//\r\n//===================================================\r\n/*\r\n ConfirmationPanel.prototype.init = function () {\r\n // Background sprite.\r\n this._bgSprite = new PIXI.Sprite(Common.blankTexture);\r\n this._bgSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n this._bgSprite.tint = 0x000000;\r\n this._bgSprite.alpha = 0.3;\r\n this._bgSprite.interactive = true;\r\n this._bgSprite.width = Common.STAGE_WIDTH;\r\n this._bgSprite.height = Common.STAGE_HEIGHT;\r\n this.addChild(this._bgSprite);\r\n\r\n // Message sprite.\r\n this._messageSprite = new PIXI.Sprite(Common.assets.getTexture(\"colour_palette_big_bg\"));\r\n this._messageSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n this.addChild(this._messageSprite);\r\n\r\n // Message text.\r\n this._messageText = P3.createText(\"COLOUR_IT\", {\r\n size: \"64px\",\r\n fill: [0xfff8b3, 0xfac109],\r\n stroke: 0x4c2607,\r\n stokeThickness: 5,\r\n wordWrap: true,\r\n wordWrapWidth: this._messageSprite.width - 200\r\n }, \"truetype\");\r\n\r\n this._messageText.anchor = new PIXI.Point(0.5, 0.5);\r\n this._messageText.y = -80;\r\n this._messageSprite.addChild(this._messageText);\r\n\r\n // Yes button.\r\n var btnStatesAux = new P3.ButtonStates(\r\n Common.assets.getTexture(\"btn_primary_large_off\"),\r\n Common.assets.getTexture(\"btn_primary_large_over\"),\r\n Common.assets.getTexture(\"btn_primary_large_down\"),\r\n Common.assets.getTexture(\"icon_tick\")\r\n );\r\n btnStatesAux.iconOver = Common.assets.getTexture(\"icon_tick\");\r\n btnStatesAux.iconDown = Common.assets.getTexture(\"icon_tick\");\r\n this._yesBtn = new P3.Button(btnStatesAux);\r\n this._yesBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n this._yesBtn.position = new PIXI.Point(100, this._messageSprite.height * 0.5 - 110);\r\n this._yesBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n this._yesBtn.downSoundName = \"sfx_ui_click_00\";\r\n this._messageSprite.addChild(this._yesBtn);\r\n\r\n // No button.\r\n btnStatesAux = new P3.ButtonStates(\r\n Common.assets.getTexture(\"btn_primary_large_off\"),\r\n Common.assets.getTexture(\"btn_primary_large_over\"),\r\n Common.assets.getTexture(\"btn_primary_large_down\"),\r\n Common.assets.getTexture(\"icon_cross\")\r\n );\r\n btnStatesAux.iconOver = Common.assets.getTexture(\"icon_cross\");\r\n btnStatesAux.iconDown = Common.assets.getTexture(\"icon_cross\");\r\n this._noBtn = new P3.Button(btnStatesAux);\r\n this._noBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n this._noBtn.position = new PIXI.Point(-100, this._messageSprite.height * 0.5 - 110);\r\n this._noBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n this._noBtn.downSoundName = \"sfx_ui_click_00\";\r\n this._messageSprite.addChild(this._noBtn);\r\n\r\n this.visible = false;\r\n };\r\n */\r\n\r\n/*\r\n ConfirmationPanel.prototype.show = function (message) {\r\n this.visible = true;\r\n this._messageText.text = message;\r\n\r\n this._messageSprite.alpha = 0;\r\n this._messageSprite.y = -100;\r\n TweenMax.to(this._messageSprite, 0.25, {y: this._messageSprite.y + 100, alpha: 1, ease: Sine.easeOut});\r\n\r\n this._bgSprite.alpha = 0;\r\n TweenMax.to(this._bgSprite, 0.25, {alpha: 0.3, ease: Sine.easeOut});\r\n\r\n this._noBtn.alpha = 0;\r\n this._noBtn.scale = new PIXI.Point();\r\n TweenMax.to(this._noBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.15});\r\n TweenMax.to(this._noBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.15});\r\n\r\n this._yesBtn.alpha = 0;\r\n this._yesBtn.scale = new PIXI.Point();\r\n TweenMax.to(this._yesBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.3});\r\n TweenMax.to(this._yesBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.3});\r\n\r\n\r\n // Signals.\r\n this._yesBtn.signals.click.addOnce(function () {\r\n this._selectedBtn = this._yesBtn;\r\n this._hide();\r\n }, this);\r\n this._noBtn.signals.click.addOnce(function () {\r\n this._selectedBtn = this._noBtn;\r\n this._hide();\r\n }, this);\r\n };\r\n */\r\n\r\n//===================================================\r\n//\r\n// Private\r\n//\r\n//===================================================\r\n/*\r\n ConfirmationPanel.prototype._hide = function () {\r\n TweenMax.to(this._messageSprite, 0.25, {y: this._messageSprite.y + 100, alpha: 0, ease: Sine.easeIn});\r\n TweenMax.to(this._bgSprite, 0.25, {alpha: 0, ease: Sine.easeIn, onComplete: this._onHidden, onCompleteScope: this});\r\n\r\n\r\n // Signals.\r\n this._yesBtn.signals.click.removeAll();\r\n this._noBtn.signals.click.removeAll();\r\n };\r\n */\r\n\r\n//===================================================\r\n//\r\n// Events\r\n//\r\n//===================================================\r\n/*\r\n ConfirmationPanel.prototype._onHidden = function () {\r\n if (this._selectedBtn == this._yesBtn) {\r\n this.signals.onYes.dispatch();\r\n\r\n // Sfx.\r\n Common.audio.playSound(\"vo_happo_ok_00\");\r\n }\r\n else if (this._selectedBtn == this._noBtn)\r\n this.signals.onNo.dispatch();\r\n\r\n this._selectedBtn = null;\r\n\r\n this.visible = false;\r\n\r\n // Signals.\r\n this.signals.onYes.removeAll();\r\n this.signals.onNo.removeAll();\r\n };\r\n */\r\n//===================================================\r\n//\r\n// Getters / Setters\r\n//\r\n//===================================================\r\n\r\n// TODO:","\"use strict\";\r\n\r\nimport Common from \"../../Common\";\r\nimport CommonGame from \"../../CommonGame\";\r\nimport ConfirmationPanel from \"./ConfirmationPanel\";\r\nimport TrashConfirmationPanel from \"./TrashConfirmationPanel\";\r\n\r\nexport default class MenuPanel extends PIXI.Container {\r\n    constructor(signals) {\r\n        super();\r\n\r\n        this._gameSceneSignals = signals;\r\n\r\n        // Attributes.\r\n        this._quitBtn = null;\r\n        this._backBtn = null;\r\n        this._printBtn = null;\r\n        this._downloadBtn = null;\r\n        this._muteBtn = null;\r\n        this._binBtn = null;\r\n        this._boxBorderSprite = null;\r\n        this._popupContainer = null;\r\n        this._drawingActionContainer = null;\r\n        this._titleSprite = null;\r\n        this._bgGradientSprite = null;\r\n        this._titleText = null;\r\n        this._confirmationPanel = null;\r\n        this._trashConfirmationPanel = null;\r\n    }\r\n\r\n    init() {\r\n        // Bg gradient sprite.\r\n        this._bgGradientSprite = new PIXI.Sprite(Common.blankTexture);\r\n        this._bgGradientSprite.tint = 0x000000;\r\n        this._bgGradientSprite.alpha = 0.6;\r\n        this._bgGradientSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._bgGradientSprite.scale.x = Common.STAGE_WIDTH * 1.25;\r\n        this._bgGradientSprite.scale.y = Common.STAGE_HEIGHT;\r\n        this._bgGradientSprite.interactive = true;\r\n        this._bgGradientSprite.click = this._bgGradientSprite.touchend = this._onBackButton_Click.bind(this);\r\n        this.addChild(this._bgGradientSprite);\r\n\r\n        // Popup.\r\n        this._popupContainer = new PIXI.Container();\r\n        this._popupContainer.anchor = new PIXI.Point(0.5, 0.5);\r\n        this.addChild(this._popupContainer);\r\n\r\n        // Bg.\r\n        /*\r\n         //removed due to feedback\r\n         //@deprecated\r\n         var SCALE_FACTOR = 0.985;\r\n         var popupTex = Common.assets.getTexture(\"popup_box\");\r\n\r\n         var popupBg = new PIXI.Graphics();\r\n         popupBg.beginFill(CommonGame.GALLERY_BORDER_TINT[CommonGame.selectedGallery], 1);\r\n         popupBg.drawRoundedRect(\r\n         -popupTex.width * 0.5 * SCALE_FACTOR,\r\n         -popupTex.height * 0.5 * SCALE_FACTOR,\r\n         popupTex.width * SCALE_FACTOR,\r\n         popupTex.height * SCALE_FACTOR,\r\n         35\r\n         );\r\n         popupBg.endFill();\r\n         popupBg.interactive = true;\r\n         this._popupContainer.addChild(popupBg);\r\n         */\r\n\r\n        // Border.\r\n        this._boxBorderSprite = new PIXI.Sprite(Common.assets.getTexture(\"menu_panel\"));\r\n        this._boxBorderSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._popupContainer.addChild(this._boxBorderSprite);\r\n        this._popupContainer.scale.set(0.9, 0.9);\r\n\r\n        // Title sprite.\r\n        this._titleSprite = new PIXI.Sprite(PIXI.Texture.EMPTY);\r\n        this._titleSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n\r\n        this._popupContainer.addChild(this._titleSprite);\r\n\r\n        // Title text.\r\n        let bkText = P3.createText(\"MENU\", {\r\n            fill: [0xfff8b3, 0xfac109],\r\n            size: \"90px\",\r\n            wordWrap: true,\r\n            wordWrapWidth: 500,\r\n            stroke: 0x23a838,\r\n            strokeThickness: 14,\r\n            align: \"centre\"\r\n        });\r\n\r\n        this._titleText = P3.createText(\"MENU\", {\r\n            fill: [0xfff8b3, 0xfac109],\r\n            size: \"90px\",\r\n            wordWrap: true,\r\n            wordWrapWidth: 500,\r\n            stroke: 0x006130,\r\n            align: \"centre\",\r\n            strokeThickness: 8\r\n        });\r\n\r\n        this._titleText.y = bkText.y = -this._boxBorderSprite.height * 0.5 + 145;\r\n        this._titleText.anchor = bkText.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._titleSprite.addChild(bkText, this._titleText);\r\n\r\n        // Quit button.\r\n        this._quitBtn = createButton(\"home\");\r\n        this._quitBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._quitBtn.position = new PIXI.Point(-234, 248);\r\n        this._quitBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._quitBtn.downSoundName = \"sfx_ui_click_00\";\r\n        this._quitBtn.signals.click.add(this._onQuitButton_Click, this);\r\n        this._popupContainer.addChild(this._quitBtn);\r\n\r\n        // Sound button.\r\n        this._muteBtn = createButton(\"sound\");\r\n        this._muteBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._muteBtn.position = new PIXI.Point(238, 248);\r\n        this._muteBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._muteBtn.downSoundName = \"sfx_ui_click_00\";\r\n        this._muteBtn.signals.click.add(this._onSoundButton_Click, this);\r\n        this._popupContainer.addChild(this._muteBtn);\r\n\r\n        // Container for Print, Download and Bin buttons.\r\n        this._drawingActionContainer = new PIXI.Sprite(PIXI.Texture.EMPTY);\r\n        this._drawingActionContainer.anchor.set(0.5, 0.5);\r\n        this._drawingActionContainer.y = -15;\r\n        this._popupContainer.addChild(this._drawingActionContainer);\r\n\r\n        const btnOffset = 240;\r\n        let btnStatesAux;\r\n\r\n        // Print button.\r\n        if (Common.assets.getJSON(\"config\").menuPanel.printBtn.isVisible) {\r\n            btnStatesAux = new P3.ButtonStates(\r\n                PIXI.Texture.EMPTY,\r\n                PIXI.Texture.EMPTY,\r\n                PIXI.Texture.EMPTY,\r\n                Common.assets.getTexture(\"icon_print\")\r\n            );\r\n            this._printBtn = new P3.Button(btnStatesAux);\r\n            this._printBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n            this._printBtn.x = -btnOffset;\r\n\r\n            this._printBtn.signals.click.add(this._onPrintButton_Click, this);\r\n            this._drawingActionContainer.addChild(this._printBtn);\r\n        }\r\n\r\n        // Download button.\r\n        if (Common.assets.getJSON(\"config\").menuPanel.downloadBtn.isVisible) {\r\n            btnStatesAux = new P3.ButtonStates(\r\n                PIXI.Texture.EMPTY,\r\n                PIXI.Texture.EMPTY,\r\n                PIXI.Texture.EMPTY,\r\n                Common.assets.getTexture(\"icon_save\"));\r\n            this._downloadBtn = new P3.Button(btnStatesAux);\r\n            this._downloadBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n            this._downloadBtn.x = 0;//this._drawingActionContainer.children.length * btnOffset;\r\n\r\n            this._downloadBtn.signals.click.add(this._onDownloadButton_Click, this);\r\n            this._drawingActionContainer.addChild(this._downloadBtn);\r\n        }\r\n\r\n        // Bin button.\r\n        if (Common.assets.getJSON(\"config\").menuPanel.binBtn.isVisible) {\r\n            btnStatesAux = new P3.ButtonStates(\r\n                PIXI.Texture.EMPTY,\r\n                PIXI.Texture.EMPTY,\r\n                PIXI.Texture.EMPTY,\r\n                Common.assets.getTexture(\"icon_replay\"));\r\n            this._binBtn = new P3.Button(btnStatesAux);\r\n            this._binBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n            this._binBtn.x = btnOffset;\r\n\r\n            this._binBtn.signals.click.add(this._onBinButton_Click, this);\r\n            this._drawingActionContainer.addChild(this._binBtn);\r\n        }\r\n\r\n        // Back button.\r\n        this._backBtn = createButton(\"play_large\", \"primary_large\");\r\n        this._backBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._backBtn.position = new PIXI.Point(0, this._boxBorderSprite.height * 0.5 - 115);\r\n        this._backBtn.overSoundName = \"sfx_ui_rollover_00\";\r\n        this._backBtn.downSoundName = \"sfx_ui_click_00\";\r\n        this._backBtn.signals.click.add(this._onBackButton_Click, this);\r\n        this._popupContainer.addChild(this._backBtn);\r\n\r\n        // Confirmation panel.\r\n        this._confirmationPanel = new ConfirmationPanel();\r\n        this._confirmationPanel.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._confirmationPanel.init();\r\n        this.addChild(this._confirmationPanel);\r\n\r\n        // Trash confirmation panel.\r\n        this._trashConfirmationPanel = new TrashConfirmationPanel();\r\n        this._trashConfirmationPanel.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._trashConfirmationPanel.init();\r\n        this.addChild(this._trashConfirmationPanel);\r\n\r\n        this.visible = false;\r\n        this.alpha = 0;\r\n    }\r\n\r\n    show() {\r\n        // Animate-in.\r\n        this.visible = true;\r\n        this._popupContainer.y = -50;\r\n        TweenMax.to(this, 0.25, {alpha: 1, ease: Quad.easeOut});\r\n        TweenMax.to(this._popupContainer, 0.25, {y: 0, ease: Quad.easeOut});\r\n\r\n        this._backBtn.alpha = 0;\r\n        this._backBtn.scale = new PIXI.Point();\r\n        TweenMax.to(this._backBtn, 0.25, {alpha: 1, ease: Sine.easeOut, delay: 0.2});\r\n        TweenMax.to(this._backBtn.scale, 0.5, {x: 1, y: 1, ease: Elastic.easeOut, delay: 0.2});\r\n\r\n        Common.game.scene.addTutorialEvent(CommonGame.TUT_EVENT.MENU_PANEL_SHOWN);\r\n    }\r\n\r\n    //----EVENTS----//\r\n\r\n    _onQuitButton_Click() {\r\n        this._confirmationPanel.signals.onYes.addOnce(\r\n            () => {\r\n                // Music.\r\n                Common.audio.stopMusic();\r\n                Common.audio.playMusic(\"music_mainmenu_loop_00\");\r\n\r\n                // Common.main.application.loadScene(CommonGame.SCENE_ID_IMAGE_SELECTION);\r\n                this._gameSceneSignals.previous.dispatch(this);\r\n            }, this);\r\n        this._confirmationPanel.show(Common.assets.getJSON(\"languages\").LEAVE_CONFIRMATION[Common.language]);\r\n    }\r\n\r\n    _onPrintButton_Click() {\r\n        // Sfx.\r\n        Common.audio.playSound(\"sfx_ui_newpage_00\");\r\n\r\n        this.visible = false;\r\n        Common.game.hud.visible = false;\r\n\r\n        //--timeout is needed. otherwise window.open returns null (according to SO must be initialised by a native event)--//\r\n        setTimeout(()=> {\r\n            var canvas = Common.renderer.extract.canvas(Common.game.canvas);\r\n            ;\r\n            if (myWindow) {\r\n                myWindow.document.body.appendChild(canvas);\r\n\r\n                var css = \"@page { size: landscape; margin-top: 1.4cm; margin-left: 2.3cm; }\";\r\n                var head = myWindow.document.head || myWindow.document.getElementsByTagName(\"head\")[0];\r\n                var style = document.createElement(\"style\");\r\n\r\n                style.type = \"text/css\";\r\n                style.media = \"print\";\r\n\r\n                if (style.styleSheet)\r\n                    style.styleSheet.cssText = css;\r\n                else\r\n                    style.appendChild(document.createTextNode(css));\r\n\r\n                head.appendChild(style);\r\n\r\n\r\n                myWindow.print();\r\n                myWindow.close();\r\n            } else {\r\n                console.error(\"unable to open new window\");\r\n                console.log(myWindow);\r\n            }\r\n\r\n            this.visible = true;\r\n            Common.game.hud.visible = true;\r\n        }, 2.5);\r\n\r\n    }\r\n\r\n    _onDownloadButton_Click() {\r\n        // Sfx.\r\n        Common.audio.playSound(\"sfx_ui_folder_save_00\");\r\n\r\n        this.visible = false;\r\n        Common.game.hud.visible = false;\r\n\r\n        setTimeout(()=> {\r\n            var canvas = Common.renderer.extract.canvas(Common.game.canvas);\r\n            ;\r\n            if (myWindow != null)\r\n                myWindow.document.body.appendChild(canvas);\r\n\r\n            this.visible = true;\r\n            Common.game.hud.visible = true;\r\n        }, 2.5);\r\n    }\r\n\r\n    _onSoundButton_Click() {\r\n        Common.isMute = !Common.isMute;\r\n\r\n        // TODO:\r\n        this._muteBtn._icon.texture = Common.assets.getTexture(Common.isMute ? \"icon_mute_off\" : \"icon_sound_off\");\r\n        this._muteBtn._currentIconTexture = this._muteBtn._icon.texture;\r\n\r\n        Common.audio.mute(Common.isMute);\r\n    }\r\n\r\n    _onBinButton_Click() {\r\n        this._trashConfirmationPanel.signals.onYes.addOnce(\r\n            function () {\r\n                // Sfx.\r\n                Common.audio.playSound(\"sfx_tool_trashcan_select_00\");\r\n\r\n                Common.game.canvas.clear();\r\n                Common.game.undoManager.clear();\r\n\r\n                this.visible = false;\r\n            }, this);\r\n        this._trashConfirmationPanel.show(Common.assets.getJSON(\"languages\").BIN_CONFIRMATION[Common.language]);\r\n    }\r\n\r\n    _onBackButton_Click() {\r\n        // Animate-out.\r\n        TweenMax.to(this, 0.25, {alpha: 0, ease: Quad.easeOut});\r\n        TweenMax.to(this._popupContainer, 0.25, {\r\n                y: 50,\r\n                ease: Quad.easeOut,\r\n                onComplete: function () {\r\n                    this.visible = false;\r\n                    Common.game.scene.addTutorialEvent(CommonGame.TUT_EVENT.MENU_PANEL_HIDDEN);\r\n                },\r\n                onCompleteScope: this\r\n            }\r\n        );\r\n    }\r\n}","\"use strict\";\r\n\r\nimport Common from \"../../Common\";\r\nimport CommonGame from \"../../CommonGame\";\r\n\r\nexport default class PalettePanel extends PIXI.Container {\r\n    constructor() {\r\n        super();\r\n\r\n        // Constants.\r\n        this.ITEMS_PER_ROW = 5;\r\n        this.ITEMS_PER_PAGE = 15;\r\n        this.PALETTE_TOOLS = Common.assets.getJSON(\"config\").palettePanel.tools;\r\n        this.PALETTE_TYPE_TO_TOOL = [\r\n            this.PALETTE_TOOLS.pencil,\r\n            this.PALETTE_TOOLS.brush,\r\n            this.PALETTE_TOOLS.stamp,\r\n            this.PALETTE_TOOLS.fill,\r\n            this.PALETTE_TOOLS.ink,\r\n            this.PALETTE_TOOLS.spray,\r\n            this.PALETTE_TOOLS.fill\r\n        ];\r\n\r\n        // Attributes.\r\n        this._bgGradientSprite = null;\r\n        this._panel = null;\r\n        this._boxSprite = null;\r\n        this._type = null;\r\n        this._nextBtn = null;\r\n        this._prevBtn = null;\r\n        this._pageIndex = 0;\r\n        this._pageCount = 0;\r\n        this._arrBtnInfo = [];\r\n\r\n        // Signals.\r\n        this.signals = {};\r\n        this.signals.onColourChanged = new signals.Signal();\r\n        this.signals.onStampChanged = new signals.Signal();\r\n    }\r\n\r\n    init() {\r\n        // Bg gradient sprite.\r\n        this._bgGradientSprite = new PIXI.Sprite(Common.blankTexture);\r\n        this._bgGradientSprite.tint = 0x000000;\r\n        this._bgGradientSprite.alpha = 0.6;\r\n        this._bgGradientSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._bgGradientSprite.scale.x = Common.STAGE_WIDTH * 1.25;\r\n        this._bgGradientSprite.scale.y = Common.STAGE_HEIGHT;\r\n        this._bgGradientSprite.interactive = true;\r\n        this._bgGradientSprite.click = this._bgGradientSprite.touchend = this.hide.bind(this);\r\n        this.addChild(this._bgGradientSprite);\r\n\r\n        // Panel.\r\n        this._panel = new PIXI.Container();\r\n        this.addChild(this._panel);\r\n\r\n        // Box sprite.\r\n        this._boxSprite = new PIXI.Sprite(Common.assets.getTexture(\"colour_palette_big_bg\"));\r\n        this._boxSprite.interactive = true;\r\n        this._boxSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._panel.addChild(this._boxSprite);\r\n\r\n        // Next button.\r\n        var btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_next_off\"),\r\n            Common.assets.getTexture(\"icon_next_over\"),\r\n            Common.assets.getTexture(\"icon_next_down\")\r\n        );\r\n        this._nextBtn = new P3.Button(btnStatesAux);\r\n        this._nextBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._nextBtn.scale = new PIXI.Point(1.5, 1.5);\r\n        this._nextBtn.defaultScale = new PIXI.Point(1.5, 1.5);\r\n        this._nextBtn.position.x = this._boxSprite.width * 0.5 + 50;\r\n        this._nextBtn.alpha = 0;\r\n        this._nextBtn.interactive = false;\r\n        this._nextBtn.signals.click.add(this._onNextButton_Click, this);\r\n        this._panel.addChild(this._nextBtn);\r\n\r\n        // Prev button.\r\n        btnStatesAux = new P3.ButtonStates(\r\n            Common.assets.getTexture(\"icon_next_off\"),\r\n            Common.assets.getTexture(\"icon_next_over\"),\r\n            Common.assets.getTexture(\"icon_next_down\")\r\n        );\r\n        this._prevBtn = new P3.Button(btnStatesAux);\r\n        this._prevBtn.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._prevBtn.scale = new PIXI.Point(-1.5, 1.5);\r\n        this._prevBtn.defaultScale = new PIXI.Point(-1.5, 1.5);\r\n        this._prevBtn.position.x = -this._boxSprite.width * 0.5 - 50;\r\n        this._prevBtn.alpha = 0;\r\n        this._prevBtn.interactive = false;\r\n        this._prevBtn.signals.click.add(this._onPrevButton_Click, this);\r\n        this._panel.addChild(this._prevBtn);\r\n\r\n        this.visible = false;\r\n    }\r\n\r\n    show(toolType) {\r\n        this._type = toolType;\r\n\r\n        this._arrBtnInfo = this._findItems(this._type);\r\n\r\n        this._pageIndex = 0;\r\n        this._updateNavControls();\r\n\r\n        this._createItems(this._arrBtnInfo);\r\n\r\n        // Animate-in.\r\n        this.visible = true;\r\n        this.alpha = 0;\r\n        this._panel.y = -50;\r\n        TweenMax.to(this._panel, 0.25, {y: 0, ease: Quad.easeOut});\r\n        TweenMax.to(this, 0.25, {alpha: 1, ease: Quad.easeOut});\r\n\r\n        // Sfx.\r\n        Common.audio.playSound(\"sfx_palette_select_00\");\r\n    }\r\n\r\n    changeType(toolType) {\r\n        if (this._type === toolType) return;\r\n\r\n        this._type = toolType;\r\n\r\n        this._removeItems();\r\n        this._pageIndex = 0;\r\n        this._arrBtnInfo = this._findItems(this._type);\r\n\r\n        this._updateNavControls();\r\n\r\n        this._createItems(this._arrBtnInfo);\r\n    }\r\n\r\n    hide() {\r\n        // Animate-out.\r\n        TweenMax.to(this._panel, 0.25, {y: 50, ease: Quad.easeOut});\r\n        TweenMax.to(this, 0.25, {\r\n            alpha: 0,\r\n            ease: Quad.easeOut,\r\n            onComplete: function () {\r\n                this.visible = false;\r\n\r\n                this._boxSprite.removeChildren();\r\n\r\n                // Tutorial\r\n                Common.game.scene.addTutorialEvent(CommonGame.TUT_EVENT.PALETTE_PANEL_HIDDEN);\r\n            },\r\n            onCompleteScope: this\r\n        });\r\n\r\n        // Sfx.\r\n        Common.audio.playSound(\"sfx_palette_close_00\");\r\n    }\r\n\r\n    _removeItems() {\r\n        for (var menuButton of this._boxSprite.children) {\r\n            menuButton.interactive = false;\r\n            TweenMax.to(menuButton.scale, 0.2, {\r\n                x: 0,\r\n                y: 0,\r\n                ease: Sine.easeIn,\r\n                delay: Math.random() * 0.2,\r\n                onComplete: function (menuBtn) {\r\n                    this._boxSprite.removeChild(menuBtn);\r\n                },\r\n                onCompleteScope: this,\r\n                onCompleteParams: [menuButton]\r\n            });\r\n        }\r\n    }\r\n\r\n    _findItems(paletteType) {\r\n        var result = [];\r\n\r\n        var PALETTE_PAGES = Common.assets.getJSON(\"config\").palettePanel.pages;\r\n        var arrPageIndex = this.PALETTE_TYPE_TO_TOOL[paletteType];\r\n\r\n        for (var pageIndex of arrPageIndex) {\r\n            result.push([]);\r\n            for (var item of PALETTE_PAGES[pageIndex]) {\r\n                if (item.indexOf(\"#\") == 0)\r\n                // Colour.\r\n                    result[result.length - 1].push({\r\n                        out: \"btns_colour_white\",\r\n                        over: \"btns_colour_white\",\r\n                        down: \"btns_colour_white\",\r\n                        tint: parseInt(\"0x\" + item.substring(1)),\r\n                        isShine: true\r\n                    });\r\n                else if (item.indexOf(CommonGame.TEXTURE_SPRITE_BASE_ID) != -1) {\r\n                    // Texture.\r\n                    var spriteId = CommonGame.TEXTURE_BUTTON_BASE_ID + item.substring(item.length - 2);\r\n                    result[result.length - 1].push({out: spriteId, over: spriteId, down: spriteId, isShine: true});\r\n                }\r\n                else\r\n                // Stamp.\r\n                    result[result.length - 1].push({out: item, over: item, down: item, isShine: false});\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    _createItems(arrBtnInfo) {\r\n        // Create buttons for the selected page.\r\n        var arrCurPageBtnInfo = this._arrBtnInfo[this._pageIndex];\r\n        var btnIndex = 0;\r\n        var colIndex = 0;\r\n        var rowIndex = 0;\r\n        var arcHeight = 7;\r\n        var rowCount = Math.ceil(arrCurPageBtnInfo.length / this.ITEMS_PER_ROW);\r\n        var startingX = -this._boxSprite.width * 0.5 + ( this._boxSprite.width - this._findItemCount(rowIndex, arrCurPageBtnInfo.length) * 135 + 125 ) * 0.5;\r\n        var startingY = -this._boxSprite.height * 0.5 + ( this._boxSprite.height - ( rowCount - 1 ) * 130 ) * 0.5;\r\n        // TODO: Set starting X and Y according to the number of items for the given row and the number of rows.\r\n        for (var btnInfo of arrCurPageBtnInfo) {\r\n            var btnStatesAux = new P3.ButtonStates(\r\n                Common.assets.getTexture(btnInfo.out),\r\n                Common.assets.getTexture(btnInfo.over),\r\n                Common.assets.getTexture(btnInfo.down));\r\n            var menuButton = new P3.Button(btnStatesAux);\r\n            menuButton.tint = btnInfo.tint != null ? btnInfo.tint : 0xffffff;\r\n            menuButton.anchor = new PIXI.Point(0.5, 0.5);\r\n            menuButton.x = startingX + colIndex * 135;\r\n            menuButton.y = startingY + rowIndex * 125;\r\n            if (colIndex % 2 != 0) {\r\n                menuButton.y += arcHeight;\r\n                arcHeight *= -1;\r\n            }\r\n            menuButton.index = btnIndex;\r\n            menuButton.signals.click.addOnce(this._onMenuButton_Click, this);\r\n            this._boxSprite.addChild(menuButton);\r\n\r\n            // Shine overlay.\r\n            if (btnInfo.isShine) {\r\n                var shineOverlay = new PIXI.Sprite(Common.assets.getTexture(\"btns_colour_overlay\"));\r\n                shineOverlay.anchor = new PIXI.Point(0.5, 0.5);\r\n                shineOverlay.alpha = 0.4;\r\n                shineOverlay.blendMode = PIXI.BLEND_MODES.ADD;\r\n                menuButton.addChild(shineOverlay);\r\n            }\r\n\r\n            ++btnIndex;\r\n\r\n            ++colIndex;\r\n            if (colIndex >= this.ITEMS_PER_ROW) {\r\n                colIndex = 0;\r\n                ++rowIndex;\r\n\r\n                startingX = -this._boxSprite.width * 0.5 + ( this._boxSprite.width - this._findItemCount(rowIndex, arrCurPageBtnInfo.length) * 135 + 125 ) * 0.5;\r\n            }\r\n\r\n            // Animate the button.\r\n            menuButton.scale = new PIXI.Point();\r\n            TweenMax.to(menuButton.scale, 0.2, {x: 1, y: 1, ease: Sine.easeOut, delay: Math.random() * 0.2});\r\n        }\r\n    }\r\n\r\n    _findItemCount(rowIndex, btnCount) {\r\n        let result = 0;\r\n\r\n        let remainingBtnCount = btnCount - rowIndex * this.ITEMS_PER_ROW;\r\n        if (remainingBtnCount / this.ITEMS_PER_ROW >= 1) result = this.ITEMS_PER_ROW;\r\n        else result = remainingBtnCount % this.ITEMS_PER_ROW;\r\n\r\n        return result;\r\n    }\r\n\r\n    _updateNavControls() {\r\n        if (this._prevBtn.alpha === 0) {\r\n            if (this._pageIndex > 0) {\r\n                TweenMax.to(this._prevBtn, 0.25, {alpha: 1, ease: Sine.easeOut});\r\n                this._prevBtn.interactive = true;\r\n            }\r\n        }\r\n        else {\r\n            if (this._pageIndex === 0) {\r\n                TweenMax.to(this._prevBtn, 0.25, {alpha: 0, ease: Sine.easeIn});\r\n                this._prevBtn.interactive = false;\r\n            }\r\n        }\r\n\r\n        if (this._nextBtn.alpha === 0) {\r\n            if (this._pageIndex < this._arrBtnInfo.length - 1) {\r\n                TweenMax.to(this._nextBtn, 0.25, {alpha: 1, ease: Sine.easeOut});\r\n                this._nextBtn.interactive = true;\r\n            }\r\n        }\r\n        else {\r\n            if (this._pageIndex === this._arrBtnInfo.length - 1) {\r\n                TweenMax.to(this._nextBtn, 0.25, {alpha: 0, ease: Sine.easeIn});\r\n                this._nextBtn.interactive = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    //----EVENTS----//\r\n\r\n    _onPageIndex_Changed() {\r\n        // Navigation controls.\r\n        this._updateNavControls();\r\n\r\n        // Menu buttons.\r\n        this._removeItems();\r\n        this._createItems(this._arrBtnInfo);\r\n    }\r\n\r\n    _onNextButton_Click() {\r\n        if (this._pageIndex < this._arrBtnInfo.length - 1) {\r\n            this._pageIndex += 1;\r\n\r\n            this._onPageIndex_Changed();\r\n        }\r\n    }\r\n\r\n    _onPrevButton_Click() {\r\n        if (this._pageIndex > 0) {\r\n            this._pageIndex -= 1;\r\n\r\n            this._onPageIndex_Changed();\r\n        }\r\n    }\r\n\r\n    _onMenuButton_Click(btn) {\r\n        switch (this._type) {\r\n            case CommonGame.TOOL.PENCIL:\r\n            case CommonGame.TOOL.BRUSH:\r\n            case CommonGame.TOOL.BUCKET:\r\n            case CommonGame.TOOL.INK_POT:\r\n            case CommonGame.TOOL.SPRAY:\r\n            {\r\n                this.signals.onColourChanged.dispatch(\r\n                    Common.assets.getJSON(\"config\").palettePanel.pages[this.PALETTE_TYPE_TO_TOOL[this._type][this._pageIndex]][btn.index],\r\n                    this.PALETTE_TYPE_TO_TOOL[this._type][this._pageIndex],\r\n                    btn.index);\r\n\r\n                break;\r\n            }\r\n\r\n            case CommonGame.TOOL.STAMP:\r\n            {\r\n                this.signals.onStampChanged.dispatch(\r\n                    Common.assets.getJSON(\"config\").palettePanel.pages[this.PALETTE_TYPE_TO_TOOL[this._type][this._pageIndex]][btn.index],\r\n                    this.PALETTE_TYPE_TO_TOOL[this._type][this._pageIndex],\r\n                    btn.index);\r\n\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.hide();\r\n\r\n        // Sfx.\r\n        Common.audio.playSound(\"sfx_generic_colour_type_change_00\");\r\n    }\r\n\r\n}\r\n","\"use strict\";\r\n\r\nimport Common from \"../../Common\";\r\nimport CommonGame from \"../../CommonGame\";\r\nimport ConfirmationPanel from \"./ConfirmationPanel\";\r\n\r\nexport default class TrashConfirmationPanel extends ConfirmationPanel {\r\n    constructor() {\r\n        super();\r\n\r\n        // Attributes.\r\n        this._canvasContainer = null;\r\n        this._trashBgSprite = null;\r\n        this._trashFgSprite = null;\r\n    }\r\n\r\n    init() {\r\n        super.init();\r\n        //  ConfirmationPanel.prototype.init.call(this);\r\n        this._messageText.y += 20;\r\n\r\n        // Trash bg sprite.\r\n        this._trashBgSprite = new PIXI.Sprite(Common.assets.getTexture(\"icon_replay_bg\"));\r\n        this._trashBgSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._trashBgSprite.y = this._messageText.y - 150;\r\n        this._messageSprite.addChild(this._trashBgSprite);\r\n\r\n        // Canvas container.\r\n        this._canvasContainer = new PIXI.Container();\r\n        this._canvasContainer.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._canvasContainer.scale = new PIXI.Point(0.11, 0.11);\r\n        this._canvasContainer.y = this._messageText.y - 250;\r\n        this._canvasContainer.rotation = Math.PI * 0.5;\r\n        this._messageSprite.addChild(this._canvasContainer);\r\n\r\n        this._canvasContainer.addChild(CommonGame.createCanvasBg());\r\n\r\n        let galleryKey = \"drawing\";\r\n        if (CommonGame.selectedGallery === 1) galleryKey = \"colouring\";\r\n\r\n        // Border.\r\n        var borderSprite = new PIXI.Sprite(Common.assets.getTexture(\"canvas_\" + galleryKey));\r\n        borderSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._canvasContainer.addChild(borderSprite);\r\n        // Sprite.\r\n        var contentSprite = new PIXI.Sprite(Common.blankTexture);\r\n        contentSprite.tint = 0xffffff;\r\n        contentSprite.width = CommonGame.CANVAS_WIDTH;\r\n        contentSprite.height = CommonGame.CANVAS_HEIGHT;\r\n        contentSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._canvasContainer.addChild(contentSprite);\r\n\r\n        // Trash fg sprite.\r\n        this._trashFgSprite = new PIXI.Sprite(Common.assets.getTexture(\"icon_replay_fg\"));\r\n        this._trashFgSprite.anchor = new PIXI.Point(0.5, 0.5);\r\n        this._trashFgSprite.x = this._trashBgSprite.x;\r\n        this._trashFgSprite.y = this._trashBgSprite.y;\r\n        this._messageSprite.addChild(this._trashFgSprite);\r\n    }\r\n\r\n    show(message) {\r\n        super.show(message);\r\n\r\n        this._canvasContainer.y = this._messageText.y - 250;\r\n        this._canvasContainer.alpha = 1;\r\n        this._trashFgSprite.scale = new PIXI.Point(1, 1);\r\n        this._trashBgSprite.scale = new PIXI.Point(1, 1);\r\n\r\n        TweenMax.to(this._canvasContainer, 1, {\r\n            y: this._trashBgSprite.y,\r\n            ease: Sine.easeOut,\r\n            repeat: -1,\r\n            repeatDelay: 0.5,\r\n            onRepeat: function () {\r\n                this._canvasContainer.alpha = 1;\r\n            },\r\n            onRepeatScope: this\r\n        });\r\n        TweenMax.to(this._canvasContainer, 0.5, {alpha: 0, ease: Sine.easeOut, repeat: -1, repeatDelay: 1, delay: 0.5});\r\n        TweenMax.fromTo(this._trashBgSprite.scale, 0.5, {x: 0.99, y: 0.99}, {\r\n            x: 1,\r\n            y: 1,\r\n            ease: Back.easeOut.config(100),\r\n            repeat: -1,\r\n            delay: 0.75,\r\n            repeatDelay: 1\r\n        });\r\n        TweenMax.fromTo(this._trashFgSprite.scale, 0.5, {x: 0.99, y: 0.99}, {\r\n            x: 1,\r\n            y: 1,\r\n            ease: Back.easeOut.config(100),\r\n            repeat: -1,\r\n            delay: 0.75,\r\n            repeatDelay: 1\r\n        });\r\n    }\r\n\r\n    _hide() {\r\n        super._hide();\r\n\r\n        TweenMax.killTweensOf(this._canvasContainer);\r\n        TweenMax.killTweensOf(this._trashBgSprite.scale);\r\n        TweenMax.killTweensOf(this._trashFgSprite.scale);\r\n    }\r\n}"],"sourceRoot":"./"}